// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./dijit/AGOLLoading ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e){function u(a,e){var b=d.clone(a),f=p.widgetProperties;"undefined"===typeof e&&(e=!1);delete b.mode;delete b.configWabVersion;p.visitElement(b,
function(a,g){a.widgets?(delete a.isOnScreen,delete a.gid,"jimu.js/images/group_icon.png"===a.icon&&delete a.icon,delete a.openType,g.isOnScreen&&a.panel&&p.isEqual(a.panel,b.widgetOnScreen.panel)&&delete a.panel):(a.icon&&a.icon===a.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete a.icon,delete a.panel,delete a.folderUrl,delete a.amdFolder,delete a.thumbnail,delete a.configFile,delete a.gid,delete a.isOnScreen,delete a.isRemote,delete a.featureActions,f.forEach(function(b){delete a[b]}),
e?"undefined"===typeof a.openAtStart&&(a.openAtStart=!1):(a.visible&&delete a.visible,a.manifest&&a.label===a.manifest.label&&delete a.label,a.isDefaultConfig&&(delete a.config,delete a.isDefaultConfig)),delete a.manifest,a.itemId&&delete a.uri)});delete b.rawAppConfig;delete b._ssl;delete b.getConfigElementById;delete b.getConfigElementsByName;delete b.processNoUriWidgets;delete b.addElementId;delete b.getCleanConfig;delete b.visitElement;delete b.agolConfig;delete b._itemData;delete b.oldWabVersion;
delete b.titleColor;return b}var v=null,x;x=r(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a){this.urlParams=a||{};this.listenBuilderEvents();this.versionManager=new n;this.widgetManager=h.getInstance();this.configLoader=k.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&d.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(c);
"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&d.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(c);p.isMobileUa()||q(window,"resize",d.hitch(this,this._onWindowResize));q(window,"orientationchange",d.hitch(this,this._onOrientationChange))},listenBuilderEvents:function(){c.subscribe("builder/widgetChanged",d.hitch(this,this._onWidgetChanged));c.subscribe("builder/groupChanged",d.hitch(this,this._onGroupChanged));c.subscribe("builder/layoutDefinitionChanged",
d.hitch(this,this._onLayoutDefinitionChanged));c.subscribe("builder/onScreenGroupsChanged",d.hitch(this,this._onOnScreenGroupsChanged));c.subscribe("builder/widgetPoolChanged",d.hitch(this,this._onWidgetPoolChanged));c.subscribe("builder/openAtStartChange",d.hitch(this,this._onOpenAtStartChanged));c.subscribe("builder/onScreenOrderChanged",d.hitch(this,this._onScreenOrderChanged));c.subscribe("builder/mapContentModified",d.hitch(this,this._onMapContentModified));c.subscribe("builder/mapChanged",d.hitch(this,
this._onMapChanged));c.subscribe("builder/mapOptionsChanged",d.hitch(this,this._onMapOptionsChanged));c.subscribe("builder/mapRefreshIntervalChanged",d.hitch(this,this._onMapRefreshIntervalChanged));c.subscribe("builder/appAttributeChanged",d.hitch(this,this._onAppAttributeChanged));c.subscribe("builder/dataSourceChanged",d.hitch(this,this._onDataSourceChanged));c.subscribe("builder/setAppConfig",d.hitch(this,this._onAppConfigSet));c.subscribe("builder/themeChanged",d.hitch(this,this._onThemeChanged));
c.subscribe("builder/layoutChanged",d.hitch(this,this._onLayoutChanged));c.subscribe("builder/styleChanged",d.hitch(this,this._onStyleChanged));c.subscribe("builder/syncExtent",d.hitch(this,this._onSyncExtent));c.subscribe("builder/loadingPageChanged",d.hitch(this,this._onLoadingPageChanged));c.subscribe("builder/templateConfigChanged",d.hitch(this,this._onTemplateConfigChanged));c.subscribe("builder/appProxyForMapChanged",d.hitch(this,this._onAppProxyForMapChanged));c.subscribe("builder/appProxyForUrlChanged",
d.hitch(this,this._onAppProxyForUrlChanged));c.subscribe("builder/sharedThemeChanged",d.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==this.urlParams.mode&&"config"!==this.urlParams.mode){var a=new g;a.placeAt(window.jimuConfig.layoutId);return this.configLoader.loadConfig().then(d.hitch(this,function(b){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(b);console.timeEnd("Load Config");window.appInfo.isRunInMobile=p.inMobileSize();b=
this.getAppConfig();a.destroy();c.publish("appConfigLoaded",b);return b}),d.hitch(this,function(b){a.destroy();console.error(b);b&&b.message&&"string"===typeof b.message&&this._showErrorMessage(b.message)}))}},_showErrorMessage:function(a){l.create("div",{"class":"app-error",innerHTML:p.sanitizeHTML(a)},document.body)},getAppConfig:function(){var a;window.appInfo.isRunInMobile?(a=d.clone(this._getMobileConfig(this.appConfig)),a._originConfig=d.clone(this.appConfig)):a=d.clone(this.appConfig);a.getConfigElementById=
function(a){return p.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return p.getConfigElementsByName(this,a)};a.getCleanConfig=function(a){return this._originConfig?u(this._originConfig,a):u(this,a)};a.visitElement=function(a){p.visitElement(this,a)};return a},_onOrientationChange:function(){this.appConfig&&c.publish("appConfigChanged",this.getAppConfig(),"layoutChange")},_onWindowResize:function(){var a=p.inMobileSize();window.appInfo.isRunInMobile!==a&&(window.appInfo.isRunInMobile=
a,this.appConfig&&c.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_getMobileConfig:function(a){return p.mixinAppConfigPosition(a,a.mobileLayout)},_updateDataSourceForWidget:function(a){this._deleteDataSourcesFromWidget(a);this._addDataSourcesForWidget(a)},_deleteDataSourcesFromWidget:function(a){for(var b in this.appConfig.dataSource.dataSources)b.startWith("widget~"+a.id+"~")&&delete this.appConfig.dataSource.dataSources[b]},_addDataSourcesForWidget:function(a){m.forEach(a.provideDataSources,
function(b){var e="widget~"+a.id+"~"+b.id;b.id=e;this.appConfig.dataSource.dataSources[e]=b},this);delete a.provideDataSources},_addIdForWidgets:function(a){var b=0,e;this.getAppConfig().visitElement(function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var f=a.id.lastIndexOf("_");-1<f&&(e=a.id.substr(f+1),b=Math.max(b,e))}});m.forEach(a,function(a){a.id||(b++,a.id=a.itemId?a.itemId+"_"+b:a.uri?a.uri.replace(/\//g,"_")+"_"+b:"_"+b)})},_onWidgetChanged:function(a){var b=p.reCreateObject(a);a=p.getConfigElementById(this.appConfig,
a.id);this._updateDataSourceForWidget(b);!1!==b.inPanel||a.uri||(b.closeable=!0);for(var e in b)a[e]=b[e];delete a.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"widgetChange",b)},_onGroupChanged:function(a){var b=p.reCreateObject(a);a=p.getConfigElementById(this.appConfig,a.id);this._handleDataSourceForWidgets(a,b);for(var e in b)a[e]=b[e];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
c.publish("appConfigChanged",this.getAppConfig(),"groupChange",b)},_handleDataSourceForWidgets:function(a,b){var e=m.filter(b.widgets,function(b){return b.id?0===m.filter(a.widgets,function(a){return b.id===a.id}).length:!0},this);this._addIdForWidgets(e);m.forEach(e,function(a){this._addDataSourcesForWidget(a)},this);e=m.filter(a.widgets,function(a){return 0===m.filter(b.widgets,function(b){return b.id===a.id}).length},this);m.forEach(e,function(a){this._deleteDataSourcesFromWidget(a)},this);m.forEach(b.widgets,
function(b){m.forEach(a.widgets,function(a){b.id===a.id&&b.provideDataSources&&this._updateDataSourceForWidget(b)},this)},this)},_onWidgetPoolChanged:function(a){var b=p.reCreateObject(a);this._handleDataSourceForWidgetsSection(this.appConfig.widgetPool,b);1===this.widgetManager.getControllerWidgets().length?(this.appConfig.widgetPool.widgets=b.widgets,this.appConfig.widgetPool.groups=b.groups):(a=p.getConfigElementById(this.appConfig,b.controllerId),m.forEach(a.controlledWidgets,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,
a)},this),m.forEach(a.controlledGroups,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this),this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?b.widgets:this.appConfig.widgetPool.widgets.concat(b.widgets),this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?b.groups:this.appConfig.widgetPool.groups.concat(b.groups),a.controlledWidgets=m.map(b.widgets,function(a){return a.id}),a.controlledGroups=m.map(b.groups,
function(a){return a.id}));this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(d.hitch(this,function(a){this.appConfig=a;this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",b)}))},_handleDataSourceForWidgetsSection:function(a,b){var e=b.widgets;m.forEach(b.groups,function(a){e=e.concat(a.widgets)},this);var f=a.widgets;m.forEach(a.groups,function(a){f=f.concat(a.widgets)},this);
this._handleDataSourceForWidgets({widgets:f},{widgets:e})},_removeWidgetOrGroupFromPoolById:function(a,b){m.some(a.widgetPool.widgets,function(e,f){if(e.id===b)return a.widgetPool.widgets.splice(f,1),!0});m.some(a.widgetPool.groups,function(e,f){if(e.id===b)return a.widgetPool.groups.splice(f,1),!0})},_onOpenAtStartChanged:function(a){var b=p.reCreateObject(a),e=this.appConfig;a.isOnScreen?(e=e.widgetOnScreen&&e.widgetOnScreen.widgets)&&0<e.length&&m.forEach(e,d.hitch(this,function(b){b.id===a.id?
b.openAtStart=!b.openAtStart:delete b.openAtStart})):((e=e.widgetPool)&&e.groups&&0<e.groups.length&&m.forEach(e.groups,d.hitch(this,function(b){b.id===a.id?b.openAtStart=!b.openAtStart:delete b.openAtStart})),e&&e.widgets&&0<e.widgets.length&&m.forEach(e.widgets,d.hitch(this,function(b){b.id===a.id?b.openAtStart=!b.openAtStart:delete b.openAtStart})));c.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",b)},_onScreenOrderChanged:function(a){var b=p.reCreateObject(a);m.forEach(this.appConfig.widgetOnScreen.widgets,
function(a){a.isController||(!1!==a.inPanel||!0!==a.closeable)&&!0!==a.inPanel&&a.uri||m.some(b,function(b){if(a.id===b.id)return a.position=b.position,!0})},this);c.publish("appConfigChanged",this.getAppConfig(),"onScreenOrderChange",b)},_onAppAttributeChanged:function(a){a=p.reCreateObject(a);d.mixin(this.appConfig,a);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),
"attributeChange",a)},_onDataSourceChanged:function(a){var b=p.reCreateObject(a);this.appConfig.dataSource=b;c.publish("appConfigChanged",this.getAppConfig(),"dataSourceChange",a)},_onLoadingPageChanged:function(a){a=p.reCreateObject(a);var b;"backgroundColor"in a?this.appConfig.loadingPage.backgroundColor=a.backgroundColor:"backgroundImage"in a?(b=this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=d.mixin(b,a.backgroundImage)):"loadingGif"in a&&(b=this.appConfig.loadingPage.loadingGif||
{},this.appConfig.loadingPage.loadingGif=d.mixin(b,a.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",a)},_onAppProxyForMapChanged:function(a){a=p.reCreateObject(a);"appProxy"in this.appConfig.map?this.appConfig.map.appProxy.mapItemId!==a.mapItemId?this.appConfig.map.appProxy=a:m.forEach(a.proxyItems,d.hitch(this,function(a){if(!m.some(this.appConfig.map.appProxy.proxyItems,function(b){if(b.sourceUrl===
a.sourceUrl)return b.useProxy=a.useProxy,b.proxyUrl=a.proxyUrl||"",b.proxyId=a.proxyId||"",isNaN(a.hitsPerInterval)||(b.hitsPerInterval=a.hitsPerInterval),isNaN(a.intervalSeconds)||(b.intervalSeconds=a.intervalSeconds),!0})&&a.useProxy&&a.proxyUrl){var b=this.appConfig.map.appProxy.proxyItems||[];b.push(a);this.appConfig.map.appProxy.proxyItems=b}})):this.appConfig.map.appProxy=a;c.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",a)},_onAppProxyForUrlChanged:function(a){a=p.reCreateObject(a);
this.appConfig.appProxies=a;c.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",a)},_onTemplateConfigChanged:function(a){a=p.reCreateObject(a);this.appConfig.templateConfig=a;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",a)},_onMapContentModified:function(){c.publish("mapContentModified")},_onMapChanged:function(a){var b=p.reCreateObject(a);this.appConfig.map.mapOptions&&
p.deleteMapOptions(this.appConfig.map.mapOptions);this.appConfig.map.mapRefreshInterval={useWebMapRefreshInterval:!0};d.mixin(this.appConfig.map,b);this._deleteDataSourcesFromMap();this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(d.hitch(this,function(a){this.appConfig=a;this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"mapChange",b)}))},_deleteDataSourcesFromMap:function(){m.forEach(Object.keys(this.appConfig.dataSource.dataSources),
function(a){a.startWith("map")&&delete this.appConfig.dataSource.dataSources[a]},this)},_onMapOptionsChanged:function(a){a=p.reCreateObject(a);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});d.mixin(this.appConfig.map.mapOptions,a);c.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",a)},_onMapRefreshIntervalChanged:function(a){a=p.reCreateObject(a);this.appConfig.map.mapRefreshInterval||(this.appConfig.map.mapRefreshInterval={});d.mixin(this.appConfig.map.mapRefreshInterval,
a);this.appConfig.map.mapRefreshInterval.useWebMapRefreshInterval&&delete this.appConfig.map.mapRefreshInterval.minutes;c.publish("appConfigChanged",this.getAppConfig(),"mapRefreshIntervalChange",a)},_onThemeChanged:function(a){this._getAppConfigFromTheme(a).then(d.hitch(this,function(b){var e=d.clone(this.appConfig.widgetOnScreen);this.appConfig=b;this._handleDataSourceForWidgetsSection(e,{});c.publish("appConfigChanged",this.getAppConfig(),"themeChange",a.getName())}))},_onLayoutChanged:function(a){this.appConfig=
p.mixinAppConfigPosition(this.appConfig,a.layoutConfig);this.appConfig.layoutDefinition=a.layoutConfig.layoutDefinition;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"layoutChange",a.name)},_onStyleChanged:function(a){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,a.name);a.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:a.styleColor}:(delete this.appConfig.theme.customStyles,
delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme={isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});c.publish("appConfigChanged",this.getAppConfig(),"styleChange",a.name)},_onOnScreenGroupsChanged:function(a){a=p.reCreateObject(a);this.appConfig.widgetOnScreen.groups=a.groups;c.publish("appConfigChanged",this.getAppConfig(),"onScreenGroupsChange",a.groups)},_onLayoutDefinitionChanged:function(a){a=p.reCreateObject(a);p.isEqual(this.appConfig.layoutDefinition,
a.layoutDefinition)||(this.appConfig.layoutDefinition=a.layoutDefinition,this.appConfig.widgetOnScreen.groups=p.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,a.groupIds),this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),c.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",a.layoutDefinition))},_onSharedThemeChanged:function(a){var b=this.appConfig.theme.sharedTheme;a=p.reCreateObject(a);a.useHeader&&!b.useHeader&&
(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));!a.useHeader&&b.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));
a.useLogo&&!b.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!a.useLogo&&b.useLogo&&
this._onAppAttributeChanged({logo:this.appConfig.logo});d.mixin(b,a);c.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",a)},_onSyncExtent:function(a){c.publish("syncExtent",a)},_genStyles:function(a,b){var e=[];e.push(b);m.forEach(a,function(a){0>e.indexOf(a)&&e.push(a)});return e},_getAppConfigFromTheme:function(a){var b=new t,e,f=[],g=this.getAppConfig().getCleanConfig();g.mode=this.urlParams.mode;m.forEach(g.widgetPool.groups,function(a){delete a.panel},this);if(a.appConfig)e=
d.clone(a.appConfig),e.map=g.map,e.map.position=a.appConfig.map.position,this._copyPoolToThemePool(g,e),e.links=g.links,e.title=g.title,e.subtitle=g.subtitle,e.logo=g.logo;else{var k=a.getCurrentLayout(),f=a.getCurrentStyle();e=d.clone(g);k=d.clone(k.layoutConfig);e.widgetOnScreen=k.widgetOnScreen;k.widgetPool&&(m.forEach(k.widgetPool.widgets,function(a){a.isPreconfiguredInTheme=!0}),m.forEach(k.widgetPool.groups,function(a){a.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(g,k);e.widgetPool=
k.widgetPool;k.map&&k.map.position&&(e.map.position=k.map.position);e.mobileLayout=k.mobileLayout;e.layoutDefinition=k.layoutDefinition;f=this._genStyles(m.map(a.getStyles(),function(a){return a.name}),f.name);e.theme={name:a.getName(),styles:f,version:a.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(e.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},e.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):
(e.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},e.theme.customStyles={mainBackgroundColor:""});e.titleColor=g.titleColor;e.logoLink=g.logoLink}this.configLoader.addNeedValues(e);this.configLoader.loadWidgetsManifest(e).then(d.hitch(this,function(a){return this.configLoader.loadAndUpgradeAllWidgetsConfig(a)})).then(d.hitch(this,function(){this._addDefaultValues(e);b.resolve(e)}));return b},_copyPoolToThemePool:function(a,b){var e=a.widgetPool;b.widgetPool||(b.widgetPool={});a=b.widgetPool;
var f=m.filter(a.widgets,function(a){if(a.isPreconfiguredInTheme||!m.some(e.widgets,function(b){return b.name===a.name}))return!0}),g=m.filter(a.groups,function(a){return a.isPreconfiguredInTheme}),k=m.filter(e.widgets,function(a){return!a.isPreconfiguredInTheme}),h=m.filter(e.groups,function(a){return!a.isPreconfiguredInTheme}),k=this._getPoolWidgetsWithoutDuplicated(k,b.widgetOnScreen.widgets||[]);a.widgets=k.concat(f);a.groups=h.concat(g)},_getPoolWidgetsWithoutDuplicated:function(a,b){for(var e=
d.clone(a),f=this.getAppConfig(),g=a.length-1;0<=g;g--)for(var k=b.length-1;0<=k;k--)if(b[k].uri){var h=b[k].name;h||(h=p.getWidgetNameFromUri(b[k].uri));var u=f.getConfigElementById(a[g].id);a[g]&&a[g].name===h&&!1===u.supportMultiInstance&&(console.log("Widget",a[g].name,"is not copied to new theme because this widget exists in new theme."),e.splice(g,1))}return e},_onAppConfigSet:function(b){b=p.reCreateObject(b);window.appInfo.isRunInMobile=p.inMobileSize();this.configLoader.processProxy(b);this.configLoader.addNeedValues(b);
this.configLoader.loadAndUpgradeAllWidgetsConfig(b).then(d.hitch(this,function(b){this._addDefaultValues(b);a.setPortalUrl(b.portalUrl);window.portalUrl=b.portalUrl;this.appConfig?(p.deleteMapOptions(b.map.mapOptions),this.appConfig=b,this._deleteDataSourcesFromMap(),c.publish("appConfigChanged",this.getAppConfig(),"resetConfig",b)):(this.appConfig=b,f.getPortal(b.portalUrl).loadSelfInfo().then(d.hitch(this,function(a){this.portalSelf=a;c.publish("appConfigLoaded",this.getAppConfig())})))}))},_addDefaultValues:function(a){this._addDefaultPortalUrl(a);
this._addDefaultGeometryService(a);this._addDefaultStyle(a);this._addDefaultMap(a);this._addDefaultVisible(a);this._addDefaultDataSource(a);this._addDefaultSharedTheme(a);"undefined"===typeof a.widgetOnScreen&&(a.widgetOnScreen={});"undefined"===typeof a.widgetPool&&(a.widgetPool={});this._addDefaultPanelAndPosition(a);this._addDefaultOfWidgetGroup(a);(a.widgetPool.widgets&&0<a.widgetPool.widgets.length&&void 0===a.widgetPool.widgets[0].index||a.widgetPool.groups&&0<a.widgetPool.groups.length&&void 0===
a.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(a);return a},_addDefaultDataSource:function(a){a.dataSource?(a.dataSource.dataSources||(a.dataSource.dataSources={}),a.dataSource.settings||(a.dataSource.settings={})):a.dataSource={dataSources:{},settings:{}}},_addDefaultPortalUrl:function(a){"undefined"===typeof a.portalUrl&&(a.portalUrl="http://www.arcgis.com/");a.portalUrl&&"/"!==a.portalUrl.substr(a.portalUrl.length-1)&&(a.portalUrl+="/")},_addDefaultGeometryService:function(a){var f=
a&&a.geometryService,f=f&&"string"===typeof f&&d.trim(f)?d.trim(f):this.portalSelf.helperServices.geometry.url;a.geometryService=f;b.defaults.geometryService=new e(a.geometryService)},_addDefaultStyle:function(a){!a.theme||a.theme.styles&&0!==a.theme.styles.length||(a.theme.styles=["default"])},_addDefaultMap:function(a){a.map.id="map";"undefined"===typeof a.map["3D"]&&"undefined"===typeof a.map["2D"]&&(a.map["2D"]=!0);"undefined"===typeof a.map.position&&(a.map.position={left:0,right:0,top:0,bottom:0});
"undefined"===typeof a.map.portalUrl&&(a.map.portalUrl=a.portalUrl)},_addDefaultVisible:function(a){p.visitElement(a,function(a){void 0===a.visible&&(a.visible=!0)})},_addDefaultSharedTheme:function(a){a.theme.sharedTheme?("undefined"===typeof a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.useHeader=!1),"undefined"===typeof a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.useLogo=!1)):a.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(a){this._addOnScreenDefaultPanelAndPosition(a);
this._addPoolDefaultPanelAndPosition(a)},_addOnScreenDefaultPanelAndPosition:function(a){var b,e;if(a=a.widgetOnScreen){b=a.panel&&a.panel.positionRelativeTo?a.panel.positionRelativeTo:"map";"undefined"===typeof a.panel||"undefined"===typeof a.panel.uri?a.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof a.panel.position?a.panel.position={relativeTo:b}:"undefined"===typeof a.panel.position.relativeTo&&(a.panel.position.relativeTo=b);if(a.widgets)for(b=0;b<a.widgets.length;b++)a.widgets[b].position||
(a.widgets[b].position={}),a.widgets[b].position.relativeTo||(a.widgets[b].position.relativeTo=a.widgets[b]&&a.widgets[b].positionRelativeTo?a.widgets[b].positionRelativeTo:"map"),!0!==a.widgets[b].inPanel||a.widgets[b].panel||(a.widgets[b].panel=d.clone(a.panel),a.widgets[b].panel.position=a.widgets[b].position,a.widgets[b].panel.position.relativeTo=a.widgets[b].position.relativeTo);if(a.groups)for(b=0;b<a.groups.length;b++)for(a.groups[b].panel||(a.groups[b].panel=a.panel),a.groups[b].panel&&!a.groups[b].panel.position&&
(a.groups[b].panel.position={}),a.groups[b].panel.position.relativeTo||(a.groups[b].panel.position.relativeTo=a.groups[b].panel.positionRelativeTo?a.groups[b].panel.positionRelativeTo:"map"),a.groups[b].widgets||(a.groups[b].widgets=[]),e=0;e<a.groups[b].widgets.length;e++)a.groups[b].widgets[e].panel=a.groups[b].panel}},_addPoolDefaultPanelAndPosition:function(a){var b,e,f=a.widgetPool;if(f){b=f.panel&&f.panel.positionRelativeTo?f.panel.positionRelativeTo:"map";"undefined"===typeof f.panel||"undefined"===
typeof f.panel.uri?f.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof f.panel.position?f.panel.position={relativeTo:b}:"undefined"===typeof f.panel.position.relativeTo&&(f.panel.position.relativeTo=b);if(f.groups)for(b=0;b<f.groups.length;b++)for(f.groups[b].panel?f.groups[b].panel.position.relativeTo||(f.groups[b].panel.position.relativeTo=f.groups[b].panel.positionRelativeTo?f.groups[b].panel.positionRelativeTo:"map"):f.groups[b].panel=f.panel,f.groups[b].widgets||
(f.groups[b].widgets=[]),e=0;e<f.groups[b].widgets.length;e++)f.groups[b].widgets[e].panel=f.groups[b].panel;if(f.widgets)for(b=0;b<f.widgets.length;b++)!1===f.widgets[b].inPanel?(e=f.widgets[b].positionRelativeTo?f.widgets[b].positionRelativeTo:"map",f.widgets[b].position)?f.widgets[b].position.relativeTo||(f.widgets[b].position.relativeTo=e):f.widgets[b].position={relativeTo:e}:f.widgets[b].panel||(f.widgets[b].panel=a.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(a){p.visitElement(a,d.hitch(this,
function(a,b){a.isOnScreen=b.isOnScreen;a.widgets?(a.gid=a.id,1===a.widgets.length?(a.label||(a.label=a.widgets[0].label?a.widgets[0].label:window.apiNls.common.groupLabel),a.icon||(a.icon=a.widgets[0].uri?this._getDefaultIconFromUri(a.widgets[0].uri):"jimu.js/images/group_icon.png")):(a.icon=a.icon?a.icon:"jimu.js/images/group_icon.png",a.label=a.label?a.label:window.apiNls.common.groupLabel+" "+b.index)):a.gid=b.groupId}))},_getDefaultIconFromUri:function(a){a=a.split("/");a.pop();return a.join("/")+
"/images/icon.png?wab_dv\x3d"+window.deployVersion},_addIndexForWidgetPool:function(a){var b=0,e,f;if(a.widgetPool.widgets)for(e=0;e<a.widgetPool.widgets.length;e++)a.widgetPool.widgets[e].index=b,b++;if(a.widgetPool.groups)for(e=0;e<a.widgetPool.groups.length;e++)for(a.widgetPool.groups[e].index=b,b++,f=0;f<a.widgetPool.groups[e].widgets.length;f++)a.widgetPool.groups[e].widgets[f].index=f}});x.getInstance=function(a){null===v?v=new x(a):a&&(v.urlParams=a,v.configLoader&&(v.configLoader.urlParams=
a));window.getAppConfig=d.hitch(v,v.getAppConfig);return v};return x})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/tasks/FeatureSet esri/symbols/PictureMarkerSymbol esri/urlUtils esri/request esri/tasks/query esri/tasks/QueryTask esri/graphicsUtils jimu/portalUrlUtils ./shared/utils ./zoomToUtils".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z,A,E,y,C,F,B,G,H,L,J,K,I,O,P,R,N,Q,M){function V(a,b){a=a||"";var e=0,f=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!w.file.isEnabledFlash(),failure:[a+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){e++;e===f.length&&b()}}];for(a=0;a<f.length;a++)testLoad(f[a])}function X(a,b){var e=a.match(/url\([^)]+\)/gi),f,g;if(null===e||""===b)return a;for(f=0;f<e.length;f++)if(g=e[f].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),
4<=g.length){var k=g[2];/^data:image\/.*;/.test(k)||(b.endWith("/")||(b+="/"),a=a.replace(g[1]+k+g[3],g[1]+b+k+g[3]))}return a}function T(a,b){var e=Array.isArray(b),f=e&&[]||{};e?(a=a||[],f=f.concat(a),b.forEach(function(b,e){"undefined"===typeof a[e]?f[e]=b:"object"===typeof b?f[e]=T(a[e],b):-1===a.indexOf(b)&&f.push(b)})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(b){f[b]=a[b]}),Object.keys(b).forEach(function(e){f[e]="object"===typeof b[e]&&b[e]?a[e]?T(a[e],b[e]):b[e]:b[e]}));return f}
function Z(a,b){var e=a.map(function(a){return a.id});d.forEach(b,function(b){0>e.indexOf(b)&&a.push({id:b,widgets:[]})},this);var f=[];a=d.filter(a,function(a){return 0>b.indexOf(a.id)?(f.push(a),!1):!0},this);if(0===a.length)return[];var g=a[a.length-1];d.forEach(f,function(a){g.widgets=g.widgets.concat(a.widgets)},this);return a=a.sort(function(a,e){return b.indexOf(a.id)-b.indexOf(e.id)})}function W(a,b,e){function f(a,b){return r.isArray(a[b.key])?a[b.key][b.index]:a[b.key]}b=function(a){var b=
[];a.split("_").forEach(function(a){var e=!1,f;"--"===a.slice(a.length-2)&&(e=!0,a=a.slice(0,a.length-2));f=a.search(/\[[0-9]+\]/);-1===f&&(f=a.length);b.push({key:a.slice(0,f),index:Number(a.slice(f+1,-1)),deleteFlag:e})});return b}(b);for(var g=1;g<b.length-1;g++)if(a=f(a,b[g]),!a)return;if(b[b.length-1].deleteFlag)!0===e&&(r.isArray(a[b[b.length-1].key])?delete a[b[b.length-1].key][b[b.length-1].index]:delete a[b[b.length-1].key]);else if(r.isArray(a[b[b.length-1].key])){if(void 0===e)return a[b[b.length-
1].key][b[b.length-1].index];a[b[b.length-1].key][b[b.length-1].index]=e}else{if(void 0===e)return a[b[b.length-1].key];a[b[b.length-1].key]=e}}function Y(a,b,e){function f(e){e=w.template.getSearchRange(b,e,"]");var f=b.slice(e.firstPos,e.lastPos);return-1!==e.firstPos?(f=b.slice(e.firstPos+f.indexOf("[")+1,e.lastPos-1),e=b.slice(e.lastPos+1),(f=w.getConfigElementById(a,f))?{object:f,key:"section_"+e,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var g=a,k=b=b.replace(/\//g,"_"),h=
f("groups\\[.+\\]");if("deleted"!==h.state&&("isSection"===h.state&&(g=h.object,k=h.key),h=f("widgets\\[.+\\]"),"delete"!==h.state))return"isSection"===h.state&&(g=h.object,k=h.key),W(g,k,e)}var w={},U={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};r.mixin(w,Q);r.mixin(w,M);window.atob||(window.atob=function(a){a=u.decode(a);for(var b="",e=0,f=a.length;e<f;e++)b+=String.fromCharCode(a[e]);return b});window.btob||(window.btob=function(a){for(var b=
[],e=0,f=a.length;e<f;e++)b.push(String.charCodeAt(a[e]));return u.encode(b)});var S="unload",ea=[];require.on("error",function(a){d.forEach(ea,function(b){a.info[0]&&-1<a.info[0].indexOf(b.resKey)&&b.def.reject(a);for(var e in a.info)-1<e.indexOf(b.resKey)&&b.def.reject(a)})});w.checkError=function(a,b){ea.push({resKey:a,def:b})};w.replacePlaceHolder=function(b,e){var f=a.stringify(b),g=f.match(/\$\{(\w)+\}/g);if(null===g)return b;for(b=0;b<g.length;b++){var k=g[b].match(/(\w)+/g)[0];e[k]&&(f=f.replace(g[b],
e[k]))}return a.parse(f)};w.changeUnit=function(a){var b=Math.abs(a),e;a=Math.floor(b);e=Math.floor(60*(b-a));b=(60*(60*(b-a)-e)).toFixed(2);return a+"\u00b0"+(10>e?"0"+e:e)+"'"+(10>b?"0"+b:b)+'"'};w.formatTime=function(a){var b=a/1E3;a=Math.floor(b/60);b=Number(b-60*a).toFixed(1);return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)};w.parseTime=function(a){var b=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!b.test(a))return console.log("wrong time format."),-1;a=a.match(b);return 1E3*(60*parseInt(a[1],10)+parseInt(a[2],10)+
parseInt(a[3],10)/10)};w.preloadImg=function(a,b){var e=[],e="string"===typeof a?[a]:a;d.forEach(e,function(a){(new Image).src=b?b+a:a})};var ba=null;w.getImagesSize=function(a){var b=new h;if(!a||0!==a.indexOf("http"))return b.reject(),b;null===ba&&(ba=m.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var e=k(ba,"load",function(){clearTimeout(f);f=null;e.remove();var a=m.getContentBox(ba);1===a.w&&1===a.h||0===a.w||0===a.h?b.reject():
b.resolve([a.w,a.h])},{}),f=setTimeout(function(){clearTimeout(f);f=null;b.reject()},5E3);m.setAttr(ba,"src",a);return b};w.getPositionStyle=function(a){var b={};if(!a)return b;a=r.clone(a);if(window.isRTL){var e;"undefined"!==typeof a.left&&"undefined"!==typeof a.right?(e=a.left,a.left=a.right,a.right=e):"undefined"!==typeof a.left?(a.right=a.left,delete a.left):"undefined"!==typeof a.right&&(a.left=a.right,delete a.right);"undefined"!==typeof a.paddingLeft&&"undefined"!==typeof a.paddingRight?(e=
a.paddingLeft,a.paddingLeft=a.paddingRight,a.paddingRight=e):"undefined"!==typeof a.paddingLeft?(a.paddingRight=a.paddingLeft,delete a.paddingLeft):"undefined"!==typeof a.paddingRight&&(a.paddingLeft=a.paddingRight,delete a.paddingRight)}e="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom".split(" ");for(var f=0;f<e.length;f++){var g=e[f];"number"===typeof a[g]?b[g]=a[g]+"px":"undefined"!==typeof a[g]?b[g]=a[g]:"padding"===g.substr(0,7)?b[g]=0:b[g]="auto"}b.zIndex=
"undefined"===typeof a.zIndex?"auto":a.zIndex;return b};w.isEqual=function(a,b){function e(a,b){var k;if(null===a&&null===b||"undefined"===typeof a&&"undefined"===typeof b)return!0;if(null===a&&null!==b||null===b&&null!==a||"undefined"===typeof a&&"undefined"!==typeof b||"undefined"===typeof b&&"undefined"!==typeof a)return!1;if(isNaN(a)&&isNaN(b)&&"number"===typeof a&&"number"===typeof b||a===b)return!0;if("function"===typeof a&&"function"===typeof b||a instanceof Date&&b instanceof Date||a instanceof
RegExp&&b instanceof RegExp||a instanceof String&&b instanceof String||a instanceof Number&&b instanceof Number)return a.toString()===b.toString();if(-1<f.indexOf(a)||-1<g.indexOf(b))return!1;if(null!==b){for(k in b)if(b.hasOwnProperty(k)!==a.hasOwnProperty(k)||typeof b[k]!==typeof a[k])return!1;for(k in a){if(b.hasOwnProperty(k)!==a.hasOwnProperty(k)||typeof b[k]!==typeof a[k])return!1;switch(typeof a[k]){case "object":case "function":f.push(a);g.push(b);if(!e(a[k],b[k]))return!1;f.pop();g.pop();
break;default:if(!(isNaN(a[k])&&isNaN(b[k])&&"number"===typeof a[k]&&"number"===typeof b[k]||a[k]===b[k]))return!1}}}return!0}var f,g;f=[];g=[];return e(a,b)?!0:!1};w.file={loadFileAPI:function(){var a=new h;if("unload"===S){var b=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:b+"libs/polyfills/fileAPI/",flashUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};V(b,r.hitch(this,function(){S="loaded";a.resolve()}));
S="loading"}else"loaded"===S&&a.resolve();return a},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return l("safari")&&6>l("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var a=null;if(document.all)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(aa){a=null}else navigator.plugins&&0<navigator.plugins.length&&(a=navigator.plugins["Shockwave Flash"]);return!!a},containSeparator:function(a){return 0<=
a.indexOf("/")?!0:0<=a.indexOf("\\")?!0:!1},getNameFromPath:function(a){var b="",b=0<=a.indexOf("/")?"/":"\\";a=a.split(b);return 0<a.length?a[a.length-1]:null},getFolderFromPath:function(a){return a.substr(0,a.length-w.file.getNameFromPath(a).length)},readFile:function(a,b,e,f){if(this.supportHTML5()){var g=a.target.files[0];g&&(g.type.match(b)?g.size>=e?f({errCode:"exceed"}):(a=new FileReader,a.onload=function(a){f(null,g.name,a.target.result)},a.readAsDataURL(g)):f({errCode:"invalidType"}))}else if(this.supportFileAPI()){var k=
window.FileAPI.getFiles(a);k[0].type.match(b)?k[0].size>=e?f({errCode:"exceed"}):window.FileAPI.readAsDataURL(k[0],function(a){a&&a.result?f(null,k[0].name,a.result):f({errCode:"readError"})}):f({errCode:"invalidType"})}}};w.getUriInfo=function(a){var b,e={};b=a.indexOf("/");a.substring(0,b);b=a.substring(0,a.lastIndexOf("/")+1);e.folderUrl=require(w.getRequireConfig()).toUrl(b);e.amdFolder=b;e.url=e.folderUrl;if(/^http(s)?:\/\//.test(a)||/^\/\//.test(a))e.isRemote=!0;return e};w.widgetJson=function(){var a=
{addManifest2WidgetJson:function(a,b){r.mixin(a,b.properties);a.name=b.name;a.label||(a.label=b.label);a.manifest=b;a.isRemote=b.isRemote;a.isRemote&&(a.itemId=b.itemId);b.featureActions&&(a.featureActions=b.featureActions);a.icon||(a.icon=b.icon);a.thumbnail||(a.thumbnail=b.thumbnail);a.folderUrl=b.folderUrl;a.amdFolder=b.amdFolder},removeManifestFromWidgetJson:function(a){if(a.manifest){for(var b in a.manifest.properties)a[b]=void 0;a.name=void 0;a.label=void 0;a.featureActions=void 0;a.manifest=
void 0}},getUriFromItem:function(b){return b.url?a.getFolderUrlFromItem(b)+"Widget":null},getFolderUrlFromItem:function(a){if(!a.url)return null;a=/manifest\.json$/.test(a.url)?a.url.substring(0,a.url.length-13):/\/$/.test(a.url)?a.url:a.url+"/";"https:"===window.location.protocol&&(a=a.replace(/^http:\/\//,"https://"));return a}};return a}();w.getRequireConfig=function(){if(jimuConfig){var a=[];jimuConfig.widgetsPackage&&(a=a.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(a=a.concat(jimuConfig.themesPackage));
jimuConfig.configsPackage&&(a=a.concat(jimuConfig.configsPackage));return{packages:a}}return{}};w.getTypeByGeometryType=function(a){var b="",e="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),f=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(a)?b="point":0<=e.indexOf(a)?b="polyline":0<=f.indexOf(a)&&(b="polygon");return b};w.getSymbolTypeByGeometryType=
function(a){var b=null;a=w.getTypeByGeometryType(a);"point"===a?b="marker":"polyline"===a?b="line":"polygon"===a&&(b="fill");return b};w.getServices=function(){return U};w.getArcGISDefaultGeometryService=function(){return new G(U.geometryService)};w.restoreToDefaultWebMapExtent=function(a,b,e){var f=new h;if(!a||"esri.Map"!==a.declaredClass)return setTimeout(function(){f.reject("Invalid map.")},0),f;b=b&&b.itemInfo;if(!b)return setTimeout(function(){f.reject("Invalid itemInfo")},0),f;b=b.item&&b.item.extent;
if(!b)return setTimeout(function(){f.reject("Invalid itemInfo.item.extent")}),f;var g=new z({wkid:4326}),g=new A(b[0][0],b[0][1],b[1][0],b[1][1],g);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(g);if(a.spatialReference.isWebMercator())return g=B.geographicToWebMercator(g),a.setExtent(g);b=new H;b.geometries=[g];b.outSR=a.spatialReference;g=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;g&&"esri.tasks.GeometryService"===g.declaredClass||(e&&"string"===typeof e&&
r.trim(e)?(e=r.trim(e),g=new G(e)):g=w.getArcGISDefaultGeometryService());g.project(b).then(function(b){if(b=b&&b[0])return a.setExtent(b);f.reject("Invalid projected geometry.");return f},function(a){console.error(a);f.reject(a);return f});return f};w.getAncestorWindow=function(){for(var a=window;a&&a.parent&&a!==a.parent;)a=a.parent;return a};w.getAncestorDom=function(a,b,e){if(a&&1===a.nodeType&&b&&"function"===typeof b){var f=100,g=document.body;e&&("number"===typeof e?(e=parseInt(e,10),0<e&&
(f=e)):1===e.nodeType&&(g=e));for(e=0;a.parentNode&&e<f&&m.isDescendant(a.parentNode,g);){if(b(a.parentNode))return a.parentNode;a=a.parentNode;e++}}return null};w.bindClickAndDblclickEvents=function(a,b,e,f){var g=null;if(a&&1===a.nodeType&&b&&"function"===typeof b&&e&&"function"===typeof e){var h=200;f&&"number"===typeof f&&(f=parseInt(f,10),0<f&&(h=f));var u=0,g=k(a,"click",function(a){u++;1===u?setTimeout(function(){1===u&&(u=0,b(a))},h):2===u&&(u=0,e(a))})}return g};w.isScrollToBottom=function(a){var b=
m.getContentBox(a);return 1>a.scrollHeight-(a.scrollTop+b.h)};w.getAllItemTypes=function(){var a=[],a=a.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service","Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In",
"Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return a=a.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer","Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};
w.getItemQueryStringByTypes=function(a){var b="",e=w.getAllItemTypes();if(a&&0<a.length&&0<a.length){var f="";d.forEach(a,function(b,e){f+=' type:"'+b+'" ';e!==a.length-1&&(f+=" OR ")});b=" ( "+f+" ) ";e=a.concat(e);e=d.filter(e,function(b){return d.every(a,function(a){return 0>a.toLowerCase().indexOf(b.toLowerCase())})});d.forEach(e,function(a){b+=' -type:"'+a+'" '})}return b};w.getItemQueryStringByTypeKeywords=function(a){var b="";a&&0<a.length&&(b=' typekeywords:"'+a.join(",")+'" ');return b};
w.isNotEmptyString=function(a,b){var e=a&&"string"===typeof a;return e?b?e&&r.trim(a):!0:!1};w.isNotEmptyStringArray=function(a,b){for(var e=0;e<a.length;e++){var f=a[e];if(!w.isNotEmptyString(f.value?f.value:f,b))return!1}return!0};w.isValidNumber=function(a){return"number"===typeof a&&!isNaN(a)};w.isValidNumberArray=function(a){for(var b=0;b<a.length;b++){var e=a[b],e=e.value||0===e.value?e.value:e;if(!w.isValidNumber(e))return!1}return!0};w.isValidDate=function(a){if(a)try{return!isNaN((new Date(a)).getTime())}catch(aa){return console.error(aa),
!1}else return!1};w.isObject=function(a){return a&&"object"===typeof a};w.createWebMap=function(a,b,e,f){a=N.getStandardPortalUrl(a);a=N.getBaseItemUrl(a);x.arcgisUrl=a;return x.createMap(b,e,f)};w.getRandomString=function(){var a=Math.random().toString();return a=a.slice(2,a.length)};w._getDomainsByServerName=function(a){var b=a.split("."),e=b.length;return d.map(b,r.hitch(this,function(a,f){a=b.slice(f,e);var g="",k=a.length-1;d.forEach(a,r.hitch(this,function(a,b){g+=a;b!==k&&(g+=".")}));return g}))};
w.removeCookie=function(a,b){var e=this._getDomainsByServerName(window.location.hostname);d.forEach(e,r.hitch(this,function(e){g(a,null,{expires:-1,path:b});g(a,null,{expires:-1,path:b,domain:e});g(a,null,{expires:-1,path:b,domain:"."+e})}))};w.isLocaleChanged=function(a,b){return!a.startWith(b)};w.hashToObject=function(b){b=b.replace("#","");b=t.queryToObject(b);for(var e in b)if(b.hasOwnProperty(e))try{b[e]=a.parse(b[e])}catch(fa){}return b};w.reCreateObject=function(a){function b(a){var f=[];a.forEach(function(a){Array.isArray(a)?
f.push(b(a)):"object"===typeof a?f.push(e(a)):f.push(a)});return f}function e(a){var f={},g;for(g in a)a.hasOwnProperty(g)&&(null===a[g]?f[g]=null:Array.isArray(a[g])?f[g]=b(a[g]):f[g]="object"===typeof a[g]?e(a[g]):a[g]);return f}return Array.isArray(a)?b(a):e(a)};w.setVerticalCenter=function(a){setTimeout(function(){var b=q(".jimu-vcenter-text",a),e,f;d.forEach(b,function(a){e=m.getContentBox(a).h;m.setStyle(a,{lineHeight:e+"px"})},this);b=q(".jimu-vcenter",a);d.forEach(b,function(a){e=m.getContentBox(a).h;
f=m.getContentBox(q(a).parent()[0]).h;m.setStyle(a,{marginTop:(f-e)/2+"px"})},this)},10)};w.merge=T;w.loadStyleLink=function(a,b,e){var f=new h,g,u=require(w.getRequireConfig()).toUrl(b);if(require.cache["url:"+u]){g=require.cache["url:"+u];var v=u.split("/").pop(),u=u.substr(0,u.length-v.length);g=X(g,u);a=e?m.create("style",{id:a,type:"text/css"},m.byId(e),"before"):m.create("style",{id:a,type:"text/css"},document.getElementsByTagName("head")[0]);a.styleSheet&&!a.sheet?a.styleSheet.cssText=g:a.appendChild(m.toDom(g));
f.resolve("load");return f}g=e?m.create("link",{id:a,rel:"stylesheet",type:"text/css",href:u+"?wab_dv\x3d"+window.deployVersion},m.byId(e),"before"):m.create("link",{id:a,rel:"stylesheet",type:"text/css",href:u+"?wab_dv\x3d"+window.deployVersion},document.getElementsByTagName("head")[0]);k(g,"load",function(){f.resolve("load")});var n=setInterval(function(){var a;if(d.some(document.styleSheets,function(e){if(e.href&&e.href.substr(e.href.indexOf(b),e.href.length)===b)return a=e,!0}))try{!f.isFulfilled()&&
(a.cssRules&&a.cssRules.length||a.rules&&a.rules.length)&&f.resolve("load"),clearInterval(n)}catch(ja){}},50);return f};w.changeLocation=function(a){window.history.pushState&&window.history.pushState({path:a},"",encodeURI(a))};w.urlToObject=function(a){var b=null;-1===a.indexOf("#")?(b=K.urlToObject(a),b.hash=null):(a=a.split("#"),b=K.urlToObject(a[0]),b.hash=a[1]?-1<a[1].indexOf("\x3d")?t.queryToObject(a[1]):a[1]:null);return b};w.manifest=function(){function a(a){a.panels.forEach(function(a){a.uri=
"panels/"+a.name+"/Panel.js"});a.styles.forEach(function(a){a.uri="styles/"+a.name+"/style.css"});a.layouts.forEach(function(a){a.uri="layouts/"+a.name+"/config.json";a.icon="layouts/"+a.name+"/icon.png";a.RTLIcon="layouts/"+a.name+"/icon_rtl.png"})}return{addManifestProperies:function(b){b.icon||(b.icon=b.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion);b.thumbnail||(b.thumbnail=b.folderUrl+"images/thumbnail.png");"theme"===b.category?a(b):("undefined"!==typeof b["2D"]&&(b.support2D=
b["2D"]),"undefined"!==typeof b["3D"]&&(b.support3D=b["3D"]),"undefined"===typeof b["2D"]&&"undefined"===typeof b["3D"]&&(b.support2D=!0),delete b["2D"],delete b["3D"],"undefined"===typeof b.properties&&(b.properties={}),Q.processWidgetProperties(b))},processManifestLabel:function(a,b){var e=b.split("-")[0];a.label=a.i18nLabels&&(a.i18nLabels[b]||a.i18nLabels[e]||a.i18nLabels.defaultLabel)||a.label||a.name;a.layouts&&d.forEach(a.layouts,function(e){var f="i18nLabels_layout_"+e.name;e.label=a[f]&&
(a[f][b]||a[f].defaultLabel)||e.label||e.name});a.styles&&d.forEach(a.styles,function(e){var f="i18nLabels_style_"+e.name;e.label=a[f]&&(a[f][b]||a[f].defaultLabel)||e.label||e.name})},addI18NLabel:function(a){var b=new h;if(a.i18nLabels)return b.resolve(a),b;a.i18nLabels={};if(a.properties&&!1===a.properties.hasLocale)return b.resolve(a),b;var e;e=a.isRemote?a.amdFolder+"nls/strings.js":a.amdFolder+"nls/strings";require(w.getRequireConfig(),["dojo/i18n!"+e],function(e){var f={};f[dojoConfig.locale]=
e;Q.addI18NLabelToManifest(a,null,f);b.resolve(a)});return b}}}();w.isNumberField=function(a){return 0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a)};w.getTime=function(a){var b=a.getTimezoneOffset(),b=0>b?"+"+Math.abs(b)/60:"-"+b/60;return a.getTime()+36E5*b};w.getUniqueValues=function(a,b,e,f,g){return function(){var b=new h,e={};f?(e.layerDefinition=f,g&&(e.fieldPopupInfo=g),b.resolve(e)):b=I({url:a,content:{f:"json"},
handleAs:"json",callbackParamName:"callback"}).then(function(a){e.layerDefinition=a;return e},function(a){console.log("Error: ",a.message)});return b}().then(function(f){return w._getUniqueValues(a,b,e,f.layerDefinition).then(function(a){return w._getValues(f.layerDefinition,f.fieldPopupInfo,b,a)})})};w._getValues=function(a,b,e,f){var g=[],g=w.getFieldInfoByFieldName(a.fields,e),k=null,h=w.isNumberField(g.type),u="esriFieldTypeDate"===g.type?!0:!1;if(g&&(h?f=d.map(f,function(a){a=parseFloat(a);isNaN(a)&&
(a=null);return a}):u&&(f=d.map(f,r.hitch(this,function(a){return w.isValidDate(a)?(a=0>(b?b.format.dateFormat:"").indexOf("Time")?a:w.getTime(new Date(a)),w.localizeDateByFieldInfo(new Date(a),b)):a}))),a=w.getCodedValueListForCodedValueOrSubTypes(a,e),null!==a))for(k={},e=0;e<a.length;e++)k[a[e].value]=a[e].label;return g=d.map(f,function(a){var e=null,e=null===a||void 0===a?"\x3cNull\x3e":k&&k.hasOwnProperty(a)?k[a]:h?b?w.localizeNumberByFieldInfo(a,b):w.localizeNumber(a):a;return{value:a,label:e}})};
w._getUniqueValues=function(a,b,e,f){var g=new h;a=a.replace(/\/*$/g,"");e||(e="1\x3d1");var g=/\/ImageServer$/gi.test(a),k=-1<a.indexOf("MapServer/dynamicLayer");g||k?g=w._getUniqueValuesByQueryTask(a,b,e):(g=w.getFieldInfoByFieldName(f.fields,b),g=0<w.getCodedValuesOrTypesCount(g,f)?w._getUniqueValuesByQueryTask(a,b,e):w._getUniqueValuesByGenerateRenderer(a,b,e));return g};w.getCodedValuesOrTypesCount=function(a,b){return a?b.typeIdField&&b.typeIdField.toUpperCase()===a.name.toUpperCase()&&b.types?
b.types.length:(a=w._getAllCodedValue(b,a))?a.length:0:0};w._getUniqueValuesByQueryTask=function(a,b,e){var f=new O;f.where=e;f.returnDistinctValues=!0;f.returnGeometry=!1;f.outFields=[b];return(new P(a)).execute(f).then(function(a){var e=[];a.features&&0<a.features.length&&d.forEach(a.features,function(a){a&&a.attributes&&e.push(a.attributes[b])});return e})};w._getUniqueValuesByGenerateRenderer=function(b,e,f){var g=new h,k=b.split("?");b=1<k.length?k[0].replace(/\/*$/g,"")+"/generateRenderer?"+
k[1]:b.replace(/\/*$/g,"")+"/generateRenderer";e=a.stringify({type:"uniqueValueDef",uniqueValueFields:[e]});I({url:b,content:{classificationDef:e,f:"json",where:f},handleAs:"json",callbackParamName:"callback"}).then(r.hitch(this,function(a){var b=[];(a=a&&a.uniqueValueInfos)&&0<a.length&&(b=d.map(a,r.hitch(this,function(a){return a.value})));g.resolve(b)}),r.hitch(this,function(a){g.reject(a)}));return g};w.isCodedValuesSupportFilter=function(a,b){var e=parseFloat(a.currentVersion);return b<=parseFloat(a.maxRecordCount)&&
10.1<e};w.combineRadioCheckBoxWithLabel=function(a,b){var e=!1;if(a&&1===a.nodeType&&"input"===a.tagName.toLowerCase()){var f=a.getAttribute("type")||"",f=f.toLowerCase();if("radio"===f||"checkbox"===f)e=!0}f=!1;b&&1===b.nodeType&&"label"===b.tagName.toLowerCase()&&(f=!0);e&&f&&(e=a.getAttribute("id"),e||(e="input_"+w.getRandomString(),a.setAttribute("id",e)),b.setAttribute("for",e),m.setStyle(b,"cursor","pointer"))};w.groupRadios=function(a,b){var e=[],f="radiogroup_"+w.getRandomString();d.forEach(a,
function(a){a.name=f;b&&(a=k(a,"change",b),e.push(a))});return e};w.convertExtentToPolygon=function(a){var b=a.xmin,e=a.xmax,f=a.ymin,g=a.ymax;return new F({rings:[[[b,g],[e,g],[e,f],[b,f],[b,g]]],spatialReference:a.toJson()})};w.combineGeometries=function(a){function b(a){var b={points:[],spatialReference:a[0].spatialReference.toJson()};d.forEach(a,function(a){"point"===a.type?b.points=b.points.concat([[a.x,a.y]]):"multipoint"===a.type&&(b.points=b.points.concat(a.points))});return new y(b)}function e(a){var b=
{paths:[],spatialReference:a[0].spatialReference.toJson()};d.forEach(a,function(a){b.paths=b.paths.concat(a.paths)});return new C(b)}function f(a){var b={rings:[],spatialReference:a[0].spatialReference.toJson()};d.forEach(a,function(a){"polygon"===a.type?b.rings=b.rings.concat(a.rings):"extent"===a.type&&(a=w.convertExtentToPolygon(a),b.rings=b.rings.concat(a.rings))});return new F(b)}var g=null;if(a&&0<a.length)if(1===a.length)g=a[0];else{for(var k=null,h=null,u=null,v=null,n=0;n<a.length;n++){k=
a[n];switch(k.type){case "point":case "multipoint":v="point";break;case "polyline":v="polyline";break;case "polygon":case "extent":v="polygon";break;default:return null}if(0===n)u=v;else if(u!==v)return null;if(n!==a.length-1&&(h=a[n+1],!k.spatialReference.equals(h.spatialReference)))return null}"point"===v?g=b(a):"polyline"===v?g=e(a):"polygon"===v&&(g=f(a))}return g};w.combineGeometriesByGraphics=function(a){var b=null;a&&0<a.length&&(a=d.map(a,function(a){return a.geometry}),b=w.combineGeometries(a));
return b};w.isFeaturelayerUrlSupportQuery=function(a,b){var e=!1,f=/\/featureserver\//gi.test(a);a=/\/mapserver\//gi.test(a);b=(b||"").toLowerCase();f?e=0<=b.indexOf("query"):a&&(e=0<=b.indexOf("data"));return e};w.isImageServiceSupportQuery=function(a){return 0<=(a||"").toLowerCase().indexOf("catalog")};w.isStringEndWith=function(a,b){return a.lastIndexOf(b)+b.length===a.length};w.localizeNumber=function(a,b){var e=(a.toString().split(".")[1]||"").length,g="",g=b&&isFinite(b.places)&&b.places,g=
0<g||0<e?"#,###,###,##0.0"+Array.prototype.join.call({length:0<g?g+1:e},"0"):"#,###,###,##0",e={locale:c.locale,pattern:g};r.mixin(e,b||{});try{return f.format(a,e)}catch(ga){return console.error(ga),a.toLocaleString()}};w.parseNumber=function(a,b){var e={locale:c.locale};r.mixin(e,b||{});try{return f.parse(a,e)}catch(ca){return console.error(ca),a}};w.localizeDate=function(a,e){var f={locale:c.locale,fullYear:!0};r.mixin(f,e||{});"ar"===c.locale&&"long"!==f.formatLength&&"full"!==f.formatLength&&
(f.formatLength="long");try{return b.format(a,f)}catch(ca){return console.error(ca),"date"===f.selector?a.toLocaleDateString():"time"===f.selector?a.toLocaleTimeString():a.toLocaleString()}};w.localizeNumberByFieldInfo=function(a,b){var f=null,f=r.exists("format.places",b)&&b.format.places,f=w.localizeNumber(a,{places:f});return r.exists("format.digitSeparator",b)&&!b.format.digitSeparator?f.toString().replace(new RegExp("\\"+e.group,"g"),""):f};w.localizeDateByFieldInfo=function(a,b){var e=null;
try{var f={date:a instanceof Date?a.getTime():a},g=r.exists("format.dateFormat",b)?b.format.dateFormat:"longMonthDayYear",e=v.substitute(f,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+D.prototype._dateFormats[g]}})}catch(da){console.error(da),e=a}return e};w.fieldFormatter={getFormattedUrl:function(a){if(a&&"string"===typeof a){var b=a.indexOf("http:");-1===b&&(b=a.indexOf("https:"));if(-1<b&&-1===a.indexOf("href\x3d")){var e=a.indexOf(" ",b);-1===e&&(e=a.length);var f=-1<a.indexOf("\r\n",
b)?a.indexOf("\r\n",b):-1<a.indexOf("\n",b)?a.indexOf("\n",b):e,e=f<e?f:e,f=a.substring(b,e);a=a.substring(0,b)+'\x3cA href\x3d"'+f+'" target\x3d"_blank"\x3e'+f+"\x3c/A\x3e"+a.substring(e,a.length)}}return null===a?"":a},getFormattedNumber:function(a,b){if("number"===typeof a){var e=(a.toString().split(".")[1]||"").length;a=w.localizeNumberByFieldInfo(a,{format:{places:b&&"number"===typeof b.places?parseInt(b.places,10):e,digitSeparator:b&&b.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+
(a||"")+"\x3c/span\x3e"}return a},getFormattedDate:function(a,b){if("number"===typeof a||a instanceof Date)a=w.localizeDateByFieldInfo(a,{format:b});return a||""},getCodedValue:function(a,b){if(a&&a.codedValues){for(var e=0,f=a.codedValues.length;e<f;e++){var g=a.codedValues[e];if(v.isDefined(b)&&r.exists("code",g)&&b.toString()===g.code.toString())return g.name}return b}return b||null},getTypeName:function(a,b){for(var e=b.length,f=0;f<e;f++)if(a===b[f].id)return b[f].name;return a}};w.addRelativePathInCss=
X;w.url={isAbsolute:function(a){return a?a.startWith("http")||a.startWith("/"):!1},removeQueryParamFromUrl:function(a,b){a=K.urlToObject(a);a.query&&delete a.query[b];b=a.path;for(var e in a.query)b=b===a.path?b+"?"+e+"\x3d"+a.query[e]:b+"\x26"+e+"\x3d"+a.query[e];return b},addQueryParamToUrl:function(a,b,e){a=K.urlToObject(a);a.query||(a.query={});a.query[b]=e;b=a.path;for(var f in a.query)b=b===a.path?b+"?"+f+"\x3d"+a.query[f]:b+"\x26"+f+"\x3d"+a.query[f];return b},compareUrl:function(a,b){a=this.getUrlPath(a);
b=this.getUrlPath(b);a=N.removeProtocol(a.toString().toLowerCase()).replace(/\/+/g,"/");b=N.removeProtocol(b.toString().toLowerCase()).replace(/\/+/g,"/");return a===b},getUrlPath:function(a){return K.urlToObject(a).path}};w.processUrlInWidgetConfig=function(a,b){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:a.startWith("${appPath}")?a.replace("${appPath}",window.appInfo.appPath):b+a};w.processUrlInAppConfig=function(a){if(a)return a.startWith("data:")||a.startWith("http")||
a.startWith("/")?a:window.appInfo.appPath+a};w.getLocationUrlWithoutHashAndQueryParams=function(){var a=window.location,b=a.protocol+"//"+a.host+a.pathname,a=K.urlToObject(a.href);a.query&&a.query.apiurl&&(b=w.url.addQueryParamToUrl(b,"apiurl",a.query.apiurl));return b};w.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};w.invertColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,
16);return 7829367<a?"#000000":"#ffffff"};w.isLightColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?!0:!1};w.mixinAppConfigPosition=function(a,b){var e=r.clone(a);if(!b)return e;b=r.clone(b);var f=e.widgetOnScreen,g=b.widgetOnScreen;g&&g.widgets&&("[object Object]"===Object.prototype.toString.call(g.widgets)?d.forEach(f.widgets,function(a,b){b=a.uri?a.uri:"ph_"+b;g.widgets[b]&&g.widgets[b].position&&
(g.widgets[b].position.relativeTo||(g.widgets[b].position.relativeTo="map"),a.position=g.widgets[b].position)},this):d.forEach(g.widgets,function(a,b){a.position&&!a.position.relativeTo&&(a.position.relativeTo="map");f.widgets[b]&&a.position&&(f.widgets[b].position=a.position)}));g&&g.groups&&("[object Object]"===Object.prototype.toString.call(g.groups)?d.forEach(f.groups,function(a,b){b=a.label?a.label:"g_"+b;g.groups[b]&&g.groups[b].panel&&g.groups[b].panel.position&&(g.groups[b].panel.position.relativeTo||
(g.groups[b].panel.position.relativeTo="map"),a.panel.position=g.groups[b].panel.position)},this):(a=a.layoutDefinition?a.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===a?d.forEach(g.groups,function(a,b){a.panel&&a.panel.position&&!a.panel.position.relativeTo&&(a.panel.position.relativeTo="map");f.groups[b]&&a.panel&&a.panel.position&&(f.groups[b].panel.position=a.panel.position)}):"jimu/layoutManagers/GridLayoutManager"===
a&&(f.groups=Z(f.groups,g.groups.map(function(a){return a.id})))));b.map&&b.map.position&&(e.map?e.map.position=b.map.position:e.map={position:b.map.position});b.widgetPool&&b.widgetPool.panel&&(b.widgetPool.panel.position&&!b.widgetPool.panel.position.relativeTo&&(b.widgetPool.panel.position.relativeTo="map"),e.widgetPool.panel.position=b.widgetPool.panel.position);b.mobileLayout&&(e.mobileLayout=b.mobileLayout);return e};w.handleGridLayoutOnScreenGroupChange=Z;w.template={groupIdentification:"groups\\[.+\\]",
widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(a,b,e){var f=-1;b=a.search(new RegExp(b));0<=b&&(a=a.slice(b,a.length),a=a.indexOf(e),f=b+a+e.length);return{firstPos:b,lastPos:f}},setConfigValue:function(a,b,e){W(a,b,e)},getConfigValue:function(a,b){return W(a,b)},setConfigValueWithId:function(a,b,e){Y(a,b,e)},getConfigValueWithId:function(a,b){return Y(a,b)},getKeyInfo:function(a){var b=this.getWidgetIdByKey(a);if(null!==b)return{type:"widget",id:b};a=this.getGroupIdByKey(a);return null!==
a?{type:"group",id:a}:{type:"unknow",id:null}},getWidgetIdByKey:function(a){var b=w.template.getSearchRange(a,w.template.widgetIdentification,"]");if(-1===b.firstPos)a=null;else{var e=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+e.indexOf("[")+1,b.lastPos-1)}return a},getGroupIdByKey:function(a){var b=w.template.getSearchRange(a,w.template.groupIdentification,"]");if(-1===b.firstPos)a=null;else{var e=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+e.indexOf("[")+1,b.lastPos-1)}return a},
getConfigedWidgetsByTemplateConfig:function(a){var b=[],e=w.template.widgetIdentification+"_config",f;d.forEach(a.configurationSettings,function(a){d.forEach(a.fields,function(a){a.fieldName&&(f=w.template.getSearchRange(a.fieldName,e,"]"),0<=f.firstPos&&(a=w.template.getWidgetIdByKey(a.fieldName),-1===b.indexOf(a)&&b.push(a)))},this)},this);return b},mergeTemplateAppConfigToAppConfig:function(a,b,e){function f(a){var b=[];d.forEach(a,function(a){a&&b.push(a)},this);return b}var g=a.widgetOnScreen,
k=a.portalUrl;b.values.webmap&&(a.map.itemId=b.values.webmap);e&&(a.map.mapOptions&&w.deleteMapOptions(a.map.mapOptions),a.map.portalUrl=k,b.values.app_title||(b.values.app_title=e.title),b.values.app_subtitle||(b.values.app_subtitle=e.snippet));for(var h in b.values)"webmap"!==h&&w.template.setConfigValueWithId(a,h,b.values[h]);a.widgetPool.widgets=f(a.widgetPool.widgets);g.widgets=f(g.widgets);if(a.widgetPool.groups)for(b=0;b<a.widgetPool.groups.length;b++)a.widgetPool.groups[b].widgets=f(a.widgetPool.groups[b].widgets);
if(g.groups)for(b=0;b<g.groups.length;b++)g.groups[b].widgets=f(g.groups[b].widgets);return a}};w.deleteMapOptions=function(a){a&&(delete a.extent,delete a.lods,delete a.center,delete a.scale,delete a.zoom,delete a.maxScale,delete a.maxZoom,delete a.minScale,delete a.minZoom)};w.sanitizeHTML=function(a){return html_sanitize(a,function(a){return a},function(a){return a})};w.stripHTML=function(a){return a?-1<a.indexOf("\x3c")&&-1<a.indexOf("\x3e")?a.replace(/<(?:.|\s)*?>/g,""):a:a};w.encodeHTML=function(a){return String(a).replace(/&/g,
"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#39;")};w.removeSuffixSlashes=function(a){return a.replace(/\/*$/g,"")};w.getBestDisplayAttributes=function(a,b){var e={},f=null,g;for(g in a)f=w.getBestDisplayValue(g,a,b),e[g]=f;return e};w.getBestDisplayValue=function(a,b,e){var f="",g=null;r.isArrayLike(e)?g=w.getFieldInfoByFieldName(e,a):"object"===typeof e&&e.name===a&&(g=e);g&&(f=b[a],"esriFieldTypeDate"===g.type?f&&(a=new Date(parseInt(f,
10)),f=w._tryLocaleDate(a)):"number"===typeof f&&(g.domain&&"codedValue"===g.domain.type?d.some(g.domain.codedValues,function(a){if(a.code===f)return f=a.name,!0}):f=w._tryLocaleNumber(f)));if(null===f||void 0===f)f="";return f};w._getCodedValues=function(a){var b=null;(a=a.domain)&&"codedValue"===a.type&&a.codedValues&&0<a.codedValues.length&&(b=a.codedValues,b=d.map(b,r.hitch(this,function(a){return{value:a.code,label:a.name}})));return b};w._getSubTypes=function(a){var b=null;a.subtypeField&&a.subtypes&&
0<a.subtypes.length&&(b=d.map(a.subtypes,r.hitch(this,function(a){return{value:a.id,label:a.name}})));return b};w._getRenderTypes=function(a){var b=null;a.typeIdField&&a.types&&0<a.types.length&&(b=d.map(a.types,r.hitch(this,function(a){return{value:a.id,label:a.name}})));return b};w._getCodedValueOrSubtypes=function(a,b,e){var f=w.getFieldInfoByFieldName(a.fields,b);return void 0!==e&&null!==e?w._getCodedValueBySubTypeId(a,b,e,f):w._getAllCodedValue(a,f)};w._getDisplayValueForCodedValueOrSubtype=
function(a,b,e,f){var g={isCodedValueOrSubtype:!1,displayValue:e+""};(a=w._getCodedValueOrSubtypes(a,b,f))&&0<a.length&&d.some(a,r.hitch(this,function(a){return a.value===e?(g={isCodedValueOrSubtype:!0,displayValue:a.label},!0):!1}));return g};w._deleteSubtypePropertiesTemp=function(a){delete a.subtypeField;delete a.subtypes};w.getDisplayValueForCodedValueOrSubtype=function(a,b,e){w._deleteSubtypePropertiesTemp(a);var f=e[b],g,k=a.typeIdField;e.hasOwnProperty(k)&&(g=e[k]);(k=a.subtypeField)&&a.subtypes&&
0<a.subtypes.length&&e.hasOwnProperty(k)&&(g=e[k]);f=w._getDisplayValueForCodedValueOrSubtype(a,b,f,g);a.typeIdField===b&&(f.displayValue=w._updateCodedValueListFromRender(a,[{value:e[b],label:f.displayValue}])[0].label);return f};w._getDisplayValueFromCodedValues=function(a,b){var e={isCodedValueOrSubtype:!1,displayValue:a+""};b&&0<b.length&&d.some(b,r.hitch(this,function(b){return b.value===a?(e={isCodedValueOrSubtype:!0,displayValue:b.label},!0):!1}));e.value=a;return e};w.getDisplayValueForCodedValueOrSubtypeBatch=
function(a,b,e){w._deleteSubtypePropertiesTemp(a);var f={},g=a.typeIdField,k=a.subtypeField,h=w.getFieldInfoByFieldName(a.fields,b);k&&a.subtypes&&0<a.subtypes.length?(f.subType=w._getSubTypes(a),g=k,f.all=w._getAllCodedValueNew(a,h)):(f.all=w._getAllCodedValue(a,h),f.subType=w._getRenderTypes(a));if(f.subType&&0<f.subType.length){var k=f.subType,u;for(u in k){var v=k[u].value,n=w._getCodedValueBySubTypeId(a,b,v,h);f[v]=a.typeIdField===b?w._updateCodedValueListFromRender(a,n):n}}a.typeIdField===b&&
(f.subType=w._updateCodedValueListFromRender(a,f.subType),f.all=w._updateCodedValueListFromRender(a,f.all));v=[];u=[];for(var c in e)v=e[c],k=v[b],g===b?v=f.subType:v.hasOwnProperty(g)?(v=v[g],v=f[v],v||(v=w._getCodedValues(h),a.typeIdField===b&&(v=w._updateCodedValueListFromRender(a,v)))):v=f.all,k=w._getDisplayValueFromCodedValues(k,v),u.push(k);return u};w._getUniquCodedValue=function(a,b,e){a[b]?e!==a[b]&&(a[b]=a[b]+", "+e):a[b]=e;return a};w._getAllCodedValue=function(a,b){var e=b.name,f={},
g=null,k=!0;if(a.typeIdField&&a.types&&0<a.types.length)d.map(a.types,r.hitch(this,function(a){a.domains&&a.domains[e]&&(a=a.domains[e],"inherited"===a.type?k&&(k=!1,a=w._getCodedValues(b),d.map(a,r.hitch(this,function(a){f=w._getUniquCodedValue(f,a.value,a.label)}))):a.codedValues&&0<a.codedValues.length&&d.map(a.codedValues,r.hitch(this,function(a){f=w._getUniquCodedValue(f,a.code,a.name)})))})),g||(g=w._getCodedValues(b));else return this._getCodedValues(b);a=[];var h=w.isNumberField(b.type),u;
for(u in f){var v=h?parseInt(u,10):u;a.push({value:v,label:f[u]})}0<a.length&&(g=a);return g};w._getAllCodedValueNew=function(a,b){var e=b.name,f={},g=null,k=!0;if(a.subtypeField&&a.subtypes&&0<a.subtypes.length)d.map(a.subtypes,r.hitch(this,function(a){a.domains&&a.domains[e]&&(a=a.domains[e],"inherited"===a.type?k&&(k=!1,a=w._getCodedValues(b),d.map(a,r.hitch(this,function(a){f=w._getUniquCodedValue(f,a.value,a.label)}))):a.codedValues&&0<a.codedValues.length&&d.map(a.codedValues,r.hitch(this,function(a){f=
w._getUniquCodedValue(f,a.code,a.name)})))})),g||(g=w._getCodedValues(b));else return this._getCodedValues(b);a=[];var h=w.isNumberField(b.type),u;for(u in f){var v=h?parseInt(u,10):u;a.push({value:v,label:f[u]})}0<a.length&&(g=a);return g};w._getCodedValueBySubTypeId=function(a,b,e,f){var g="typeIdField",k="types";a.subtypeField&&a.subtypes&&0<a.subtypes.length&&(g="subtypeField",k="subtypes");var h=null;f=f?f:w.getFieldInfoByFieldName(a.fields,b);a[g]&&a[k]&&0<a[k].length?(d.map(a[k],r.hitch(this,
function(k){if(k.id===e){if(b===a[g])return h=[{value:k.id,label:k.name}],!0;k.domains&&k.domains[b]?(k=k.domains[b],"inherited"===k.type?h=w._getCodedValues(f):k.codedValues&&0<k.codedValues.length&&(h=d.map(k.codedValues,r.hitch(this,function(a){return{value:a.code,label:a.name}})))):k.domains&&(h=w._getCodedValues(f))}})),h||(h=w._getCodedValues(f))):h=w._getCodedValues(f);return h};w.getCodedValueListForCodedValueOrSubTypes=function(a,b,e){w._deleteSubtypePropertiesTemp(a);var f=null,f=w.getFieldInfoByFieldName(a.fields,
b),g,k;e&&(g=e[a.typeIdField],k=e[a.subtypeField]);if(a.subtypeField&&a.subtypes&&0<a.subtypes.length)return b===a.subtypeField?(f=w._getSubTypes(a),void 0!==k&&(e=w._getDisplayValueFromCodedValues(k,f),f=[{value:e.value,label:e.displayValue}])):f=void 0===k?w._getAllCodedValueNew(a,f):w._getCodedValueBySubTypeId(a,b,k,f),b===a.typeIdField&&(f=w._updateCodedValueListFromRender(a,f)),f;a.subtypeField="";a.subtypes=[];a.typeIdField&&a.typeIdField.toUpperCase()===b.toUpperCase()?(f=w._getRenderTypes(a),
e&&void 0!==g&&null!==g&&(e=w._getDisplayValueFromCodedValues(g,f),f=[{value:e.value,label:e.displayValue}])):f=e&&void 0!==g&&null!==g?w._getCodedValueBySubTypeId(a,b,g,f):w._getAllCodedValue(a,f);b===a.typeIdField&&(f=w._updateCodedValueListFromRender(a,f));return f};w._verifyIfFieldIsSubtypeField=function(a,b){var e={isSubtypeField:!1,subtypeField:""};if(a.subtypeField)return e={isSubtypeField:a.subtypeField===b.name,subtypeField:a.subtypeField};["esriFieldTypeSmallInteger","esriFieldTypeInteger"].indexOf(b.type)&&
a.typeIdField===b.name&&a.types&&0<a.types.length&&(void 0===a.types[0].domains[b.name]?e={isSubtypeField:!0,subtypeField:b.name}:e.isSubtypeField=!1);return!1};w._getRenderValueLabelsForUnique=function(a){var b=null;if(a.drawingInfo&&a.drawingInfo.renderer&&"uniqueValue"===a.drawingInfo.renderer.type){b={};a=a.drawingInfo.renderer.uniqueValueInfos;for(var e=0;e<a.length;e++){var f=a[e];b[f.value]=f.label}}return b};w._updateCodedValueListFromRender=function(a,b){if((a=w._getRenderValueLabelsForUnique(a))&&
b)for(var e=0;e<b.length;e++){var f=b[e];a[f.value]&&(f.label=a[f.value])}return b};w.getDefaultPortalFieldInfo=function(a){var b=a.name,b={fieldName:b,label:a.alias||b,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(a.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":b.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":b.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":b.format={dateFormat:"longMonthDayYear"}}return b};
w.getDefaultPopupInfo=function(a,b,e){var f=null;a&&a.fields&&(f={title:b,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},d.forEach(a.fields,function(a){var b=!1;e?d.some(e,r.hitch(this,function(b){return b&&a.name.toLowerCase()===b.toLowerCase()}))&&(b=!0):b=!0;b&&(b=this.getDefaultPortalFieldInfo(a),b.visible=!0,b.isEditable=a.editable,f.fieldInfos.push(b))},this));return f};w._tryLocaleNumber=function(a){var b=w.localizeNumber(a);if(null===b||void 0===b)b=a;return b};w._tryLocaleDate=
function(a){var b=w.localizeDate(a);b||(b=a.toLocaleDateString());return b};w.getFieldInfoByFieldName=function(a,b){var e=null;a&&0<a.length&&d.some(a,r.hitch(this,function(a){return a.name===b?(e=a,!0):!1}));return e};w.getDateFieldFormatByFieldName=function(a,b){if(a&&0<a.length)for(var e=0;e<a.length;e++){var f=a[e];if(f.fieldName===b){if(f.format&&f.format.dateFormat)return f.format.dateFormat;break}}return""};w.completePopupFieldFromLayerField=function(a,b){for(var e in a){var f=a[e].name,g=
!1,k;for(k in b)if(b[k].fieldName===f){g=!0;break}g||(f=w.getPopupFieldFromLayerField(a[e]),b.push(f))}return b};w.getPopupFieldFromLayerField=function(a){return{fieldName:a.name,isEditable:a.editable,label:a.alias,visible:a.visible?a.visible:!1,stringFieldOption:"esriFieldTypeString"===a.type?"textbox":null,tooltips:"",domain:a.domain?a.domain:null}};w.containsNonLatinCharacter=function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1};w.has=function(a){var b=l(a);if(b)return b;
if("ie"===a.toLowerCase()){a=0;var e=/MSIE (\d+\.\d+);/.test(navigator.userAgent),f=!!navigator.userAgent.match(/Trident\/7.0/),g=navigator.userAgent.indexOf("rv:11.0");e&&(a=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(a=10);f&&-1!==g&&(a=11);return 11===a&&11||b}if("edge"===a.toLowerCase())return navigator.userAgent.split("Edge/")[1]||b};w.detectUserAgent=function(){var a={},b={},e=navigator.userAgent,f=navigator.platform,g=e.match(/Web[kK]it[\/]{0,1}([\d.]+)/),k=e.match(/(Android);?[\s\/]+([\d.]+)?/),
h=!!e.match(/\(Macintosh\; Intel /),u=e.match(/(iPad).*OS\s([\d_]+)/),v=e.match(/(iPod)(.*OS\s([\d_]+))?/),n=!u&&e.match(/(iPhone\sOS)\s([\d_]+)/),c=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),f=/Win\d{2}|Windows/.test(f),p=e.match(/Windows Phone ([\d.]+)/),x=c&&e.match(/TouchPad/),d=e.match(/Kindle\/([\d.]+)/),q=e.match(/Silk\/([\d._]+)/),t=e.match(/(BlackBerry).*Version\/([\d.]+)/),z=e.match(/(BB10).*Version\/([\d.]+)/),y=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),l=e.match(/PlayBook/),D=e.match(/Chrome\/([\d.]+)/)||
e.match(/CriOS\/([\d.]+)/),E=e.match(/Firefox\/([\d.]+)/),m=e.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),A=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),C=!D&&e.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),r=C||e.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);b.webkit=!!g;b.webkit&&(b.version=g[1]);k&&(a.android=!0,a.version=k[2]);n&&!v&&(a.ios=a.iphone=!0,a.version=n[2].replace(/_/g,"."));u&&(a.ios=a.ipad=!0,a.version=u[2].replace(/_/g,
"."));v&&(a.ios=a.ipod=!0,a.version=v[3]?v[3].replace(/_/g,"."):null);p&&(a.wp=!0,a.version=p[1]);c&&(a.webos=!0,a.version=c[2]);x&&(a.touchpad=!0);t&&(a.blackberry=!0,a.version=t[2]);z&&(a.bb10=!0,a.version=z[2]);y&&(a.rimtabletos=!0,a.version=y[2]);l&&(b.playbook=!0);d&&(a.kindle=!0,a.version=d[1]);q&&(b.silk=!0,b.version=q[1]);!q&&a.android&&e.match(/Kindle Fire/)&&(b.silk=!0);D&&(b.chrome=!0,b.version=D[1]);E&&(b.firefox=!0,b.version=E[1]);m&&(a.firefoxos=!0,a.version=m[1]);A&&(b.ie=!0,b.version=
A[1]);r&&(h||a.ios||f)&&(b.safari=!0,a.ios||(b.version=r[1]));C&&(b.webview=!0);a.tablet=!!(u||l||k&&!e.match(/Mobile/)||E&&e.match(/Tablet/)||A&&!e.match(/Phone/)&&e.match(/Touch/));a.phone=!(a.tablet||a.ipod||!(k||n||c||t||z||D&&e.match(/Android/)||D&&e.match(/CriOS\/([\d.]+)/)||E&&e.match(/Mobile/)||A&&e.match(/Touch/)));return{os:a,browser:b}};w.isMobileUa=function(){var a=w.detectUserAgent();return!0===a.os.phone||!0===a.os.tablet?!0:!1};w.inMobileSize=function(){var a=m.getMarginBox(document.body);
if(a.w<=window.jimuConfig.breakPoints[0]||a.h<=window.jimuConfig.breakPoints[0])return m.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;m.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1};w.getObjectIdField=function(a){if(a.objectIdField)return a.objectIdField;a=a.fields;for(var b=0;b<a.length;b++){var e=a[b];if("esriFieldTypeOID"===e.type)return e.name}return null};w.isNeedHttpsButNot=function(){var a=navigator.geolocation,b=window.hasOwnProperty("isSecureContext");return(b&&
window.isSecureContext||!b&&"https:"===window.location.protocol)&&a?!1:!0};w.toFeatureSet=function(a){var b=new L;"[object Object]"===Object.prototype.toString.call(a)&&(a=[a]);b.features=a;if(0<a.length){var e;d.some(a,function(a){if(a.geometry)return e=a,!0});if(e){a=e.getLayer();var f={};a&&(b.displayFieldName=a.displayField,d.forEach(a.fields,r.hitch(this,function(a){var b=a.name;f[b]=a.alias||b})),b.fieldAliases=f);b.geometryType=e.geometry.type;b.spatialReference=e.geometry.spatialReference}}return b};
w.showValidationErrorTipForFormDijit=function(a){try{!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),setTimeout(r.hitch(this,function(){a.focusNode.blur()}),100))}catch(aa){console.error(aa)}};w.getFeatureLayerDefinition=function(a){var b=null,e=a.graphics;a.graphics=[];var f=a.toJson();a.graphics=e;f&&(b=f.layerDefinition);return b};w.simulateClickEvent=function(a){if(l("safari")){var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!0);a.dispatchEvent(b)}else a.click()};
w.getFeatureSetByLayerAndFeatures=function(a,b){var e=new L;e.fields=r.clone(a.fields);e.features=b;e.geometryType=a.geometryType;e.fieldAliases={};d.forEach(e.fields,r.hitch(this,function(a){var b=a.name;e.fieldAliases[b]=a.alias||b}));return e};w.featureAction=function(){return{zoomTo:function(a,b,e){e||(e={});if(a&&b&&0<b.length){var f=d.every(b,function(a){return a&&a.spatialReference&&a.type});if(d.every(b,function(a){return a&&a.geometry&&a.geometry.spatialReference&&a.geometry.type})||f)f&&
(b=d.map(b,function(a){return{geometry:a}})),w.zoomToFeatureSet(a,{features:b},e.extentFactor)}},flash:function(a,b){function e(a,b){d.forEach(g,function(e,f){e.setSymbol(b?a:k[f]||h)})}function f(a){return function(){setTimeout(function(){e(u,!0);g[0]&&b&&b.redraw();setTimeout(function(){e(null,!1);g[0]&&b&&b.redraw();a()},200)},200)}}if(d.every(a||[],function(a){return a&&a.geometry})){var g=a;a=g[0];var k=d.map(g,function(a){return a.symbol}),h=a.symbol||r.getObject("renderer.symbol",!1,b),u=null;
b&&"esriGeometryPoint"===b.geometryType?u=new J(require.toUrl("jimu")+"/images/flash.gif",20,20):(u=r.clone(h))&&(u.outline?u.outline.setColor("#ffc500"):u.setColor("#ffc500"));a&&h&&u&&b&&("esriGeometryPoint"===b.geometryType?(e(u,!0),b.redraw(),setTimeout(function(){e(null,!1);b.redraw()},2E3)):f(f(f(function(){})))())}},panTo:function(a,b){d.every(b||[],function(a){return a&&a.geometry})&&(0<b.length?b=R.graphicsExtent(b).getCenter():(b=b[0].geometry,b="polyline"===b.type||"polygon"===b.type?b.getExtent().getCenter():
"extent"===b.type?b.getCenter():"multipoint"===b.type?1<b.points.length?b.getExtent().getCenter():b.getPoint(0):b),a.centerAt(b))},showPopup:function(a,b){d.every(b||[],function(a){return a&&a.geometry})&&(a=a.infoWindow,a.setFeatures(b),b=b[0],"point"===b.geometry.type?a.show(b.geometry,{closetFirst:!0}):a.show(b.geometry.getExtent().getCenter(),{closetFirst:!0}))}}}();w.isInConfigOrPreviewWindow=function(){var a=!1;try{a=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(aa){a=
!1}return!!a};w.getAppHref=function(){var a="";return a=w.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};w.getAppIdFromUrl=function(){var a=!0,b=w.getAppHref();if(-1!==b.indexOf("id\x3d")||-1!==b.indexOf("appid\x3d")||-1!==b.indexOf("apps"))a=!1;if(!0===a)return b;a=this.urlToObject(window.location.href);if(a.query&&(a.query.id||a.query.appid))return a.query.id||a.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(a=
window.appInfo.appPath.split("/"),a.length&&2<a.length)return a[a.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};w.getEditorContentHeight=function(a,b,e){var f=new h;this._content=a;this._dom=b;this._domParam=e;var g=setTimeout(r.hitch(this,function(){clearTimeout(g);g=null;var a=0,b=this._domParam.contentWidth;try{var e=document.createElement("div");e.setAttribute("id","fakeContent");m.setStyle(e,"background-size","contain");e.innerHTML=this._content;this._dom.appendChild(e);if(e){var k=
q("img",e);k&&k.length&&k.style({maxWidth:b-20+"px"});m.setStyle(e,"position","absolute");m.setStyle(e,"width",b+"px");m.setStyle(e,"left","-99999px");m.setStyle(e,"top","-99999px");m.setStyle(e,"visibility","hidden");var h=m.getContentBox(e);h.h&&(a=h.h,a+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(ha){console.error("can't getEditorContentHeight"+ha),a=200}f.resolve(a)}),1500);return f};w.getBase64Data=function(a){var b=new h;if(a&&a.startWith("data:image"))b.resolve(a);
else try{I({url:a,handleAs:"arraybuffer"}).then(function(a){var e=new FileReader;e.onloadend=function(){b.resolve(e.result)};e.onerror=function(){b.resolve(null)};e.readAsDataURL(new Blob([a],{type:"image/png"}))},function(){b.resolve(null)})}catch(fa){console.warn(fa),b.resolve(null)}return b};w.getEditorTextColor=function(a,b){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:w.getColorRecordName(a),forceAttr:b}}};w.getEditorBackgroundColor=function(a){return{name:"dijit.editor.plugins.EditorBackgroundColor",
custom:{recordUID:w.getColorRecordName(a)}}};w.getColorRecordName=function(a){return"wab_cr_"+(a||"")};w.b64toBlob=function(a,b,e){b=b||"";e=e||512;a=window.atob(a.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""));for(var f=[],g=0;g<a.length;g+=e){for(var k=a.slice(g,g+e),h=Array(k.length),u=0;u<k.length;u++)h[u]=k.charCodeAt(u);k=new Uint8Array(h);f.push(k)}return new Blob(f,{type:b})};w.subtractionArray=function(a,b){for(var e=a.length-1;0<=e;e--)for(var f=a[e],g=b.length-1;0<=g;g--)if(f===
b[g]){a.splice(e,1);b.splice(g,1);break}return a};w.resourcesUrlToBlob=function(a){return I({url:a,handleAs:"blob"})};w.processItemResourceOfAppConfig=function(a,b){function e(a){var b=a.obj,e=a.key,f={obj:b,key:e};"number"===typeof a.i?(f.i=a.i,f.value=b[e][a.i]):f.value=b[e];return f}function f(a){for(var b in a)if("object"===typeof a[b])if(Array.isArray(a[b]))for(var e=a,k=b,h=0;h<e[k].length;h++)"string"===typeof e[k][h]?g(e,k,h):"object"===typeof e[k][h]&&f(e[k][h]);else f(a[b]);else"string"===
typeof a[b]&&g(a,b)}function g(a,f,g){"number"===typeof g?b.test(a[f][g])&&(u=b.func(e({obj:a,key:f,i:g})),"function"===typeof u.then?h.push(u):k.push(u)):b.test(a[f])&&(u=b.func(e({obj:a,key:f})),"function"===typeof u.then?h.push(u):k.push(u))}var k=[],h=[],u;f(a);return 0<h.length?n(h).then(function(b){0<k.length&&(b=b.concat(k));return{appConfig:a,result:b}}):{appConfig:a,result:k}};w.isEsriDomain=function(a){return/^https?:\/\/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(a)};w.uniqueArray=function(a){for(var b=
[],e=0;e<a.length;e++)-1===b.indexOf(a[e])&&b.push(a[e]);return b};w.isNotEmptyObject=function(a,b){return b?w.isObject(a)&&0<Object.keys(a).length&&Array.isArray(a):w.isObject(a)&&0<Object.keys(a).length};w.getMinOfArray=function(a){return Number(Math.min.apply(Math,a))};w.getDataSchemaFromLayerDefinition=function(a){var b=a.fields.filter(function(a){return"esriFieldTypeOID"===a.type}),b=0<b.length?b[0]:null;return{geometryType:a.geometryType,fields:a.fields,displayField:a.displayField,objectIdField:b,
typeIdField:a.typeIdField}};w.isValidPointGeometry=function(a){return a&&"point"===a.type&&w.isTrueOrZero(a.x)&&w.isTrueOrZero(a.y)};w.isVaildPointGeometry=w.isValidPointGeometry;w.isNumberOrNumberString=function(a){return/^-?[1-9]\d*$/.test(a)||/^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$/.test(a)};w.convertNumberToPercentage=function(a,b){if(!w.isNumberOrNumberString(a))return a;"undefined"===typeof b&&(b=2);var e=c.locale,e="ar"===e||"tr"===e;a=Number(a);var f=!1;0>a&&(f=!0,a=Math.abs(a));a=(100*
a).toFixed(b);a=w.localizeNumber(a);a=e?"%"+a:a+"%";f&&(a="-"+a);return a};w.getClientFeaturesFromMap=function(a,b,e,f){var g=[],k=!1;if(b){e?0<b.getSelectedFeatures().length?(g=b.getSelectedFeatures(),k=!0):g=b.graphics:g=b.graphics;f&&(g=w.filterFeaturesByExtent(a.extent,g));if(g&&0<g.length){var h=w.getObjectIdField(b);h&&(a=g[0])&&a.attributes&&a.attributes.hasOwnProperty(h)&&g.sort(function(a,b){a.attributes||(a.attributes={});b.attributes||(b.attributes={});a=a.attributes[h];b=b.attributes[h];
return a<b?-1:a>b?1:0})}g.isSelectedFeatures=k;return g}};w.filterFeaturesByExtent=function(a,b){var e=a.normalize();return b=d.filter(b,r.hitch(this,function(a){try{if(a.geometry){var b="point"===a.geometry.type||"multipoint"===a.geometry;return d.some(e,r.hitch(this,function(e){return b?e.contains(a.geometry):E.intersects(e,a.geometry)}))}}catch(da){console.error(da)}return!1}))};w.upperCaseString=function(a){return a&&"string"===typeof a?a.toUpperCase():a};w.lowerCaseString=function(a){return a&&
"string"===typeof a?a.toLowerCase():a};return w})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(r,d,m){var l=r.NodeList;d.extend(l,{_buildArrayFromCallback:function(c){for(var d=[],q=0;q<this.length;q++){var p=c.call(this[q],this[q],d);p&&(d=d.concat(p))}return d},_getUniqueAsNodeList:function(c){for(var d=[],q=0,p;p=c[q];q++)1==p.nodeType&&-1==m.indexOf(d,p)&&d.push(p);return this._wrap(d,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(c,
d){c=this._getUniqueAsNodeList(c);c=d?r._filterResult(c,d):c;return c._stash(this)},_getRelatedUniqueNodes:function(c,d){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(d),c)},children:function(c){return this._getRelatedUniqueNodes(c,function(c,q){return d._toArray(c.childNodes)})},closest:function(c,d){return this._getRelatedUniqueNodes(null,function(q,p){do if(r._filterResult([q],c,d).length)return q;while(q!=d&&(q=q.parentNode)&&1==q.nodeType);return null})},parent:function(c){return this._getRelatedUniqueNodes(c,
function(c,d){return c.parentNode})},parents:function(c){return this._getRelatedUniqueNodes(c,function(c,d){for(d=[];c.parentNode;)c=c.parentNode,d.push(c);return d})},siblings:function(c){return this._getRelatedUniqueNodes(c,function(c,d){d=[];for(var p=c.parentNode&&c.parentNode.childNodes,h=0;h<p.length;h++)p[h]!=c&&d.push(p[h]);return d})},next:function(c){return this._getRelatedUniqueNodes(c,function(c,d){for(c=c.nextSibling;c&&1!=c.nodeType;)c=c.nextSibling;return c})},nextAll:function(c){return this._getRelatedUniqueNodes(c,
function(c,d){for(d=[];c=c.nextSibling;)1==c.nodeType&&d.push(c);return d})},prev:function(c){return this._getRelatedUniqueNodes(c,function(c,d){for(c=c.previousSibling;c&&1!=c.nodeType;)c=c.previousSibling;return c})},prevAll:function(c){return this._getRelatedUniqueNodes(c,function(c,d){for(d=[];c=c.previousSibling;)1==c.nodeType&&d.push(c);return d})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?
[this[this.length-1]]:[],this)},even:function(){return this.filter(function(c,d){return 0!=d%2})},odd:function(){return this.filter(function(c,d){return 0==d%2})}});return l})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],function(r){r=r.getObject("dojox.encoding.base64",!0);r.encode=function(d){for(var m=[],l=d.length,c=l%3,l=l-c,t=0;t<l;){var q=d[t++]<<16|d[t++]<<8|d[t++];m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>18&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>
12&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>6&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q&63))}switch(c){case 2:q=d[t++]<<16|d[t++]<<8;m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>18&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>12&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>6&
63));m.push("\x3d");break;case 1:q=d[t++]<<16,m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>18&63)),m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>12&63)),m.push("\x3d"),m.push("\x3d")}return m.join("")};r.decode=function(d){d=d.split("");for(var m=[],l=d.length;"\x3d"==d[--l];);for(var c=0;c<l;){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d[c++])<<18;c<=l&&(t|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d[c++])<<
12);c<=l&&(t|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d[c++])<<6);c<=l&&(t|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d[c++]));m.push(t>>>16&255);m.push(t>>>8&255);m.push(t&255)}for(;0==m[m.length-1];)m.pop();return m};return r})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(r,d,m,l,c,t,q,
p){r=r(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var h=m.map(this.geometries,function(k){return k.toJson()}),n={};n.outSR=this.outSR.wkid||l.toJson(this.outSR.toJson());n.inSR=this.geometries[0].spatialReference.wkid||l.toJson(this.geometries[0].spatialReference.toJson());n.geometries=l.toJson({geometryType:p.getJsonType(this.geometries[0]),geometries:h});this.transformation&&(n.transformation=this.transformation.wkid||
l.toJson(this.transformation));q.isDefined(this.transformForward)&&(n.transformForward=this.transformForward);return n}});c("extend-esri")&&d.setObject("tasks.ProjectParameters",r,t);return r})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(r,d){var m=r.clone(d);m.declaredClass="jimu.portalUrlUtils";m.getPortalUrlFromLocation=function(){return m.getPortalServerFromLocation()+m.getDeployContextFromLocation()};m.getPortalSignInUrlFromLocation=
function(){var d=m.getPortalUrlFromLocation();return m.setHttpsProtocol(d+"home/signin.html")};m.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};m.getDeployContextFromLocation=function(){var d=window.location.href.split("?")[0],c=d.indexOf("/home/");0>c&&(c=d.indexOf("/apps/"));d=d.substring(d.indexOf(window.location.host)+window.location.host.length+1,c);"/"!==d&&(d="/"+d+"/");return d};m.getRestBaseUrlFromLocation=function(){return window.location.protocol+
"//"+window.location.host+m.getDeployContextFromLocation()+"sharing/rest/"};return m})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var r={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(d){return this.substr(0,d.length)===d});"function"!==typeof String.prototype.endWith&&
(String.prototype.endWith=function(d){return this.substr(this.length-d.length,d.length)===d});r.getServerByUrl=function(d){d=(d||"").trim();d=d.replace(/^(http(s?):?)\/\//gi,"");0===d.indexOf("//")&&(d=d.slice(2));return d.split("/")[0]};r.getServerWithProtocol=function(d){var m="";if(d=(d||"").trim()){var l=r.getServerByUrl(d);if(!l)return m;var c=r.getProtocol(d);c?m=c+"://"+l:0===d.indexOf("//")&&(m="//"+l)}return m};r.isSameServer=function(d,m){d=r.getServerByUrl(d)||"";m=r.getServerByUrl(m)||
"";return d.toLowerCase()===m.toLowerCase()};r.getDomain=function(d){var m="";if(d=r.getServerByUrl(d))d=d.replace(/:\d+$/,""),d=d.match(/[^.]\w+\.\w+$/),null!==d&&(m=d[0],/^\d+\.\d+$/.test(m)&&(m=""));return m};r.isSameDomain=function(d,m){d=r.getDomain(d);m=r.getDomain(m);return""!==d&&d===m};r.isOrgOnline=function(d){return 0<=r.getServerByUrl(d).toLowerCase().indexOf(".maps.arcgis.com")};r.isOnline=function(d){return 0<=r.getServerByUrl(d).toLowerCase().indexOf(".arcgis.com")};r.isArcGIScom=function(d){d=
r.getServerByUrl(d).toLowerCase();return"www.arcgis.com"===d||"arcgis.com"===d};r.getStandardPortalUrl=function(d){var m=r.getServerByUrl(d);if(""===m)return"";r.isOnline(m)?(r.isArcGIScom(m)&&(m="www.arcgis.com"),d=r.addProtocol(d),d=r.getProtocol(d)+"://"+m):(d=(d||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),d=r.addProtocol(d),d.replace(new RegExp("http(s?)://"+m,"g"),"")||(d+="/arcgis"));return d};r.isSamePortalUrl=function(d,m){var l=/^http(s?):\/\//gi,c=/^\/\//gi;d=r.getStandardPortalUrl(d).toLowerCase().replace(l,
"").replace(c,"");m=r.getStandardPortalUrl(m).toLowerCase().replace(l,"").replace(c,"");return d===m};r.addProtocol=function(d){if(-1>=d.toLowerCase().indexOf("http://")&&-1>=d.toLowerCase().indexOf("https://")){var m="";"undefined"!==typeof window&&window.location?(m=window.location.protocol,d=d.startWith("//")?m+d:d.startWith("/")?m+"//"+window.location.host+d:m+"//"+d):(m="http:",d=d.startWith("//")?m+d:m+"//"+d)}return d};r.getProtocol=function(d){var m="";d=d.toLowerCase();0===d.indexOf("https://")?
m="https":0===d.indexOf("http://")&&(m="http");return m};r.updateUrlProtocolByOtherUrl=function(d,m){m=m.toLowerCase();0===m.indexOf("https://")?d=r.setHttpsProtocol(d):0===m.indexOf("http://")&&(d=r.setHttpProtocol(d));return d};r.removeProtocol=function(d){return d.replace(/^http(s?):\/\//i,"//")};r.setHttpProtocol=function(d){d=r.addProtocol(d);return d.replace(/^https:\/\//,"http://")};r.setHttpsProtocol=function(d){d=r.addProtocol(d);return d.replace(/^http:\/\//,"https://")};r.setProtocol=function(d,
m){return 0<=m.indexOf("https")?r.setHttpsProtocol(d):0<=m.indexOf("http")?r.setHttpProtocol(d):d};r.getSharingUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/sharing/rest");return m};r.getOAuth2Url=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/sharing/rest/oauth2");return m};r.getAppIdUrl=function(d,m){var l="";(d=r.getStandardPortalUrl(d))&&(l=d+"/sharing/rest/oauth2/apps/"+m);return l};r.getSignInUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/home/signin.html");
return m};r.getBaseSearchUrl=function(d){var m="";d=r.getStandardPortalUrl(d);(d=d.replace(/\/*$/g,""))&&(m=d+"/sharing/rest/search");return m};r.getBaseItemUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/sharing/rest/content/items");return m};r.getItemUrl=function(d,m){var l="";(d=r.getBaseItemUrl(d))&&m&&(l=d+"/"+m);return l};r.getItemDataUrl=function(d,m){var l="";(d=r.getItemUrl(d,m))&&(l=d+"/data");return l};r.getItemGroupsUrl=function(d,m){var l="";(d=r.getItemUrl(d,m))&&(l=d+
"/groups");return l};r.getGenerateTokenUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/sharing/generateToken");return m};r.getItemDetailsPageUrl=function(d,m){var l="";d&&m&&(d=r.getStandardPortalUrl(d),l=d+"/home/item.html?id\x3d"+m);return l};r.getUserProfilePageUrl=function(d,m){var l="";d&&m&&(d=r.getStandardPortalUrl(d),l=d+"/home/user.html?user\x3d"+m);return l};r.getBaseGroupUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/sharing/rest/community/groups");return m};
r.getPortalSelfInfoUrl=function(d){var m="";(d=r.getStandardPortalUrl(d||""))&&(m=d+"/sharing/rest/portals/self");return m};r.getCommunitySelfUrl=function(d){var m="";(d=r.getStandardPortalUrl(d||""))&&(m=d+"/sharing/rest/community/self");return m};r.getBaseUserUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/sharing/rest/community/users");return m};r.getUserUrl=function(d,m){var l="",c=r.getBaseUserUrl(d);d&&m&&(l=c+"/"+m);return l};r.getUserTagsUrl=function(d,m){var l="",c=r.getUserUrl(d,
m);d&&m&&(l=c+"/tags");return l};r.getUserThumbnailUrl=function(d,m,l){var c="";(d=r.getUserUrl(d,m))&&l&&(c=d+"/info/"+l);return c};r.getContentUrl=function(d){var m="";d&&(d=r.getStandardPortalUrl(d),m=d+"/sharing/rest/content");return m};r.getUserContentUrl=function(d,m,l){var c="",c="";d&&m&&(c=r.getContentUrl(d),c=l?c+"/users/"+m+"/"+l:c+"/users/"+m);return c};r.getUserContentItemUrl=function(d,m,l){var c="",c="";d&&m&&l&&(c=r.getUserContentUrl(d,m),c=c+"/items/"+l);return c};r.getItemResourceUrl=
function(d,m,l){var c="",c="";d&&m&&(c=r.getContentUrl(d),c=l?c+"/items/"+m+"/resources/"+l:c+"/items/"+m+"/resources");return c};r.getAddItemUrl=function(d,m,l){var c="",c="";d&&m&&(c=r.getUserContentUrl(d,m,l),c+="/addItem");return c};r.getDeleteItemUrl=function(d,m,l){var c="";(d=r.getUserItemsUrl(d,m))&&(c=d+"/"+l+"/delete");return c};r.getUserItemsUrl=function(d,m,l){var c="",c="";d&&m&&(c=r.getUserContentUrl(d,m,l),c+="/items");return c};r.getUpdateItemUrl=function(d,m,l,c){var t="",t="";d&&
m&&(t=r.getUserItemsUrl(d,m,c),t=t+"/"+l+"/update");return t};r.shareItemUrl=function(d,m,l,c){var t="",t="";d&&m&&(t=r.getUserItemsUrl(d,m,c),t=t+"/"+l+"/share");return t};r.getHomeIndexUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/home/index.html");return m};r.getHomeMapViewerUrl=function(d,m){var l="";if(d=r.getStandardPortalUrl(d))l=d+"/home/webmap/viewer.html",l=m?l+("?webmap\x3d"+m):l+"?useExisting\x3d1";return l};r.getHomeSceneViewerUrl=function(d,m){var l="";if(d=r.getStandardPortalUrl(d))l=
d+"/home/webscene/viewer.html",m&&(l+="?webscene\x3d"+m);return l};r.getHomeGalleryUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/home/gallery.html");return m};r.getHomeGroupsUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/home/groups.html");return m};r.getHomeMyContentUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/home/content.html");return m};r.getHomeMyOrganizationUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/home/organization.html");
return m};r.getHomeUserUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/home/user.html");return m};r.getPortalHelpUrl=function(d,m){var l="";(d=r.getStandardPortalUrl(d))&&(l=d+"/portalhelp/"+(m||"en")+"/website/help/");return l};r.getPortalAdminHelpUrl=function(d,m){var l="";(d=r.getStandardPortalUrl(d))&&(l=d+"/portalhelp/"+(m||"en")+"/admin/help/");return l};r.getPortalProxyUrl=function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/sharing/proxy");return m};r.getOAuth2SignOutUrl=
function(d){var m="";(d=r.getStandardPortalUrl(d))&&(m=d+"/sharing/rest/oauth2/signout");return m};r.getNewPrintUrl=function(d){var m="";if(d=r.getStandardPortalUrl(d))d=r.setHttpProtocol(d),m=d+"/sharing/tools/newPrint";return m};r.getSwitchAccoutnsUrl=function(d,m,l){var c="";if(d=r.getStandardPortalUrl(d))c=d+"/home/pages/Account/manage_accounts.html#client_id\x3d"+m,l&&(c+="\x26redirect_uri\x3d"+l);c&&(c=r.setHttpsProtocol(c));return c};return r})},"jimu/shared/utils":function(){define([],function(){function r(d,
c){function t(c,p){var h,n,k,a,g="widgetOnScreen"===c;if(d[c]){if(d[c].groups)for(h=0;h<d[c].groups.length;h++)if(k=d[c].groups[h],p(k,{index:h,isWidget:!1,groupId:k.id,isThemeWidget:!1,isOnScreen:g}),d[c].groups[h].widgets)for(n=0;n<d[c].groups[h].widgets.length;n++)a=d[c].groups[h].widgets[n],p(a,{index:n,isWidget:!0,groupId:k.id,isThemeWidget:a.uri&&-1<a.uri.indexOf("themes/"+d.theme.name),isOnScreen:g});if(d[c].widgets)for(h=0;h<d[c].widgets.length;h++)a=d[c].widgets[h],p(d[c].widgets[h],{index:h,
isWidget:!0,groupId:c,isThemeWidget:a.uri&&-1<a.uri.indexOf("themes/"+d.theme.name),isOnScreen:g})}}t("widgetOnScreen",c);t("widgetPool",c)}var d={},m="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");d.visitElement=r;d.getConfigElementById=function(d,c){var t;if("map"===c)return d.map;r(d,function(d){if(d.id===c)return t=
d,!0});return t};d.getConfigElementByLabel=function(d,c){var t;if("map"===c)return d.map;r(d,function(d){if(d.label||d.name===c)return t=d,!0});return t};d.getConfigElementsByName=function(d,c){var t=[];if("map"===c)return[d.map];r(d,function(d){d.name===c&&t.push(d)});return t};d.getWidgetNameFromUri=function(d){d=d.split("/");d.pop();return d.pop()};d.getAmdFolderFromUri=function(d){d=d.split("/");d.pop();return d.join("/")+"/"};d.widgetProperties=m;d.processWidgetProperties=function(d){"undefined"===
typeof d.properties.isController&&(d.properties.isController=!1);"undefined"===typeof d.properties.isThemeWidget&&(d.properties.isThemeWidget=!1);"undefined"===typeof d.properties.hasVersionManager&&(d.properties.hasVersionManager=!1);"undefined"===typeof d.properties.mirrorIconForRTL&&(d.properties.mirrorIconForRTL=!1);m.forEach(function(c){"undefined"===typeof d.properties[c]&&(d.properties[c]=!0)})};d.getControllerWidgets=function(d){var c=[];d.visitElement(function(d){d.isController&&c.push(d)});
return c};d.addI18NLabelToManifest=function(d,c,t){function q(h,k){k[p]&&(d.i18nLabels[h]=k[p]);"theme"===d.category&&(d.layouts&&d.layouts.forEach(function(a){d["i18nLabels_layout_"+a.name]||(d["i18nLabels_layout_"+a.name]={});d["i18nLabels_layout_"+a.name][h]=k["_layout_"+a.name]}),d.styles&&d.styles.forEach(function(a){d["i18nLabels_style_"+a.name]||(d["i18nLabels_style_"+a.name]={});d["i18nLabels_style_"+a.name][h]=k["_style_"+a.name]}));"widget"===d.category&&d.featureActions&&d.featureActions.forEach(function(a){d["i18nLabels_featureAction_"+
a.name]||(d["i18nLabels_featureAction_"+a.name]={});d["i18nLabels_featureAction_"+a.name][h]=k["_featureAction_"+a.name]})}d.i18nLabels={};var p="widget"===d.category?"_widgetLabel":"_themeLabel";c&&c.root&&c.root[p]&&(d.i18nLabels.defaultLabel=c.root[p],"theme"===d.category&&(d.layouts&&d.layouts.forEach(function(h){d["i18nLabels_layout_"+h.name]={};d["i18nLabels_layout_"+h.name].defaultLabel=c.root["_layout_"+h.name]}),d.styles&&d.styles.forEach(function(h){d["i18nLabels_style_"+h.name]={};d["i18nLabels_style_"+
h.name].defaultLabel=c.root["_style_"+h.name]})),"widget"===d.category&&d.featureActions&&d.featureActions.forEach(function(h){d["i18nLabels_featureAction_"+h.name]={};d["i18nLabels_featureAction_"+h.name].defaultLabel=c.root["_featureAction_"+h.name]}));for(var h in t)q(h,t[h])};d.isHostedService=function(d){if(!d)return!1;var c=-1!==d.indexOf(".arcgis.com/");d=-1!==d.indexOf("//services")||-1!==d.indexOf("//tiles")||-1!==d.indexOf("//features");return c&&d};return d})},"jimu/zoomToUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred esri/config esri/graphic esri/graphicsUtils esri/geometry/Extent esri/geometry/Point esri/SpatialReference esri/geometry/webMercatorUtils esri/tasks/ProjectParameters".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k){var a={zoomToFeatureSet:function(g,f,b){var e=f.features&&0<f.features.length&&f.features[0].getLayer&&f.features[0].getLayer(),e=e?e.id:null;f=a.graphicsExtent(f.features,b);return a.zoomToExtent(g,f,e)},zoomToExtent:function(g,f,b){var e;if(!g||!a.isValidExtent(f))return e=new m,e.reject(),e;b?(e=new m,require(["jimu/LayerStructure"],function(k){(k=k.getInstance().getNodeById(b))?k.zoomTo(f).then(function(){e.resolve()},function(){e.reject()}):a.projectToMapSpatialReference(g,
f).then(function(b){f.isSinglePoint&&(b=a.convertSinglePointExtent(g,b));g.setExtent(b,!0);e.resolve()},function(){e.reject()})})):e=a.projectToMapSpatialReference(g,f).then(function(b){f.isSinglePoint&&(b=a.convertSinglePointExtent(g,b));return g.setExtent(b,!0)});return e},isValidExtent:function(g){return g&&a.isTrueOrZero(g.xmin)&&a.isTrueOrZero(g.ymin)&&a.isTrueOrZero(g.xmax)&&a.isTrueOrZero(g.ymax)}};a.isVaildExtent=a.isValidExtent;a.isTrueOrZero=function(a){return 0===a?!0:!!a};a.convertSinglePointExtent=
function(g,f){var b=g.getScale();if(b=a.getMedianScale(g,b,0))f=a.adjustHeightToAspectRatio(g,f),f=a.getExtentForScale(f,g.width,b);return f};a.graphicsExtent=function(a,f){var b=null;try{if(a&&1===a.length&&"esri.geometry.Multipoint"===a[0].geometry.declaredClass&&1===a[0].geometry.points.length){var e=a[0].geometry.points[0],g=new p(e[0],e[1],a[0].geometry.spatialReference);a=[new c(g)]}if(a&&1===a.length&&"esri.geometry.Point"===a[0].geometry.declaredClass){var k=a[0].geometry,b=new q(k.x-1E-4,
k.y-1E-4,k.x+1E-4,k.y+1E-4,k.spatialReference);b.isSinglePoint=!0}else a&&0<a.length&&(b=t.graphicsExtent(a))&&"number"===typeof f&&0<f&&(b=b.expand(f))}catch(x){console.error(x)}return b};a.projectToMapSpatialReference=function(g,f){return a.projectToSpatialReference(f,g.spatialReference)};a.projectToSpatialReference=function(a,f){var b=new m,e=a;if(f&&a)if(f.equals(a.spatialReference))b.resolve(e);else if(f.isWebMercator()&&a.spatialReference.equals(new h(4326)))e=n.geographicToWebMercator(a),e.isSinglePoint=
a.isSinglePoint,b.resolve(e);else if(f.equals(new h(4326))&&a.spatialReference.isWebMercator())e=n.webMercatorToGeographic(a),e.isSinglePoint=a.isSinglePoint,b.resolve(e);else{var g=l&&l.defaults&&l.defaults.geometryService;if(g&&"esri.tasks.GeometryService"===g.declaredClass){var v=new k;v.geometries=[a];v.outSR=f;g.project(v).then(function(f){(e=f&&0<f.length&&f[0])?(e.isSinglePoint=a.isSinglePoint,b.resolve(e)):b.reject()},function(){})}else b.reject()}else b.reject();return b};a.getMapLods=function(a){var f=
null;a._params&&a._params.lods&&(f=d.map(a._params.lods,r.hitch(this,function(a){return a.toJson()})));return f};a.getMedianScale=function(g,f,b){return a.getTargetScale(g,2,f,b)};a.getTargetScale=function(g,f,b,e){g=a.getMapLods(g);var k=1;if(g){var h=[],c=[];d.forEach(g,function(a){0<b&&a.scale>b||(a.scale<e?c.push(a.scale):h.push(a.scale))});h.reverse();1<=h.length?(k=c.length?c.length/g.length:1,f=Math.floor((h.length-1)/(f/k)),f=h[f]):f=null}else f=0===b?null:(b-e)/f;return f};a.getScaleForNextTileLevel=
function(g,f,b){if(g=a.getMapLods(g)){if(b){for(b=0;b<g.length;b++)if(g[b].scale<f)return g[b].scale-1;return g[g.length-1].scale-1}for(b=g.length-1;0<=b;b--)if(g[b].scale>f)return g[b].scale+1;return g[0].scale+1}return b?f-1:f+1};a.adjustExtentToAspectRatio=function(a,f){a=a.width/a.height;var b=f.getWidth()/f.getHeight();b>a?(a=f.getWidth()/a/2,r.mixin(f,{ymin:f.getCenter().y-a,ymax:f.getCenter().y+a})):b<a&&(a=f.getHeight()*a/2,r.mixin(f,{xmin:f.getCenter().x-a,xmax:f.getCenter().x+a}));return f};
a.adjustHeightToAspectRatio=function(a,f){a=f.getWidth()*(a.height/a.width)/5;r.mixin(f,{ymin:f.getCenter().y-a,ymax:f.getCenter().y+a});return f};a.getExtentForScale=function(a,f,b){var e=20015077/180,g=esri.config.defaults,k=esri.WKIDUnitConversion,h,c,n=a.spatialReference;n&&(h=n.wkid,c=n.wkt);n=null;h?n=k.values[k[h]]:c&&-1!==c.search(/^PROJCS/i)&&(k=/UNIT\[([^\]]+)\]\]$/i.exec(c))&&k[1]&&(n=parseFloat(k[1].split(",")[1]));return a.expand(b*f/(39.37*(n||e)*g.screenDPI)/a.getWidth())};a.getScaleForExtent=
function(a,f){var b=20015077/180,e=esri.config.defaults,g=esri.WKIDUnitConversion,k,h,c=a.spatialReference;c&&(k=c.wkid,h=c.wkt);c=null;k?c=g.values[g[k]]:h&&-1!==h.search(/^PROJCS/i)&&(g=/UNIT\[([^\]]+)\]\]$/i.exec(h))&&g[1]&&(c=parseFloat(g[1].split(",")[1]));return a.getWidth()/f*(c||b)*39.37*e.screenDPI};return a})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all dijit/registry ./utils jimu/tokenUtils ./dijit/Message ./DataSourceManager".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v){var x=null,D=r(q,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(t.subscribe("app/mapLoaded",d.hitch(this,this._onMapLoaded)),t.subscribe("app/mapChanged",d.hitch(this,this._onMapChanged))):(t.subscribe("mapLoaded",d.hitch(this,this._onMapLoaded)),t.subscribe("mapChanged",d.hitch(this,this._onMapChanged)));window.isBuilder?(t.subscribe("app/sceneViewLoaded",d.hitch(this,this._onSceneViewLoaded)),t.subscribe("app/sceneViewChanged",
d.hitch(this,this._onSceneViewChanged))):(t.subscribe("sceneViewLoaded",d.hitch(this,this._onSceneViewLoaded)),t.subscribe("sceneViewChanged",d.hitch(this,this._onSceneViewChanged)));window.isBuilder?(t.subscribe("app/appConfigLoaded",d.hitch(this,this._onAppConfigLoaded)),t.subscribe("app/appConfigChanged",d.hitch(this,this._onAppConfigChanged))):(t.subscribe("appConfigLoaded",d.hitch(this,this._onAppConfigLoaded)),t.subscribe("appConfigChanged",d.hitch(this,this._onAppConfigChanged)));t.subscribe("userSignIn",
d.hitch(this,this._onUserSignIn));t.subscribe("userSignOut",d.hitch(this,this._onUserSignOut));t.subscribe("builder/actionTriggered",d.hitch(this,this._onActionTriggered));t.subscribe("/dnd/move/start",d.hitch(this,this._onMoveStart))},loadWidget:function(a){var b=new c,e;a=d.clone(a);(e=this.getWidgetById(a.id))?b.resolve(e):g([this.loadWidgetClass(a),this.loadWidgetManifest(a)]).then(d.hitch(this,function(a){var e=a[0],g=a[1];this.loadWidgetResources(g).then(d.hitch(this,function(a){try{var k=this.createWidget(g,
e,a);l.setAttr(k.domNode,"data-widget-name",g.name);console.log("widget ["+g.uri+"] created.")}catch(H){console.log("create ["+g.uri+"] error:"+H.stack),new u({message:window.jimuNls.widgetManager.createWidgetError+": "+g.uri}),f.byId(g.id)&&f.byId(g.id).destroy(),b.reject(H)}setTimeout(d.hitch(this,function(){b.resolve(k);this.emit("widget-created",k);t.publish("widgetCreated",k)}),50)}),function(a){b.reject(a)})}),function(a){b.reject(a)});return b},loadWidgetClass:function(a){var e=new c,f;f=a.isRemote?
a.uri+".js":a.uri;require(b.getRequireConfig(),[f],d.hitch(this,function(a){e.resolve(a)}));b.checkError(a.uri,e);return e},loadWidgetResources:function(a){var b=new c,e,f,k,h=[];k=d.clone(a);a=this.tryLoadWidgetConfig(k);e=this._tryLoadResource(k,"i18n");f=this._tryLoadResource(k,"style");k=this._tryLoadResource(k,"template");h.push(a);h.push(e);h.push(k);h.push(f);g(h).then(d.hitch(this,function(a){var e={};e.config=a[0];e.i18n=a[1];e.template=a[2];e.style=a[3];b.resolve(e)}),function(a){b.reject(a)});
return b},loadWidgetManifest:function(e){var f=new c,g=b.getUriInfo(e.uri),g=g.isRemote?g.folderUrl+"manifest.json?f\x3djson":g.folderUrl+"manifest.json";if(e.manifest)return f.resolve(e),f;a(g,{handleAs:"json",headers:{"X-Requested-With":null}}).then(d.hitch(this,function(a){if(a.error&&a.error.code)return f.reject(a.error);a.category="widget";d.mixin(a,b.getUriInfo(e.uri));b.manifest.addI18NLabel(a).then(d.hitch(this,function(){this._processManifest(a);b.widgetJson.addManifest2WidgetJson(e,a);f.resolve(e)}))}),
function(a){f.reject(a)});return f},getWidgetMarginBox:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return{};if(a._marginBox)return a._marginBox;var b={left:-9999,top:-9999,relativeTo:a.position.relativeTo};a._isTestSizeFlag=!0;a.setPosition(b);this.openWidget(a);a._marginBox=a.getMarginBox();this.closeWidget(a);"undefined"!==typeof a._isTestSizeFlag&&delete a._isTestSizeFlag;return a._marginBox},_processManifest:function(a){b.manifest.addManifestProperies(a);b.manifest.processManifestLabel(a,
window.dojoConfig.locale)},createWidget:function(a,e,f){if(this.getWidgetById(a.id))return this.getWidgetById(a.id);f.config&&f.i18n&&(f.config=b.replacePlaceHolder(f.config,f.i18n));a.rawConfig=a.config;a.config=f.config||{};this.appConfig._appData&&this._mergeAgolConfig(a);a.nls=f.i18n||{};f.template&&(a.templateString=f.template);a["class"]="jimu-widget";a.label||(a.label=a.name);this.map&&(a.map=this.map);a.appConfig=this.appConfig;f={};for(var g in a)a.hasOwnProperty(g)&&(f[g]=a[g]);f.widgetManager=
this;a=new e(f);a.clazz=e;h.after(a,"startup",d.hitch(this,this._postWidgetStartup,a));h.before(a,"destroy",d.hitch(this,this._onDestroyWidget,a));a.domNode.addEventListener("click",d.hitch(this,this._onClickWidget,a),{capture:!0});this.loaded.push(a);return a},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var a=m.map(this.loaded,function(a){return a.id});m.forEach(a,function(a){this.destroyWidget(a)},this);this.loaded=[]},loadWidgetSettingPage:function(a){var b=new c;
a=d.clone(a);a.id+="_setting";g([this.loadWidgetSettingClass(a)]).then(d.hitch(this,function(e){var g=e[0];this.loadWidgetSettingPageResources(a).then(d.hitch(this,function(e){var k;e={nls:e.i18n,templateString:e.template,appConfig:this.appConfig,"class":"jimu-widget-setting"};"HTML3D"===window.appInfo.appType?e.sceneView=this.sceneView:e.map=this.map;for(var v in a)a.hasOwnProperty(v)&&(e[v]=a[v]);try{k=new g(e),l.setAttr(k.domNode,"data-widget-name-setting",e.name),h.before(k,"destroy",d.hitch(this,
this._onDestroyWidgetSetting,k)),b.resolve(k)}catch(G){new u({message:window.jimuNls.widgetManager.createWidgetSettingPageError+":"+a.uri}),f.byId(e.id)&&f.byId(e.id).destroy(),b.reject(G)}}),function(a){console.log(a)})}),function(a){b.reject(a)});return b},loadWidgetSettingClass:function(a){var e=new c,f;f=a.isRemote?a.folderUrl+"setting/Setting.js":a.amdFolder+"setting/Setting";require(b.getRequireConfig(),[f],d.hitch(this,function(a){e.resolve(a)}));b.checkError(a.folderUrl+"setting/Setting.js",
e);return e},loadWidgetSettingPageResources:function(a){var b=new c,e,f,k=[];a=d.clone(a);e=this._tryLoadResource(a,"settingI18n");f=this._tryLoadResource(a,"settingTemplate");a=this._tryLoadResource(a,"settingStyle");k.push(e);k.push(f);k.push(a);g(k).then(d.hitch(this,function(a){var e={};e.i18n=a[0]||{};e.template=a[1];e.style=a[2];b.resolve(e)}),function(a){console.log(a)});return b},getWidgetById:function(a){var b;m.some(this.loaded,function(e){if(e.id===a)return b=e,!0},this);return b},getWidgetByLabel:function(a){var b;
m.some(this.loaded,function(e){if(e.label===a)return b=e,!0},this);return b},getWidgetsByName:function(a){var b=[];m.some(this.loaded,function(e){e.name===a&&b.push(e)},this);return b},changeWindowStateTo:function(a,b){"normal"===b?this.normalizeWidget(a):"minimized"===b?this.minimizeWidget(a):"maximized"===b?this.maximizeWidget(a):console.log("error state: "+b)},closeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if("closed"!==a.state){this.activeWidget&&this.activeWidget.id===
a.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);l.setStyle(a.domNode,"display","none");a.setState("closed");try{a.onClose()}catch(A){console.log(console.error("fail to close widget "+a.name+". "+A.stack))}}this.appConfig.mode||this._removeDataSourceUsage(a)},openWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if(!a.started)try{a.started=!0,a.startup()}catch(A){console.error("fail to startup widget "+a.name+". "+A.stack)}if("closed"===a.state){l.setStyle(a.domNode,
"display","");a.setState("opened");try{a.onOpen()}catch(A){console.error("fail to open widget "+a.name+". "+A.stack)}}this.appConfig.mode||this._addDataSourceUsage(a)},activateWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"opened"===a.state&&this._activeWidget(a)},maximizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("maximized");try{a.onMaximize()}catch(A){console.log(console.error("fail to maximize widget "+
a.name+". "+A.stack))}},minimizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("minimized");try{a.onMinimize()}catch(A){console.log(console.error("fail to minimize widget "+a.name+". "+A.stack))}},normalizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("normal");try{a.onNormalize()}catch(A){console.log(console.error("fail to normalize widget "+
a.name+". "+A.stack))}},destroyWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this._removeWidget(a);try{a.destroy()}catch(A){console.log(console.error("fail to destroy widget "+a.name+". "+A.stack))}},tryLoadWidgetConfig:function(a){return this._tryLoadWidgetConfig(a).then(d.hitch(this,function(b){return this._upgradeWidgetConfig(a,b).then(function(b){return a.config=b})}))},triggerWidgetOpen:function(a){function b(a){var b=h.after(a,"onOpen",function(){b.remove();
e.resolve(a)})}var e=new c,f=this.getWidgetById(a);if(f){if("closed"!==f.state)return e.resolve(f),e;b(f)}else var g=t.subscribe("widgetCreated",d.hitch(this,function(b){b.id===a&&(g.remove(),e.resolve(b))}));t.publish("openWidget",a);return e},_tryLoadWidgetConfig:function(e){var f=new c;if(e.config&&d.isObject(e.config))return f.resolve(e.config),f;if(e.config){if(require.cache["url:"+e.config])return f.resolve(n.parse(require.cache["url:"+e.config])),f;f=b.processUrlInAppConfig(e.config);f=f.split("/");
f[f.length-1]=encodeURIComponent(f[f.length-1]);f=f.join("/");return a(f,{handleAs:"json",headers:{"X-Requested-With":null}})}return this._tryLoadResource(e,"config").then(function(a){e.isDefaultConfig=!0;return a})},_upgradeWidgetConfig:function(a,e){var f=new c,g=a.manifest.version,k=a.version,h;if(g===k)return f.resolve(e),f;if(!1===a.hasVersionManager)return a.version=g,f.resolve(e),f;require(b.getRequireConfig(),[a.amdFolder+(a.isRemote?"VersionManager.js":"VersionManager")],d.hitch(this,function(b){b=
new b;var u=b.getVersionIndex(k),v=b.getVersionIndex(g);if(u>v)f.reject("Bad widget version number, "+a.name+","+k);else try{h=b.upgrade(e,k,g),a.version=g,f.resolve(h)}catch(L){console.log("Read widget ["+a.name+"] old config error,"+L.stack),f.resolve(e)}}));return f},loadWidgetStyle:function(a){var e=this._getStyleIdFromWidgetJson(a,!1),f=new c;return l.byId(e)?(f.resolve("load"),f):b.loadStyleLink(e,a.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(a){var e=
this._getStyleIdFromWidgetJson(a,!0),f=new c;return l.byId(e)?(f.resolve("load"),f):b.loadStyleLink(e,a.settingStyleFile)},loadWidgetConfig:function(e){e=require(b.getRequireConfig()).toUrl(e.configFile);if(require.cache["url:"+e]){var f=new c;f.resolve(n.parse(require.cache["url:"+e]));return f}return a(e,{handleAs:"json",headers:{"X-Requested-With":null}})},loadWidgetI18n:function(a){var e=new c;require(b.getRequireConfig(),["dojo/i18n!"+a.i18nFile],function(a){e.resolve(a)});return e},loadWidgetSettingI18n:function(a){var e=
new c;require(b.getRequireConfig(),["dojo/i18n!"+a.settingI18nFile],function(a){e.resolve(a)});return e},loadWidgetTemplate:function(a){var e=new c;require(b.getRequireConfig(),["dojo/text!"+a.templateFile],function(a){e.resolve(a)});b.checkError(a.templateFile,e);return e},loadWidgetSettingTemplate:function(a){var e=new c;require(b.getRequireConfig(),["dojo/text!"+a.settingTemplateFile],function(a){e.resolve(a)});b.checkError(a.settingTemplateFile,e);return e},removeWidgetStyle:function(a){this._removeStyle(this._getStyleIdFromWidgetJson(a,
!1))},removeWidgetSettingStyle:function(a){this._removeStyle(this._getStyleIdFromWidgetJson(a,!0))},_removeStyle:function(a){if(l.byId(a)){var b=l.attr(a,"data-import-styles");if(b)for(var e=0;e<parseInt(b,10);e++)l.destroy(a+"_import_"+e);l.destroy(a)}},_getStyleIdFromWidgetJson:function(a,b){return this._replaceId("widget/style/"+(a.itemId?a.itemId:a.uri)+(b?"/setting":""))},getControllerWidgets:function(){return m.filter(this.loaded,function(a){return a.isController})},getOffPanelWidgets:function(){return m.filter(this.loaded,
function(a){return!a.inPanel})},getOnScreenOffPanelWidgets:function(){return m.filter(this.loaded,function(a){return a.isOnScreen&&!a.inPanel})},closeOtherWidgetsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a.gid&&this.loaded[b].id!==a.id&&this.closeWidget(this.loaded[b])},closeAllWidgetsInGroup:function(a){for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a&&this.closeWidget(this.loaded[b])},
_addDataSourceUsage:function(a){m.forEach(this._getUsedDataSourceIdFromWidget(a),function(b){v.getInstance().addDataSourceUsage(b,a.id)})},_removeDataSourceUsage:function(a){m.forEach(this._getUsedDataSourceIdFromWidget(a),function(b){v.getInstance().removeDataSourceUsage(b,a.id)})},_getUsedDataSourceIdFromWidget:function(a){if((a=this.appConfig.getConfigElementById(a.id))&&a.config){var b=n.stringify(a.config);return m.filter(Object.keys(this.appConfig.dataSource.dataSources),function(a){return-1<
b.indexOf(a)},this)}},_mergeAgolConfig:function(a){var e=this.appConfig._appData.values,f="widgets["+a.id+"]",g;for(g in e){var k=g.replace(/\//g,"_").indexOf(f+"_config");0<=k&&b.template.setConfigValue(a,g.replace(/\//g,"_").substr(k,g.length).replace(f,"widget"),e[g])}},_onUserSignIn:function(a){m.forEach(this.loaded,function(b){b.onSignIn(a)},this)},_onUserSignOut:function(){m.forEach(this.loaded,function(a){a.onSignOut()},this)},_activeWidget:function(a){if(this.activeWidget){if(this.activeWidget.id===
a.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&l.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&l.setStyle(a.domNode,"zIndex","zIndex"in a.position?a.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=a;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&
l.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),t.publish("widgetActived",a))},_onClickWidget:function(a,b){var e=k(".jimu-widget",a.domNode);if(0<e.length)for(var f=0;f<e.length;f++)if(b.target===e[f]||l.isDescendant(b.target,e[f]))return;this._activeWidget(a)},_onMoveStart:function(a){m.forEach(this.loaded,function(b){b.domNode===a.node&&this._activeWidget(b)},this)},_onAppConfigLoaded:function(a){this.appConfig=a=d.clone(a);e.setPortalUrl(a.portalUrl)},_onMapLoaded:function(a){this.map=
a},_onMapChanged:function(a){this.map=a},_onSceneViewLoaded:function(a){this.sceneView=a},_onSceneViewChanged:function(a){this.sceneView=a},_onAppConfigChanged:function(a,b,e,f){var g=d.clone(a);this.appConfig=g;m.forEach(this.loaded,function(a){a&&(a.onAppConfigChanged(g,b,e,f),"widgetChange"===b&&this._onConfigChanged(e.id,e.config,f))},this)},_onConfigChanged:function(a,b){if(a=this.getWidgetById(a))a.onConfigChanged(b),d.mixin(a.config,b)},_onActionTriggered:function(a){if("map"!==a.elementId&&
"app"!==a.elementId){var b=this.getWidgetById(a.elementId);if(b)b.onAction(a.action,a.data);else this.missedActions.push({id:a.elementId,action:{name:a.action,data:a.data}});m.forEach(this.getControllerWidgets(),function(b){if(b.widgetIsControlled(a.elementId))b.onAction(a.action,{widgetId:a.elementId,data:a.data})},this)}},_postWidgetStartup:function(a){a.started=!0;b.setVerticalCenter(a.domNode);h.after(a,"resize",d.hitch(this,b.setVerticalCenter,a.domNode));this.openWidget(a);var f=e.getPortalCredential(this.appConfig.portalUrl);
if(f)a.onSignIn(f);else a.onSignOut();this._triggerMissedAction(a)},_triggerMissedAction:function(a){this.missedActions.forEach(function(b){if(b.id===a.id)a.onAction(b.action.name,b.action.data)})},_remove:function(a){return m.some(this.loaded,function(b,e){if(b.id===a)return this.loaded.splice(e,1),!0},this)},_tryLoadResource:function(a,b){var e,f=new c;if("config"===b)e=a.amdFolder+"config.json",a.configFile=e,e="hasConfig";else if("style"===b)e=a.amdFolder+"css/style.css",a.styleFile=e,e="hasStyle";
else if("i18n"===b)e=a.amdFolder+"nls/strings.js",a.i18nFile=a.isRemote?e:a.amdFolder+"nls/strings",e="hasLocale";else if("template"===b)e=a.amdFolder+"Widget.html",a.templateFile=e,e="hasUIFile";else if("settingTemplate"===b)e=a.amdFolder+"setting/Setting.html",a.settingTemplateFile=e,e="hasSettingUIFile";else if("settingI18n"===b)e=a.amdFolder+"setting/nls/strings.js",a.settingI18nFile=a.isRemote?e:a.amdFolder+"setting/nls/strings",e="hasSettingLocale";else if("settingStyle"===b)e=a.amdFolder+"setting/css/style.css",
a.settingStyleFile=e,e="hasSettingStyle";else return f;a[e]?function(){var e;if("config"===b)e=this.loadWidgetConfig(a);else if("style"===b)e=this.loadWidgetStyle(a);else if("i18n"===b)e=this.loadWidgetI18n(a);else if("template"===b)e=this.loadWidgetTemplate(a);else if("settingTemplate"===b)e=this.loadWidgetSettingTemplate(a);else if("settingStyle"===b)e=this.loadWidgetSettingStyle(a);else if("settingI18n"===b)e=this.loadWidgetSettingI18n(a);else return f;e.then(function(a){f.resolve(a)},function(e){console.error("Load widget resource error. resource:",
b);console.error(e);new u({message:window.jimuNls.widgetManager.loadWidgetResourceError+": "+a.uri});f.reject(e)})}.apply(this):f.resolve(null);return f},_replaceId:function(a){return a.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(a){"closed"!==a.state&&this.closeWidget(a);this._removeWidget(a);this.emit("widget-destroyed",a.id);t.publish("widgetDestroyed",a.id);console.log("destroy widget ["+a.uri+"].")},_onDestroyWidgetSetting:function(a){this.removeWidgetSettingStyle(a)},_removeWidget:function(a){if("string"===
typeof a&&(a=this.getWidgetById(a),!a))return;this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget=null);this._remove(a.id);0===this.getWidgetsByName(a.name).length&&this.removeWidgetStyle(a)}});D.getInstance=function(a){null===x&&(x=new D(a),window._widgetManager=x);return x};return D})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils esri/layers/vectorTiles/kernel".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u){"function"!==typeof c.getAll&&(c.getAll=function(a){var b=[];(a=c(a))&&b.push(a);return b});g={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return e.isInConfigOrPreviewWindow()},isStringStartWith:function(a,b){return a.substr(0,b.length)===b},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=b.getStandardPortalUrl(a))&&
(a+="/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(e){var f=new l,g=b.getStandardPortalUrl(e);e=g+"/sharing";var k=b.setHttpsProtocol(g+"/sharing/generateToken?f\x3djson"),u=b.setHttpsProtocol(e);p.get(k,{jsonp:"callback"}).then(r.hitch(this,function(e){e.token?(this.webTierPortalUrls.push(g),this.removeWabAuthCookie(),h.id.getCredential(u).then(r.hitch(this,function(h){function u(a){var b=a.creationTime||(new Date).getTime(),e=a.expires;0<b&&0<e&&e>
b&&setTimeout(function(){p.get(k,{jsonp:"callback"}).then(function(b){b.token&&(a.token=b.token,a.expires=b.expires,a.creationTime=(new Date).getTime(),a.refreshServerTokens(),u(a))},function(a){console.error(a)})},.8*(e-b))}h.token||(h.token=e.token);h.expires||(h.expires=e.expires);var v=a.canUseXhr(h.server,!0);-1<v&&n.defaults.io.corsEnabledServers.splice(v,1);this._pushCorsEnabledServerInfo({host:b.getServerByUrl(g),withCredentials:!0});f.resolve(!0);u(h)}),r.hitch(this,function(){f.resolve(!0)}))):
f.resolve(!1)}),r.hitch(this,function(a){console.error(a);f.reject(a)}));return f},addAuthorizedCrossOriginDomains:function(a){if(a&&0<a.length)for(var b=0;b<a.length;b++)this.addWithCredentialDomain(a[b])},addWithCredentialDomain:function(e){if(e&&"string"===typeof e){var f=n.defaults.io.corsEnabledServers,g=b.getServerByUrl(e);(e=b.getServerWithProtocol(e))||(e="http://"+g);e=a.canUseXhr(e,!0);-1<e&&f.splice(e,1);this._pushCorsEnabledServerInfo({host:g,withCredentials:!0})}},_pushCorsEnabledServerInfo:function(a){if(a){var b=
n.defaults.io.corsEnabledServers,e="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof a&&"string"===typeof a.host){for(var f in a.host)a[f]="function"===typeof a.host[f]?function(){return a.host[f].apply(a.host,arguments)}:a.host[f];a.length=a.host.length;d.forEach(e,function(b){"function"===
typeof a.host[b]&&(a[b]=function(){return a.host[b].apply(a.host,arguments)})})}b.push(a)}},tryRegisterCredential:function(a){return this.isValidCredential(a)?d.some(h.id.credentials,r.hitch(this,function(b){return a.token===b.token}))?!1:(h.id.credentials.push(a),!0):!1},registerToken:function(a){var e=b.getSharingUrl(this.portalUrl);h.id.findCredential(e)&&d.some(h.id.credentials,r.hitch(this,function(a,b){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a))return h.id.credentials.splice(b,
1),!0}));return this._getTokenInfo(a).then(function(a){a&&h.id.registerToken(a)})},_getTokenInfo:function(a){var e=b.getPortalSelfInfoUrl(this.portalUrl);return p.get(e+("?f\x3djson\x26token\x3d"+a),{jsonp:"callback"}).then(r.hitch(this,function(e){return e.user?{server:b.getSharingUrl(this.portalUrl),ssl:e.allSSL,token:a,userId:e.user.username}:null}),function(a){console.error(a);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(a){return a&&"string"===typeof a&&
r.trim(a)},signInPortal:function(a){var e=new l;if(this._isInvalidPortalUrl(a)){a=b.getStandardPortalUrl(a);var f=b.getSharingUrl(a),g=this.getPortalCredential(a);g?setTimeout(r.hitch(this,function(){e.resolve(g)}),0):e=h.id.getCredential(f)}else setTimeout(r.hitch(this,function(){e.reject("Invalid portalurl.")}),0);return e},_loadPortalSelfInfo:function(a){a=b.getPortalSelfInfoUrl(a);return k({url:a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"})},registerOAuthInfo:function(a,b){if(!a||
"string"!==typeof a||!b||"string"!==typeof b)return null;var e=h.id.findOAuthInfo(a);e||(e=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",e=new f({appId:b,expiration:20159,portalUrl:a,authNamespace:"/",popup:!0,popupCallbackUrl:e}),h.id.registerOAuthInfos([e]));e.appId=b;return e},signOutAll:function(){var a=b.getStandardPortalUrl(this.portalUrl),e=!!h.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():
this.removeWabAuthCookie();h.id.destroyCredentials();h.id._oAuthHash=null;e&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(r.trim(a||""))},isValidCredential:function(a){var b=!1;if(a){var b=a.token,e=a.server,f=a.scope,b=b&&"string"===typeof b&&r.trim(b),e=e&&"string"===typeof e&&r.trim(e),f="portal"===f||"server"===f,g=!0;a.expires&&(a=parseInt(a.expires,10),g=(new Date).getTime(),g=a>g);b=b&&e&&f&&g}return b},isValidPortalCredentialOfPortalUrl:function(a,
e){var f=!1;this.isValidCredential(e)&&(f="portal"===e.scope,a=b.isSameServer(a,e.server),f=f&&a);return f},getPortalCredential:function(a){var e=null;a=r.trim(a||"");if(!a)return null;a=b.getStandardPortalUrl(a);(e=this._filterPortalCredential(a,h.id.credentials))||this._tryConvertArcGIScomCrendentialToOrgCredential();return e},_tryConvertArcGIScomCrendentialToOrgCredential:function(){var a=this.portalUrl;if(a&&(a=b.getStandardPortalUrl(a),b.isOrgOnline(a)&&!this._filterPortalCredential(a,h.id.credentials))){var e=
this._filterPortalCredential("http://www.arcgis.com",h.id.credentials);e&&h.id.registerToken({token:e.token,scope:"portal",userId:e.userId,server:a+"/sharing/rest",expires:e.expires})}},saveAndRegisterCookieToCredential:function(a){a=r.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=!!a.isAdmin;this.saveWabCookie(a);var b=a.server+"/sharing/rest";a.server=b;h.id.registerToken(a);return h.id.findCredential(b,a.userId)},registerAuth2Hash:function(a){a=r.clone(a);var e=1E3*parseInt(a.expires_in,
10),e=(new Date).getTime()+e,f=b.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:f,token:a.access_token,expires:e,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");c("wab_auth",t.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");
window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,e){var f=null;a=b.getStandardPortalUrl(a);e&&0<e.length&&(e=d.filter(e,r.hitch(this,function(b){return this.isValidPortalCredentialOfPortalUrl(a,b)})),0<e.length&&(f=e[e.length-1]));return f},_removePortalCredential:function(a){var e=r.trim(a||"");if(e){e=b.getStandardPortalUrl(e);for(a=d.filter(h.id.credentials,r.hitch(this,
function(a){return this.isValidPortalCredentialOfPortalUrl(e,a)}));0<a.length;)a[0].destroy(),a.splice(0,1);h.id.credentials=d.filter(h.id.credentials,r.hitch(this,function(a){return!this.isValidPortalCredentialOfPortalUrl(e,a)}))}},getUserIdByToken:function(a,e){var f=new l;if(a&&"string"===typeof a&&e&&"string"===typeof e){var g=b.getStandardPortalUrl(e);e=d.filter(h.id.credentials,r.hitch(this,function(e){var f=e.token===a&&e.userId;e=b.isSameServer(g,e.server);return f&&e}));if(0<e.length){var u=
e[0];setTimeout(r.hitch(this,function(){f.resolve(u.userId)}),0);return f}e=b.getCommunitySelfUrl(g);k({url:e,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(r.hitch(this,function(a){f.resolve(a&&a.username||"")}),r.hitch(this,function(a){console.error(a);f.reject("fail to get userId by token")}))}else setTimeout(r.hitch(this,function(){f.reject("invalid parameters")}),0);return f},xtGetCredentialFromCookie:function(a){var e=c("wab_auth"),f=null;if(e)try{f=t.parse(e)}catch(z){console.error(z)}if(!f||
"object"!==typeof f||!b.isSameServer(a,f.server)||window.location.host!==f.referer)return null;f.expires=parseInt(f.expires,10);e=(new Date).getTime();if(!(f.expires>e))return this.removeCookie("wab_auth"),null;a+="/sharing/rest";f.server=a;(e=h.id.findCredential(a))||h.id.registerToken(f);return e=h.id.findCredential(a)},removeCookie:function(a){var b=this.getCookiePath();e.removeCookie(a,b)},_getDomainsByServerName:function(a){var b=a.split("."),e=b.length;return d.map(b,r.hitch(this,function(a,
f){a=b.slice(f,e);var g="",k=a.length-1;d.forEach(a,r.hitch(this,function(a,b){g+=a;b!==k&&(g+=".")}));return g}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{q.publish("userSignIn",a)}catch(x){console.error(x)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{q.publish("anyUserSignIn",a)}catch(x){console.error(x)}},_publishCurrentPortalUserSignOut:function(a){try{q.publish("userSignOut",a)}catch(x){console.error(x)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,
a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(x){console.error(x)}},_bindEvents:function(){m.after(h.id,"signIn",r.hitch(this,function(a,b){console.log(b[1]);m.after(a,"callback",r.hitch(this,function(a,b){this._signInSuccess(b[0],!1)}));return a}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var b=a.esri&&a.esri.id;b._wab="builder";if(b){h.id=b;var e=window.esriConfig.defaults.io,
a=a.esriConfig.defaults.io;e.corsEnabledServers=a.corsEnabledServers;e.webTierAuthServers=a.webTierAuthServers;e._processedCorsServers=a._processedCorsServers;e.corsStatus=a.corsStatus;Object.defineProperty(u,"id",{get:function(){return b},enumerable:!0,configurable:!0})}}}this._bindEvents();this._started=!0}}};g.startup();return g})},"esri/layers/vectorTiles/kernel":function(){define(["require","exports","esri/kernel","./identity/IdentityManager"],function(r,d,m,l){return function(){function c(){}
Object.defineProperty(c,"id",{get:function(){return m.id?l:null},enumerable:!0,configurable:!0});c.workerMessages={};return c}()})},"esri/layers/vectorTiles/identity/IdentityManager":function(){define(["require","exports","esri/IdentityManager"],function(r,d,m){Object.defineProperty(d,"__esModule",{value:!0});d.findCredential=function(d){return m.findCredential(d)}})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),
function(r,d,m,l,c,t){return r(t,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,customZIndex:null,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=m.create("div",{"class":"title"},this.domNode),this.titleLabeNode=m.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=
m.create("div",{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(c(this.closeBtnNode,"click",d.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:l.ENTER,onClick:d.hitch(this,this.close)})},_increaseZIndex:function(){m.setStyle(this.domNode,"zIndex",501);m.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/Evented dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g){var f=0;return r([a,m],{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,customZIndex:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,isResize:!0,horizontalWidthRate:0,maxHeight:800,maxWidth:1024,enableMoveable:!0,hasTitle:!0,contentHasNoMargin:!1,hasOverlay:!0,moveToCenter:!0,customPosition:null,hiddenAfterInit:!1,constructor:function(){this.buttons=[];this.enabledButtons=
[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();this._addStylesByHeightType();this._calcAndSetPosition();c.place(this.domNode,this.container);setTimeout(d.hitch(this,function(){this._calcAndSetPosition(!0,!1)}),50);this.isResize&&this.own(q(window,"resize",d.hitch(this,function(){this._calcAndSetPosition(!0,!0)})));this.hasOverlay&&(this.overlayNode=c.create("div",{"class":"jimu-overlay"},
this.container));this.customZIndex||0===this.customZIndex?(c.setStyle(this.domNode,"zIndex",this.customZIndex+1),this.overlayNode&&c.setStyle(this.overlayNode,"zIndex",this.customZIndex)):this._increaseZIndex();this.hiddenAfterInit&&this.hide();t.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"!==typeof this.width&&(this.width=this.maxWidth);"number"===typeof this.height&&(this._fixedHeight=!0,this.autoHeight=
!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=c.create("div",{"class":"title"},this.domNode);this.titleLabeNode=c.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=c.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var a=null,a="ontouchstart"in document?h.press:"click";this.own(q(this.closeBtnNode,a,d.hitch(this,this.close)))},_initDomNode:function(){this.hasTitle&&
this._createTitleNode();this.contentContainerNode=c.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&c.place(this.content,this.contentContainerNode));this.buttonContainer=c.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&c.setStyle(this.buttonContainer,
"display","none");for(var a=this.buttons.length-1;-1<a;a--)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=this.enabledButtons.length;if(0!==a){var e=c.getContentBox(this.buttonContainer),f=c.getMarginExtents(this.enabledButtons[0]),g=c.getPadBorderExtents(this.enabledButtons[0]),k=0,g=8===p("ie")?g.l+g.r:0,k=(e.w-(f.l+f.r+g)*a)/a;0<k&&(l.forEach(this.enabledButtons,d.hitch(this,function(a){c.setStyle(a,"maxWidth",k+"px")})),
l.forEach(this.disabledButtons,d.hitch(this,function(a){c.setStyle(a,"maxWidth",k+"px")})))}},_moveableNode:function(a,e){this.moveable&&(this.moveable.destroy(),this.moveable=null);var b=c.getMarginBox(this.container);b.l=b.l-a+e;b.w+=2*(a-e);this.moveable=new k.boxConstrainedMoveable(this.domNode,{box:b,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(q(this.moveable,"Moving",d.hitch(this,this.onMoving)));this.own(q(this.moveable,"MoveStop",d.hitch(this,this.onMoveStop)))},
_getHeaderBox:function(){return 0===n("#header").length?{t:0,l:0,w:0,h:0}:c.getMarginBox("header")},_getFooterBox:function(){return 0===n(".footer",this.container).length?{t:0,l:0,w:0,h:0}:c.getMarginBox(n(".footer",this.container)[0])},_calcAndSetPosition:function(a,e){var b=c.getMarginBox(this.domNode);if("string"!==typeof this.container||c.byId(this.container)){var f=c.getContentBox(this.container),g=this._getHeaderBox(),k=this._getFooterBox(),k=f.h-g.h-k.h-40,h=0,n=0;this.customPosition&&this.customPosition.height?
(this.height=this.customPosition.height,n="number"===typeof this.height?this.height+"px":this.height):(this.height=this._fixedHeight?this.height>k?k:this.height:this.autoHeight?(b.h>k?k:b.h)||k-200:k>this.maxHeight?this.maxHeight:k,n=this.height+"px");this.customPosition&&this.customPosition.width?(this.width=this.customPosition.width,h="number"===typeof this.width?this.width+"px":this.width):("number"===typeof this.horizontalWidthRate&&0<this.horizontalWidthRate?(h=c.getMarginBox(window.document.body).w*
this.horizontalWidthRate,this.width=h=h>this.maxWidth?h:this.maxWidth):this.width=this.width||this.maxWidth,h=this.width+"px");var p=b=0;this.customPosition?(b="number"===typeof this.customPosition.left?this.customPosition.left+"px":this.customPosition.left,p="number"===typeof this.customPosition.top?this.customPosition.top+"px":this.customPosition.top):this.moveToCenter&&(p=(k-this.height)/2+g.h+20,p=p<g.h?g.h:p,b=(f.w-this.width)/2+"px",p+="px");c.setStyle(this.domNode,{width:h,height:this.autoHeight?
"auto":n,left:b,top:p});this.enableMoveable&&this._moveableNode(this.width,100);!this.moveToCenter&&a&&"block"===c.getStyle(this.domNode,"display")&&this.emit("popupHasInitedSuccessfully",e)}},setDomNodeStyls:function(a){c.setStyle(this.domNode,a)},setCustomPosition:function(a,e,f,g){this.width=f||this.width||this.maxWidth;this.height=g||this.height||this.maxHeight;f="number"===typeof this.width?this.width+"px":this.width;g="number"===typeof this.height?this.height+"px":this.height;c.setStyle(this.domNode,
{left:"number"===typeof a?a+"px":a,top:"number"===typeof e?e+"px":e,width:f,height:this.autoHeight?"auto":g})},_addStylesByHeightType:function(){this.autoHeight?(c.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&c.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(c.addClass(this.contentContainerNode,"content-absolute"),this.hasTitle||c.addClass(this.contentContainerNode,"no-popup-title-content-absolute"),c.addClass(this.buttonContainer,"button-container-absolute"),
0===this.buttons.length&&c.setStyle(this.contentContainerNode,{bottom:"15px"}));this.contentHasNoMargin&&c.addClass(this.contentContainerNode,"content-fill-Popup")},_increaseZIndex:function(){c.setStyle(this.domNode,"zIndex",f+200+1);this.overlayNode&&c.setStyle(this.overlayNode,"zIndex",f+200);f++},setTitleLabel:function(a){this.titleNode.innerHTML=g.stripHTML(a)},onMoving:function(a){c.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){c.setStyle(a.node,"opacity",1)},show:function(){this.overlayNode&&
c.setStyle(this.overlayNode,"display","block");c.setStyle(this.domNode,"display","block")},hide:function(){this.overlayNode&&c.setStyle(this.overlayNode,"display","none");c.setStyle(this.domNode,"display","none")},close:function(){if(!this.onClose||!1!==this.onClose()){var a=this.domNode.parentNode,e=d.clone(this.domNode);c.setStyle(this.domNode,"display","none");this.overlayNode&&c.destroy(this.overlayNode);this.destroy();this.moveable&&this.moveable.destroy();c.place(e,a);t.animateProperty({node:e,
properties:{opacity:0},duration:200,onEnd:function(){c.destroy(e)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(a){var b=" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(b+=a.classNames.join(" "));var f=c.create("div",{"class":"jimu-btn jimu-popup-action-btn jimu-float-trailing jimu-trailing-margin1 "+b,innerHTML:a.label,title:a.title||a.label},this.buttonContainer);this.enabledButtons.unshift(f);b=c.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+
b,title:a.title||a.label,innerHTML:a.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(b);this.own(q(f,"click",d.hitch(this,function(b){if(a.onClick)a.onClick(b);else this.close()})))},setButtonProps:function(a,e){"number"===typeof a&&isFinite(a)||(e=a,a=0);if(e&&0!==this.enabledButtons.length)for(var b in e)"title"===b?(c.setAttr(this.enabledButtons[a],"title",e[b]),c.setAttr(this.disabledButtons[a],"title",e[b])):"label"===b&&(c.setProp(this.enabledButtons[a],"innerHTML",
e[b]),c.setProp(this.disabledButtons[a],"innerHTML",e[b]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.enabledButtons.length?(c.setStyle(this.enabledButtons[a],"display","inline-block"),c.setStyle(this.disabledButtons[a],"display","none")):(l.forEach(this.enabledButtons[a],d.hitch(this,function(a){c.setStyle(a,"display","inline-block")})),l.forEach(this.disabledButtons[a],d.hitch(this,function(a){c.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a&&
isFinite(a)&&a<this.disabledButtons.length?(c.setStyle(this.disabledButtons[a],"display","inline-block"),c.setStyle(this.enabledButtons[a],"display","none")):(l.forEach(this.disabledButtons,d.hitch(this,function(a){c.setStyle(a,"display","inline-block")})),l.forEach(this.enabledButtons,d.hitch(this,function(a){c.setStyle(a,"display","none")})))},showButton:function(a){this.enableButton(a)},hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(c.setStyle(this.disabledButtons[a],
"display","none"),c.setStyle(this.enabledButtons[a],"display","none")):(l.forEach(this.disabledButtons,d.hitch(this,function(a){c.setStyle(a,"display","none")})),l.forEach(this.enabledButtons,d.hitch(this,function(a){c.setStyle(a,"display","none")})))},resize:function(a){a&&(this.width=a.w,this.height=a.h);this._calcAndSetPosition();this.content&&this.content.domNode&&this.content.resize&&this.content.resize()}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),
function(r,d,m,l,c,t){l=r("dojo.dnd.move.constrainedMoveable",t,{constraints:function(){},within:!1,constructor:function(c,p){p||(p={});this.constraints=p.constraints;this.within=p.within},onFirstMove:function(c){var p=this.constraintBox=this.constraints.call(this,c);p.r=p.l+p.w;p.b=p.t+p.h;this.within&&(c=d.getMarginSize(c.node),p.r-=c.w,p.b-=c.h)},onMove:function(c,p){var h=this.constraintBox,n=c.node.style;this.onMoving(c,p);p.l=p.l<h.l?h.l:h.r<p.l?h.r:p.l;p.t=p.t<h.t?h.t:h.b<p.t?h.b:p.t;n.left=
p.l+"px";n.top=p.t+"px";this.onMoved(c,p)}});c=r("dojo.dnd.move.boxConstrainedMoveable",l,{box:{},constructor:function(c,p){var h=p&&p.box;this.constraints=function(){return h}}});r=r("dojo.dnd.move.parentConstrainedMoveable",l,{area:"content",constructor:function(c,p){var h=p&&p.area;this.constraints=function(){var c=this.node.parentNode,k=m.getComputedStyle(c),a=d.getMarginBox(c,k);if("margin"==h)return a;var g=d.getMarginExtents(c,k);a.l+=g.l;a.t+=g.t;a.w-=g.w;a.h-=g.h;if("border"==h)return a;
g=d.getBorderExtents(c,k);a.l+=g.l;a.t+=g.t;a.w-=g.w;a.h-=g.h;if("padding"==h)return a;g=d.getPadExtents(c,k);a.l+=g.l;a.t+=g.t;a.w-=g.w;a.h-=g.h;return a}}});return{constrainedMoveable:l,boxConstrainedMoveable:c,parentConstrainedMoveable:r}})},"jimu/DataSourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Evented dojo/when ./utils jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/portalUrlUtils jimu/filterUtils esri/tasks/query esri/tasks/QueryTask esri/tasks/StatisticDefinition ./Query".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b){var e=null,u=r(c,{constructor:function(){this._listeners=[];this._refreshTimers=[];this._dataStore={};this._jimuQueryObject={};this._dataSourceUsage={};this._itemsFilter={};this.filterUtils=new k;window.isBuilder?(l.subscribe("app/mapLoaded",d.hitch(this,this._onMapLoaded)),l.subscribe("app/mapChanged",d.hitch(this,this._onMapChanged))):(l.subscribe("mapLoaded",d.hitch(this,this._onMapLoaded)),l.subscribe("mapChanged",d.hitch(this,this._onMapChanged)));window.isBuilder?
(l.subscribe("app/appConfigLoaded",d.hitch(this,this._onAppConfigLoaded)),l.subscribe("app/appConfigChanged",d.hitch(this,this._onAppConfigChanged))):(l.subscribe("appConfigLoaded",d.hitch(this,this._onAppConfigLoaded)),l.subscribe("appConfigChanged",d.hitch(this,this._onAppConfigChanged)));l.subscribe("updateDataSourceData",d.hitch(this,this._onUpdataDataSourceData));window.isBuilder&&l.subscribe("app/dataSourceDataUpdated",d.hitch(this,this._onDataSourceDataUpdatedInApp))},getData:function(a){return this._dataStore[a]},
getDataSourceConfig:function(a){return this.appConfig.dataSource.dataSources[a]},parseDataSourceId:function(a){var b=a.split("~"),e={};if(2>b.length)return console.error("Bad data source id:",a),e;switch(b[0]){case "map":return b=a.lastIndexOf("~"),e={from:"map",layerId:a.substring(4,b)};case "widget":return e={from:"widget",widgetId:b[1]};case "external":return e={from:"external"};default:console.error("Bad data source id:",a)}},addDataSourceUsage:function(a,b){this._dataSourceUsage[a]?(0>this._dataSourceUsage[a].indexOf(b)&&
this._dataSourceUsage[a].push(b),1===this._dataSourceUsage[a].length&&this._startOneDataSource(this.appConfig.dataSource.dataSources[a])):(this._dataSourceUsage[a]=[b],this._startOneDataSource(this.appConfig.dataSource.dataSources[a]))},removeDataSourceUsage:function(a,b){this._dataSourceUsage[a]&&0<=this._dataSourceUsage[a].indexOf(b)&&(this._dataSourceUsage[a]=m.filter(this._dataSourceUsage[a],function(a){return a!==b}))},_onUpdataDataSourceData:function(a,b){this.appConfig.dataSource.dataSources[a]?
"widget"!==this.parseDataSourceId(a).from?console.error("Please update data source from widget only.",a):this._updateDataSourceData(a,b):console.error("Not found data source id:",a)},_updateDataSourceData:function(a,b){this._dataStore[a]=b;l.publish("dataSourceDataUpdated",a,b);this.emit("update",a,b)},_onDataSourceDataUpdatedInApp:function(a,b){this._updateDataSourceData(a,b)},_onMapLoaded:function(a){this.map=a;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapLoaded")},
_onMapChanged:function(a){this.map=a;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapChanged")},_onAppConfigLoaded:function(a){this.appConfig=d.clone(a)},_onAppConfigChanged:function(a,b){a=d.clone(a);window.isBuilder||("dataSourceChange"===b?this._handleDataSourceConfigChange(this.appConfig,a,b):"mapChange"===b&&this._cleanForConfigChangedDataSource(this.appConfig,a));this.appConfig=a},_handleDataSourceConfigChange:function(a,b,e){a&&(this._removeListeners(),
this._removeTimers(),this._cleanForConfigChangedDataSource(a,b));m.forEach(Object.keys(b.dataSource.dataSources),function(a){b.dataSource.dataSources[a].idObj=this.parseDataSourceId(a)},this);this._listenDataSourceChange(b.dataSource.dataSources);this._startRefreshTimer(b.dataSource,e);this._initStaticDataSource(b.dataSource)},_cleanForConfigChangedDataSource:function(a,b){var e=a.dataSource.dataSources,f=b.dataSource.dataSources;m.forEach(Object.keys(e),function(a){if(!f[a]||f[a]&&!q.isEqual(f[a],
e[a]))delete this._jimuQueryObject[a],this._updateDataSourceData(a,{features:[]}),delete this._dataStore[a]},this)},_isGlobalRefresh:function(a){return a.unifiedRefreshInterval&&0<a.unifiedRefreshInterval},_startOneDataSource:function(a){var b;b=this._isGlobalRefresh(this.appConfig.dataSource.settings)?this.appConfig.dataSource.settings.unifiedRefreshInterval:a.refreshInterval;if("map"===a.idObj.from)this._listenMapDataSourceChange(a);else if("external"===a.idObj.from&&a.filterByExtent){var e={};
e.handle=this.map.on("extent-change",d.hitch(this,this._onLayerDataChange,a));e.dsId=a.id;this._listeners.push(e)}if("map"===a.idObj.from||"external"===a.idObj.from)this._refeshDataSource(a),a.isDynamic&&(e={},e.handle=setInterval(d.hitch(this,this._refeshDataSource,a),6E4*b),e.dsId=a.id,this._refreshTimers.push(e))},_stopAndCleanOneDataSource:function(a){this._listeners=m.filter(this._listeners,function(b){return b.dsId===a.id?(b.handle.remove(),!1):!0},this);this._refreshTimers=m.filter(this._refreshTimers,
function(b){return b.dsId===a.id?(clearInterval(b.handle),!1):!0},this);this._updateDataSourceData(a.id,{features:[]})},_listenDataSourceChange:function(a){m.forEach(Object.keys(a),function(b){b=a[b];if("map"===b.idObj.from)this._listenMapDataSourceChange(b);else if("external"===b.idObj.from&&b.filterByExtent){var e={};e.handle=this.map.on("extent-change",d.hitch(this,this._onLayerDataChange,b));e.dsId=b.id;this._listeners.push(e)}},this)},_listenMapDataSourceChange:function(a){this._getLayerObject(a.idObj.layerId).then(d.hitch(this,
function(b){if(b){var e={};e.handle=b.on("edits-complete",d.hitch(this,this._onLayerDataChange,a));e.dsId=a.id;this._listeners.push(e);e={};e.handle=this._getLayerInfo(a.idObj.layerId).on("filterChanged",d.hitch(this,this._onLayerDataChange,a));e.dsId=a.id;this._listeners.push(e);a.filterByExtent&&(e={},e.handle=this.map.on("extent-change",d.hitch(this,this._onLayerDataChange,a)),e.dsId=a.id,this._listeners.push(e))}else console.error("Can not find layer that data source depends on.",a.id)}))},_onLayerDataChange:function(a){this._doQueryForDataSource(a)},
_doQueryForDataSource:function(a){("config"===this.appConfig.mode||this._dataSourceUsage[a.id]&&0!==this._dataSourceUsage[a.id].length)&&this.doQuery(a).then(d.hitch(this,function(b){this._updateDataSourceData(a.id,{features:b.features})}))},_getLayerObject:function(a){return(a=p.getInstanceSync().getLayerOrTableInfoById(a))?a.getLayerObject():t(null)},_getLayerInfo:function(a){return p.getInstanceSync().getLayerOrTableInfoById(a)},_startRefreshTimer:function(a,b){var e=a.dataSources,f=a.settings;
m.forEach(Object.keys(e),function(g){g=e[g];if("widget"!==g.idObj.from&&g.isDynamic&&g.url){var k;k=this._isGlobalRefresh(f)?f.unifiedRefreshInterval:g.refreshInterval;"dataSourceChange"===b?"external"!==g.idObj.from&&"map"!==g.idObj.from||this._refeshDataSource(g):"external"===g.idObj.from&&this._refeshDataSource(g);g={handle:setInterval(d.hitch(this,this._refeshDataSource,g),6E4*k),dsId:a.id};this._refreshTimers.push(g)}},this)},_initStaticDataSource:function(a){m.forEach(Object.keys(a.dataSources),
function(b){b=a.dataSources[b];"widget"!==b.idObj.from&&!b.isDynamic&&b.url&&this._doQueryForDataSource(b)},this)},_refeshDataSource:function(a){this._doQueryForDataSource(a)},_getDataSourceFilter:function(a){if("map"===a.idObj.from){var b=p.getInstanceSync().getLayerOrTableInfoById(a.idObj.layerId),e;b&&(e=b.getFilter());var b=a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1",f;f=e?"("+e+") and ("+b+")":b;return t(f)}return"external"===a.idObj.from?a.portalUrl&&a.itemId?this._getFilterFromItem(a.portalUrl,
a.itemId,a.url).then(d.hitch(this,function(b){var e=a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1";return f=b?"("+b+") and ("+e+")":e})):t(a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1"):t(a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1")},_getFilterExpr:function(a,b){return this.filterUtils.hasVirtualDate(a)?(this.filterUtils.isHosted=q.isHostedService(b),this.filterUtils.getExprByFilterObj(a)):a.expr},_getFilterFromItem:function(a,b,e){var f=n.getItemUrl(a,b);if(this._itemsFilter[f])return t(this._itemsFilter[f]);
var g=h.getPortal(a);return g.getItemById(b).then(d.hitch(this,function(a){return"Feature Service"!==a.type?this._itemsFilter[f]=null:g.getItemData(b).then(d.hitch(this,function(a){var b=e.split("/"),g=b.pop();g||(g=b.pop());if(!a.layers)return this._itemsFilter[f]=null;a=a.layers.filter(function(a){return a.id+""===g})[0];return a&&a.layerDefinition?this._itemsFilter[f]=a.layerDefinition.definitionExpression:this._itemsFilter[f]=null}))}))},doQuery:function(e){e.idObj||(e.idObj=this.parseDataSourceId(e.id));
this.emit("begin-update",e.id);return this._getQueryObjectFromDataSource(e).then(d.hitch(this,function(k){var h,u;if("Features"===e.type){if("serviceLimitation"===e.resultRecordType)return h=k,u=new g(e.url),u.execute(h);var c=this._jimuQueryObject[e.id];!c||c.url===e.url&&q.isEqual(c.query.toJson(),k.toJson())||(delete this._jimuQueryObject[e.id],c=null);c||(c={},c.url=e.url,c.query=k,"all"!==e.resultRecordType&&(c.pageSize=e.resultRecordCount),c=new b(c),this._jimuQueryObject[e.id]=c);return"all"===
e.resultRecordType?c.getAllFeatures():c.queryByPage(1)}u=new g(e.url);h=new a;return this._getDataSourceFilter(e).then(d.hitch(this,function(a){h.where=a;e.filterByExtent&&(h.geometry=this.map.extent);e.dataSchema.groupByFields&&0<e.dataSchema.groupByFields.length&&(h.groupByFieldsForStatistics=e.dataSchema.groupByFields);e.dataSchema.orderByFields&&0<e.dataSchema.orderByFields.length&&(h.orderByFields=e.dataSchema.orderByFields);h.outStatistics=e.dataSchema.statistics.map(function(a){var b=a.onStatisticField+
"_"+a.statisticType;"count"===a.statisticType&&(b="STAT_COUNT");var b=q.upperCaseString(b),e=new f;e.statisticType=a.statisticType;e.onStatisticField=a.onStatisticField;e.outStatisticFieldName=b;return e});return u.execute(h)}))}))},_getQueryObjectFromDataSource:function(b){return this._getDataSourceFilter(b).then(d.hitch(this,function(e){var f=new a;f.where=e;b.filterByExtent&&(f.geometry=this.map.extent);f.outFields=b.dataSchema.fields.map(function(a){return a.name});b.dataSchema.orderByFields&&
0<b.dataSchema.orderByFields.length&&(f.orderByFields=b.dataSchema.orderByFields);f.returnGeometry=!0;f.outSpatialReference=this.map.spatialReference;return t(f)}))},_removeListeners:function(){this._listeners.forEach(d.hitch(this,function(a){a.handle.remove()}));this._listeners=[]},_removeTimers:function(){this._refreshTimers.forEach(d.hitch(this,function(a){clearInterval(a.handle)}));this._refreshTimers=[]}});u.getInstance=function(){null===e&&(e=new u,window._datasourceManager=e);return e};return u})},
"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/Evented dojo/promise/all ./LayerInfoFactory".split(" "),function(r,d,m,l,c,t,q,p,h){var n=r([q],{declaredClass:"jimu.LayerInfos",map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,_tableInfos:null,_basemapLayerInfos:null,_finalBasemapLayerInfos:null,_basemapLayers:null,_unreachableLayersTitleOfWebmap:null,_objectId:null,_layerInfoFactory:null,constructor:function(a,
f){this._objectId=Math.random();this._unreachableLayersTitleOfWebmap=[];this._basemapLayers=f.baseMap.baseMapLayers;this._operLayers=f.operationalLayers;this._tables=f.tables;this._layerInfoFactory=new h(a,this);this.map=a;this._initLayerInfos();this._initBasemapLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();this._clearAddedFlag(this._finalLayerInfos);this._clearAddedFlag(this._finalBasemapLayerInfos);this._initFinalLayerInfos();
this._initFinalBasemapLayerInfos();this._markFirstOrLastNode()},getLayerInfoArrayOfWebmap:function(){var a=[];d.forEach(this.getLayerInfoArray(),function(f){for(var b=0;b<this._operLayers.length;b++)if(f.id===this._operLayers[b].id){a.push(f);break}b===this._operLayers.length&&0<=this._removedLayerInfoIdsFromFeatureCollection.indexOf(f.id)&&a.push(f)},this);return a},getTableInfoArrayOfWebmap:function(){var a=[];d.forEach(this.getTableInfoArray(),function(f){for(var b=0;b<this._tables.length;b++)if(f.id===
this._tables[b].id){a.push(f);break}},this);return a},getLayerInfoArray:function(){return d.filter(this._finalLayerInfos,function(a){m.getObject("_wabProperties.isTemporaryLayer",!1,a.layerObject)&&(a._flag._isTemporaryLayerInfo=!0);return!a._flag._isTemporaryLayerInfo})},getTableInfoArray:function(){return this._tableInfos},getBasemapLayerInfoArray:function(){return this._finalBasemapLayerInfos},addFeatureCollection:function(a,f){var b=this._getUniqueTopLayerInfoId(f),e={layers:[]};d.forEach(a,function(a,
f){a.id=b+"_"+f;e.layers.push({id:a.id,layerObject:a})},this);this.map.addLayers(a);var g;try{g=this._layerInfoFactory.create({featureCollection:e,title:f||b,id:b},this.map),g.init()}catch(v){console.warn(v.message),g=null}g&&(g._extraOfWebmapLayerInfo=!0,this._layerInfos.push(g),this.update(),this._onLayersUpdated(g,g.getRootLayerInfo()))},addTable:function(a){a=this._addTables([a],this._tableInfos);return a[0]?a[0]:null},removeTable:function(a){var f=-1;d.forEach(this._tableInfos,function(b,g){a.id===
b.id&&(f=g)});if(0<=f){var b=this._tableInfos[f];this._tableInfos.splice(f,1);b.destroy();this._onTableChange([a],n.REMOVED)}},_addTables:function(a,f){var b=[],e=[];d.forEach(a,function(a){var g;try{a.layerObject={url:a.url,featureCollectionData:a.featureCollectionData,empty:!0},a.id=this._getUniqueTableId(a.id),a.selfType="table",g=this._layerInfoFactory.create(a),g.init()}catch(x){console.warn(x.message),g=null}g&&(b.push(g),f.push(g),e.push(g.getLayerObject()))},this);p(e).then(m.hitch(this,function(a){var e=
[];d.forEach(a,function(a,f){f=b[f];a?e.push(f):(this.removeTable(f),f.destroy())},this);this._onTableChange(e,n.ADDED)}));return b},_getUniqueTableId:function(a){var f=this._tableInfos.concat(this._tableInfos||[]);return this._getUniqueLayerOrTableId(a,f)},_getUniqueTopLayerInfoId:function(a){return this._getUniqueLayerOrTableId(a,this._finalLayerInfos)},_getUniqueLayerOrTableId:function(a,f){var b=1,e;a||(a="table");for(e=a;;){for(var g=0;g<f.length&&f[g].id!==e;g++);if(g===f.length)return e;e=
a+"_"+b.toString();b++}},_traversal:function(a,f){for(var b=0;b<f.length;b++)if(f[b].traversal(a))return!0;return!1},traversal:function(a){var f=this.getLayerInfoArray();return this._traversal(a,f)},traversalLayerInfosOfWebmap:function(a){var f=this.getLayerInfoArrayOfWebmap();return this._traversal(a,f)},traversalAll:function(a){var f=this.getLayerInfoArray(),b=this.getBasemapLayerInfoArray(),e=this.getTableInfoArray(),f=f.concat(b.concat(e));return this._traversal(a,f)},_traversalAllWithSpecialLayerInfo:function(a){return this._traversal(a,
this._finalLayerInfos.concat(this._tableInfos))},getLayerInfoById:function(a){return this._findLayerInfoById(a)},getTableInfoById:function(a){var f=null;d.some(this.getTableInfoArray(),function(b){if(b.id===a)return f=b,!0});return f},getLayerOrTableInfoById:function(a){var f=null;this.traversalAll(function(b){if(b.id===a)return f=b,!0});return f},getLayerInfoByTopLayerId:function(a){return this._findTopLayerInfoById(a)},moveUpLayer:function(a,f){var b=null;f=f?f:1;a=this._getTopLayerInfoIndexById(a.id);
0<=a-f&&(b=this._finalLayerInfos[a-f].obtainLayerIndexesInMap().length,this._finalLayerInfos[a].moveLayerByIndex(this._finalLayerInfos[a-f].obtainLayerIndexesInMap()[b-1].index),b=this._finalLayerInfos[a-f],t.publish("layerInfos/layerReorder",a,f,"moveup"));return b},_reorderLayerInfosArray:function(a,f,b){"moveup"===b?(b=this._finalLayerInfos[a],this._finalLayerInfos.splice(a,1),this._finalLayerInfos.splice(a-f,0,b)):(b=this._finalLayerInfos[a],this._finalLayerInfos.splice(a+f+1,0,b),this._finalLayerInfos.splice(a,
1));this._markFirstOrLastNode();return b},moveDownLayer:function(a,f){var b=null;f=f?f:1;a=this._getTopLayerInfoIndexById(a.id);a+f<=this._finalLayerInfos.length-1&&(this._finalLayerInfos[a].moveLayerByIndex(this._finalLayerInfos[a+f].obtainLayerIndexesInMap()[0].index),b=this._finalLayerInfos[a+f],t.publish("layerInfos/layerReorder",a,f,"movedown"));return b},getBasemapLayers:function(){var a=[];d.forEach(this.map.layerIds.concat(this.map.graphicsLayerIds||[]),function(f){f=this.map.getLayer(f);
"basemap"!==f._basemapGalleryLayerType&&"reference"!==f._basemapGalleryLayerType||a.push(f)},this);return a.reverse()},getMapNotesLayerInfoArray:function(){return d.filter(this.getLayerInfoArray(),function(a){return a.isMapNotesLayerInfo()},this)},restoreState:function(a){var f=a&&a.layerOptions?a.layerOptions:null;d.forEach(this._finalLayerInfos,function(a){a.resetLayerObjectVisibility(f)},this)},getUnreachableLayersTitle:function(){return this._unreachableLayersTitleOfWebmap},getObjectId:function(){return this._objectId},
_initLayerInfos:function(){this._layerInfos=[];this._initSpecifiedLayerInfos(this._operLayers,this._layerInfos)},_initBasemapLayerInfos:function(){this._basemapLayerInfos=[];this._initSpecifiedLayerInfos(this._basemapLayers,this._basemapLayerInfos)},_initSpecifiedLayerInfos:function(a,f){var b;d.forEach(a,function(a){try{b=this._layerInfoFactory.create(a),b.init()}catch(u){console.warn(u.message),b=null,this._unreachableLayersTitleOfWebmap.push(a.title)}b&&f.push(b)},this)},_extraSetLayerInfos:function(){this._removedLayerInfoIdsFromFeatureCollection=
[];d.forEach(this._finalLayerInfos||this._layerInfos,function(a,f){var b;if(a._needToRenew()){try{b=this._layerInfoFactory.create(a.originOperLayer),b.init()}catch(u){console.warn(u.message),b=null}b&&(a.destroy(),this._finalLayerInfos[f]=b)}else if(a.originOperLayer.featureCollection){var e=[];d.forEach(a.getSubLayers(),function(a){e.push(a.id)});d.forEach(e,function(b){this.map.getLayer(b)||a.removeSubLayerById(b)},this);1===a.getSubLayers().length&&(f=a.getSubLayers()[0],this.map.getLayer(f.id).title=
a.title,a.removeSubLayerById(f.id),this._removedLayerInfoIdsFromFeatureCollection.push(f.id),a.id+="_logically_removed")}},this)},_refineFinalLayerInfos:function(){this._finalLayerInfos&&(this._finalLayerInfos=d.filter(this._finalLayerInfos,function(a){return!a._flag._invalid}))},_initFinalLayerInfos:function(){var a,f,b=this._finalLayerInfos||this._layerInfos;this._finalLayerInfos=[];for(a=this.map.graphicsLayerIds.length-1;0<=a;a--)f=this.map.graphicsLayerIds[a],this._isBasemap(f)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(f,
b),f,!0);for(a=this.map.layerIds.length-1;0<=a;a--)f=this.map.layerIds[a],this._isBasemap(f)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(f,b),f,!1);this._refineFinalLayerInfos()},_initTablesInfos:function(){this._tableInfos=[];var a=this._tables&&this._tables.reverse();a&&this._addTables(a,this._tableInfos)},_initFinalBasemapLayerInfos:function(){var a=this._finalBasemapLayerInfos||this._basemapLayerInfos;this._finalBasemapLayerInfos=[];d.forEach(this.getBasemapLayers(),function(f){var b;
d.some(a,function(a){if(a.id===f.id)return b=a,!0},this);this._addToFinalBasemapLayerInfos(b,f.id,!1)},this)},_isBasemap:function(a){for(var f=!1,b=this.getBasemapLayers(),e=0;e<b.length;e++)b[e].id===a&&(f=!0);return f},_addToFinalBasemapLayerInfos:function(a,f,b){this._addToSpecifiedLayerInfos(a,f,b,this._finalBasemapLayerInfos)},_addToFinalLayerInfos:function(a,f,b){this._addToSpecifiedLayerInfos(a,f,b,this._finalLayerInfos)},_addToSpecifiedLayerInfos:function(a,f,b,e){var g;if(a)a._addedFlag||
a.isGraphicLayer()!==b||(e.push(a),a._addedFlag=!0);else{a=this.map.getLayer(f);if("esri.layers.GraphicsLayer"!==a.declaredClass&&"esri.layers.LabelLayer"!==a.declaredClass){try{var k={layerObject:a,title:this._getLayerTitle(a),id:a.id||" "};m.mixin(k,m.getObject("_wabProperties.originOperLayer",!1,a));g=this._layerInfoFactory.create(k,this.map);g.init()}catch(x){console.warn(x.message),g=null}g&&(m.getObject("_wabProperties.isTemporaryLayer",!1,a)&&(g._flag._isTemporaryLayerInfo=!0),e.push(g))}("esri.layers.ArcGISDynamicMapServiceLayer"===
a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass)&&g&&g._getServiceDefinition().then(m.hitch(this,function(a){var b=[];d.forEach(a.tables,function(a){a.url=g.getUrl()+"/"+a.id;a.id=g.id+"_"+a.id;a.title=this._getLayerTitle(a);b.push(a)},this);this._addTables(b,this._tableInfos)}))}},_getLayerTitle:function(a){if(a.title)return a.title;if(m.getObject("_wabProperties.originalLayerName",!1,a))return a.name||a.id;var f=a.label||a.name||"";if(a.url){var b;b=a.url.indexOf("/FeatureServer");
-1===b&&(b=a.url.indexOf("/MapServer"));-1===b&&(b=a.url.indexOf("/service"));-1<b&&(b=a.url.substring(0,b),b=b.substring(b.lastIndexOf("/")+1,b.length),f=f?b+" - "+f:b)}return f||a.id},_findLayerInfoByIdAndReturnTopLayer:function(a,f){var b,e=null;f||(f=this._finalLayerInfos);for(b=0;b<f.length;b++)if(e=f[b].findLayerInfoById(a)){e=f[b];break}return e},_findLayerInfoById:function(a,f){var b,e=null;f||(f=this._finalLayerInfos);for(b=0;b<f.length&&!(e=f[b].findLayerInfoById(a));b++);return e},_findTopLayerInfoById:function(a){var f,
b=null,e=this._finalLayerInfos.concat(this._tableInfos);for(f=0;f<e.length;f++)if(e[f].id===a){b=e[f];break}return b},_getTopLayerInfoIndexById:function(a){var f,b=-1;for(f=0;f<this._finalLayerInfos.length;f++)if(this._finalLayerInfos[f].id===a){b=f;break}return b},_clearAddedFlag:function(a){d.forEach(a,function(a){a._addedFlag=!1})},_markFirstOrLastNode:function(){var a;if(this._finalLayerInfos.length){for(a=0;a<this._finalLayerInfos.length;a++)this._finalLayerInfos[a].isFirst=!1,this._finalLayerInfos[a].isLast=
!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=!0;for(a=0;a<this._finalLayerInfos.length;a++)if(!this._finalLayerInfos[a].isGraphicLayer()){a&&(this._finalLayerInfos[a-1].isLast=!0);this._finalLayerInfos[a].isFirst=!0;break}}},_onReceiveBasemapGalleryeData:function(a,f,b){"BasemapGallery"===a&&(this._basemapLayers.length=0,d.forEach(b,m.hitch(this,function(a){this._basemapLayers.push({layerObject:a,id:a.id})}),this),this.update(),this.emit("layerInfosChanged"))},
_onBasemapChange:function(a){var f;for(f=this._basemapLayers.length=0;f<a.layers.length;f++)this._basemapLayers.push({layerObject:a.layer[f],id:a.layers[f].id})},_destroyLayerInfos:function(){d.forEach(this._finalLayerInfos,m.hitch(this,function(a){a.destroy()}))},_bindEvents:function(){var a,f,b,e,k,h,p,d,q,l;a=c(this.map,"layer-add-result",m.hitch(this,this._onLayersChange,n.ADDED));f=c(this.map,"layer-remove",m.hitch(this,this._onLayersChange,n.REMOVED));p=t.subscribe("layerInfos/layerReorder",
m.hitch(this,this._onLayerReorder));e=t.subscribe("layerInfos/layerInfo/isShowInMapChanged",m.hitch(this,this._onShowInMapChanged));k=t.subscribe("layerInfos/layerInfo/visibleChanged",m.hitch(this,this._onVisibleChanged));h=t.subscribe("layerInfos/layerInfo/filterChanged",m.hitch(this,this._onFilterChanged));d=t.subscribe("layerInfos/layerInfo/rendererChanged",m.hitch(this,this._onRendererChanged));q=t.subscribe("layerInfos/layerInfo/opacityChanged",m.hitch(this,this._onOpacityChanged));l=t.subscribe("layerInfos/layerInfo/timeExtentChanged",
m.hitch(this,this._onTimeExtentChanged));b=c(this.map,"before-unload",m.hitch(this,function(){a.remove();f.remove();p.remove();e.remove();k.remove();h.remove();d.remove();b.remove();q.remove();l.remove();this._destroyLayerInfos()}))},_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(g){console.warn(g)}},_emitEventForEveryLayerInfo:function(a,f){try{d.forEach(f,function(b){b.emitEvent(a)},this)}catch(b){console.warn(b)}},_onLayersChange:function(a,f){var b=null,e;f.error||"esri.layers.GraphicsLayer"===
f.layer.declaredClass||"esri.layers.LabelLayer"===f.layer.declaredClass||(a===n.ADDED?(this.update(),b=a=this._findLayerInfoById(f.layer.id,f.layer._basemapGalleryLayerType?this._finalBasemapLayerInfos:this._finalLayerInfos),e=n.ADDED,a&&!a.isRootLayer()&&(b=a.getRootLayerInfo(),e=n.SUBLAYER_ADDED)):(b=a=this._findLayerInfoById(f.layer.id,f.layer._basemapGalleryLayerType?this._finalBasemapLayerInfos:this._finalLayerInfos),e=n.REMOVED,a&&!a.isRootLayer()&&(b=a.getRootLayerInfo(),e=n.SUBLAYER_REMOVED),
a&&a.destroy(),this.update()),b&&(f.layer._basemapGalleryLayerType?(this._emitEvent("basemapLayersChanged"),this._emitEvent("basemapLayerInfosChanged",b,e,a)):this._emitEvent("layerInfosChanged",b,e,a)))},_onTableChange:function(a,f){this._emitEvent("tableInfosChanged",a,f,a)},_onLayersUpdated:function(a,f){a.isTable?this._emitEvent("tableInfosChanged",[a],n.UPDATED,[f]):this._emitEvent("layerInfosChanged",a,n.UPDATED,f)},_onShowInMapChanged:function(a){this._emitEvent("layerInfosIsShowInMapChanged",
a);this._emitEventForEveryLayerInfo("isShowInMapChanged",a)},_onVisibleChanged:function(a){this._emitEvent("layerInfosIsVisibleChanged",a);this._emitEventForEveryLayerInfo("isVisibleChanged",a)},_onFilterChanged:function(a){this._emitEvent("layerInfosFilterChanged",a);this._emitEventForEveryLayerInfo("filterChanged",a)},_onLayerReorder:function(a,f,b){a=this._reorderLayerInfosArray(a,f,b);this._emitEvent("layerInfosReorder",a,n.REORDERED,a)},_onRendererChanged:function(a){this._emitEvent("layerInfosRendererChanged",
a);this._emitEventForEveryLayerInfo("rendererChanged",a)},_onOpacityChanged:function(a){this._emitEvent("layerInfosOpacityChanged",a);this._emitEventForEveryLayerInfo("opacityChanged",a)},_onTimeExtentChanged:function(a){this._emitEvent("layerInfosTimeExtentChanged",a);this._emitEventForEveryLayerInfo("timeExtentChanged",a)}});n.getLayerInfoArrayByType=function(a,f){var b=new l,e=[],g=[];n.getInstance(a,a.iteminfo).then(function(a){a.traversal(function(a){var b=a.getLayerType();b.layerInfo=a;e.push(b)});
p(e).then(function(a){d.forEach(a,function(a,b){f===a&&g.push(e[b].layerInfo)});b.resolve(g)})});return b};var k=null,a=null;n.getInstance=function(a,f){var b=new l;b.resolve(n.getInstanceSyncForInit(a,f));return b};n.getInstanceSyncForInit=function(g,f){k&&k!==g&&(a=k=null);a||(a=new n(g,f.itemData),k=g);return a};n.getInstanceSync=function(){return a};n.setInstance=function(g,f){k=g;a=f};n.createInstance=function(a){var f=null;return f=new n(a,a.itemInfo.itemData)};m.mixin(n,{ADDED:"added",REMOVED:"removed",
SUBLAYER_ADDED:"subLayerAdded",SUBLAYER_REMOVED:"subLayerRemoved",UPDATED:"updated",REORDERED:"reordered"});return n})},"jimu/LayerInfos/LayerInfoFactory":function(){define("dojo/_base/declare jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream jimu/LayerInfos/LayerInfoForDefaultKML".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f){return r(null,{constructor:function(a,e){this.map=a;this.layerInfos=e},create:function(b){var e=null;if(b.featureCollection)e=new d(b,this.map,this,this.layerInfos);else if("esri.layers.KMLLayer"===b.layerObject.declaredClass)e=new l(b,this.map,this,this.layerInfos);else if("esri.layers.GeoRSSLayer"===b.layerObject.declaredClass)e=new c(b,this.map,this,this.layerInfos);else if("esri.layers.WMSLayer"!==b.layerObject.declaredClass||b.selfType)if("esri.layers.ArcGISDynamicMapServiceLayer"===
b.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===b.layerObject.declaredClass)e=new m(b,this.map,this,this.layerInfos);else if("esri.layers.ArcGISImageServiceLayer"===b.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===b.layerObject.declaredClass)e=new a(b,this.map,this,this.layerInfos);else if("esri.layers.StreamLayer"===b.layerObject.declaredClass)e=new g(b,this.map,this,this.layerInfos);else switch("Table"===b.layerObject.type&&(b.selfType="table"),
b.selfType){case "mapservice_dynamic_group":case "mapservice_dynamic":e=new p(b,this.map,this,this.layerInfos);break;case "mapservice_tiled_group":case "mapservice_tiled":e=new h(b,this.map,this,this.layerInfos);break;case "wms":e=new n(b,this.map,this,this.layerInfos);break;case "kml":e=new f(b,this.map,this,this.layerInfos);break;case "table":e=new k(b,this.map,this,this.layerInfos);break;default:e=new t(b,this.map,this,this.layerInfos)}else e=new q(b,this.map,this,this.layerInfos);return e}})})},
"jimu/LayerInfos/LayerInfoForCollection":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/promise/all esri/lang jimu/utils ./LayerInfo".split(" "),function(r,d,m,l,c,t,q){return r(q,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection",empty:!0}},_getExtent:function(){var c=null,h=[];d.forEach(this.getSubLayers(),function(c){h.push(c._getExtent())},this);return l(h).then(m.hitch(this,function(h){d.forEach(h,function(k){t.isValidExtent(k)&&
(c=c?c.union(k):k)},this);return c}))},_resetLayerObjectVisiblity:function(c){var h=c?c[this.id]:null;if(h){var n={},k;for(k in c)c.hasOwnProperty(k)&&"function"!==typeof c[k]&&(n[k]=c[k].visible);this._setSubLayerVisibleByCheckedInfo(n);this._setTopLayerVisible(h.visible)}},_setSubLayerVisibleByCheckedInfo:function(p){d.forEach(this.newSubLayers,function(h){c.isDefined(p[h.id])&&h.layerObject.setVisibility(p[h.id])},this)},_initVisible:function(){var c=!1,h;for(h=0;h<this.newSubLayers.length;h++)c=
c||this.newSubLayers[h].layerObject.visible;c&&(this._visible=!0)},_setTopLayerVisible:function(c){this._visible=c?!0:!1;d.forEach(this.newSubLayers,function(h){h.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var c=[];d.forEach(this.originOperLayer.featureCollection.layers,function(h){this._getLayerIndexesInMapByLayerId(h.layerObject.id)&&(m.setObject("_wabProperties.originOperLayer.showLegend",this.originOperLayer.featureCollection.showLegend,h.layerObject),
h=this._layerInfoFactory.create({layerObject:h.layerObject,title:h.layerObject.label||h.layerObject.title||h.layerObject.name||h.layerObject.id||" ",id:h.id||"-",subId:h.id||"-",collection:{layerInfo:this},selfType:"collection",showLegend:!0,parentLayerInfo:this}),c.push(h),h.init())},this);c.reverse();return c},_obtainLayerIndexesInMap:function(){var c=[],h,n;for(n=0;n<this.newSubLayers.length;n++)(h=this._getLayerIndexesInMapByLayerId(this.newSubLayers[n].layerObject.id))&&c.push(h);return c},moveLeftOfIndex:function(c){var h;
for(h=this.newSubLayers.length-1;0<=h;h--)this.map.reorderLayer(this.newSubLayers[h].layerObject,c)},moveRightOfIndex:function(c){var h;for(h=0;h<this.newSubLayers.length;h++)this.map.reorderLayer(this.newSubLayers[h].layerObject,c)},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0},getOpacity:function(){var c,h=0;for(c=0;c<this.newSubLayers.length;c++)if(this.newSubLayers[c].layerObject.opacity)h=
this.newSubLayers[c].layerObject.opacity>h?this.newSubLayers[c].layerObject.opacity:h;else return 1;return h},setOpacity:function(c){d.forEach(this.newSubLayers,function(h){h.layerObject.setOpacity&&h.layerObject.setOpacity(c)})},getScaleRange:function(){var c=this.getSubLayers();return c[0]?c[0].getScaleRange():{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic dojo/aspect dojo/Evented dojo/request/script jimu/portalUrlUtils jimu/portalUtils jimu/LayerNode jimu/utils ./RequestBuffer esri/kernel esri/request".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u){var v=r([h],{declaredClass:"jimu.LayerInfo",originOperLayer:null,layerObject:null,map:null,title:null,id:null,subId:null,newSubLayers:null,parentLayerInfo:null,isTable:null,isTiled:null,_oldIsShowInMap:null,_oldFilter:null,_eventHandles:null,_subLayerInfoIndex:null,_serviceDefinitionBuffer:null,_flag:null,_objectId:null,_itemInfo:null,_adaptor:null,constructor:function(a,b,e,f){this.originOperLayer=a;this.layerObject=a.layerObject;this.map=b;this.title=
this.originOperLayer.title||this.originOperLayer.id||"";this.id=this.originOperLayer.id;this.subId=void 0!==this.originOperLayer.subId?this.originOperLayer.subId:this.id;this.parentLayerInfo=a.parentLayerInfo?a.parentLayerInfo:null;this.isTiled=this.isTable=!1;this._eventHandles=[];this._layerInfoFactory=e;this._layerInfos=f;this._flag={};this._objectId=Math.random();this._adaptor=new g(this)},init:function(){this.newSubLayers=this.obtainNewSubLayers();this._initSubLayerInfoIndex();this._initVisible();
this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=this.isShowInMap();this._initOldFilter();this._initServiceDefinitionBuffer();this._bindEvent()},_initOldFilter:function(){this._oldFilter=null},_initServiceDefinitionBuffer:function(){this._serviceDefinitionBuffer=new b(m.hitch(this,this._serviceDefinitionRequest))},isGraphicLayer:function(){var a=this._obtainLayerIndexesInMap();return a.length?a[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},
getObjectId:function(){return this._objectId},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},moveLayerByIndex:function(a){this.map.reorderLayer(this.layerObject,a)},traversal:function(a){if(a(this))return!0;for(var b=this.getSubLayers(),e=0;e<b.length;e++)if(b[e].traversal(a))return!0},findLayerInfoById:function(a){var b=null,e=0;if(this.id&&this.id===a)return this;for(e=0;e<this.newSubLayers.length&&
!(b=this.newSubLayers[e].findLayerInfoById(a));e++);return b},setTopLayerVisible:function(a){this._setTopLayerVisible(a)},_setTopLayerVisible:function(a){},_setSubLayerVisible:function(a,b){},setLayerVisiblefromTopLayer:function(){},_resetLayerObjectVisiblity:function(){},resetLayerObjectVisibility:function(a){var b=a?a[this.id]:null;this.isRootLayer()&&b&&this._resetLayerObjectVisiblity(a)},_initVisible:function(){},isVisible:function(){return this._visible?!0:!1},show:function(){this._setTopLayerVisible(!0)},
hide:function(){this._setTopLayerVisible(!1)},_obtainLayerIndexesInMap:function(){var a=[],b;(b=this._getLayerIndexesInMapByLayerId(this.id))&&a.push(b);return a},_getLayerIndexesInMapByLayerId:function(a){var b;for(b=0;b<this.map.graphicsLayerIds.length;b++)if(this.map.graphicsLayerIds[b]===a)return{isGraphicLayer:!0,index:b};for(b=0;b<this.map.layerIds.length;b++)if(this.map.layerIds[b]===a)return{isGraphicLayer:!1,index:b};return null},_isShowInMapChanged:function(){var a=!1,b=this.isShowInMap();
!1===b&&this.map.infoWindow.hide();this._oldIsShowInMap!==b&&(this._oldIsShowInMap=b,a=!0);return a},_isShowInMapChanged2:function(){var a=[];this.traversal(function(b){b._isShowInMapChanged()&&a.push(b)});q.publish("layerInfos/layerInfo/isShowInMapChanged",a)},_visibleChanged:function(){q.publish("layerInfos/layerInfo/visibleChanged",[this])},_initSubLayerInfoIndex:function(){var a={};this.isRootLayer()&&this.traversal(function(b){b.isRootLayer()||(a[b.subId]=b)});this._subLayerInfoIndex=a},_getLayerInfosObj:function(){return this._layerInfos},
obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return t.create("div",{"class":"legends-div"})},drawLegends:function(a,b){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},_needToRenew:function(){return!1},_getServiceDefinition:function(){var a=new l;a.resolve(null);
return a},_serviceDefinitionRequest:function(a){return this._normalRequest(a,{f:"json"},"json")},getServiceDefinition:function(){return this._getServiceDefinition()},_normalRequest:function(a,b,e){return u({url:a,content:b,handleAs:e,callbackParamName:"callback"})},getLayerObject:function(){var a=new l;this.layerObject?a.resolve(this.layerObject):a.resolve(null);return a},getLayerObjectTryUsingFeatureService:function(){return this.getLayerObject()},getSubLayers:function(){return this.newSubLayers},
isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},getLayerLevel:function(){for(var a=0,b=this;b.parentLayerInfo;)a++,b=b.parentLayerInfo;return a},getRootLayerInfo:function(){for(var a=this;a.parentLayerInfo;)a=a.parentLayerInfo;return a},isShowInMap:function(){for(var a=!0,b=this;b;)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},getLayerType:function(){var a=[null],b=new l;this.layerObject.declaredClass&&(a=this.layerObject.declaredClass.split("."));
b.resolve(a[a.length-1]);return b},getPopupInfo:function(){return this.originOperLayer.popupInfo},getPopupInfoFromLayerObject:function(){var a=this.getInfoTemplate(),b=null;a&&(b=a.info);return b},loadPopupInfo:function(){var a=new l;this.loadInfoTemplate().then(m.hitch(this,function(b){var e=null;b&&(e=b.info);a.resolve(e)}));return a},loadInfoTemplate:function(){var a=new l;a.resolve(null);return a},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?
this.originOperLayer.layerDefinition.definitionExpression:null},getFilter:function(){return null},setFilter:function(){},getShowLegendOfWebmap:function(){for(var a=this,b=!0;a;)b=b&&a._getShowLegendOfWebmap(),a=a.parentLayerInfo;return b},getUrl:function(){return this.layerObject.url||this.layerObject._url},hasLayerTypes:function(a){},getSupportTableInfo:function(){var a=new l,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},e=this.getLayerType(),f=this.getLayerObject();c({type:e,layerObject:f}).then(m.hitch(this,
function(e){var f=e.type;e=e.layerObject;b.layerType=f;0<=this._getLayerTypesOfSupportTable().indexOf(f)&&(b.isSupportedLayer=!0);if(!e)b.isSupportQuery=!1;else if(this.parentLayerInfo&&this.parentLayerInfo.isMapNotesLayerInfo())b.isSupportQuery=!1;else if(!e.url||e.capabilities&&e.capabilities.indexOf&&0<=e.capabilities.indexOf("Query"))b.isSupportQuery=!0;a.resolve(b)}),function(){a.resolve(b)});return a},getRelatedTableInfoArray:function(a){a=new l;a.resolve([]);return a},removeSubLayerById:function(a){var b=
[];d.forEach(this.newSubLayers,function(e){e.id!==a?b.push(e):e.destroy()});this.newSubLayers=b},releaseResource:function(){d.forEach(this._eventHandles,function(a){a.remove()});this.destroyLabelLayer();this._adaptor&&this._adaptor.destroy()},destroy:function(){d.forEach(this.newSubLayers,function(a){a.destroy()});this.releaseResource();this.inherited(arguments)},update:function(){d.forEach(this.newSubLayers,function(a){a.destroy()});this.releaseResource();this.init()},isMapNotesLayerInfo:function(){return this.originOperLayer.featureCollection&&
0===this.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===this.originOperLayer.layerType&&!this.map.getLayer(this.id)?!0:!1},_getExtent:function(){var a=new l;a.resolve(this.layerObject.fullExtent||this.layerObject.initialExtent);return a},getExtent:function(){var a=new l;this._getExtent().then(m.hitch(this,function(b){f.projectToMapSpatialReference(this.map,b).then(m.hitch(this,function(b){a.resolve(b)}),m.hitch(this,function(){a.resolve(null)}))}),m.hitch(this,function(){a.resolve(null)}));return a},
zoomTo:function(a){return a?f.projectToMapSpatialReference(this.map,a).then(m.hitch(this,function(a){return this._zoomTo(a)})):this.getExtent().then(m.hitch(this,function(a){return this._zoomTo(a)}))},_zoomTo:function(a){if(f.isValidExtent(a)){a=m.clone(a);var b=this.getLayerScaleRange(),e=b.minScale,b=b.maxScale;if(a.isSinglePoint){if(e=f.getTargetScale(this.map,3,e,b))a=f.adjustHeightToAspectRatio(this.map,a),a=f.getExtentForScale(a,this.map.width,e),this.map.setExtent(a)}else{a=f.adjustExtentToAspectRatio(this.map,
a);var g=f.getScaleForExtent(a,this.map.width);0<e&&g>e?(e=f.getScaleForNextTileLevel(this.map,e,!0),a=f.adjustHeightToAspectRatio(this.map,a),a=f.getExtentForScale(a,this.map.width,e),this.map.setExtent(a)):g<b?(b=f.getScaleForNextTileLevel(this.map,b,!1),a=f.adjustHeightToAspectRatio(this.map,a),a=f.getExtentForScale(a,this.map.width,b),this.map.setExtent(a)):this.map.setExtent(a,!0)}}},mergeScale:function(a,b,e,f){var g=0,k=0;0===a&&0<e?g=e:0<a&&0===e?g=a:0<a&&0<e&&(g=Math.min(a,e));k=Math.max(b,
f);return{minScale:g,maxScale:k}},unionScale:function(a,b,e,f){var g=0,k=0,g=0===a||0===e?0:Math.max(a,e),k=Math.min(b,f);return{minScale:g,maxScale:k}},getScaleRange:function(){return this.layerObject&&0<=this.layerObject.minScale&&0<=this.layerObject.maxScale?{minScale:this.layerObject.minScale,maxScale:this.layerObject.maxScale}:{minScale:0,maxScale:0}},getLayerScaleRange:function(){var a,b=this.getScaleRange();this.traversal(m.hitch(this,function(b){b.id!==this.id&&(b=b.getScaleRange(),a=a?this.unionScale(a.minScale,
a.maxScale,b.minScale,b.maxScale):b)}));return a?this.mergeScale(b.minScale,b.maxScale,a.minScale,a.maxScale):b},isCurrentScaleInTheScaleRange:function(){var a=this.getScaleRange(),b=this.map.getScale();return 0===a.minScale&&0===a.maxScale?!0:(0===a.minScale||a.minScale>=b)&&(0===a.maxScale||b>=a.maxScale)?!0:!1},isInScale:function(){for(var a=!0,b=this;b&&(a=b.isCurrentScaleInTheScaleRange(),b=b.parentLayerInfo,a););return a},enablePopup:function(){},disablePopup:function(){},isPopupEnabled:function(){return!1},
getCapabilitiesOfWebMap:function(){return this.originOperLayer.capabilities},isItemLayer:function(){return this._getBasicItemInfo()},isPublicService:function(){var a=new l,b=this.getUrl()+"?f\x3djson";b?("https"===k.getProtocol(window.location.href)&&(b=k.setHttpsProtocol(b)),n.get(b,{jsonp:"callback"}).then(m.hitch(this,function(b){b&&b.error?a.resolve(!1):a.resolve(!0)}),m.hitch(this,function(){a.resolve(!1)}))):a.resolve(!0);return a},isEditable:function(){var b=!1,f=!0,g=a.getPortal(window.portalUrl),
k=this.isPublicService(),h=new l,u=new l;g.getUser().then(m.hitch(this,function(a){u.resolve(a)}),m.hitch(this,function(){u.resolve(null)}));c({user:u,isPublicService:k}).then(m.hitch(this,function(a){var g=a.user&&a.user.privileges;a=a.isPublicService;g&&-1===d.indexOf(g,"features:user:edit")&&e.id&&!a&&(f=!1);b=this.layerObject&&this.layerObject.isEditable?this.layerObject.isEditable()&&f?!0:!1:!1;h.resolve(b)}),m.hitch(this,function(){h.resolve(!1)}));return h},_getBasicItemInfo:function(){var a=
null,b=this.getRootLayerInfo(),e=window.appConfig||window.getAppConfig(),f=m.getObject("_wabProperties.itemLayerInfo",!1,b.layerObject);b.originOperLayer.itemId?(a={},a.itemId=b.originOperLayer.itemId,a.portalUrl=k.getStandardPortalUrl(e.map.portalUrl||e.portalUrl)):f&&f.portalUrl&&f.itemId&&(a={},a.itemId=f.itemId,a.portalUrl=k.getStandardPortalUrl(f.portalUrl));return a},getItemInfo:function(){var a=new l,b=this.getRootLayerInfo();b.isItemLayer()?(b._itemInfo||(b._itemInfo=new v.ItemInfo(this,b)),
b._itemInfo.onLoad().then(m.hitch(this,function(){a.resolve(b._itemInfo)}),m.hitch(this,function(){a.resolve(null)}))):a.resolve(null);return a},isHostedService:function(){var a=new l;this._getServiceDefinition().then(m.hitch(this,function(b){a.resolve(b&&b.serviceItemId?!0:!1)}));return a},isHostedLayer:function(){var a;this.isItemLayer()?a=this.isHostedService():(a=new l,a.resolve(!1));return a},obtainLabelControl:function(){},restoreLabelControl:function(){},destroyRealtedLabelLayer:function(){},
destroyLabelLayer:function(){},canShowLabel:function(){},isShowLabels:function(){},showLabels:function(){},hideLabels:function(){},isBasemap:function(){return this.getRootLayerInfo().layerObject._basemapGalleryLayerType?!0:!1},emitEvent:function(){try{this.emit.apply(this,arguments),this._adaptor&&this._adaptor.emitEvent.apply(this._adaptor,arguments)}catch(x){console.error(x)}},_bindEvent:function(){var a;this.layerObject&&!this.layerObject.empty&&(a=this.layerObject.on("visibility-change",m.hitch(this,
this._onVisibilityChanged)),this._eventHandles.push(a),a=p.after(this.layerObject,"setDefinitionExpression",m.hitch(this,this._onFilterChanged)),this._eventHandles.push(a),a=p.after(this.layerObject,"setRenderer",m.hitch(this,this._onRendererChanged)),this._eventHandles.push(a),this.isRootLayer()&&(a=this.layerObject.on("opacity-change",m.hitch(this,this._onOpacityChanged)),this._eventHandles.push(a)),this.isRootLayer()&&(a=this.map.on("time-extent-change",m.hitch(this,function(){this.layerObject&&
this.layerObject.useMapTime&&this._onTimeExtentChanged()})),this._eventHandles.push(a)),this.isRootLayer()&&(a=p.after(this.layerObject,"setTimeDefinition",m.hitch(this,function(){this.layerObject&&this.layerObject.timeInfo&&this.layerObject.mode===esri.layers.FeatureLayer.MODE_SNAPSHOT&&this._onTimeExtentChanged()})),this._eventHandles.push(a)))},_onVisibilityChanged:function(){this._initVisible();this._visibleChanged();this._isShowInMapChanged2()},_onFilterChanged:function(){var a=this._oldFilter?
this._oldFilter:null,b=this.layerObject.getDefinitionExpression(),b=b?b:null;a!==b&&(q.publish("layerInfos/layerInfo/filterChanged",[this]),this._oldFilter=b)},_onRendererChanged:function(){q.publish("layerInfos/layerInfo/rendererChanged",[this])},_onOpacityChanged:function(){q.publish("layerInfos/layerInfo/opacityChanged",[this])},_onTimeExtentChanged:function(){var a=[],b=[];this.traversal(function(e){var f=e.getServiceDefinition().then(function(b){b&&b.timeInfo&&a.push(e)});b.push(f)});c(b).then(m.hitch(this,
function(){q.publish("layerInfos/layerInfo/timeExtentChanged",a)}))}});v.ItemInfo=r(null,{_currentLayerInfo:null,_rootLayerInfo:null,_portalUrl:null,_itemId:null,_item:null,_itemData:null,_serviceDefinition:null,_itemInfoLoadedDef:null,constructor:function(a,b){this._currentLayerInfo=a;this._rootLayerInfo=b;this._loadResource()},_loadResource:function(){this._itemInfoLoadedDef=new l;var b=this._rootLayerInfo.isItemLayer();if(b){this._portalUrl=b.portalUrl;this._itemId=b.itemId;var e=a.getPortal(this._portalUrl),
b=e.getItemById(this._itemId),e=e.getItemData(this._itemId),f=this._currentLayerInfo._getServiceDefinition();c({item:b,itemData:e,serviceDefinition:f}).then(m.hitch(this,function(a){this._item=a.item;this._itemData=a.itemData;this._serviceDefinition=a.serviceDefinition;this._itemInfoLoadedDef.resolve(this)}),m.hitch(this,function(a){a&&a.message&&console.log(a.message);this._itemInfoLoadedDef.reject()}))}else this._itemInfoLoadedDef.reject()},onLoad:function(){return this._itemInfoLoadedDef},getPortalUrl:function(){return this._portalUrl},
getItemId:function(){return this._itemId},getItem:function(){return this._item},getItemData:function(){return this._itemData},isHostedLayer:function(){return this._serviceDefinition&&this._serviceDefinition.serviceItemId?!0:!1}});return v})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json dojo/request/xhr esri/request ./Role ./utils ./portalUrlUtils ./tokenUtils ./ServiceDefinitionManager".split(" "),function(r,
d,m,l,c,t,q,p,h,n,k,a,g,f){var b=r([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(b){this.portalUrl=a.getStandardPortalUrl(b);this.selfUrl=a.getPortalSelfInfoUrl(b)},loadSelfInfo:function(){var a=this.selfUrl;this.isValidCredential()&&(a=-1<a.indexOf("?")?a+("\x26token\x3d"+this.credential.token):a+("?token\x3d"+this.credential.token));return f.getInstance().getServiceDefinition(a).then(d.hitch(this,function(a){var b=a.user;
delete a.user;d.mixin(this,a);a.user=b;return a}))},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||this.clearCredentialAndUser();return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=g.getPortalCredential(this.portalUrl))},signIn:function(){var a=new c;this.updateCredential();this.isValidCredential()?setTimeout(d.hitch(this,function(){a.resolve(this.credential)}),
0):a=g.signInPortal(this.portalUrl);return a},haveSignIn:function(){return g.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var a=new c;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(d.hitch(this,function(){this.user.updateCredential();a.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(d.hitch(this,function(b){this.user=
b;a.resolve(this.user)}),d.hitch(this,function(b){console.error(b);a.reject(b)})):g.getUserIdByToken(this.credential.token,this.portalUrl).then(d.hitch(this,function(b){this.credential.userId=b;this._getUser(this.credential.userId).then(d.hitch(this,function(b){this.user=b;a.resolve(this.user)}),d.hitch(this,function(b){console.error(b);a.reject(b)}))}),d.hitch(this,function(b){console.error(b);a.reject(b)})):setTimeout(d.hitch(this,function(){a.reject("credential is null.")}),0);return a},queryItems:function(b){this.updateCredential();
var e=new c,f=a.getBaseSearchUrl(this.portalUrl),g={f:"json"};b&&(g=d.mixin(g,b));this.isValidCredential()&&(g.token=this.credential.token);g.sortField||g.sortOrder||(g.sortField="title",g.sortOrder="asc");h({url:f,handleAs:"json",content:g,callbackParamName:"callback"}).then(d.hitch(this,function(a){a.results=m.map(a.results,d.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new v(a)}));e.resolve(a)}),d.hitch(this,function(a){console.error(a);e.reject(a)}));
return e},getItemData:function(b){this.updateCredential();b={url:a.getItemDataUrl(this.portalUrl,b),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};return h(b)},_getItemById:function(b,e){b={url:a.getItemUrl(this.portalUrl,b),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};e&&(b.content.token=e);return h(b).then(d.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new v(a)}))},getItemById:function(a,b){this.updateCredential();
return this._getItemById(a).then(d.hitch(this,function(e){return b&&e.owner&&this.isValidCredential()&&this.credential&&this.credential.userId===e.owner?this._getItemById(a,this.credential.token):e}))},getAppById:function(b){var e=new c;this.updateCredential();this.isValidCredential()?(b=a.getAppIdUrl(this.portalUrl,b),e=h({url:b,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(d.hitch(this,function(){e.reject("token is null.")}),0);return e},queryGroups:function(b){this.updateCredential();
var e=new c,f=a.getBaseGroupUrl(this.portalUrl),g={f:"json"};b&&(g=d.mixin(g,b));this.isValidCredential()&&(g.token=this.credential.token);h({url:f,handleAs:"json",content:g,callbackParamName:"callback"}).then(d.hitch(this,function(a){a.results=m.map(a.results,d.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new u(a)}));e.resolve(a)}),d.hitch(this,function(a){console.error(a);e.reject(a)}));return e},registerApp:function(b,e,f){var g=new c;this.updateCredential();
if(this.isValidCredential())var k=this.credential&&this.credential.token,u=a.getOAuth2Url(this.portalUrl),g=h({url:u+"/registerApp",content:{itemId:b,appType:e,redirect_uris:q.stringify(f),token:k,f:"json"},handleAs:"json"},{usePost:!0});else setTimeout(d.hitch(this,function(){g.reject("token is null.")}),0);return g},createAndRegisterApp:function(a){var b=new c;this.updateCredential();this.isValidCredential()?this.getUser().then(d.hitch(this,function(e){e.addItem({title:"Web AppBuilder for ArcGIS",
type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(d.hitch(this,function(e){e.success?this.registerApp(e.id,"browser",a).then(d.hitch(this,function(a){b.resolve(a)}),d.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject("create app failed")}),d.hitch(this,function(a){console.error(a);b.reject(a)}))}),d.hitch(this,function(a){console.error(a);b.reject(a)})):setTimeout(d.hitch(this,function(){b.reject("token is null.")}),0);return b},_getUser:function(b){this.updateCredential();
var f=new c;b={url:a.getUserUrl(this.portalUrl,b),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential&&this.credential.token);h(b).then(d.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;this.user=new e(a);f.resolve(this.user)}),d.hitch(this,function(a){console.error(a);f.reject(a)}));return f}}),e=r([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&
d.mixin(this,a)},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},canCreateItem:function(){var a=new n({id:this.roleId?this.roleId:this.role,role:this.role});this.privileges&&a.setPrivileges(this.privileges);return a.canCreateItem()},
getGroups:function(){var a=[];this.groups&&(a=m.map(this.groups,d.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this.portal;return new u(a)})));return a},getItemsByKeywords:function(a,b){return this.portal.queryItems({start:b||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();var b={url:a.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};
this.isValidCredential&&(b.content.token=this.credential.token);return h(b)},getTags:function(){this.updateCredential();var b={url:a.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential.token);return h(b)},addItem:function(b,e){this.updateCredential();var f=new c;if(this.isValidCredential()){var g={f:"json",token:this.credential.token};b&&(g=d.mixin(g,b));h({url:a.getAddItemUrl(this.portalUrl,
this.username,e),handleAs:"json",callbackParamName:"callback",content:g},{usePost:!0}).then(d.hitch(this,function(a){f.resolve(a)}),d.hitch(this,function(a){console.error(a);f.reject(a)}))}else setTimeout(d.hitch(this,function(){f.reject("token is null.")}),0);return f},deleteItem:function(b){this.updateCredential();var e=new c;this.isValidCredential()?(b=a.getDeleteItemUrl(this.portalUrl,this.username,b),e=h({url:b,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(d.hitch(this,
function(){e.reject("token is null.")}),0);return e},getItemById:function(b,e){this.updateCredential();var f=new c;b={url:a.getUserItemsUrl(this.portalUrl,this.username,e)+"/"+b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};h(b).then(d.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new v(a);f.resolve(a)}),d.hitch(this,function(a){console.error(a);f.reject(a)}));return f},shareItem:function(b,e,f){this.updateCredential();var g=new c;
this.isValidCredential()?(e={url:a.shareItemUrl(this.portalUrl,this.username,e,f),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},b&&(e.content=d.mixin(e.content,b)),h(e,{usePost:!0}).then(d.hitch(this,function(a){g.resolve(a)}),d.hitch(this,function(a){console.error(a);g.reject(a)}))):setTimeout(d.hitch(this,function(){g.reject("token is null.")}),0);return g},updateItem:function(b,e){this.updateCredential();var f=new c;this.isValidCredential()?this.portal.getItemById(b).then(d.hitch(this,
function(g){var k={f:"json",token:this.credential.token};e&&(k=d.mixin(k,e));h({url:a.getUpdateItemUrl(this.portalUrl,g.owner,b,g.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:k},{usePost:!0}).then(d.hitch(this,function(a){f.resolve(a)}),d.hitch(this,function(a){console.error(a);f.reject(a)}))}),d.hitch(this,function(a){console.error(a);f.reject(a)})):setTimeout(d.hitch(this,function(){f.reject("token is null.")}),0);return f},isAdminRole:function(){return"org_admin"===
this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role},getRegisteredAppInfo:function(b,e){var f=new c;this.updateCredential();e=a.getUserItemsUrl(this.portalUrl,this.username,e);return f=h({url:e+"/"+b+"/registeredAppInfo",content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})},getRegisteredAppInfoWithXhr:function(b,
e){var f=new c;this.updateCredential();e=a.getUserItemsUrl(this.portalUrl,this.username,e);return f=p(e+"/"+b+"/registeredAppInfo",{data:{token:this.credential.token,f:"json"},method:"POST",handleAs:"json"})}}),u=r([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&d.mixin(this,a)},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},
updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q="group:"+this.id+" AND "+a.q;return this.portal.queryItems(a)}}),v=r([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(b){b&&d.mixin(this,b);this.itemUrl=a.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&
(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=a.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=a.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var a=g.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)},getItemGroups:function(){this.updateCredential();var b={url:a.getItemGroupsUrl(this.portalUrl,this.id),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential.token);return h(b)}}),x={portals:[],webMapQueryStr:" "+
k.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+k.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(b){for(var e=0;e<this.portals.length;e++){var f=this.portals[e];if(a.isSamePortalUrl(b,f.portalUrl))return f.updateCredential(),f}return null},getPortal:function(e){if(!e||"string"!==typeof e||!d.trim(e))return null;e=a.getStandardPortalUrl(e);var f=this._findPortal(e);f||(f=new b(e),f.credential=g.getPortalCredential(f.portalUrl),f.updateCredential(),this.portals.push(f));
return f},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,"basemapGalleryGroupQuery")},getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},getUnits:function(a){var b="english",e="",f=new c;this.getPortal(a).getUser().then(d.hitch(this,function(a){a&&a.units?b=a.units:(e=l.locale,b=e.startWith("en")?"english":"metric");f.resolve(b)}),d.hitch(this,function(g){console.warn(g);
this.getPortalSelfInfo(a).then(d.hitch(this,function(a){var b=null;a&&a.units?b=a.units:(e=a&&a.culture||l.locale,b=e.startWith("en")?"english":"metric");f.resolve(b)}),d.hitch(this,function(a){console.warn(a);e=l.locale;b=e.startWith("en")?"english":"metric";f.resolve(b)}))}));return f.promise},_getPortalSelfGroup:function(a,b){var e=new c,f=this.getPortal(a);f||setTimeout(d.hitch(this,function(){e.reject()}),0);this.getPortalSelfInfo(a).then(d.hitch(this,function(a){f.queryGroups({f:"json",q:a[b]}).then(d.hitch(this,
function(a){0<a.results.length?(a=a.results[0],a.portalUrl=f.portalUrl,a.credential=f.credential,a.portal=f,a=new u(a),e.resolve(a)):e.reject("Can't find portal self group.")}),d.hitch(this,function(a){console.error(a);e.reject(a)}))}),d.hitch(this,function(a){console.error(a);e.reject(a)}));return e},getWebMapsFromBasemapGalleryGroup:function(a){var b=new c;this.getBasemapGalleryGroup(a).then(d.hitch(this,function(a){a?a.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(d.hitch(this,
function(a){b.resolve(a)}),d.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject()}),d.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getDefaultWebScene:function(b){var e=a.getStandardPortalUrl(b);return this._searchWABDefaultWebScene(e).then(d.hitch(this,function(a){return a?a:this._createWABDefaultWebScene(e).then(d.hitch(this,function(a){return this.getPortal(e).getUser().then(d.hitch(this,function(b){var e=!1;b&&b.privileges&&0<b.privileges.length&&(e=m.some(b.privileges,
function(a){return 0<=a.indexOf("shareToPublic")}));return e?b.shareItem({everyone:!0},a).then(d.hitch(this,function(){return a}),d.hitch(this,function(){return a})):a}),d.hitch(this,function(b){console.error(b);return a}))}))}))},_searchWABDefaultWebScene:function(b){var e=new c;b=a.getStandardPortalUrl(b);b=this.getPortal(b);b.queryItems({q:'typekeywords:"WABDefaultWebScene" orgid:'+b.user.orgId+" access:public "+this.webSceneQueryStr}).then(d.hitch(this,function(a){a&&a.results&&0<a.results.length?
e.resolve(a.results[0].id):e.resolve(null)}),d.hitch(this,function(a){console.error("_searchWABDefaultWebScene error:",a);e.reject(a)}));return e},_createWABDefaultWebScene:function(b){var e=new c;b=a.getStandardPortalUrl(b);this.getPortal(b).getUser().then(d.hitch(this,function(a){var b={title:"Default Web Scene",type:"Web Scene",typeKeywords:"WABDefaultWebScene",tags:"default",text:q.stringify({operationalLayers:[],baseMap:{id:"basemap",title:"Topographic",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",
id:"worldTopoBase",layerType:"ArcGISTiledMapServiceLayer",title:"Topo"}],elevationLayers:[{url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",id:"globalElevation",listMode:"hide",layerType:"ArcGISTiledElevationServiceLayer",title:"Elevation"}]},ground:{layers:[{url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",id:"globalElevation",listMode:"hide",layerType:"ArcGISTiledElevationServiceLayer",title:"Elevation"}]},
viewingMode:"global",spatialReference:{latestWkid:3857,wkid:102100},version:"1.12",authoringApp:"WebAppBuilder",authoringAppVersion:"2.10"}),snippet:""};a.addItem(b,"").then(d.hitch(this,function(a){a.success?e.resolve(a.id):(console.error("Can't create default web scene:",a),e.reject())}))}),d.hitch(this,function(a){console.error("Can't create default web scene");e.reject(a)}));return e},getDefaultWebMap:function(a){var b=new c;this.getPortalSelfInfo(a).then(d.hitch(this,function(e){var f=e.defaultBasemap&&
e.defaultBasemap.id;f?b.resolve(f):this._getDefaultWebMapByBasemapGallery(a,e).then(d.hitch(this,function(e){e?b.resolve(e):this._getMostNumViewsWebMap(a).then(d.hitch(this,function(a){a?b.resolve(a):b.reject()}),d.hitch(this,function(a){console.error(a);b.reject(a)}))}),d.hitch(this,function(a){console.error(a);b.reject(a)}))}),d.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_getDefaultWebMapByBasemapGallery:function(a,b){var e=new c,f=this.getPortal(a),g=b.defaultBasemap&&b.defaultBasemap.title;
f.queryGroups({f:"json",q:b.basemapGalleryGroupQuery}).then(d.hitch(this,function(a){a=a.results;0<a.length?f.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+a[0].id+" AND title:"+g}).then(d.hitch(this,function(a){a=a.results;a=m.filter(a,d.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?e.resolve(a[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),f.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+
g}).then(d.hitch(this,function(a){a=a.results;a=m.filter(a,d.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));if(0<a.length){var b=a[0];f.getItemData(b.id).then(d.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?e.resolve(b.id):e.resolve(null)}),d.hitch(this,function(){e.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),e.resolve(null)}),d.hitch(this,function(a){console.error(a);e.reject(a)})))}),d.hitch(this,function(a){console.error(a);
e.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),e.resolve(null))}),d.hitch(this,function(a){console.error(a);e.reject(a)}));return e},_getMostNumViewsWebMap:function(a){var b=new c;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(d.hitch(this,function(a){a=a.results;a=m.filter(a,d.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?
b.resolve(a[0].id):b.reject("Can't find most-num-views web map.")}),d.hitch(this,function(a){console.error(a);b.reject(a)}));return b},comparePortalVersion:function(a,b){var e=a.split(".");a=parseInt(e[0],10);var e=1<e.length?parseInt(e[1],10):0,f=b.split(".");b=parseInt(f[0],10);f=1<f.length?parseInt(f[1],10):0;return a>b?1:a<b?-1:e>f?1:e<f?-1:0},getItemResources:function(b,e,f){f||(f=100);b=a.getStandardPortalUrl(b);b=a.getItemResourceUrl(b,e);return h({url:b,content:{f:"json",num:f}}).then(function(a){if(a&&
a.resources)return a.resources})},addResource:function(b,e,f,g,k){b=a.getStandardPortalUrl(b);var c=this.getPortal(b),u=new FormData;u.append("file",f,g);u.append("fileName",g);u.append("f","json");var n="";k?(u.append("resourcesPrefix",k),n=k+"/"+g):n=g;return c.getItemById(e,!0).then(function(f){f=a.getUserContentItemUrl(b,f.owner,e);return h({url:f+"/addResources",form:u}).then(function(e){var f="";e&&e.success&&(f=a.getItemResourceUrl(b,"${itemId}",n));return f},function(a){console.error(a.message||
a);return a})})},removeResources:function(b,e,f,g){var k={resource:g?g+"/"+f:f,f:"json"};b=a.getStandardPortalUrl(b);return this.getPortal(b).getItemById(e,!0).then(function(f){f=a.getUserContentItemUrl(b,f.owner,e);return h({url:f+"/removeResources",content:k},{usePost:!0}).then(function(a){return a},function(a){console.error(a.message||a);return a})})}};t.subscribe("userSignOut",function(a){(a=x._findPortal(a))&&a.clearCredentialAndUser()});return x})},"jimu/Role":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","dojo/json","esri/lang"],function(r,d,m,l,c){return r(null,{id:null,baseRole:null,name:null,description:null,privileges:[],privilegeObj:null,constructor:function(c){c=c||{};this.id=c.id;this.baseRole=c.role;this.name=c.name;this.description=c.description},_initPrivilegesObject:function(){this.privilegeObj={portal:{admin:{inviteUsers:!1,disableUsers:!1,viewUsers:!1,updateUsers:!1,deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,
assignToGroups:!1,manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,manageLicenses:!1},publisher:{publishFeatures:!1,publishTiles:!1,publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},features:{user:{edit:!1,fullEdit:!1}},opendata:{user:{openDataAdmin:!1,designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,
demographics:!1,elevation:!1}},marketplace:{admin:{manage:!1,purchase:!1,startTrial:!1}}}},_readPrivileges:function(t){c.isDefined(t)&&t instanceof Array&&m.forEach(t,d.hitch(this,function(c){this._readPrivilege(c)}))},_readPrivilege:function(c){this._applyEffectToAction(!0,c)},_applyEffectToAction:function(c,d){switch(d){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=c;break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=c;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=
c;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=c;break;case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=c;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=c;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=c;break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=c;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=
c;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=c;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=c;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=c;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=c;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=c;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=
c;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=c;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=c;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=c;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=c;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=c;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=
c;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=c;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=c;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=c;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=c;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=c;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=c;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=
c;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=c;break;case "features:user:edit":this.privilegeObj.features.user.edit=c;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=c;break;case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=c;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=c;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=c;
break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=c;break;case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=c;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=c;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=c;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=c;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=
c;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=c;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=c}},_applyToAll:function(c){this.privilegeObj.portal.admin.inviteUsers=c;this.privilegeObj.portal.admin.disableUsers=c;this.privilegeObj.portal.admin.viewUsers=c;this.privilegeObj.portal.admin.updateUsers=c;this.privilegeObj.portal.admin.deleteUsers=c;this.privilegeObj.portal.admin.changeUserRoles=c;this.privilegeObj.portal.admin.viewGroups=
c;this.privilegeObj.portal.admin.updateGroups=c;this.privilegeObj.portal.admin.deleteGroups=c;this.privilegeObj.portal.admin.reassignGroups=c;this.privilegeObj.portal.admin.assignToGroups=c;this.privilegeObj.portal.admin.manageEnterpriseGroups=c;this.privilegeObj.portal.admin.viewItems=c;this.privilegeObj.portal.admin.updateItems=c;this.privilegeObj.portal.admin.deleteItems=c;this.privilegeObj.portal.admin.reassignItems=c;this.privilegeObj.portal.admin.manageLicenses=c;this.privilegeObj.portal.publisher.publishFeatures=
c;this.privilegeObj.portal.publisher.publishTiles=c;this.privilegeObj.portal.publisher.publishScenes=c;this.privilegeObj.portal.user.createGroup=c;this.privilegeObj.portal.user.joinGroup=c;this.privilegeObj.portal.user.joinNonOrgGroup=c;this.privilegeObj.portal.user.createItem=c;this.privilegeObj.portal.user.shareToGroup=c;this.privilegeObj.portal.user.shareToOrg=c;this.privilegeObj.portal.user.shareToPublic=c;this.privilegeObj.portal.user.shareGroupToOrg=c;this.privilegeObj.portal.user.shareGroupToPublic=
c;this.privilegeObj.features.user.edit=c;this.privilegeObj.opendata.user.openDataAdmin=c;this.privilegeObj.opendata.user.designateGroup=c;this.privilegeObj.premium.user.geocode=c;this.privilegeObj.premium.user.networkanalysis=c;this.privilegeObj.premium.user.spatialanalysis=c;this.privilegeObj.premium.user.geoenrichment=c;this.privilegeObj.premium.user.demographics=c;this.privilegeObj.premium.user.elevation=c;this.privilegeObj.marketplace.admin.purchase=c;this.privilegeObj.marketplace.admin.manage=
c;this.privilegeObj.marketplace.admin.startTrial=c},_buildPrivilegesArray:function(){var c=[];!0===this.privilegeObj.portal.admin.inviteUsers&&c.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&c.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&c.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&c.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&c.push("portal:admin:deleteUsers");
!0===this.privilegeObj.portal.admin.changeUserRoles&&c.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&c.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&c.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&c.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&c.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&c.push("portal:admin:assignToGroups");
!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&c.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&c.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&c.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&c.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&c.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&c.push("portal:admin:manageLicenses");
!0===this.privilegeObj.portal.publisher.publishFeatures&&c.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&c.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&c.push("portal:publisher:publishScenes");!0===this.privilegeObj.portal.user.createGroup&&c.push("portal:user:createGroup");!0===this.privilegeObj.portal.user.joinGroup&&c.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&
c.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&c.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&c.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&c.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&c.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&c.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&
c.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&c.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&c.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&c.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&c.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&c.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&
c.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&c.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&c.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&c.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&c.push("premium:user:elevation");!0===this.privilegeObj.marketplace.admin.purchase&&c.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&
c.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&c.push("marketplace:admin:startTrial");return c},isUser:function(){return c.isDefined(this.id)&&("org_user"===this.id||"account_user"===this.id)},isPublisher:function(){return c.isDefined(this.id)&&("org_publisher"===this.id||"account_publisher"===this.id)},isAdmin:function(){return c.isDefined(this.id)&&("org_admin"===this.id||"account_admin"===this.id)},isBasedOnUser:function(){return this.isUser()||c.isDefined(this.baseRole)&&
("org_user"===this.baseRole||"account_user"===this.baseRole)},isBasedOnPublisher:function(){return this.isPublisher()||c.isDefined(this.baseRole)&&("org_publisher"===this.baseRole||"account_publisher"===this.baseRole)},isBasedOnAdmin:function(){return this.isAdmin()||c.isDefined(this.baseRole)&&("org_admin"===this.baseRole||"account_admin"===this.baseRole)},isCustom:function(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&c.isDefined(this.id)&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.disableUsers},canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},canDeleteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},
canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},canUpdateOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},
canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},canViewOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},
canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createGroup},canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},
canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishScenes},canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&
this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},canShareGroupToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&
this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},canUseGeocode:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&
this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},canUseElevation:function(){return this.privilegeObj&&this.privilegeObj.premium.user.elevation},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&
this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(d){this.privileges=d;this._initPrivilegesObject();c.isDefined(d)&&this._readPrivileges(d)},stringify:function(){return l.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return l.stringify({id:this.id,name:this.name,description:this.description})},stringifyPrivileges:function(){return l.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return l.stringify({id:this.id,
name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},null,"  ")}})})},"jimu/ServiceDefinitionManager":function(){define(["dojo/_base/declare","esri/request"],function(r,d){var m=null,l=r(null,{cache:{},getServiceDefinition:function(c,l){l||(l="json");var q=this.cache[c];0>=this._getDefStatus(q)&&(q=d({url:c,handleAs:l,content:{f:l},callbackParamName:"callback"}),this.cache[c]=q);return q},_getDefStatus:function(c){return c?c.isFulfilled()?c.isResolved()?2:-1:1:0}});
l.getInstance=function(){m||(m=new l,window._serviceDefinitionManager=m);return m};return l})},"jimu/LayerNode":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Deferred","dojo/Evented"],function(r,d,m,l,c){var t=r([c],{declaredClass:"jimu.LayerNode",_layerInfo:null,map:null,title:null,id:null,subId:null,layerObject:null,constructor:function(c){this._layerInfo=c;this.map=c.map;this.title=c.title;this.id=c.id;this.subId=c.subId},isLeaf:function(){return this._layerInfo.isLeaf()},
isRoot:function(){return this._layerInfo.isRootLayer()},toggle:function(){this._layerInfo.setTopLayerVisible(!this.isToggledOn())},isToggledOn:function(){return this._layerInfo.isVisible()},show:function(){this._layerInfo.show()},hide:function(){this._layerInfo.hide()},isVisible:function(){return this._layerInfo.isShowInMap()},traversal:function(c){return this._layerInfo.traversal(function(d){return c(d._adaptor)})},getNodeById:function(c){var d=null;if(c=this._layerInfo.findLayerInfoById(c))d=c._adaptor;
return d},getExtent:function(){return this._layerInfo.getExtent()},getOpacity:function(){return this._layerInfo.getOpacity()},setOpacity:function(c){this._layerInfo.setOpacity(c)},getServiceDefinition:function(){return this._layerInfo.getServiceDefinition()},getLayerObject:function(){return this._layerInfo.getLayerObject()},getRootNode:function(){return this._layerInfo.getRootLayerInfo()._adaptor},getParentNode:function(){var c=this._layerInfo.parentLayerInfo;return c?c._adaptor:null},getSubNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfo.getSubLayers())},
getNodeLevel:function(){return this._layerInfo.getLayerLevel()},getLayerType:function(){return this._layerInfo.getLayerType()},getPopupInfoFromWebmap:function(){return this._layerInfo.getPopupInfo()},getPopupInfo:function(){return this._layerInfo.getPopupInfoFromLayerObject()},loadPopupInfo:function(){return this._layerInfo.loadPopupInfo()},getInfoTemplate:function(){return this._layerInfo.getInfoTemplate()},loadInfoTemplate:function(){return this._layerInfo.loadInfoTemplate()},getFilterFromWebmap:function(){return this._layerInfo.getFilterOfWebmap()},
getFilter:function(){return this._layerInfo.getFilter()},setFilter:function(c){this._layerInfo.setFilter(c)},isShowLegend:function(){return this.isShowLegendFromWebmap()},isShowLegendFromWebmap:function(){return this._layerInfo.getShowLegendOfWebmap()},isToggledOnLegendFromWebMap:function(){return this._layerInfo._getShowLegendOfWebmap()},getUrl:function(){return this._layerInfo.getUrl()},getRelatedNodes:function(){var c=new l;this._layerInfo.getRelatedTableInfoArray().then(m.hitch(this,function(d){c.resolve(this._getNodesArrayFromInfosArray(d))}));
return c},isVisibleAtMapScale:function(){return this._layerInfo.isInScale()},enablePopup:function(){return this._layerInfo.enablePopup()},disablePopup:function(){return this._layerInfo.disablePopup()},isPopupEnabled:function(){return this._layerInfo.isPopupEnabled()},isItemLayer:function(){return this._layerInfo.isItemLayer()},getItemInfo:function(){return this._layerInfo.getItemInfo()},isHostedService:function(){return this._layerInfo.isHostedService()},isHostedLayer:function(){return this._layerInfo.isHostedLayer()},
canShowLabel:function(){return this._layerInfo.canShowLabel()},isLabelVisble:function(){return this._layerInfo.isShowLabels()},showLabel:function(){this._layerInfo.showLabels()},hideLabel:function(){this._layerInfo.hideLabels()},isTable:function(){return!!this._layerInfo.isTable},isTiled:function(){return!!this._layerInfo.isTiled},isBasemap:function(){return this._layerInfo.isBasemap()},isEditable:function(c){return this._layerInfo.isEditable(c)},zoomTo:function(c){return this._layerInfo.zoomTo(c)},
emitEvent:function(c){try{var d=null;switch(c){case "isVisibleChanged":d=t.EVENT_TOOGLE_CHANGE;break;case "isShowInMapChanged":d=t.EVENT_VISIBILITY_CHANGE;break;case "filterChanged":d=t.EVENT_FILTER_CHANGE;break;case "rendererChanged":d=t.EVENT_RENDERER_CHANGE;break;case "opacityChanged":d=t.EVENT_OPACITY_CHANGE;break;case "timeExtentChanged":d=t.EVENT_TIME_EXTENT_CHANGE}d&&this.emit(d)}catch(h){console.error(h)}},destroy:function(){this.inherited(arguments)},_getNodesArrayFromInfosArray:function(c){var p=
[];d.forEach(c,function(h){p.push(h._adaptor)},this);return p}});m.mixin(t,{EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",EVENT_FILTER_CHANGE:"filter-change",EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change",EVENT_TIME_EXTENT_CHANGE:"time-extent-change"});return t})},"jimu/LayerInfos/RequestBuffer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred"],function(r,d,m){var l=r(null,{_realRequest:null,_buffer:null,constructor:function(c){this._buffer=
{};this._realRequest=c?c:function(){return new m}},getRequest:function(c){this._buffer[c]||(this._buffer[c]=new l.RequestProxy(this._realRequest,c));return this._buffer[c]},request:function(c){var d=Array.prototype.slice.apply(arguments);d.splice(0,1);var q=this.getRequest(c);return q.request.apply(q,d)},setResponse:function(c,d){this.getRequest(c).setResponse(d)},isResolved:function(c){return this.getRequest(c).isResolved()}});l.RequestProxy=r(null,{_key:null,_deferred:null,_realRequest:null,constructor:function(c,
d){this._realRequest=c;this._key=d},request:function(){this._deferred||(this._deferred=new m,this._realRequest.apply(null,arguments).then(d.hitch(this,function(c){this._deferred.resolve(c)}),d.hitch(this,function(c){c&&console.warn(c.message||c);c=this._deferred;this._deferred=null;c.resolve(null)})));return this._deferred},fakeRequest:function(){this._deferred||(this._deferred=new m);return this._deferred},setResponse:function(c,d){this._deferred||(this._deferred=new m);null===c||void 0===c?(this._deferred.resolve(null),
d&&(this._deferred=null)):this._deferred.resolve(c)},isResolved:function(){return this._deferred&&this._deferred.isResolved()}});return l})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/lang".split(" "),function(r,d,m,l,c,t,q,p,h,n){return r(p,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,_jsapiLayerInfos:null,_oldFilter:null,_subLayerVisible:null,
constructor:function(){},init:function(){this._initJsapiLayerInfos();this._initSubLayerVisible();this._initSubLayerIdent();this._initControlPopup();this.inherited(arguments);this._needToRefresh().then(m.hitch(this,function(k){k&&(this.update(),this._getLayerInfosObj()._onLayersUpdated(this,this))}))},_needToRefresh:function(){var k=new l;this.layerObject.dynamicLayerInfos&&this.isRootLayer()&&this.isItemLayer()&&!this.originOperLayer.thematicGroup?this.getItemInfo().then(m.hitch(this,function(a){(a=
(a=a.getItemData())&&a.thematicGroup)?(this.originOperLayer.thematicGroup=a,k.resolve(!0)):k.resolve(!1)})):k.resolve(!1);return k},_initOldFilter:function(){this._oldFilter=this.layerObject&&this.layerObject.layerDefinitions?this.layerObject.layerDefinitions:[]},_initJsapiLayerInfos:function(){var k=d.filter(this.originOperLayer.layers,function(a){return n.isDefined(a.id)&&n.isDefined(a.name)&&n.isDefined(a.minScale)&&n.isDefined(a.maxScale)&&n.isDefined(a.parentLayerId)&&n.isDefined(a.defaultVisibility)});
this._jsapiLayerInfos=this.layerObject.dynamicLayerInfos?this.originOperLayer.thematicGroup&&this.originOperLayer.thematicGroup.layerIds&&0<=this.originOperLayer.thematicGroup.layerIds.length?d.filter(this.layerObject.dynamicLayerInfos,function(a){return-1<this.originOperLayer.thematicGroup.layerIds.indexOf(a.id)?!0:!1},this):this.layerObject.dynamicLayerInfos:0<k.length?k:this.layerObject.layerInfos},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplates:m.clone(this.layerObject.infoTemplates)};
this.layerObject._infoTemplates=m.clone(this.layerObject.infoTemplates);t.after(this.layerObject,"setInfoTemplates",m.hitch(this,function(){this.layerObject._infoTemplates=m.clone(this.layerObject.infoTemplates);this.controlPopupInfo.infoTemplates=m.clone(this.layerObject.infoTemplates);this.traversal(function(k){k._afterSetInfoTemplates&&k._afterSetInfoTemplates()})}))},_initSubLayerIdent:function(){this._sublayerIdent={definitions:{},empty:!0,defLoad:new l}},_initSubLayerVisible:function(k){this._subLayerVisible=
{};for(var a=0;a<this._jsapiLayerInfos.length;a++)this._subLayerVisible[this._jsapiLayerInfos[a].id]=!1;k?d.forEach(k,function(a){this._subLayerVisible[a]=!0},this):this.originOperLayer.visibleLayers?d.forEach(this.originOperLayer.visibleLayers,function(a){this._subLayerVisible[a]=!0},this):d.forEach(this._jsapiLayerInfos,function(a){a.defaultVisibility&&(this._subLayerVisible[a.id]=!0)},this)},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(k){this.originOperLayer.layerObject.setVisibility(k);
this._visible=k},_setSubLayerVisible:function(k){var a=[-1,-1,-1],g,f=[],b=d.filter(this.originOperLayer.layerObject.visibleLayers,function(a){return-1!==a});d.forEach(b,function(a){if(!this._isGroupLayerBySubId(a)){var b=this._subLayerInfoIndex[a];b&&b._isAllSubLayerVisibleOnPath()&&f.push(a)}},this);var b=f,e;for(e in k)if(k.hasOwnProperty(e)&&"function"!==typeof k[e]){var h=Number(e);k[e]?(g=d.indexOf(b,h),0>g&&b.push(h)):(g=d.indexOf(b,h),0<=g&&b.splice(g,1))}a=a.concat(b);this.originOperLayer.layerObject.setVisibleLayers(a)},
_resetLayerObjectVisiblity:function(k){var a=k?k[this.id]:null,g=!1;if(k&&(a&&this.layerObject.setVisibility(a.visible),"esri.layers.ArcGISDynamicMapServiceLayer"===this.layerObject.declaredClass)){var a={},f;for(f in k)k.hasOwnProperty(f)&&"function"!==typeof k[f]&&(g=!0,a[f]=k[f].visible);g&&this._setSubLayerVisibleByCheckedInfo(a)}},_setSubLayerVisibleByCheckedInfo:function(k){var a=[];d.forEach(this._jsapiLayerInfos,function(f){var b=this.id+"_"+f.id;n.isDefined(k[b])?k[b]&&a.push(f.id):this._subLayerVisible[f.id]&&
a.push(f.id)},this);this._initSubLayerVisible(a);this.traversal(function(a){a._initVisible()});var g={};this.traversal(function(a){0===a.getSubLayers().length&&(g[a.originOperLayer.mapService.subId]=a._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(g)},_subLayerVisibleChanged:function(){var k=[];this.traversal(function(a){k.push(a)});q.publish("layerInfos/layerInfo/visibleChanged",k)},obtainNewSubLayers:function(){var k=[],a=this.originOperLayer.layerObject,g=null,g="esri.layers.ArcGISDynamicMapServiceLayer"===
a.declaredClass?"dynamic":"tiled";d.forEach(this._jsapiLayerInfos,function(b){var e=null,e=a.url+"/"+b.id,f=a.id+"_"+b.id;b.subLayerIds&&0<b.subLayerIds.length?(e={url:e,empty:!0},this._addNewSubLayer(k,e,f,b,g+"_group")):(e={url:e,empty:!0},this._addNewSubLayer(k,e,f,b,g))},this);var f=[];d.forEach(this._jsapiLayerInfos,function(a,e){a=a.parentLayerId;if(-1!==a){for(var b=null,f=0;f<k.length;f++)if(k[f].mapService.subId===a){b=k[f];break}(a=b)&&a.subLayers.push(k[e])}},this);d.forEach(this._jsapiLayerInfos,
function(a,e){-1===a.parentLayerId&&(a=this._layerInfoFactory.create(k[e]),f.push(a),a.init())},this);return f},_addNewSubLayer:function(k,a,g,f,b){var e=f.source&&f.source.mapLayerId;if(void 0===e||null===e)e=f.id;k.push({layerObject:a,title:f.name||f.id||" ",id:g||"-",subId:f.id,subLayers:[],mapService:{layerInfo:this,subId:f.id,mapServiceSubId:e},selfType:"mapservice_"+b,parentLayerInfo:this})},_handleErrorSubLayer:function(k,a,g,f,b,e){k[a]={layerObject:null,title:e.name||e.id||" ",id:g||" ",
subLayers:[],mapService:{layerInfo:this,subId:f}}},getLegendInfo:function(k){var a=new l;this._legendInfo?a.resolve(this._legendInfo):this._legendRequest(k).then(m.hitch(this,function(g){this._legendInfo=g.layers;a.resolve(this._legendInfo)}),function(){a.reject()});return a},_legendRequest:function(k){return 10.01<=this.layerObject.version?this._legendRequestServer():this._legendRequestTools(k)},_legendRequestServer:function(){var k=this.layerObject.url+"/legend",a={f:"json"};this.layerObject._params.dynamicLayers&&
(a.dynamicLayers=c.stringify(this._createDynamicLayers(this.layerObject)),"[{}]"===a.dynamicLayers&&(a.dynamicLayers="[]"));return h({url:k,content:a,handleAs:"json",callbackParamName:"callback"})},_legendRequestTools:function(k){return h({url:k+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_createDynamicLayers:function(k){var a=[],g;d.forEach(k.dynamicLayerInfos||k.layerInfos,function(f){g={id:f.id};g.source=f.source&&f.source.toJson();
var b;k.layerDefinitions&&k.layerDefinitions[f.id]&&(b=k.layerDefinitions[f.id]);b&&(g.definitionExpression=b);var e;k.layerDrawingOptions&&k.layerDrawingOptions[f.id]&&(e=k.layerDrawingOptions[f.id]);e&&(g.drawingInfo=e.toJson());g.minScale=f.minScale||0;g.maxScale=f.maxScale||0;a.push(g)});return a},_getServiceDefinition:function(){var k=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(k)},_getSubserviceDefinition:function(k){return 10.11<=this.layerObject.version?
this._getAllLayerAndTable(k):this._getLayerAndTable(k)},_getAllLayerAndTable:function(k){var a=this.layerObject.url+"/layers",g=this._serviceDefinitionBuffer.getRequest("_all_layer_and_table_request");g.isResolved()||g.request(a).then(m.hitch(this,function(a){a||(a={layers:[]});this.traversal(m.hitch(this,function(b){if(!b.isRootLayer()){var e=b.originOperLayer.mapService.mapServiceSubId;b=this._serviceDefinitionBuffer.getRequest(e);var f=null;d.some(a.layers,function(a){if(a.id===e)return f=a,!0},
this);b.setResponse(f)}}))}));return this._serviceDefinitionBuffer.getRequest(k).fakeRequest()},_getLayerAndTable:function(k){var a=this.layerObject.url+"/"+k;return this._serviceDefinitionBuffer.getRequest(k).request(a)},_getSublayerSettingOfWebmap:function(k){var a=d.filter(this.originOperLayer.layers,function(a){return a.id===k});return 1===a.length?a[0]:null},_getSublayerShowLegendOfWebmap:function(k){return(k=this._getSublayerSettingOfWebmap(k))?void 0!==k.showLegend?k.showLegend:!0:!0},_idIsInJsapiLayerInfos:function(k){return null===
this._getJsapiLayerInfoById(k)?!1:!0},_getJsapiLayerInfoById:function(k){for(var a=null,g=0;g<this._jsapiLayerInfos.length;g++)if(this._jsapiLayerInfos[g].id===k){a=this._jsapiLayerInfos[g];break}return a},_isGroupLayerBySubId:function(k){return(k=this._getJsapiLayerInfoById(k))&&k.subLayerIds&&0<k.subLayerIds.length?!0:!1},_bindEvent:function(){var k;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(k=this.layerObject.on("visible-layers-change",m.hitch(this,this._onVisibleLayersChanged)),
this._eventHandles.push(k),k=t.after(this.layerObject,"setLayerDefinitions",m.hitch(this,this._onFilterChanged)),this._eventHandles.push(k))},_onVisibleLayersChanged:function(k){var a=k.visibleLayers;if(-1===a[0]&&-1===a[1]&&-1===a[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();else{k=[];var g=[-1,-1,-1],a=this._converVisibleLayers(a);k=a.visibleLayersForUpdateSubLayerVisible;g=g.concat(a.visibleLayersForSetVisibleLayers);this._initSubLayerVisible(k);this.traversal(function(a){a._initVisible()});
this.layerObject.setVisibleLayers(g)}},_converVisibleLayers:function(k){var a={visibleLayersForUpdateSubLayerVisible:[],visibleLayersForSetVisibleLayers:[]};d.forEach(k,function(a){var f=this.findLayerInfoById(this.id+"_"+a);if(this._isGroupLayerBySubId(a))f.traversal(function(a){k.push(a.originOperLayer.mapService.subId)});else for(;f&&f.originOperLayer.mapService;)k.push(f.originOperLayer.mapService.subId),f=f.parentLayerInfo},this);d.forEach(k,function(g){0<=g&&0>a.visibleLayersForUpdateSubLayerVisible.indexOf(g)&&
a.visibleLayersForUpdateSubLayerVisible.push(g)},this);d.forEach(a.visibleLayersForUpdateSubLayerVisible,function(g){this._isGroupLayerBySubId(g)||a.visibleLayersForSetVisibleLayers.push(g)},this);return a},_onFilterChanged:function(){for(var k,a=[],g=this.layerObject.layerDefinitions,f=g.length>this._oldFilter.length?g.length:this._oldFilter.length,b=0;b<f;b++)(g[b]?g[b]:null)!==(this._oldFilter[b]?this._oldFilter[b]:null)&&(k=this.findLayerInfoById(this.id+"_"+b))&&k.isLeaf()&&a.push(k);0<a.length&&
(q.publish("layerInfos/layerInfo/filterChanged",a),this._oldFilter=g)}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect dojo/topic ./LayerInfo ./LayerInfoForDefault jimu/utils dojo/Deferred esri/lang".split(" "),function(r,d,m,l,c,t,q,p,h,n,k){return r(q,{constructor:function(){},_getExtentAsync:function(){var a=this.layerObject.getLayers(),g=null,f=null;if(0<a.length&&"esri.layers.KMLLayer"===a[0].declaredClass){var b=
[];this.traversal(m.hitch(this,function(a){a.id!==this.id&&"esri.layers.KMLLayer"===a.layerObject.declaredClass&&b.push(a)}));d.forEach(b,function(a){f=a._getExtentAsync();g=g?g.union(f):f},this)}else d.forEach(a,function(a){f=h.graphicsExtent(a.graphics);g=g?g.union(f):f},this);return g},_getExtent:function(){var a=new n;a.resolve(this._getExtentAsync());return a},_resetLayerObjectVisiblity:function(a){var g=a?a[this.id]:null;if(g){var f={},b;for(b in a)a.hasOwnProperty(b)&&"function"!==typeof a[b]&&
(f[b]=a[b].visible);this._setSubLayerVisibleByCheckedInfo(f);this._setTopLayerVisible(g.visible)}},_setSubLayerVisibleByCheckedInfo:function(a){this.traversal(m.hitch(this,function(g){k.isDefined(a[g.id])&&g._setTopLayerVisible(a[g.id])}))},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(a){a?this.layerObject.show():this.layerObject.hide()},obtainNewSubLayers:function(){var a=[];d.forEach(this._getOperLayerByParentFolderId(-1,this),function(g){g=
this._layerInfoFactory.create(g);a.push(g);g.init()},this);return a},_getOperLayerByParentFolderId:function(a,g){var f=[],b=this.layerObject.getLayers()||[],e=d.filter(this.layerObject.folders||[],function(b){return b.parentFolderId===a?!0:!1}),k=[],k=0===e.length?d.filter(b,function(a){return this._flag.kmzSubLayersWereHandled?!1:!0},this):e;d.forEach(k,function(a){var b;"esri.layers.KMLFolder"===a.declaredClass?b={layerObject:a,title:a.label||a.title||a.name||"\x26lt;no name\x26gt;",id:this._getSubLayerInfoIdForSubFolder(a),
subId:a.id,kml:{layerInfo:this,currentFolder:a},selfType:"kml",parentLayerInfo:g}:"esri.layers.KMLLayer"===a.declaredClass?(b=m.getObject("linkInfo.name",!1,a),b={layerObject:a,title:a.label||a.title||b||a.name||a.id||" ",id:a.id||"-",subId:a.id||"-",kml:{layerInfo:this,currentFolder:null},selfType:"kml",parentLayerInfo:g},m.setObject("_wabProperties.kmllayerWasHandled",!0,a),this._flag.kmzSubLayersWereHandled=!0):(m.setObject("_wabProperties.kmllayerWasHandled",!0,a),m.setObject("_wabProperties.isTemporaryLayer",
!0,a));b&&f.push(b)},this);return f},_getAllSubLayerObject:function(){var a=[];this.traversal(m.hitch(this,function(g){g.layerObject&&g.layerObject.getLayers&&(a=a.concat(g.layerObject.getLayers()))}));return a},_getSubLayerInfoIdForSubFolder:function(a){return this.id+"_folder_"+a.id},_needToRenew:function(){return d.some(this._getAllSubLayerObject(),function(a){if(!m.getObject("_wabProperties.kmllayerWasHandled",!1,a))return!0},this)},_bindEvent:function(){var a;this.inherited(arguments);this.layerObject&&
!this.layerObject.empty&&(a=c.after(this.layerObject,"setFolderVisibility",m.hitch(this,this._onSubFolderVisibleChanged),!0),this._eventHandles.push(a))},_onSubFolderVisibleChanged:function(a){a=this._getSubLayerInfoIdForSubFolder(a);(a=this.findLayerInfoById(a))&&t.publish("layerInfos/layerInfo/visibleChanged",[a])}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred ./LayerInfo dojox/gfx dojo/dom-construct dojo/dom-attr dojo/dom-class dojo/aspect jimu/portalUrlUtils jimu/portalUtils jimu/utils esri/symbols/jsonUtils esri/layers/LabelLayer esri/layers/LabelClass esri/dijit/PopupTemplate esri/dijit/Legend esri/graphic esri/geometry/Point esri/tasks/query esri/tasks/QueryTask".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z,A){return r(c,{_legendsNode:null,controlPopupInfo:null,constructor:function(){this._initControlPopup();this._updateLayerObjectName();try{this._initToShowLabels()}catch(E){console.warn(E.message)}},_updateLayerObjectName:function(){this.layerObject&&!this.layerObject.empty&&this.layerObject.name&&!m.getObject("_wabProperties.originalLayerName",!1,this.layerObject)&&(m.setObject("_wabProperties.originalLayerName",this.layerObject.name,this.layerObject),
this.layerObject.name=this.title)},_initToShowLabels:function(){var b=m.getObject("_wabProperties.itemLayerInfo",!1,this.layerObject);b&&!this.layerObject.empty&&a.getPortal(b.portalUrl).getItemData(b.itemId).then(m.hitch(this,function(a){var b;a&&a.layers&&(d.some(a.layers,function(a){return a.id===this.layerObject.layerId?(b=a,!0):!1},this),b&&b.showLabels&&((a=m.getObject("layerDefinition.drawingInfo.labelingInfo",!1,b))&&!this.layerObject.labelingInfo&&this.layerObject.setLabelingInfo&&(a=d.map(a,
function(a){return new e(a)},this),this.layerObject.setLabelingInfo(a)),this.showLabels()))}),m.hitch(this,function(a){a&&a.message&&console.log(a.message)}))},_initOldFilter:function(){this._oldFilter=this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},_getLayerOptionsForCreateLayerObject:function(){var a={};a.id=this.id;var b=[],e=this.getInfoTemplate();e&&e.info&&e.info.fieldInfos?d.forEach(e.info.fieldInfos,function(a){a.visible&&
b.push(a.fieldName)},this):b=["*"];a.outFields=b;return a},_getExtent:function(){var a=new l,b;b=this.layerObject.graphics&&0<this.layerObject.graphics.length?g.graphicsExtent(this.layerObject.graphics):this.layerObject.fullExtent||this.layerObject.initialExtent;this.layerObject.url?"esri.layers.FeatureLayer"===this.layerObject.declaredClass?this.getServiceDefinition().then(m.hitch(this,function(e){var f=new A(this.layerObject.url),k=new z,h=this.getFilter();k.where=h?h:"1\x3d1";k.outSpatialReference=
this.map.spatialReference;k.returnGeometry=!0;e&&e.advancedQueryCapabilities&&e.advancedQueryCapabilities.supportsReturningQueryExtent?f.executeForExtent(k,m.hitch(this,function(b){var e=b.extent;1===b.count&&"esriGeometryPoint"===this.layerObject.geometryType&&(b=new D(b.extent.xmin,b.extent.ymin,b.extent.spatialReference),e=g.graphicsExtent([new x(b)]));a.resolve(e)}),m.hitch(this,function(){a.resolve(b);console.log("executeForExtent failed.")})):f.execute(k).then(m.hitch(this,function(b){b=g.graphicsExtent(b.features);
a.resolve(b)}),m.hitch(this,function(){a.resolve(b);console.log("query execute failed.")}))})):a.resolve(b):a.resolve(b);return a},_resetLayerObjectVisiblity:function(a){a=a?a[this.id]:null;!this.originOperLayer.collection&&a&&(this.layerObject.setVisibility(a.visible),this._visible=this.layerObject.visible)},_initVisible:function(){var a=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){var a=this.originOperLayer.collection.layerInfo,b=this.layerObject.visible;if(a._oldIsShowInMap!==
a.isShowInMap())return;this._visible=b?!0:!1;a._onVisibilityChanged()}else this._visible=a=this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_setTopLayerVisible:function(a){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?a?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):a?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):(a?this.layerObject.show():this.layerObject.hide(),
this._visible=a)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&this.layerObject.show():this.layerObject.hide()},_prepareCheckedInfoForShowOrHide:function(a){for(var b={},e=this;e.parentLayerInfo;)b[e.id]=a,e=e.parentLayerInfo;return b},show:function(){if(this.isRootLayer())this._setTopLayerVisible(!0);else{var a=this.getRootLayerInfo();if(a._setSubLayerVisibleByCheckedInfo){var b=this._prepareCheckedInfoForShowOrHide(!0);a._setSubLayerVisibleByCheckedInfo(b);
a.show()}}},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;var a=n.after(this.layerObject,"setInfoTemplate",m.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||(this.layerObject.infoTemplate=null)}));this._eventHandles.push(a)},
_getServiceDefinition:function(){var a;(a=this.getUrl())&&this.isRootLayer()&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass?a=this._serviceDefinitionBuffer.getRequest(this.subId).request(a):(a=new l,a.resolve(null));return a},createLegendsNode:function(){var a=q.create("div",{"class":"legends-div jimu-legends-div-flag jimu-leading-margin1",legendsDivId:this.id},document.body);q.create("img",{"class":"legends-loading-img",src:require.toUrl("jimu")+"/images/loading.gif"},a);return a},
drawLegends:function(a){this._initLegendsNodeByLegendDijit(a)},_initLegendsNodeByLegendDijit:function(a){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&this.layerObject.loaded){q.empty(a);h.remove(a,"jimu-legends-div-flag");var b=new v({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:v.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},q.create("div",{},a));b.startup();a._legendDijit=b}},_initLegendsNode:function(a){var b=
[],e=this.layerObject;!this.layerObject||this.layerObject.empty||this.originOperLayer.subLayer&&0!==this.originOperLayer.subLayers.length||(q.empty(a),e.renderer&&(e.renderer.infos?b=m.clone(e.renderer.infos):b.push({label:e.renderer.label,symbol:e.renderer.symbol}),e.renderer&&e.renderer.defaultSymbol&&0<b.length&&b.push({label:e.renderer.defaultLabel||"others",symbol:e.renderer.defaultSymbol}),d.forEach(b,function(b){b.legendDiv=q.create("div",{"class":"legend-div"},a);b.symbolDiv=q.create("div",
{"class":"legend-symbol jimu-float-leading"},b.legendDiv);b.labelDiv=q.create("div",{"class":"legend-label jimu-float-leading",innerHTML:b.label||" "},b.legendDiv);if("textsymbol"===b.symbol.type)p.set(b.symbolDiv,"innerHTML",b.symbol.text);else{var e=t.createSurface(b.symbolDiv,50,50);b=f.getShapeDescriptors(b.symbol);e.createShape(b.defaultShape).setFill(b.fill).setStroke(b.stroke).setTransform(t.matrix.translate(25,25))}},this)))},obtainNewSubLayers:function(){var a=[];d.forEach(this.originOperLayer.subLayers,
function(b){b.parentLayerInfo=this;b=this._layerInfoFactory.create(b);a.push(b);b.init()},this);return a},_isAllSubLayerVisibleOnPath:function(){for(var a=!0,b=this;!b.isRootLayer();)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},_getCustomPopupInfo:function(a,b){var e=null;a&&a.fields&&(e={title:a.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},d.forEach(a.fields,function(a){var f=!1;b?d.some(b,m.hitch(this,function(b){return b&&a.name.toLowerCase()===b.toLowerCase()}))&&
(f=!0):f=!0;f&&(f=g.getDefaultPortalFieldInfo(a),f.visible=!0,f.isEditable=a.editable,e.fieldInfos.push(f))},this));return e},_getDefaultPopupInfo:function(a){if(a=this._getCustomPopupInfo(a))a.fieldInfos=d.filter(a.fieldInfos,m.hitch(this,function(a){a=a.fieldName.toLowerCase();return 0>a.indexOf("object")&&0>a.indexOf("globalid")&&0>a.indexOf("shape")&&0>a.indexOf("perimeter")?!0:!1}));return a},_getDefaultPopupTemplate:function(a){var b=null;(a=this.getPopupInfo()||this._getDefaultPopupInfo(a))&&
(b=new u(a));return b},enablePopup:function(){return this.loadInfoTemplate().then(m.hitch(this,function(){return this.controlPopupInfo.infoTemplate?(this.controlPopupInfo.enablePopup=!0,this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate,!0):!1}))},disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=null},isPopupEnabled:function(){return this.controlPopupInfo&&this.controlPopupInfo.enablePopup?!0:!1},loadInfoTemplate:function(){var a=new l;this.controlPopupInfo.infoTemplate?
a.resolve(this.controlPopupInfo.infoTemplate):this.getLayerObject().then(m.hitch(this,function(){this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject);a.resolve(this.controlPopupInfo.infoTemplate)}),m.hitch(this,function(){a.resolve(null)}));return a},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate},_getRelatedUrls:function(a,b){var e=[];if(!a||!a.url||!a.relationships)return e;var f=a.url.lastIndexOf("/"),g=a.url.slice(0,f);d.forEach(a.relationships,
function(a){b&&a.role&&"esriRelCardinalityManyToMany"!==a.cardinality&&b!==a.role||e.push(g+"/"+a.relatedTableId.toString())},this);return e},getRelatedTableInfoArray:function(a){var b=[],e=new l;this.getLayerObject().then(m.hitch(this,function(f){var g=this._getRelatedUrls(f,a);0!==g.length&&this._getLayerInfosObj().traversalAll(m.hitch(this,function(a){var e=-1;if(0===g.length)return!0;d.forEach(g,function(f,g){m.getObject("layerObject.url",!1,a)&&k.removeProtocol(f.toString().toLowerCase()).replace(/\/+/g,
"/")===k.removeProtocol(a.layerObject.url.toString().toLowerCase()).replace(/\/+/g,"/")&&(b.push(a),e=g)},this);0<=e&&g.splice(e,1);return!1}));e.resolve(b)}),m.hitch(this,function(){e.resolve(b)}));return e},getFilter:function(){return this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},setFilter:function(a){this.layerObject&&!this.layerObject.empty&&this.layerObject.setDefinitionExpression&&this.layerObject.setDefinitionExpression(a)},
_isAlreadyInLabelLayerOfMap:function(a){var b=!1;a&&(b=d.some(a.getFeatureLayers(),function(a){return this.id===a.id},this));return b},_addToLabelLayerOfMap:function(){var a=this.getLabelLayerOfMap();a&&!this._isAlreadyInLabelLayerOfMap(a)&&(a.addFeatureLayer(this.layerObject),this.map.removeLayer(a),this.map.addLayer(a))},_removeFromLabelLayerOfMap:function(){this.getLabelLayerOfMap().removeFeatureLayer(this.id)},_isSupportLabelControl:function(){return this.isRootLayer()&&!this.layerObject.empty&&
"esri.layers.FeatureLayer"===this.layerObject.declaredClass&&this.layerObject.labelingInfo&&0<this.layerObject.labelingInfo.length?!0:!1},getLabelLayerOfMap:function(){var a;this.map._labels?a=this.map._labels:(a=this.map.getLayer("labels"),a||(a=new b({id:"labels"}),this.map.addLayer(a)));return a},obtainLabelControl:function(){var a=this.id+"_labelLayer",e=this.map.getLayer(a);if(!e&&this._isSupportLabelControl()){var f=this.getLabelLayerOfMap();f&&this._isAlreadyInLabelLayerOfMap(f)&&(e=new b({id:a}),
e.addFeatureLayer(this.layerObject),this.map.addLayer(e),this._removeFromLabelLayerOfMap())}return e?e:null},restoreLabelControl:function(){this._isSupportLabelControl()&&(this.destroyRealtedLabelLayer(),this._addToLabelLayerOfMap())},destroyRealtedLabelLayer:function(){var a=this.map.getLayer(this.id+"_labelLayer");a&&this.map.removeLayer(a)},destroyLabelLayer:function(){this.map.getLayer(this.id)||(this._removeFromLabelLayerOfMap(),this.destroyRealtedLabelLayer())},canShowLabel:function(){return this._isSupportLabelControl()},
isShowLabels:function(){var a=this.map.getLayer(this.id+"_labelLayer"),b=this.getLabelLayerOfMap();return this._isSupportLabelControl()&&(a||b&&this._isAlreadyInLabelLayerOfMap(b))?this.layerObject.showLabels:!1},showLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&(this.map.getLayer(this.id+"_labelLayer")||this._addToLabelLayerOfMap(),this.layerObject.setShowLabels(!0))},hideLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&this.layerObject.setShowLabels(!1)}})})},
"esri/layers/LabelLayer":function(){define("require dojo/_base/declare dojo/_base/lang dojo/number dojo/i18n!dojo/cldr/nls/number dojo/_base/array dojo/_base/connect dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../core/timerUtils ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./support/attributeUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ./GraphicsLayer ./LabelClass ../renderers/SimpleRenderer ../support/expressionUtils".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z,A,E,y,C,F){function B(a){return"sizeInfo"===a.type}r=d(E,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=m.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
m.hitch(this,"_handleLevelChange")));var b=this.inherited(arguments);this.refresh();return b},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)q.disconnect(this._mapEventHandlers[a]);this.refresh();f.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,e,f){if(!this.getFeatureLayer(a.layerId)){var g=[];g.push(a.on("update-end",
m.hitch(this,"refresh")));g.push(a.on("suspend",m.hitch(this,"refresh")));g.push(a.on("resume",m.hitch(this,"refresh")));g.push(a.on("edits-complete",m.hitch(this,"refresh")));g.push(a.on("labeling-info-change",m.hitch(this,"refresh")));g.push(a.on("time-extent-change",m.hitch(this,"refresh")));g.push(a.on("show-labels-change",m.hitch(this,"refresh")));g.push(a.on("feature-reduction-change",m.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:e,LabelingOptions:f,
LabelRenderer:b,EventHandlers:g});this.featureLayers.push(a);this.refresh()}},getFeatureLayer:function(a){var b,e;for(b=0;b<this.featureLayers.length;b++)if(e=this.featureLayers[b],void 0!==e&&e.id==a)return e;return null},removeFeatureLayer:function(a){var b;a=this.getFeatureLayer(a);if(void 0!==a&&(b=t.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)q.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,
1);this.refresh()}},removeAllFeatureLayers:function(){var a;for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)q.disconnect(this._featureLayerInfos[a].EventHandlers[b]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,e;for(b=0;b<this.featureLayers.length;b++)if(e=this.featureLayers[b],void 0!==e&&e.id==a)return this._featureLayerInfos[b];
return null},refresh:function(){null==this._refreshHandle&&(this._refreshHandle=f.setTimeout(this._refreshLabels,f.priority.LOW))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var f,g,k,h,c,u=[],n,d="DYNAMIC"===this._engineType?new b:new e;if(this._map){d.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(g=this.featureLayers[a],g.visible&&g.showLabels&&g.visibleAtMapScale&&!g._suspended)if(f=
this._featureLayerInfos[a],c=this._convertOptions(null),f.LabelRenderer){if(u=g.labelingInfo)if(n=u[0])h=this._getLabelExpression(n),c=this._convertOptions(n);k=f.LabelRenderer;f.LabelExpressionInfo&&(h=f.LabelExpressionInfo);f.LabelingOptions&&(c=this._convertOptions(null),void 0!==f.LabelingOptions.pointPriorities&&(u=f.LabelingOptions.pointPriorities,c.pointPriorities="above-center"==u||"AboveCenter"==u||"esriServerPointLabelPlacementAboveCenter"==u?"AboveCenter":"above-left"==u||"AboveLeft"==
u||"esriServerPointLabelPlacementAboveLeft"==u?"AboveLeft":"above-right"==u||"AboveRight"==u||"esriServerPointLabelPlacementAboveRight"==u?"AboveRight":"below-center"==u||"BelowCenter"==u||"esriServerPointLabelPlacementBelowCenter"==u?"BelowCenter":"below-left"==u||"BelowLeft"==u||"esriServerPointLabelPlacementBelowLeft"==u?"BelowLeft":"below-right"==u||"BelowRight"==u||"esriServerPointLabelPlacementBelowRight"==u?"BelowRight":"center-center"==u||"CenterCenter"==u||"esriServerPointLabelPlacementCenterCenter"==
u?"CenterCenter":"center-left"==u||"CenterLeft"==u||"esriServerPointLabelPlacementCenterLeft"==u?"CenterLeft":"center-right"==u||"CenterRight"==u||"esriServerPointLabelPlacementCenterRight"==u?"CenterRight":"AboveRight"),void 0!==f.LabelingOptions.lineLabelPlacement&&(c.lineLabelPlacement=f.LabelingOptions.lineLabelPlacement),void 0!==f.LabelingOptions.lineLabelPosition&&(c.lineLabelPosition=f.LabelingOptions.lineLabelPosition),void 0!==f.LabelingOptions.labelRotation&&(c.labelRotation=f.LabelingOptions.labelRotation),
void 0!==f.LabelingOptions.howManyLabels&&(c.howManyLabels=f.LabelingOptions.howManyLabels));k instanceof y&&(h=this._getLabelExpression(k),k=new C(k.symbol),c=this._convertOptions(k));this._addLabels(g,k,h,c)}else if(u=g.labelingInfo)for(f=u.length-1;0<=f;f--)if(n=u[f])k=new y(n instanceof y?n.toJson():n),h=this._getLabelExpression(n),c=this._convertOptions(n),this._addLabels(g,k,h,c);h=d._process(this._preparedLabels);this.clear();this.drawLabels(this._map,h)}},drawLabels:function(b,e){this._scale=
(b.extent.xmax-b.extent.xmin)/b.width;var f;for(f=0;f<e.length;f++){var g=e[f],k=g.x,h=g.y,c=g.text,u=g.angle,n=g.layer.labelSymbol;"polyline"==g.layer.geometry.type&&g.layer.options.labelRotation&&n.setAngle(180/Math.PI*u);n.setText(c);g=k;n instanceof v&&(k=n.getHeight(),g-=.25*k*this._scale*Math.sin(u),h-=.33*k*this._scale);u=new a(new z(g,h,b.extent.spatialReference));u.setSymbol(n);this.add(u)}},_addLabels:function(a,b,e,f){var g,k,h,c;if(this._isWithinScaleRange(b.minScale,b.maxScale)&&e&&""!==
e){var u=this._map,n=!a.url&&!u.spatialReference.equals(a.spatialReference);for(g=0;g<a.graphics.length;g++)if(k=a.graphics[g],!1!==k.visible&&!k._suspended){h=k.geometry;if(n){if(!A.canProject(h,u))continue;h=A.project(h,u)}h&&this._isWhere(b.where,k.attributes)&&this._isWithinScreenArea(h)&&(c=this._buildLabelText(e,k,a.fields,f),this._addLabel(c,b,a.renderer,k,f,h,u))}}},_isWithinScreenArea:function(a){a="point"===a.type?new D(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();if(void 0===a)return!1;
a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var e=this._map.getScale();return 0<a&&e>=a||0<b&&e<b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var e=a.split(" ");if(3===e.length)return this._sqlEquation(b[this._removeQuotes(e[0])],e[1],this._removeQuotes(e[2]));if(7===e.length){var f=this._sqlEquation(b[this._removeQuotes(e[0])],e[1],this._removeQuotes(e[2])),g=e[3],k=this._sqlEquation(b[this._removeQuotes(e[4])],e[5],this._removeQuotes(e[6]));
switch(g){case "AND":return f&&k;case "OR":return f||k}}}return!1}catch(O){console.log("Error.: can't parse \x3d "+a)}},_sqlEquation:function(a,b,e){switch(b){case "\x3d":return a==e?!0:!1;case "\x3c\x3e":return a!=e?!0:!1;case "\x3e":return a>e?!0:!1;case "\x3e\x3d":return a>=e?!0:!1;case "\x3c":return a<e?!0:!1;case "\x3c\x3d":return a<=e?!0:!1}return!1},_removeQuotes:function(a){var b=a.indexOf('"'),e=a.lastIndexOf('"');if(-1!=b&&-1!=e)return a.substr(1,a.length-2);b=a.indexOf("'");e=a.lastIndexOf("'");
return-1!=b&&-1!=e?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||t.filter(a.visualVariables,B)[0]:null},_addLabel:function(a,b,e,f,g,k,c){var u,n,d,p;if(a&&""!==m.trim(a)&&b){a=a.replace(/\s+/g," ");u=b.getSymbol(f);u instanceof v?(u=new v(u.toJson()),u.setVerticalAlignment("baseline"),u.setHorizontalAlignment("center")):u=u instanceof x?new x(u.toJson()):new v;u.setText(a);b.symbol=u;if(d=this._getProportionalSize(b.sizeInfo,f.attributes))u instanceof v?u.setSize(d):u instanceof
x&&(u.setWidth(d),u.setHeight(d));p=d=0;if(e){n=e.getSymbol(f);var q=this._getSizeInfo(e);if((e=q?e.getSize(f,{sizeInfo:q,resolution:c.getResolutionInMeters()}):f.size)&&null!==e)d=p=e;else if(n)if("simplemarkersymbol"==n.type)p=d=n.size;else if("picturemarkersymbol"==n.type)d=n.width,p=n.height;else if("simplelinesymbol"==n.type||"cartographiclinesymbol"==n.type)d=n.width}e={};e.graphic=f;e.options=g;e.geometry=k;e.labelRenderer=b;e.labelSymbol=u;e.labelWidth=u.getWidth()/2;e.labelHeight=u.getHeight()/
2;e.symbolWidth=h.normalizedLength(d)/2;e.symbolHeight=h.normalizedLength(p)/2;e.text=a;e.angle=u.angle;this._preparedLabels.push(e)}},_buildLabelText:function(a,b,e,f){if(f.hasExpression)return a=f.arcadeCache,b=b._getDataValue(a.attributeInfo,a,F),k.isDefined(b)?""+b:"";var h=b.attributes;return a.replace(/{[^}]*}/g,function(a){var b,u=a;for(b=0;b<e.length;b++)if("{"+e[b].name+"}"==a){var u=h[e[b].name],n=e[b].domain;if(n&&m.isObject(n)){if("codedValue"==n.type&&f.useCodedValues)for(b=u,a=0;a<n.codedValues.length;a++)if(n.codedValues[a].code==
b){u=n.codedValues[a].name;break}break}n=e[b].type;if(f.fieldInfos){var d=f.fieldInfos;for(b=0;b<d.length;b++)if("{"+d[b].fieldName+"}"==a){a=d[b].format;"esriFieldTypeDate"==n?(a="DateFormat"+g.prototype._dateFormats[a.dateFormat?a.dateFormat:"shortDate"])&&(u=k.substitute({myKey:u},"${myKey:"+a+"}")):"esriFieldTypeInteger"!=n&&"esriFieldTypeSingle"!=n&&"esriFieldTypeSmallInteger"!=n&&"esriFieldTypeLong"!=n&&"esriFieldTypeDouble"!=n||!a||(u=l.format(u,{places:a.places}),a.digitSeparator||c.group&&
(u=u.replace(new RegExp("\\"+c.group,"g"),"")));break}}break}else u="";return null==u?"":u})},_getLabelExpression:function(a){var b="";a.labelExpressionInfo?b=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&(b=this._convertLabelExpression(a.labelExpression));return b},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(/\[/g,"{").replace(/\]/g,"}")},_getProportionalSize:function(a,
b){if(!a)return null;b=k.substitute(b,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&b)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(b-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=!0,e="shortDate",f=null,g=null,k="",h=!0,c,n;if(a&&(a.format&&(e=a.format.dateFormat,f={places:a.format.places,digitSeparator:a.format.digitSeparator}),g=a.fieldInfos,k=a.labelPlacement,null!=a.useCodedValues&&(b=
a.useCodedValues),a=a.labelExpressionInfo)){var d=a.expression;d&&!a.value&&(n=!0,c=u.createAttributeCache({valueExpression:d},!0))}if("always-horizontal"==k||"esriServerPolygonPlacementAlwaysHorizontal"==k)h=!1;return{useCodedValues:b,dateFormat:e,numberFormat:f,fieldInfos:g,pointPriorities:"above-center"==k||"esriServerPointLabelPlacementAboveCenter"==k?"AboveCenter":"above-left"==k||"esriServerPointLabelPlacementAboveLeft"==k?"AboveLeft":"above-right"==k||"esriServerPointLabelPlacementAboveRight"==
k?"AboveRight":"below-center"==k||"esriServerPointLabelPlacementBelowCenter"==k?"BelowCenter":"below-left"==k||"esriServerPointLabelPlacementBelowLeft"==k?"BelowLeft":"below-right"==k||"esriServerPointLabelPlacementBelowRight"==k?"BelowRight":"center-center"==k||"esriServerPointLabelPlacementCenterCenter"==k?"CenterCenter":"center-left"==k||"esriServerPointLabelPlacementCenterLeft"==k?"CenterLeft":"center-right"==k||"esriServerPointLabelPlacementCenterRight"==k?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==
k||"below-start"==k||"center-start"==k?"PlaceAtStart":"above-end"==k||"below-end"==k||"center-end"==k?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==k||"esriServerLinePlacementAboveAfter"==k||"above-along"==k||"esriServerLinePlacementAboveAlong"==k||"above-before"==k||"esriServerLinePlacementAboveBefore"==k||"above-start"==k||"esriServerLinePlacementAboveStart"==k||"above-end"==k||"esriServerLinePlacementAboveEnd"==k?"Above":"below-after"==k||"esriServerLinePlacementBelowAfter"==k||
"below-along"==k||"esriServerLinePlacementBelowAlong"==k||"below-before"==k||"esriServerLinePlacementBelowBefore"==k||"below-start"==k||"esriServerLinePlacementBelowStart"==k||"below-end"==k||"esriServerLinePlacementBelowEnd"==k?"Below":"center-after"==k||"esriServerLinePlacementCenterAfter"==k||"center-along"==k||"esriServerLinePlacementCenterAlong"==k||"center-before"==k||"esriServerLinePlacementCenterBefore"==k||"center-start"==k||"esriServerLinePlacementCenterStart"==k||"center-end"==k||"esriServerLinePlacementCenterEnd"==
k?"OnLine":"Above",labelRotation:h,howManyLabels:"OneLabel",hasExpression:n,arcadeCache:c}}});p("extend-esri")&&m.setObject("layers.LabelLayer",r,n);return r})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),function(r,d,m,l,c,t){r=r(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=
[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(c,d){this._labelLayer=d;this._xmin=c.extent.xmin;this._xmax=c.extent.xmax;this._ymin=c.extent.ymin;this._ymax=c.extent.ymax;this._scale=(this._xmax-this._xmin)/c.width},_process:function(c){this._preparedLabels=c;this._placedLabels=[];var d;for(c=this._preparedLabels.length-1;0<=c;c--){var h=this._preparedLabels[c],n=Math.min(h.labelWidth,h.labelHeight),k=h.labelWidth+
0*n,n=h.labelHeight+0*n,a=(d=h.options)&&void 0!==d.lineLabelPlacement?d.lineLabelPlacement:"PlaceAtCenter",g=d&&void 0!==d.lineLabelPosition?d.lineLabelPosition:"Above",f=d&&void 0!==d.pointPriorities?d.pointPriorities:"AboveRight",b=[2,2,1,3,0,2,3,3,2];"AboveLeft"==f?b=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==f?b=[2,1,2,2,0,2,3,3,3]:"AboveRight"==f?b=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==f?b=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==f?b=[0,0,0,0,1,0,0,0,0]:"CenterRight"==f?b=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==f?
b=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==f?b=[3,3,3,2,0,2,2,1,2]:"BelowRight"==f&&(b=[3,3,2,3,0,2,2,2,1]);var e=d&&void 0!==d.labelRotation?d.labelRotation:!0,f=Math.PI/180*h.angle;d=d&&void 0!==d.howManyLabels?d.howManyLabels:"OneLabel";if("point"==h.geometry.type)this._generatePointPositions(h,h.geometry.x,h.geometry.y,h.text,f,k,n,h.symbolWidth,h.symbolHeight,b);else if("multipoint"==h.geometry.type)for(a=h.geometry,g=0;g<a.points.length;g++)this._generatePointPositions(h,a.points[g][0],a.points[g][1],
h.text,f,k,n,h.symbolWidth,h.symbolHeight,b);else"polyline"==h.geometry.type?this._generateLinePositions(h,h.geometry,h.text,k,n,2*h.symbolHeight+n,a,g,e):"polygon"==h.geometry.type&&this._generatePolygonPositions(h,d,h.geometry,h.text,f,k,n)}return this._placedLabels},_generatePointPositions:function(c,d,h,n,k,a,g,f,b,e){f=(f+a)*this._scale;b=(b+g)*this._scale;var u,p;for(u=1;3>=u;u++)for(p=1;9>=p;p++)if(e[p-1]==u)switch(p){case 1:if(this._findPlace(c,n,d-f,h+b,k,a,g))return;break;case 2:if(this._findPlace(c,
n,d,h+b,k,a,g))return;break;case 3:if(this._findPlace(c,n,d+f,h+b,k,a,g))return;break;case 4:if(this._findPlace(c,n,d-f,h,k,a,g))return;break;case 5:if(this._findPlace(c,n,d,h,k,a,g))return;break;case 6:if(this._findPlace(c,n,d+f,h,k,a,g))return;break;case 7:if(this._findPlace(c,n,d-f,h-b,k,a,g))return;break;case 8:if(this._findPlace(c,n,d,h-b,k,a,g))return;break;case 9:if(this._findPlace(c,n,d+f,h-b,k,a,g))return}},_generateLinePositions:function(c,d,h,n,k,a,g,f,b){var e=n*this._scale*n*this._scale,
u,p,q;for(u=0;u<d.paths.length;u++){var l=d.paths[u],t=l.length,m=Math.floor((t-1)/2),E=0!==(t-1)%2?1:-1;"PlaceAtStart"==g&&(m=0,E=1);"PlaceAtEnd"==g&&(m=t-2,E=-1);for(;0<=m&&m<t-1;){for(p=m;p<t;p++){var y=l[m][0],C=l[m][1],r=l[p][0]-y,B=l[p][1]-C;if(r*r+B*B>e){for(var G=Math.atan2(B,r);G>Math.PI/2;)G-=Math.PI;for(;G<-(Math.PI/2);)G+=Math.PI;var H=Math.sin(G),L=Math.cos(G),J=0,K=0;"Above"==f&&(J=a*H*this._scale,K=a*L*this._scale);"Below"==f&&(J=-a*H*this._scale,K=-a*L*this._scale);if(1==p-m){if(this._clipLine(y,
C,l[p][0],l[p][1])&&(y=this._x1-this._x0,q=this._y1-this._y0,y*y+q*q>e&&(p=Math.atan2(q,y),r=n/2+2*k,C=r*this._scale*Math.cos(p),r=r*this._scale*Math.sin(p),"PlaceAtStart"==g?(y=this._x0+C,q=this._y0+r):"PlaceAtEnd"==g?(y=this._x1-C,q=this._y1-r):(y=this._x0+y/2,q=this._y0+q/2),this._findPlace(c,h,y-J,q+K,b?-p:0,n,k))))return}else{var I=0;for(q=m;q<=p;q++)I=Math.max(I,Math.abs((l[q][1]-C)*L-(l[q][0]-y)*H));if(I<k&&this._findPlace(c,h,y+r/2-J,C+B/2+K,b?-G:0,n,k))return}break}}m+=E}}},_generatePolygonPositions:function(c,
d,h,n,k,a,g){var f;if("ManyLabels"==d)for(d=0;d<h.rings.length;d++)f=h.rings[d],t.prototype.isClockwise(f)&&(f=this._findCentroid(f,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(c,n,f[0],f[1],k,a,g));else{f=this._findCentroidForFeature(h,this._xmin,this._ymin,this._xmax,this._ymax);var b=f[1],e=0;for(d=0;10>d;d++){e+=g/4;f=this._findCentroidForFeature(h,this._xmin,b+(e-g/4),this._xmax,b+(e+g/4));if(this._findPlace(c,n,f[0],f[1],k,a,g))break;f=this._findCentroidForFeature(h,this._xmin,
b-(e+g/4),this._xmax,b-(e-g/4));if(this._findPlace(c,n,f[0],f[1],k,a,g))break}}},_findCentroid:function(c,d,h,n,k){var a=c.length,g=[0,0],f=0,b=c[0][0],e=c[0][1];b>n&&(b=n);b<d&&(b=d);e>k&&(e=k);e<h&&(e=h);for(var u=1;u<a-1;u++){var p=c[u][0],q=c[u][1],l=c[u+1][0],t=c[u+1][1];p>n&&(p=n);p<d&&(p=d);q>k&&(q=k);q<h&&(q=h);l>n&&(l=n);l<d&&(l=d);t>k&&(t=k);t<h&&(t=h);var m=(p-b)*(t-e)-(l-b)*(q-e);g[0]+=m*(b+p+l);g[1]+=m*(e+q+t);f+=m}g[0]/=3*f;g[1]/=3*f;if(isNaN(g[0])||isNaN(g[1]))return g;h=[];this._fillBuffer(c,
h,g);g[0]=this._sortBuffer(h,g[0],d,n);return g},_findCentroidForFeature:function(c,d,h,n,k){for(var a,g=0,f=[0,0],b=0;b<c.rings.length;b++){var e=c.rings[b],u=e.length,p=e[0][0],q=e[0][1];p>n&&(p=n);p<d&&(p=d);q>k&&(q=k);q<h&&(q=h);for(a=1;a<u-1;a++){var l=e[a][0],t=e[a][1],m=e[a+1][0],E=e[a+1][1];l>n&&(l=n);l<d&&(l=d);t>k&&(t=k);t<h&&(t=h);m>n&&(m=n);m<d&&(m=d);E>k&&(E=k);E<h&&(E=h);var y=(l-p)*(E-q)-(m-p)*(t-q);f[0]+=y*(p+l+m);f[1]+=y*(q+t+E);g+=y}}f[0]/=3*g;f[1]/=3*g;if(isNaN(f[0])||isNaN(f[1]))return f;
h=[];for(a=0;a<c.rings.length;a++)this._fillBuffer(c.rings[a],h,f);f[0]=this._sortBuffer(h,f[0],d,n);return f},_fillBuffer:function(c,d,h){for(var n=c.length-1,k=c[0][1]>=c[n][1]?1:-1,a=0;a<=n;a++){var g=a,f=a+1;a==n&&(f=0);var b=c[g][0],g=c[g][1],e=c[f][0],f=c[f][1],u=f>=g?1:-1;if(g<=h[1]&&h[1]<=f||f<=h[1]&&h[1]<=g)h[1]!=g&&h[1]!=f?(d.push((h[1]-g)*(e-b)/(f-g)+b),k=u):h[1]==g&&h[1]!=f?(k!=u&&d.push(b),k=u):h[1]!=g&&h[1]==f?(d.push(e),k=u):h[1]==g&&h[1]==f&&(1==k&&d.push(b),d.push(e),k=u)}},_sortBuffer:function(c,
d,h,n){var k=c.length;c.sort();if(0<k){for(var a=0,g=d=0;g<k-1;g+=2){var f=Math.abs(c[g+1]-c[g]);!(c[g]<=h&&c[g+1]<=h||c[g]>=n&&c[g+1]>=n)&&f>a&&(a=f,d=g)}k=c[d];c=c[d+1];k>n&&(k=n);k<h&&(k=h);c>n&&(c=n);c<h&&(c=h);d=(k+c)/2}return d},_findPlace:function(d,p,h,n,k,a,g){if(isNaN(h)||isNaN(n))return!1;for(var f=0;f<this._placedLabels.length;f++){var b=this._placedLabels[f].angle,e=this._placedLabels[f].width*this._scale,u=this._placedLabels[f].height*this._scale,q=this._placedLabels[f].x-h,l=this._placedLabels[f].y-
n;if(0===k&&0===b){if(this._findPlace2(-a*this._scale,-g*this._scale,a*this._scale,g*this._scale,q-e,l-u,q+e,l+u))return!1}else{var m=new c(-a*this._scale,-g*this._scale,a*this._scale,g*this._scale,null),z=0,r=1;0!==k&&(z=Math.sin(k),r=Math.cos(k));var E=q*r-l*z,q=q*z+l*r,b=b-k,z=Math.sin(b),r=Math.cos(b),y=-e*r- -u*z,l=-e*z+-u*r,b=+e*r- -u*z,C=+e*z+-u*r,e=E+y,u=q-l,z=E+b,r=q-C,y=E-y,l=q+l,E=E-b,q=q+C,b=new t;b.addRing([[e,u],[z,r],[y,l],[E,q],[e,u]]);if(m.intersects(b))return!1}}for(;k>Math.PI/2;)k-=
Math.PI;for(;k<-(Math.PI/2);)k+=Math.PI;f={};f.layer=d;f.text=p;f.angle=k;f.x=h;f.y=n;f.width=a;f.height=g;this._placedLabels.push(f);return!0},_findPlace2:function(c,d,h,n,k,a,g,f){return(c>=k&&c<=g||h>=k&&h<=g||c<=k&&h>=g)&&(d>=a&&d<=f||n>=a&&n<=f||d<=a&&n>=f)?!0:!1},_clipLine:function(c,d,h,n){for(var k=this._code(c,d),a=this._code(h,n);0!==k||0!==a;){if(0!==(k&a))return!1;var g=h-c,f=n-d;0!==k?(c<this._xmin?(d+=f*(this._xmin-c)/g,c=this._xmin):c>this._xmax?(d+=f*(this._xmax-c)/g,c=this._xmax):
d<this._ymin?(c+=g*(this._ymin-d)/f,d=this._ymin):d>this._ymax&&(c+=g*(this._ymax-d)/f,d=this._ymax),k=this._code(c,d)):(h<this._xmin?(n+=f*(this._xmin-h)/g,h=this._xmin):h>this._xmax?(n+=f*(this._xmax-h)/g,h=this._xmax):n<this._ymin?(h+=g*(this._ymin-n)/f,n=this._ymin):n>this._ymax&&(h+=g*(this._ymax-n)/f,n=this._ymax),a=this._code(h,n))}this._x0=c;this._y0=d;this._x1=h;this._y1=n;return!0},_code:function(c,d){var h=0;c<this._xmin&&(h+=8);c>this._xmax&&(h+=4);d<this._ymin&&(h+=2);d>this._ymax&&(h+=
1);return h}});m("extend-esri")&&d.setObject("layers.labelLayerUtils.DynamicLabelClass",r,l);return r})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(r,d,m,l,c,t,q){return r(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=
this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(c,h){this._labelLayer=h;this._map=c;this._xmin=c.extent.xmin;this._xmax=c.extent.xmax;this._ymin=c.extent.ymin;this._ymax=c.extent.ymax;this._scale=(this._xmax-this._xmin)/c.width},_process:function(c){var h,d,k,a,g,f,b,e,u;this._preparedLabels=c;this._placedLabels=[];for(c=this._preparedLabels.length-1;0<=c;c--){h=this._preparedLabels[c];g=h.labelWidth;
f=h.labelHeight;e=(b=h.options)&&b.lineLabelPlacement?b.lineLabelPlacement:"PlaceAtCenter";u=b&&b.lineLabelPosition?b.lineLabelPosition:"Above";d=b&&b.labelRotation?b.labelRotation:!0;k=Math.PI/180*h.angle;a=b&&b.howManyLabels?b.howManyLabels:"OneLabel";var p=[];if("point"===h.geometry.type)this._generatePointPositions(h.geometry.x,h.geometry.y,h.text,k,g,f,h.symbolWidth,h.symbolHeight,b,p);else if("multipoint"===h.geometry.type)for(d=0;d<h.geometry.points.length;d++)this._generatePointPositions(h.geometry.points[d][0],
h.geometry.points[d][1],h.text,k,g,f,h.symbolWidth,h.symbolHeight,b,p);else if("polyline"===h.geometry.type)if("PlaceAtStart"===e)this._generateLinePositionsPlaceAtStart(h.geometry,!0,h.text,g,f,2*h.symbolHeight+f,e,u,d,p);else if("PlaceAtEnd"===e)this._generateLinePositionsPlaceAtEnd(h.geometry,!0,h.text,g,f,2*h.symbolHeight+f,e,u,d,p);else{b=[];var l=h.geometry.getExtent(),m=this._map.extent;if(l.getWidth()<g*this._scale/this._OVERRUN&&l.getHeight()<g*this._scale/this._OVERRUN)continue;else.5*l.getWidth()<
m.getWidth()&&.5*l.getHeight()<m.getHeight()?this._generateLinePositionsPlaceAtCenter(h.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,h.text,g,f,2*h.symbolHeight+f,e,u,d,b):this._generateLinePositionsPlaceAtCenter(h.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,h.text,g,f,2*h.symbolHeight+f,e,u,d,b);this._postSorting(m,b,p)}else if("polygon"===h.geometry.type){e=[];for(d=0;d<h.geometry.rings.length;d++)u=h.geometry.rings[d],1<h.geometry.rings.length&&
!q.prototype.isClockwise(u)||(b=this._calcRingExtent(u),b.xmax-b.xmin<4*g*this._scale/this._OVERRUN&&b.ymax-b.ymin<4*f*this._scale/this._OVERRUN||e.push(u));e.sort(function(a,b){return b.length-a.length});for(d=0;d<e.length;d++)this._generatePolygonPositionsForManyLabels(e[d],h.geometry.spatialReference,h.text,k,g,f,p)}for(d=0;d<p.length&&(e=p[d].x,u=p[d].y,void 0!==p[d].angle&&(k=p[d].angle),b=this._findPlace(h,h.text,e,u,k,g,f),"OneLabel"!==a||!b||!this._labelLayer._isWithinScreenArea(new t(e,u,
h.geometry.spatialReference)));d++);}return this._placedLabels},_generatePointPositions:function(c,h,d,k,a,g,f,b,e,u){d=e&&e.pointPriorities?e.pointPriorities:"AboveRight";a=(f+a)*this._scale;g=(b+g)*this._scale;switch(d.toLowerCase()){case "aboveleft":c-=a;h+=g;break;case "abovecenter":h+=g;break;case "aboveright":c+=a;h+=g;break;case "centerleft":c-=a;break;case "centercenter":break;case "centerright":c+=a;break;case "belowleft":c-=a;h-=g;break;case "belowcenter":h-=g;break;case "belowright":c+=
a;h-=g;break;default:return}u.push({x:c,y:h})},_generateLinePositionsPlaceAtStart:function(c,h,d,k,a,g,f,b,e,u){f=k*this._scale;var n=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,p,q,l,t,m,y,r,F;for(p=0;p<c.paths.length;p++){var B=c.paths[p],G=f,H=0;for(q=0;q<B.length-1;q++)l=B[q][0],t=B[q][1],m=B[q+1][0],y=B[q+1][1],r=m-l,F=y-t,r=Math.sqrt(r*r+F*F),H+r>G?(H=this._generatePositionsOnLine(c.spatialReference,h,G,n,H,l,t,m,y,d,k,a,g,b,e,u),G=n):H+=r}},_generateLinePositionsPlaceAtEnd:function(c,
h,d,k,a,g,f,b,e,u){f=k*this._scale;var n=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,p,q,l,t,m,y,r,F;for(p=0;p<c.paths.length;p++){var B=c.paths[p],G=f,H=0;for(q=B.length-2;0<=q;q--)l=B[q+1][0],t=B[q+1][1],m=B[q][0],y=B[q][1],r=m-l,F=y-t,r=Math.sqrt(r*r+F*F),H+r>G?(H=this._generatePositionsOnLine(c.spatialReference,h,G,n,H,l,t,m,y,d,k,a,g,b,e,u),G=n):H+=r}},_generateLinePositionsPlaceAtCenter:function(c,h,d,k,a,g,f,b,e,u,q){var n,p,l,v,t,m,r,F;for(b=0;b<c.paths.length;b++){var B=
c.paths[b];if(!(2>B.length)){if(2==B.length){v=B[0];n=B[1];l=v[0];v=v[1];B=n[0];m=n[1];t=(B-l)*(B-l)+(m-v)*(m-v);r=Math.atan2(m-v,B-l);m=Math.cos(r);r=Math.sin(r);B=[];F=l;for(var G=v;(F-l)*(F-l)+(G-v)*(G-v)<t;)B.push([F,G]),F+=d/2*m,G+=d/2*r;B.push(n)}var H=0;for(n=0;n<B.length-1;n++)l=B[n][0],v=B[n][1],t=B[n+1][0],m=B[n+1][1],r=t-l,F=m-v,H+=Math.sqrt(r*r+F*F);for(n=G=0;n<B.length-1;n++){l=B[n][0];v=B[n][1];t=B[n+1][0];m=B[n+1][1];r=t-l;F=m-v;r=Math.sqrt(r*r+F*F);if(G+r>H/2)break;G+=r}n==B.length-
1&&n--;l=B[n][0];v=B[n][1];t=B[n+1][0];m=B[n+1][1];r=t-l;F=m-v;G=H/2-G;r=Math.atan2(F,r);F=l+G*Math.cos(r);r=v+G*Math.sin(r);l=this._angleAndShifts(l,v,t,m,f,e,u);q.push({x:F+l.shiftX,y:r+l.shiftY,angle:l.angle});var H=F,L=r,G=0;for(p=n;p<B.length-1;p++)p==n?(l=H,v=L):(l=B[p][0],v=B[p][1]),t=B[p+1][0],m=B[p+1][1],r=t-l,F=m-v,r=Math.sqrt(r*r+F*F),G=G+r>d?this._generatePositionsOnLine(c.spatialReference,h,d,d,G,l,v,t,m,k,a,g,f,e,u,q):G+r;G=0;for(p=n;0<=p;p--)p==n?(l=H,v=L):(l=B[p+1][0],v=B[p+1][1]),
t=B[p][0],m=B[p][1],r=t-l,F=m-v,r=Math.sqrt(r*r+F*F),G=G+r>d?this._generatePositionsOnLine(c.spatialReference,h,d,d,G,l,v,t,m,k,a,g,f,e,u,q):G+r}}},_generatePositionsOnLine:function(d,h,n,k,a,g,f,b,e,u,q,l,t,m,r,E){u=Math.atan2(e-f,b-g);q=g;l=f;var p=q,v=l;do if(a=n-a,q+=a*Math.cos(u),l+=a*Math.sin(u),this._belongs(q,l,g,f,b,e))a=this._angleAndShifts(g,f,b,e,t,m,r),n=q+a.shiftX,v=l+a.shiftY,h?this._labelLayer._isWithinScreenArea(new c(n,v,n,v,d))&&E.push({x:n,y:v,angle:a.angle}):E.push({x:n,y:v,angle:a.angle}),
p=q,v=l,a=0,n=k;else return d=b-p,e-=v,Math.sqrt(d*d+e*e);while(1)},_postSorting:function(c,h,d){if(c&&0<h.length){var k=.5*(c.xmin+c.xmax);c=.5*(c.ymin+c.ymax);for(var a=h[0].x,g=h[0].y,f=Math.sqrt((a-k)*(a-k)+(g-c)*(g-c)),b=h[0].angle,e=0;e<h.length;e++){var u=h[e].x,n=h[e].y,p=Math.sqrt((u-k)*(u-k)+(n-c)*(n-c));p<f&&(a=u,g=n,f=p,b=h[e].angle)}d.push({x:a,y:g,angle:b})}},_belongs:function(c,h,d,k,a,g){if(a==d&&g==k)return!1;if(a>d){if(c>a||c<d)return!1}else if(c<a||c>d)return!1;if(g>k){if(h>g||
h<k)return!1}else if(h<g||h>k)return!1;return!0},_angleAndShifts:function(c,h,d,k,a,g,f){for(c=Math.atan2(k-h,d-c);c>Math.PI/2;)c-=Math.PI;for(;c<-(Math.PI/2);)c+=Math.PI;k=Math.sin(c);var b=Math.cos(c);d=h=0;"Above"==g&&(h=a*k*this._scale,d=a*b*this._scale);"Below"==g&&(h=-a*k*this._scale,d=-a*b*this._scale);a=[];a.angle=f?-c:0;a.shiftX=-h;a.shiftY=d;return a},_generatePolygonPositionsForManyLabels:function(c,h,d,k,a,g,f){a=this._findCentroidForRing(c);k=a[0];var b=a[1],e=this._calcRingExtent(c);
a=e.xmin;g=e.ymin;var u=e.xmax,e=e.ymax,n=(e-g)/(this._map.height*this._scale);if(!(10<(u-a)/(this._map.width*this._scale)&&10<n)){var p=!0;if(u-a>this._map.width*this._scale||e-g>this._map.height*this._scale)p=!1;var n=this._map.width*this._scale*(p?.1875:.5),p=this._map.height*this._scale*(p?.1875:.5),q=!0,l=!0,t=0;do{b+=(t%2?-1:1)*t*p;if(this._scanRingByX(d,h,c,k,b,a,u,n,f))break;b<g&&(q=!1);b>e&&(l=!1);t++}while(q||l)}},_scanRingByX:function(d,h,n,k,a,g,f,b,e){var u=!0,p=!0,q=0,l=1E3;do{k+=(q%
2?-1:1)*q*b;var t=this._movePointInsideRing(n,k,a),m=this._labelLayer._isWithinScreenArea(new c(t,a,t,a,h)),r=this._isPointWithinRing(d,n,t,a);if(m&&r)return e.push({x:t,y:a}),!0;k<g&&(u=!1);k>f&&(p=!1);q++;l--;if(0>=l)return!0}while(u||p);return!1},_movePointInsideRing:function(c,h,d){for(var k=[],a=c.length-1,g=c[0][1]>=c[a][1]?1:-1,f=0;f<=a;f++){var b=f,e=f+1;f==a&&(e=0);var u=c[b][0],b=c[b][1],n=c[e][0],e=c[e][1],p=e>=b?1:-1;if(b<=d&&d<=e||e<=d&&d<=b)d!=b&&d!=e?(k.push((d-b)*(n-u)/(e-b)+u),g=
p):d==b&&d!=e?(g!=p&&k.push(u),g=p):d!=b&&d==e?(k.push(n),g=p):d==b&&d==e&&(1==g&&k.push(u),k.push(n),g=p)}k.sort(function(a,b){return a-b});c=k.length;if(0<c){for(f=d=h=0;f<c-1;f+=2)a=Math.abs(k[f+1]-k[f]),a>h&&(h=a,d=f);h=(k[d]+k[d+1])/2}return h},_calcRingExtent:function(d){var h,n;n=new c;for(h=0;h<d.length-1;h++){var k=d[h][0],a=d[h][1];if(void 0===n.xmin||k<n.xmin)n.xmin=k;if(void 0===n.ymin||a<n.ymin)n.ymin=a;if(void 0===n.xmax||k>n.xmax)n.xmax=k;if(void 0===n.ymax||a>n.ymax)n.ymax=a}return n},
_isPointWithinPolygon:function(c,h,d,k){var a;for(a=0;a<h.rings.length;a++)if(this._isPointWithinRing(c,h.rings[a],d,k))return!0;return!1},_isPointWithinRing:function(c,h,d,k){var a,g,f,b,e=[],u=h.length;for(c=0;c<u-1;c++)if(a=h[c][0],g=h[c][1],f=h[c+1][0],b=h[c+1][1],a!=f||g!=b){if(g==b)if(k==g)e.push(a);else continue;a==f?(g<b&&k>=g&&k<b&&e.push(a),g>b&&k<=g&&k>b&&e.push(a)):(g=(f-a)/(b-g)*(k-g)+a,a<f&&g>=a&&g<f&&e.push(g),a>f&&g<=a&&g>f&&e.push(g))}e.sort(function(a,b){return a-b});for(c=0;c<e.length-
1;c++)if(a=e[c],f=e[c+1],d>=a&&d<f)if(c%2)break;else return!0;return!1},_findCentroidForRing:function(c){for(var h=c.length,d=[0,0],k=0,a=c[0][0],g=c[0][1],f=1;f<h-1;f++){var b=c[f][0],e=c[f][1],u=c[f+1][0],p=c[f+1][1],q=(b-a)*(p-g)-(u-a)*(e-g);d[0]+=q*(a+b+u);d[1]+=q*(g+e+p);k+=q}d[0]/=3*k;d[1]/=3*k;return d},_findCentroidForFeature:function(c){for(var h=0,d=[0,0],k=0;k<c.rings.length;k++)for(var a=c.rings[k],g=a.length,f=a[0][0],b=a[0][1],e=1;e<g-1;e++){var u=a[e][0],p=a[e][1],q=a[e+1][0],l=a[e+
1][1],t=(u-f)*(l-b)-(q-f)*(p-b);d[0]+=t*(f+u+q);d[1]+=t*(b+p+l);h+=t}d[0]/=3*h;d[1]/=3*h;return d},_findPlace:function(d,h,n,k,a,g,f){if(isNaN(n)||isNaN(k))return!1;for(var b=0;b<this._placedLabels.length;b++){var e=this._placedLabels[b].angle,u=this._placedLabels[b].width*this._scale,p=this._placedLabels[b].height*this._scale,l=this._placedLabels[b].x-n,t=this._placedLabels[b].y-k;if(0===a&&0===e){if(this._findPlace2(-g*this._scale,-f*this._scale,g*this._scale,f*this._scale,l-u,t-p,l+u,t+p))return!1}else{var m=
new c(-g*this._scale,-f*this._scale,g*this._scale,f*this._scale,null),r=0,E=1;0!==a&&(r=Math.sin(a),E=Math.cos(a));var y=l*E-t*r,l=l*r+t*E,e=e-a,r=Math.sin(e),E=Math.cos(e),C=-u*E- -p*r,t=-u*r+-p*E,e=+u*E- -p*r,F=+u*r+-p*E,u=y+C,p=l-t,r=y+e,E=l-F,C=y-C,t=l+t,y=y-e,l=l+F,e=new q;e.addRing([[u,p],[r,E],[C,t],[y,l],[u,p]]);if(m.intersects(e))return!1}}for(;a>Math.PI/2;)a-=Math.PI;for(;a<-(Math.PI/2);)a+=Math.PI;b={};b.layer=d;b.text=h;b.angle=a;b.x=n;b.y=k;b.width=g;b.height=f;this._placedLabels.push(b);
return!0},_findPlace2:function(c,h,d,k,a,g,f,b){return(c>=a&&c<=f||d>=a&&d<=f||c<=a&&d>=f)&&(h>=g&&h<=b||k>=g&&k<=b||h<=g&&k>=b)?!0:!1}})})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/utils ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z,A,E,y,C,F,B,G,H,L,J,K,I,O,P,R,N,Q,M,V,X,T,Z){var W=B.getClassValuesForRelationship(),Y={defaultShape:{type:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15"},stroke:{width:1,color:"#555555"}},w={HH:315,HL:45,LL:135,LH:225},U=d([T,v],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,_preserveCacheOnDestroy:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new q([64,64,64]),
defaultText:"Aa",sizeRampLightColor:new q([255,255,255]),sizeRampDarkColor:new q([128,128,128]),layerConnects:[],gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(a,b){m.mixin(this,Z.widgets.legend);this._i18n=Z.widgets.legend;a=a||{};a.map?b?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=!1===a.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===a.respectVisibility?
!1:!0,this._preserveCacheOnDestroy=a.preserveCacheOnDestroy?!0:!1,this.arrangement=a.arrangement===U.ALIGN_RIGHT?U.ALIGN_RIGHT:U.ALIGN_LEFT,this.arrangement===U.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=p(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);
var a=["ar","he"],b,e;for(b=0;b<a.length;b+=1)e=a[b],r.locale&&-1!==r.locale.indexOf(e)&&(-1!==r.locale.indexOf("-")?-1!==r.locale.indexOf(e+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();
9>h("ie")&&(this._repaintItems=m.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||l.forEach(this.layers,function(a){delete a.legendResponse})},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],l.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&
(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)b.destroy(this.domNode.children[a]);
this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],l.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),
a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],b=[];l.forEach(this.map.layerIds,function(e){e=this.map.getLayer(e);var f;this._isSupportedLayerType(e)&&(e.arcgisProps&&e.arcgisProps.title&&(e._titleForLegend=e.arcgisProps.title),this.layers.push(e));"esri.layers.KMLLayer"==e.declaredClass&&(f=e.getLayers(),l.forEach(f,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==
e.declaredClass&&(f=e.getFeatureLayers(),l.forEach(f,function(a){b.push(a.id)},this))},this);l.forEach(this.map.graphicsLayerIds,function(e){var f=this.map.getLayer(e);-1==l.indexOf(a,e)&&-1==l.indexOf(b,e)&&this._isSupportedLayerType(f)&&this._isLayerDrawingEnabled(f)&&(f.arcgisProps&&f.arcgisProps.title&&(f._titleForLegend=f.arcgisProps.title),this.layers.push(f))},this)}this._createLegend()},_isLayerDrawingEnabled:function(a){return a&&(a._params&&a._params.drawMode||a.isFeatureReductionActive&&
a.isFeatureReductionActive())},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=c.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=c.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=c.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=c.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),l.forEach(this.layers,function(a){var b={};
b.oarcConnect=c.connect(a,"onFeatureReductionRendererChange",this,"_refreshLayers");b.oaicConnect=c.connect(a,"onFeatureReductionChange",this,"_refreshLayers");b.ovcConnect=c.connect(a,"onVisibilityChange",this,"_refreshLayers");b.oocConnect=c.connect(a,"onOpacityChange",this,"_refreshLayers");b.oscConnect=c.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(b.odcConnect=c.connect(a,"_onDynamicLayersChange",
m.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(b.oirConnect=c.connect(a,"onRenderingChange",m.partial(this._updateImageServiceLayers,this,a)),b.oivrConnect=c.connect(a,"onRendererChange",m.partial(this._updateImageServiceLayers,this,a)));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(b.oivrConnect=c.connect(a,"onRendererChange",m.hitch(this,"_refreshLayers")));this.layerConnects[a.id]=b},this))},_deactivate:function(){this._ozeConnect&&
c.disconnect(this._ozeConnect);this._olaConnect&&c.disconnect(this._olaConnect);this._olroConnect&&c.disconnect(this._olroConnect);this._olrConnect&&c.disconnect(this._olrConnect);l.forEach(this.layers,function(a){a=this.layerConnects[a.id]||{};a.oarcConnect&&c.disconnect(a.oarcConnect);a.oaicConnect&&c.disconnect(a.oaicConnect);a.ovcConnect&&c.disconnect(a.ovcConnect);a.oocConnect&&c.disconnect(a.oocConnect);a.oscConnect&&c.disconnect(a.oscConnect);a.odcConnect&&c.disconnect(a.odcConnect);a.oirConnect&&
c.disconnect(a.oirConnect);a.oivrConnect&&c.disconnect(a.oivrConnect)},this);this.layerConnects=[]},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];l.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);l.forEach(this.map.graphicsLayerIds,
function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this._isLayerDrawingEnabled(a)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var g=!1,k=!1;e.set(this.domNode,"position","relative");b.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var h=[];l.forEach(this.layers,function(a){if("esri.layers.KMLLayer"==a.declaredClass||"esri.layers.GeoRSSLayer"==a.declaredClass){var e;a.loaded?("esri.layers.KMLLayer"==
a.declaredClass?e=a.getLayers():"esri.layers.GeoRSSLayer"==a.declaredClass&&(e=a.getFeatureLayers(),this.hideLayersInLegend[a.id]&&(e=l.filter(e,function(b){return-1==l.indexOf(this.hideLayersInLegend[a.id],b.id)},this))),l.forEach(e,function(b){"esri.layers.FeatureLayer"==b.declaredClass&&a._titleForLegend&&(b._titleForLegend=a._titleForLegend+" - ","esriGeometryPoint"==b.geometryType?b._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==b.geometryType?b._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==
b.geometryType&&(b._titleForLegend+=this.NLS_areas),h.push(b))},this)):c.connect(a,"onLoad",m.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===a.declaredClass)if(!a.loaded)c.connect(a,"onLoad",m.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&a.visible)&&0<a.layerInfos.length&&l.some(a.layerInfos,function(a){return a.legendURL})){var f=!1;l.forEach(a.layerInfos,function(e){if(e.legendURL&&-1<
l.indexOf(a.visibleLayers,e.name)){f||(b.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(a._titleForLegend||a.name||a.id)+"\x3c/span\x3e"},this.domNode),f=!0);var k;e=e.legendURL;if(a.customParameters||a.customLayerParameters){var c=m.clone(a.customParameters||{});m.mixin(c,a.customLayerParameters||{});for(k in c)e+=(-1===e.indexOf("?")?"?":"\x26")+k+"\x3d"+c[k]}b.create("div",{innerHTML:"\x3cimg src\x3d'"+e+"'/\x3e"},this.domNode);g=!0}},this)}}else"esri.layers.WFSLayer"!==
a.declaredClass||a.renderer?h.push(a):(e=b.create("div",{id:this.id+"_"+a.id,"class":"esriLegendService"}),b.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},b.create("td",{align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},e))))),b.place(e,this.id,"first"),e=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e),e=b.create("tbody",{},e),"esriGeometryComplex"===a.geometryType?(this._buildRow_Renderer(a,
a._pointSymbol,null,this.NLS_points,null,e),this._buildRow_Renderer(a,a._lineSymbol,null,this.NLS_lines,null,e),this._buildRow_Renderer(a,a._polygonSymbol,null,this.NLS_areas,null,e)):"esriGeometryPoint"===a.geometryType?this._buildRow_Renderer(a,a._pointSymbol,null,"",null,e):"esriGeometryPolyline"===a.geometryType?this._buildRow_Renderer(a,a._lineSymbol,null,"",null,e):"esriGeometryPolygon"===a.geometryType&&this._buildRow_Renderer(a,a._polygonSymbol,null,"",null,e),k=!0)},this);var d=[];l.forEach(h,
function(a){if(!a.loaded)var e=c.connect(a,"onLoad",this,function(a){c.disconnect(e);e=null;this.refresh()});else if((!this._respectVisibility||this._respectVisibility&&a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var f=b.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});b.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},b.create("td",{align:this._align},b.create("tr",{},b.create("tbody",
{},b.create("table",{width:"95%"},f)))));b.place(f,this.id,"first");a.legendResponse||a.renderer&&"esri.renderer.StretchRenderer"!==a.renderer.declaredClass?this._createLegendForLayer(a):this.isHostedTileService(a)?this._getLayerInfos(a).then(m.hitch(this,function(a){this._createLegendForLayer(a)}),m.hitch(this,function(a){d.push(this._legendRequest(a))})):d.push(this._legendRequest(a))}},this);0!==d.length||g||k?(new a(d)).addCallback(m.hitch(this,function(a){g||k?f.byId(this.id+"_msg").innerHTML=
"":f.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):(f.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForLayer:function(a){if(a.legendResponse||a.renderer||this.isHostedTileService(a)){var b=!1;if(a.legendResponse||this.isHostedTileService(a)){var g=a.dynamicLayerInfos||a.layerInfos;g&&g.length?l.forEach(g,function(e,f){this.hideLayersInLegend[a.id]&&-1!==l.indexOf(this.hideLayersInLegend[a.id],e.id)||(e=this._buildLegendItems(a,e,f),b=b||e)},
this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(g=a.url?a.url.substring(a.url.lastIndexOf("/")+1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,{id:g,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(e.set(f.byId(this.id+"_"+a.id),"display","block"),e.set(f.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):
this._legendRequestTools(a);c.connect(a,"onLoad",m.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var b=a.url,e=b.indexOf("?"),b=-1<e?b.substring(0,e)+"/legend"+b.substring(e):b+"/legend";(e=a._getToken())&&(b+="?token\x3d"+e);var f=m.hitch(this,"_processLegendResponse"),k={f:"json"};a._params.dynamicLayers&&(k.dynamicLayers=g.stringify(this._createDynamicLayers(a)),"[{}]"===k.dynamicLayers&&(k.dynamicLayers="[]"));a._params.bandIds&&(k.bandIds=a._params.bandIds);a._params.renderingRule?
k.renderingRule=a._params.renderingRule:a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&l.forEach(a.rasterFunctionInfos,function(a){a&&a.name&&"none"===a.name.toLowerCase()&&(k.renderingRule=g.stringify({rasterFunction:a.name}))});return y({url:b,content:k,callbackParamName:"callback",load:function(b,e){f(a,b,e)},error:E.defaults.io.errorHandler})},_legendRequestTools:function(a){var b=a.url.toLowerCase().indexOf("/rest/"),b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length),b=this._legendUrl+
"?soapUrl\x3d"+window.escape(b);if(!h("ie")||8<h("ie"))b+="\x26returnbytes\x3dtrue";var e=m.hitch(this,"_processLegendResponse");return y({url:b,content:{f:"json"},callbackParamName:"callback",load:function(b,f){e(a,b,f)},error:E.defaults.io.errorHandler})},_processLegendResponse:function(a,e){e&&e.layers?(a.legendResponse=e,f.byId(this.id+"_"+a.id)&&b.empty(f.byId(this.id+"_"+a.id)),b.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},b.create("td",{align:this._align},
b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},f.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+t.toJson(e))},_buildLegendItems:function(a,e,g){var k=!1,c=f.byId(this.id+"_"+a.id),h=e.parentLayerId;if(e.subLayerIds)a=b.create("div",{id:this.id+"_"+a.id+"_"+e.id+"_group",style:{display:"none"},"class":-1==h?0<g?"esriLegendGroupLayer":"":this._legendAlign},-1==h?c:f.byId(this.id+"_"+a.id+"_"+h+"_group")),b.create("td",
{innerHTML:z.encode(e.name),align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&a.visibleLayers)if(g=a.dynamicLayerInfos||a.layerInfos)if(a._params&&a._params.layers){if(-1===l.indexOf(a.visibleLayers,e.id))return k}else{if(g=this._getReallyVisibleLayers(g,a.visibleLayers),-1===l.indexOf(g,e.id))return k}else if(-1===l.indexOf(a.visibleLayers,e.id))return k;c=b.create("div",{id:this.id+"_"+a.id+
"_"+e.id,style:{display:"none"},"class":-1<h?this._legendAlign:""},-1==h?c:f.byId(this.id+"_"+a.id+"_"+h+"_group"));b.create("td",{innerHTML:z.encode(e.name)||"",align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%","class":"esriLegendLayerLabel"},c))));g=a.dynamicLayerInfos||a.layerInfos;h=!1;g&&g.length&&(h=l.some(g,function(a){return!!a.drawingInfo}));if(a.legendResponse)k=k||this._buildLegendItems_Tools(a,e,c);else if(a.renderer||h)k=k||this._buildLegendItems_Renderer(a,
e,c)}return k},_getReallyVisibleLayers:function(a,b){if(!a||!b||!b.length)return[];var e=[],f=[],g;for(g=0;g<a.length;g++)if(a[g].subLayerIds){if(-1===l.indexOf(b,a[g].id)||-1<l.indexOf(f,a[g].id))f=f.concat(a[g].subLayerIds)}else-1<l.indexOf(b,a[g].id)&&-1===l.indexOf(f,a[g].id)&&e.push(a[g].id);return e},_buildLegendItems_Tools:function(a,g,k){var c=g.parentLayerId,h=this.map.getScale(),d=!1,u=function(a,b){var e,f;for(e=0;e<a.length;e++)if(b.dynamicLayerInfos)for(f=0;f<b.dynamicLayerInfos[f].length;f++){if(b.dynamicLayerInfos[f].mapLayerId==
a[e].layerId)return a[e]}else if(b.id==a[e].layerId)return a[e];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,g,h)){var n=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var p=this._getEffectiveScale(a,g);if(p.minScale&&p.minScale<h||p.maxScale&&p.maxScale>h)n=!1}if(n){var h=u(a.legendResponse.layers,g),q=h.legendType,t=h.layerType,v=h.legend;
if(v){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&this._sanitizeLegendResponse(a,h,g);k=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k);var m=b.create("tbody",{},k);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(k,a,g);var y=[];l.forEach(v,function(b){if(!(10.1<=a.version&&!b.values&&1<v.length)||!a._hideDefaultSymbol&&"\x3call other values\x3e"!==b.label&&(b.label||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version||
"Raster Layer"===t)){var e=b.label;if(b.url&&0===b.url.indexOf("http")||b.imageData&&0<b.imageData.length)d=!0,e&&-1!==l.indexOf(y,e)||(y.push(e),this._buildRow_Tools(b,m,a,g.id,q))}},this)}}}d&&(e.set(f.byId(this.id+"_"+a.id+"_"+g.id),"display","block"),-1<c&&(e.set(f.byId(this.id+"_"+a.id+"_"+c+"_group"),"display","block"),this._findParentGroup(a.id,a,c)));return d},_getLayerInfos:function(a){var b=new k,e=a.dynamicLayerInfos||a.layerInfos;if(e&&e.length)if(l.some(e,function(a){return!!a.drawingInfo}))b.resolve(a);
else{var f=a.url,g=f.indexOf("?"),f=-1==g?f+"/layers":f.substring(0,g)+"/layers"+f.substring(g,f.length);y({url:f,content:{f:"json"},callbackParamName:"callback",load:function(f,g){f.layers?(l.forEach(e,function(a){var b=l.filter(f.layers,function(b){return a.source?b.id===a.source.mapLayerId:b.id===a.id});b&&b[0]&&b[0].drawingInfo&&(a.drawingInfo=b[0].drawingInfo,a.fields=b[0].fields)}),b.resolve(a)):b.reject(a)},error:function(e){b.reject(a)}})}return b},_sanitizeLegendResponse:function(a,b,e){var f=
b.legend;if(10.1<=a.version&&1<f.length&&!b._sanitized){a=m.getObject("layerDefinition.drawingInfo.renderer",!1,e);var g,k;a||(a=m.getObject("drawingInfo.renderer",!1,e));l.some(f,function(a){if(a.values)return!0})&&l.some(f,function(a,b){a.values||(k=b,g=a);return!!g});a?"uniqueValue"===a.type?g&&(f.splice(k,1),f.push(g)):"classBreaks"===a.type&&(g&&f.splice(k,1),f.reverse(),g&&f.push(g)):g&&(f.splice(k,1),f.push(g));b._sanitized=!0}},_buildRow_Tools:function(a,e,f,g,k){var c=b.create("tr",{},e),
d;this.alignRight?(e=b.create("td",{align:this._isRightToLeft?"left":"right"},c),d=b.create("td",{align:this._isRightToLeft?"left":"right",width:35},c)):(d=b.create("td",{width:35,align:"center"},c),e=b.create("td",{},c));c=a.url;(!h("ie")||9<=h("ie")||9>h("ie")&&"esri.layers.ArcGISImageServiceLayer"===f.declaredClass)&&a.imageData&&0<a.imageData.length?c="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(c=f.url+"/"+g+"/images/"+a.url,(g=f._getToken())&&(c+="?token\x3d"+g));g=b.create("img",
{src:c,border:0,style:"opacity:"+f.opacity},d);a=b.create("td",{innerHTML:z.encode(a.label),align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%",dir:"ltr"},e))));k&&"Stretched"===k&&10.3<=f.version&&"esri.layers.ArcGISImageServiceLayer"===f.declaredClass&&(a.style.verticalAlign="top",a.style.lineHeight="1",g.style.marginBottom="-1px",g.style.display="block",e.style.verticalAlign="top");9>h("ie")&&(g.style.filter="alpha(opacity\x3d"+100*f.opacity+")")},_getVariable:function(a,
b,e){var f;a&&(f=(a=a.getVisualVariablesForType(b,e))&&a[0]);return f},_getVariables:function(a,b,e){a=[this._getVariable(a,"colorInfo",!1),this._getVariable(a,"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return b?l.filter(a,function(a){return!(!a||a.field!==b||a.normalizationField!=e)}):a},_getFieldAlias:function(a,b,e){var f=b.infoTemplate||(b.infoTemplates&&e&&b.infoTemplates[e.id]?b.infoTemplates[e.id].infoTemplate:null),f=f&&f.getFieldInfo&&f.getFieldInfo(a);a=m.isFunction(a)?null:this.getField(b,
a,e);b=f||a;e="";b&&(e=f&&f.label||a&&a.alias||b.name||b.fieldName);return e},_getDomainName:function(a,b,e,f){var g;a&&!m.isFunction(a)&&(g=(e=(a=this.getField(e,a,f))&&e.getDomain?e.getDomain(a.name):null)&&e.codedValues?e.getName(b):null);return g},_getRampTitle:function(a,b,e){var f,g=a.field,k=a.normalizationField,c=!1,h=!1,d=!1,g=m.isFunction(g)?null:g,k=m.isFunction(k)?null:k;if(a.legendOptions&&a.legendOptions.title)f=a.legendOptions.title;else if(a.valueExpressionTitle)f=a.valueExpressionTitle;
else{if(b.renderer&&b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables){var u=b.renderer.authoringInfo.visualVariables;for(a=0;a<u.length;a++){var n=u[a];if("colorInfo"===n.type&&"ratio"===n.style){c=!0;break}else if("colorInfo"===n.type&&"percent"===n.style){h=!0;break}else if("colorInfo"===n.type&&"percentTotal"===n.style){d=!0;break}}}(c=d&&"showRatioPercentTotal"||h&&"showRatioPercent"||c&&"showRatio"||k&&"showNormField"||g&&"showField"||null)&&(f=C.substitute({field:g&&this._getFieldAlias(g,
b,e),normField:k&&this._getFieldAlias(k,b,e)},"showField"===c?"${field}":this._i18n[c]))}return f},_getRendererTitle:function(a,b,e){var f;if(a){var g,k,c;"esri.renderer.ClassBreaksRenderer"===a.declaredClass&&(g=a.attributeField,k=a.normalizationField,c="percent-of-total"===a.normalizationType);g=m.isFunction(g)?null:g;k=m.isFunction(k)?null:k;a.legendOptions&&a.legendOptions.title?f=a.legendOptions.title:a.valueExpressionTitle?f=a.valueExpressionTitle:(a=k&&"showNormField"||(c?"showNormPct":null)||
g&&"showField"||null)&&(f=C.substitute({field:g&&this._getFieldAlias(g,b,e),normField:k&&this._getFieldAlias(k,b,e)},"showField"===a?"${field}":this._i18n[a]))}return f},_buildLegendItems_Renderer:function(a,g,k){var c=g.parentLayerId,h=this.map,d=h.getScale(),u,n=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,g,d)){var p,q,t,v,y,x,r,E,D;t="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:g&&g.drawingInfo?X.fromJson(m.clone(g.drawingInfo.renderer)):a.isFeatureReductionActive&&
a.isFeatureReductionActive()?a.getFeatureReductionRenderer():a.renderer;if("esri.renderer.ScaleDependentRenderer"===t.declaredClass&&(t=(h="zoom"===t.rangeType?t.getRendererInfoByZoom(h.getZoom()):t.getRendererInfoByScale(d))&&h.renderer,!t))return!1;D=t&&t.authoringInfo&&"relationship"===t.authoringInfo.type;var A=this._getVariables(t),L=l.filter(A,function(a){return!!a}).length,d=A[0],h=A[1],A=A[2],K,F,G,B,H;d&&(v=this._getMedianColor(t,d),d.field&&(x=m.isFunction(d.field)?null:this.getField(a,
d.field,g)),K=!(d.legendOptions&&!1===d.legendOptions.showLegend));h&&(h.field&&(E=m.isFunction(h.field)?null:this.getField(a,h.field,g)),F=!(h.legendOptions&&!1===h.legendOptions.showLegend));A&&(A.field&&(r=m.isFunction(A.field)?null:this.getField(a,A.field,g)),G=!(A.legendOptions&&!1===A.legendOptions.showLegend));if("esri.renderer.HeatmapRenderer"===t.declaredClass)u=n=!0,this._showHeatRamp(a,g,t,k);else if("esri.renderer.DotDensityRenderer"===t.declaredClass)u=n=!0,this._showDotDensityLegend(a,
g,t,k);else if("esri.renderer.TemporalRenderer"===t.declaredClass)u=n=!0,q=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k),p=b.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,g),t.latestObservationRenderer&&"esri.renderer.SimpleRenderer"===t.latestObservationRenderer.declaredClass&&this._buildRow_Renderer(a,t.latestObservationRenderer.symbol,v,z.encode(t.latestObservationRenderer.label)||this.NLS_currentObservations,null,p),
t.observationRenderer&&"esri.renderer.SimpleRenderer"===t.observationRenderer.declaredClass&&this._buildRow_Renderer(a,t.observationRenderer.symbol,v,z.encode(t.observationRenderer.label)||this.NLS_previousObservations,null,p);else if("esri.renderer.UniqueValueRenderer"===t.declaredClass){if(t.infos&&0<t.infos.length){u=n=!0;if(t.legendOptions&&t.legendOptions.title||t.valueExpressionTitle)q=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k),p=b.create("tbody",
{},q),L=t.legendOptions&&t.legendOptions.title?t.legendOptions.title:t.valueExpressionTitle,this._buildRow_Renderer(a,null,v,z.encode(L),null,p);q=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k);p=b.create("tbody",{},q);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,g);t.attributeField&&A&&this._addSubHeader(p,this._getFieldAlias(t.attributeField,a,g));if(D){var I=t.authoringInfo;H=I.focus;var L=I.numClasses,J=I.field1.field;q=I.field2.field;if(L&&
J&&q){var P=I.field1.normalizationField,I=I.field2.normalizationField,S=P&&this._i18n.showNormField||J&&"${field}",R=I&&this._i18n.showNormField||q&&"${field}",J=C.substitute({field:this._getFieldAlias(J,a,g),normField:P&&this._getFieldAlias(P,a,g)},S);q=C.substitute({field:this._getFieldAlias(q,a,g),normField:I&&this._getFieldAlias(I,a,g)},R);P={shapeDescriptor:Y,rotation:this._getRotationAngleForFocus(H)||0};this._buildRow_Renderer(a,null,null,z.encode(J),null,p,null,P);P.rotation+=90;this._buildRow_Renderer(a,
null,null,z.encode(q),null,p,null,P);this._drawRelationshipLegend(k,{numClasses:L,focus:H,uvInfos:t.infos})}}else{var w=[];l.forEach(t.infos,function(b){var e=null;a._editable&&a.types&&(e=this._getTemplateFromTypes(a.types,b.value));var f=b.label;null==f&&(f=this._getDomainName(t.attributeField,b.value,a,g)||b.value);-1===l.indexOf(w,f)&&(w.push(f),this._buildRow_Renderer(a,b.symbol,v,z.encode(f),e,p))},this)}}H=!D&&this._displayDefaultSymbol(a,t,k)}else if("esri.renderer.ClassBreaksRenderer"===
t.declaredClass){if(t.infos&&0<t.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass)u=n=!0,B=this._isUnclassedRenderer(t),d||1!==t.infos.length||(y=(y=t.infos[0])&&y.symbol),B||(q=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k),p=b.create("tbody",{},q),L=this._getRendererTitle(t,a,g),this._buildRow_Renderer(a,null,v,z.encode(L),null,p)),q=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k),p=b.create("tbody",
{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,g),B&&A&&G||(D=t.infos.slice(0).reverse(),l.forEach(D,function(b){var e=b.label;null!=e||B||(e=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,v,z.encode(e),null,p)},this)),"esri.layers.ArcGISImageServiceVectorLayer"!==a.declaredClass||a.renderer.style!==O.STYLE_SCALAR&&a.renderer.style!==O.STYLE_SINGLE_ARROW||(this._buildRow_Renderer(a,t.defaultSymbol,null,"",null,p),a._hideDefaultSymbol=!0);B||(H=this._displayDefaultSymbol(a,
t,k))}else"esri.renderer.SimpleRenderer"===t.declaredClass&&(u=n=!0,q=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k),p=b.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,g),y=null,a._editable&&a.templates&&0<a.templates.length&&(y=a.templates[0]),D=1<L?null:x&&K||E&&F||r&&G,this._buildRow_Renderer(a,t.symbol,v,z.encode(D?this._getRampTitle(1<L?null:d||h||A,a,g):t.label),y,p),y=d?null:t.symbol,D&&(x=E=r=null));u&&(d&&K&&(d.field||
d.valueExpression)&&this._showGradientRamp(a,g,t,null,k,d,x,null,A&&G?!0:!1),A&&G&&(A.field||A.valueExpression)&&(u=d&&K||"esri.renderer.UniqueValueRenderer"===t.declaredClass?!1:!0,this._showSizeLegend(a,g,t,A,v,k,r,null,u)),h&&F&&(h.field||h.valueExpression)&&this._showGradientRamp(a,g,t,y&&!y.url&&y.color?y.color:this.transparencyRampColor,k,h,E,null,!1));H||B&&!K&&!G&&!F||(H=this._displayDefaultSymbol(a,t,k));n=n||H}n&&(e.set(f.byId(this.id+"_"+a.id+"_"+g.id),"display","block"),-1<c&&(e.set(f.byId(this.id+
"_"+a.id+"_"+c+"_group"),"display","block"),this._findParentGroup(a.id,c)));return n},_isUnclassedRenderer:function(a,b){var e;if("esri.renderer.ClassBreaksRenderer"===a.declaredClass&&a.infos&&1===a.infos.length){e=a.attributeField;var f=a.normalizationField;e=b?e===b:!!this._getVariables(a,e,f).length}return e},_displayDefaultSymbol:function(a,e,f){var g;!a._hideDefaultSymbol&&e.defaultSymbol&&(g=!0,f=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},f),f=b.create("tbody",
{},f),this._buildRow_Renderer(a,e.defaultSymbol,null,z.encode(e.defaultLabel)||"others",null,f));return g},_showGradientRamp:function(a,e,f,g,k,c,h,d,u){u=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(u?"":" esriLegendSubFragment")},k);k=b.create("tbody",{},u);(a._hoverLabel||a._hoverLabels||d)&&this._createHoverAction(u,a,e,d);(h||c.valueExpression||c.legendOptions&&c.legendOptions.title)&&this._addSubHeader(k,this._getRampTitle(c,a,e));h=c.field;var n;h&&(n=
m.isFunction(h)?null:this.getField(a,h,e));(e=this._getRampStops(f,c,g,n&&"esriFieldTypeDate"===n.type))&&e.length&&this._drawGradientRamp(k,e,!0,a,this._getRampBorderColor(f),!!g)},_getMedianColor:function(a,b){var e,f;b.colors?(e=b.minDataValue,f=b.maxDataValue):b.stops&&(e=b.stops[0].value,f=b.stops[b.stops.length-1].value);return a.getColor(e+(f-e)/2,{colorInfo:b})},_getRampStops:function(a,b,e,f){var g,k,c,h,d=!1;b.colors||b.opacityValues?(k=b.maxDataValue-b.minDataValue,g=l.map([0,.25,.5,.75,
1],function(a){c=b.minDataValue+a*k;return Number(c.toFixed(6))}),this._checkPrecision(0,4,g)):b.stops&&(g=l.map(b.stops,function(a){return a.value}),(d=l.some(b.stops,function(a){return!!a.label}))&&(h=l.map(b.stops,function(a){return a.label})));var u=g[0],n,p;k=g[g.length-1]-u;return l.map(g,function(c,l){e?(n=new q(e.toRgba()),p=a.getOpacity(c,{opacityInfo:b}),null!=p&&(n.a=p)):n=a.getColor(c,{colorInfo:b});var t="";if(d)t=h[l];else{var t=f?B.formatDate(c,B.timelineDateFormatOptions):F.format(c),
v="";0===l?v=this._specialChars.lt+" ":l===g.length-1&&(v=this._specialChars.gt+" ");t=v+t}return{value:c,color:n,offset:1-(c-u)/k,label:t}},this).reverse()},_checkPrecision:function(a,b,e){var f=a+(b-a)/2,g=e[a],k=e[f],c=e[b],h=Math.floor(g),d=Math.floor(k),u=Math.floor(c);h===g&&u===c&&d!==k&&h!==d&&u!==d&&(e[f]=d);a+1!==f&&this._checkPrecision(a,f,e);f+1!==b&&this._checkPrecision(f,b,e)},_getRampBorderColor:function(a){var b;if("esri.renderer.SimpleRenderer"===a.declaredClass)b=a.symbol;else if("esri.renderer.UniqueValueRenderer"===
a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawGradientRamp:function(a,f,g,k,c,d){var u=b.create("tr",{},a),n,p,t,v,m,y=f.length-1,r;v=0;this.alignRight?(a=b.create("td",{align:this._isRightToLeft?"left":"right"},u),n=b.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},u)):(n=b.create("td",{width:this.gradientWidth,align:"center"},u),a=b.create("td",
{},u));u=c&&0<c.a&&!(240<=c.r&&240<=c.g&&240<=c.b);p=b.create("div",{"class":u?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},n);n=b.create("div",{"class":"esriLegendColorRamp"+(d?" esriLegendTransparencyRamp":"")},p);d=e.get(n,"width");u&&(c=9>h("ie")?c.toHex():"rgba("+c.toRgba().join(",")+")",e.set(n,"border",this.colorRampBorder+" "+c));g?(c=this.gradientHeight*y,e.set(n,"height",c+"px")):c=e.get(n,"height");e.set(p,"height",c+"px");u=x.createSurface(n,
d,c);9>h("ie")&&(v=u.getEventSource(),e.set(v,"position","relative"),e.set(v.parentNode,"position","relative"),v=1);try{g&&l.forEach(f,function(a,b){a.offset=b/y}),m=u.createRect({x:-v,y:-v,width:d+v,height:c+v}),m.setFill({type:"linear",x1:0,y1:0,x2:0,y2:c,colors:f}).setStroke(null),u.createRect({width:d,height:c}).setFill(new q([255,255,255,1-k.opacity])).setStroke(null),this._surfaceItems.push(u)}catch(ia){u.clear(),u.destroy()}l.forEach(f,function(a,e){a.label&&(r="top:"+100*a.offset+"%;",a="",
0===e&&(a+=" esriLegendColorRampTickFirst"),e===f.length-1&&(a+=" esriLegendColorRampTickLast"),b.create("div",{"class":"esriLegendColorRampTick"+a,innerHTML:"\x26nbsp;",style:r},p))});t=b.create("div",{"class":"esriLegendColorRampLabels",style:{height:c+this.gradientHeight+"px"}},a);g?l.forEach(f,function(a){b.create("div",{"class":"esriLegendColorRampLabel",innerHTML:z.encode(a.label)||"\x26nbsp;"},t)}):(b.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},t),b.create("div",
{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(c+this.gradientHeight-2*this.gradientHeight)+"px;"},t))},_showHeatRamp:function(a,e,f,g,k){var c,h=f.field;c=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g);g=b.create("tbody",{},c);(a._hoverLabel||a._hoverLabels||k)&&this._createHoverAction(c,a,e,k);(h=h&&this.getField(a,h,e))&&this._addSubHeader(g,this._getFieldAlias(h.name,a,e));e=this._getHeatmapStops(f);e.length&&this._drawGradientRamp(g,
e,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var e,f,g,k;b&&b[0]?(e=b.length-1,(a=b[0]&&null!=b[0].ratio)?(a=b[e])&&1!==a.ratio&&(b=b.slice(0),b.push({ratio:1,color:a.color}),e++):(f=b[0].value,g=b[e].value-f,b=l.map(b,function(a){return{color:a.color,ratio:(a.value-f)/g}}))):a&&a[0]&&(e=a.length-1,k=1/(a.length-1),b=l.map(a,function(a,b){return{color:a,ratio:b*k}}));b=l.map(b,function(a,b){var f="";0===b?f="Low":b===e&&(f="High");return{color:a.color,label:f,offset:1-a.ratio}});
return b.reverse()},_showDotDensityLegend:function(a,e,f,g){var k=f.legendOptions,c,h,d,u,n,p,q,t=this.dotDensitySwatchSize,v=Math.round(t/2);k&&(h=k.backgroundColor,d=k.outline,u=k.valueUnit,n=k.dotCoverage);n=(n||this.dotCoverage)/100;q=Math.round(t*t/Math.pow(f.dotSize,2)*n);g=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g);p=b.create("tbody",{},g);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(g,a,e);this._addSubHeader(p,C.substitute({value:f.dotValue,
unit:u||""},this.NLS_dotValue));l.forEach(f.fields,function(b){b=m.mixin({},b);b.numPoints=q;c=new R(f._generateImageSrc(t,t,[b],{x:0,y:0},{x:t,y:t},h),d||f.outline,t,t);b=this.getField(a,b.name,e)||b;this._buildRow_Renderer(a,c,null,z.encode(this._getFieldAlias(b.name,a,e)),null,p,{type:"path",path:"M "+-v+","+-v+" L "+v+","+-v+" L "+v+","+v+" L "+-v+","+v+" L "+-v+","+-v+" E"})},this)},_showSizeLegend:function(a,e,f,g,k,c,h,d,u){var n=g.legendOptions,n=n&&n.customValues;k=this._getSizeSymbol(f,
k);if((!g.valueUnit||"unknown"===g.valueUnit)&&k&&(n||null!=g.minSize&&null!=g.maxSize&&null!=g.minDataValue&&null!=g.maxDataValue||g.stops&&!(1>=g.stops.length))){u=b.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(u?"":" esriLegendSubFragment")},c);c=b.create("tbody",{},u);(a._hoverLabel||a._hoverLabels||d)&&this._createHoverAction(u,a,e,d);(h||g.valueExpression||g.legendOptions&&g.legendOptions.title)&&this._addSubHeader(c,this._getRampTitle(g,a,e));h=g.field;
var p;d=m.isFunction(h);h&&(p=d?null:a.isFeatureReductionActive&&a.isFeatureReductionActive()?a.getFeatureReductionField(h):this.getField(a,h,e));e=p&&"esriFieldTypeDate"===p.type;var n=n||this._getDataValues(f,k,g,e),q,l=n.length-1;for(p=l;0<=p;p--)u=n[p],k=V.fromJson(k.toJson()),this._applySize(k,f,g,u),u=e?B.formatDate(u,B.timelineDateFormatOptions):F.format(u),q="",p===l?q=this._specialChars.gt+" ":0===p&&(q=h&&!d&&"cluster_count"===h.toLowerCase()&&1===n[p]?"":this._specialChars.lt+" "),q="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+
z.encode(q+u)+"\x3c/span\x3e",this._buildRow_Renderer(a,k,null,q,null,c)}},_getSizeSymbol:function(a,b){var e,f;if("esri.renderer.SimpleRenderer"===a.declaredClass)e=a.symbol;else if("esri.renderer.VectorFieldRenderer"===a.declaredClass)e=a.defaultSymbol;else if("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)e=a.infos[0].symbol,f=1<a.infos.length;if(e=e&&-1!==e.type.indexOf("fillsymbol")?null:e)if(e=V.fromJson(e.toJson()),b||f)-1!==e.type.indexOf("linesymbol")?
e.setColor(new q(this.sizeRampDarkColor)):(e.setColor(new q(this.sizeRampLightColor)),e.setOutline&&(a=new Q,a.setColor(new q(this.sizeRampDarkColor)),a.setWidth(1.5),e.setOutline(a)));return e},_getDataValues:function(a,b,e,f,g,k){g=null==g?5:g;k=null==k?20:k;var c=a.getSizeRangeAtScale(e,this.map.getScale());g=this._interpolateSizeRange(c,g);var h=this._getDataRange(e),d=l.map(g,function(a){return this._getDataValueFromSize(a,h,c)},this);if(!f){var u,d=F.round(d);for(f=1;f<d.length-1;f++)if(u=this._roundDataValue(a,
b,e,d[f],d[f-1],k))d[f]=u[0],g[f]=u[1]}return d},_getDataRange:function(a){var b=a.stops;return b?{min:b[0].value,max:b[b.length-1].value}:{min:a.minDataValue,max:a.maxDataValue}},_interpolateSizeRange:function(a,b){var e=a.minSize;a=(a.maxSize-e)/(b-1);var f,g=[];for(f=0;f<b;f++)g.push(e+a*f);return g},_getDataValueFromSize:function(a,b,e){var f=e.minSize;e=e.maxSize;var g=b.min;b=b.max;return a<=f?g:a>=e?b:(a-f)/(e-f)*(b-g)+g},_roundDataValue:function(a,b,e,f,g,k){var c=this._getSize(b,a,e,f);g=
this._getSize(b,a,e,g);var h,d=F.getDigits(f),u=d.integer,d=d.fractional,n,p,q,l,t,v,m,y,x,r,D;0<f&&1>f&&(h=Math.pow(10,d),f*=h,u=F.getDigits(f).integer);for(--u;0<=u&&(n=Math.pow(10,u),d=Math.floor(f/n)*n,n*=Math.ceil(f/n),null!=h&&(d/=h,n/=h),p=(d+n)/2,p=F.round([d,p,n],{indexes:[1]})[1],q=this._getSize(b,a,e,d),l=this._getSize(b,a,e,n),t=this._getSize(b,a,e,p),v=F.getPctChange(c,q,g,null),m=F.getPctChange(c,l,g,null),y=F.getPctChange(c,t,g,null),x=v.prev<=k,r=m.prev<=k,x&&r&&(v.prev<=m.prev?(x=
!0,r=!1):(r=!0,x=!1)),x?D=[d,q]:r?D=[n,l]:y.prev<=k&&(D=[p,t]),!D);u--);return D},_applySize:function(a,b,e,f){var g=a.type;b=this._getSize(a,b,e,f);switch(g){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":g=a.width;e=a.height;a.setHeight(b);a.setWidth(g/e*b);break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,e,f){return b.getSize(f,{sizeInfo:e,scale:this.map.getScale(),shape:-1!==
a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,e,f,g,k,c,h,d){var u=!!d,n=b.create("tr",{},c),p;if(this.alignRight){if(c=b.create("td",{align:this._isRightToLeft?"left":"right"},n),e||u)p=b.create("td",{align:this._isRightToLeft?"left":"right",width:35},n)}else{if(e||u)p=b.create("td",{width:35,align:"center"},n);c=b.create("td",{},n)}var q=n=30,l;if(e)if("simplemarkersymbol"==e.type)n=Math.min(Math.max(n,e.size+12),125),q=Math.min(Math.max(q,e.size+12),125);else if("picturemarkersymbol"==
e.type)n=Math.min(Math.max(n,e.width),125),q=Math.min(e.height||q,125);else if("textsymbol"==e.type){var t,v;e.text||(t=e.text,v=!0,e.setText(this.defaultText));n=Math.min(Math.max(n,e.getWidth()+12),125);q=Math.min(Math.max(q,e.getHeight()+12),125);v&&e.setText(t)}if(e||u)l=b.create("div",{style:"width:"+n+"px;height:"+q+"px;"},p);C.isDefined(g)&&"number"===typeof g&&(g=""+g);b.create("td",{innerHTML:g||"",align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},c))));
if(e||u)a=this._drawSymbol(l,e,f,n,q,k,a,h,d),this._surfaceItems.push(a)},_addSubHeader:function(a,e){a=b.create("tr",{},a);a=b.create("td",{align:this._align,colspan:2},a);b.create("td",{innerHTML:z.encode(e)||"",align:this._align},b.create("tr",{},b.create("tbody",{},b.create("table",{width:"95%"},a))))},_drawSymbol:function(a,b,f,g,k,c,d,u,n){var p=b&&V.fromJson(b.toJson()),l=d.opacity;b=!!n;if(p)if(f&&p.setColor(new q(f.toRgba())),"simplelinesymbol"===p.type||"cartographiclinesymbol"===p.type||
"textsymbol"===p.type){if(!p.color)return;f=p.color.toRgba();f[3]*=l;p.color.setColor(f)}else"simplemarkersymbol"===p.type||"simplefillsymbol"===p.type?(p.color&&(f=p.color.toRgba(),f[3]*=l,p.color.setColor(f)),p.outline&&p.outline.color&&(f=p.outline.color.toRgba(),f[3]*=l,p.outline.color.setColor(f))):"picturemarkersymbol"===p.type&&(a.style.opacity=l,a.style.filter="alpha(opacity\x3d("+100*l+"))");a=x.createSurface(a,g,k);9>h("ie")&&(f=a.getEventSource(),e.set(f,"position","relative"),e.set(f.parentNode,
"position","relative"));c=b?n.shapeDescriptor:this._getDrawingToolShape(p,c)||V.getShapeDescriptors(p);var t,l=(f=c.defaultShape)&&"text"===f.type;try{l&&!f.text&&(f.text=this.defaultText),t=a.createShape(u||f).setFill(c.fill).setStroke(c.stroke),l&&t.setFont(c.font)}catch(ia){a.clear();a.destroy();return}var v=t.getBoundingBox();u=v.width;c=v.height;var l=-(v.x+u/2),y=-(v.y+c/2);f=a.getDimensions();l={dx:l+f.width/2,dy:y+f.height/2};if(p&&"simplemarkersymbol"===p.type&&"path"===p.style)g=d._getScaleMatrix(v,
p.size),t.applyTransform(D.scaleAt(g.xx,g.yy,{x:f.width/2,y:f.height/2}));else if(u>g||c>k)d=u/g>c/k,g=((d?g:k)-5)/(d?u:c),m.mixin(l,{xx:g,yy:g});t.applyTransform(l);b&&t.applyTransform(D.rotategAt(n.rotation,u/2,c/2));return a},_getDrawingToolShape:function(a,b){switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":b={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":b={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};
break;case "esriFeatureEditToolRectangle":b={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};break;case "esriFeatureEditToolCircle":b={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":b={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:b,fill:a.getFill(),stroke:a.getStroke()}},_drawRelationshipLegend:function(a,b){var e=b.focus,f=b.numClasses,g=W[f],k=!!e,c=Math.sqrt(Math.pow(75,2)+Math.pow(75,2)),h={};b.uvInfos.forEach(function(a){h[a.value]=
{label:a.label,fill:this._getSymbolColor(a.symbol)}},this);b=[];for(var d=0;d<f;d++){for(var u=[],n=0;n<f;n++)u.push(h[g[d][n]].fill);b.push(u)}g=this._getRelationshipCornerLabels(e,h);a=this._drawRampLayout(a,g,c,k);a=x.createSurface(a,c,c);k||(a.rawNode.style.margin="-15px -15px -18px -15px");b=M.create2DColorRamp({surface:a,colors:b,numClasses:f,size:75});f=(c-75)/2;c=(c-75)/2;b.applyTransform(D.translate(f,c));k&&b.applyTransform(D.rotategAt(this._getRotationAngleForFocus(e),37.5,37.5));b=a.createGroup();
g={width:1,color:"#555555"};d=a.defNode;this._createArrowMarker(d,"start");this._createArrowMarker(d,"end");d=b.createLine({x1:-10,y1:60,x2:-10,y2:15}).setStroke(g);g=b.createLine({x1:15,y1:85,x2:60,y2:85}).setStroke(g);this._setLineArrow(d.rawNode,"left",e);this._setLineArrow(g.rawNode,"right",e);b.applyTransform(D.translate(f,c));k&&b.applyTransform(D.rotategAt(-45,37.5,37.5));this._surfaceItems.push(a)},_drawRampLayout:function(a,e,f,g){var k=b.create("div",{style:{padding:"10px"}},a);a=f+"px";
f+="px";g?(g=b.create("div",{style:{display:"flex"}},k),b.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a,textAlign:"right"},innerHTML:e.left},g),k=b.create("div",{style:{display:"flex",flexDirection:"column",textAlign:"center"}},g),b.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:e.right},g),g=b.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:e.top},k),g=b.create("div",
{style:{height:f,width:f}},k),k=b.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:e.bottom},k)):(k=b.create("div",{style:{display:"table",color:"#555555"}},k),g=b.create("div",{style:{display:"table-row"}},k),f=b.create("div",{style:{display:"table-row"}},k),k=b.create("div",{style:{display:"table-row"}},k),b.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"right",verticalAlign:"bottom"},innerHTML:e.left},
g),b.create("div",{style:{display:"table-cell"}},g),b.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"left",verticalAlign:"bottom"},innerHTML:e.top},g),b.create("div",{style:{display:"table-cell"}},f),g=b.create("div",{style:{display:"table-cell"}},f),b.create("div",{style:{display:"table-cell"}},f),b.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"right",verticalAlign:"top"},innerHTML:e.bottom},
k),b.create("div",{style:{display:"table-cell"}},k),b.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"left",verticalAlign:"top"},innerHTML:e.right},k));return g},_getSymbolColor:function(a){if(a)return"simplelinesymbol"===a.type||"simplemarkersymbol"===a.type&&(a.style===N.STYLE_X||a.style===N.STYLE_CROSS)?(a=a.getStroke())&&a.color:a.getFill()},_getRotationAngleForFocus:function(a){var b=w[a];a&&null==b&&(b=w.HH);return b},_setLineArrow:function(a,
b,e){var f=this.id+"_arrowStart",g=this.id+"_arrowEnd";b="left"===b;switch(e){case "HL":a.setAttribute(b?"marker-start":"marker-end","url(#"+(b?g:f)+")");break;case "LL":a.setAttribute("marker-start","url(#"+g+")");break;case "LH":a.setAttribute(b?"marker-end":"marker-start","url(#"+(b?f:g)+")");break;default:a.setAttribute("marker-end","url(#"+f+")")}},_createArrowMarker:function(a,b){var e="start"===b,f=this.id+(e?"_arrowStart":"_arrowEnd");b=e?"0,0 5,5 0,10":"5,0 0,5 5,10";var g=e?5:0,e=document.createElementNS("http://www.w3.org/2000/svg",
"marker");e.setAttribute("id",f);e.setAttribute("markerWidth","10");e.setAttribute("markerHeight","10");e.setAttribute("refX",g);e.setAttribute("refY","5");e.setAttribute("markerUnits","strokeWidth");e.setAttribute("orient","auto");f=document.createElementNS("http://www.w3.org/2000/svg","polyline");f.setAttribute("points",b);f.setAttribute("fill","none");f.setAttribute("stroke","#555555");f.setAttribute("stroke-width","1");e.appendChild(f);a.appendChild(e)},_getRelationshipCornerLabels:function(a,
b){var e=b.HH.label,f=b.LL.label,g=b.HL.label;b=b.LH.label;switch(a){case "HH":return{top:e,bottom:f,left:g,right:b};case "HL":return{top:g,bottom:b,left:f,right:e};case "LL":return{top:f,bottom:e,left:b,right:g};case "LH":return{top:b,bottom:g,left:e,right:f};default:return{top:e,bottom:f,left:g,right:b}}},_repaintItems:function(){l.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&
a.setFill(a.getFill())}catch(ea){}a.children&&m.isArray(a.children)&&l.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,g,k,h){if(h=g._hoverLabel||g._hoverLabels&&g._hoverLabels[k.id]||h)h=z.encode(h),g.mouseMoveHandler=g.mouseMoveHandler||{},g.mouseMoveHandler[k.id]=c.connect(a,"onmousemove",m.hitch(this,function(a,g){this.mouseX=g.clientX;this.mouseY=g.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,e.set(f.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(m.hitch(this,
function(a,g,k){if(a==this.mouseX&&g==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,f.byId(this.id+"_hoverLabel")){var c=f.byId(this.id+"_hoverLabel");c.innerHTML="\x3cspan\x3e"+k+"\x3c/span\x3e";e.set(c,"top",g+"px");e.set(c,"left",a+15+"px");e.set(c,"display","")}else b.create("div",{innerHTML:"\x3cspan\x3e"+k+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:g+"px",left:a+15+"px"}},document.body)},g.clientX,g.clientY,a),500)},h)),g.mouseOutHandler=
g.mouseOutHandler||{},g.mouseOutHandler[k.id]=c.connect(a,"onmouseout",m.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,e.set(f.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;l.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)c.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)c.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=
[],e;l.forEach(a.dynamicLayerInfos||a.layerInfos,function(f){e={id:f.id};e.source=f.source&&f.source.toJson();var g;a.layerDefinitions&&a.layerDefinitions[f.id]&&(g=a.layerDefinitions[f.id]);g&&(e.definitionExpression=g);var k;a.layerDrawingOptions&&a.layerDrawingOptions[f.id]&&(k=a.layerDrawingOptions[f.id]);k&&(e.drawingInfo=k.toJson());e.minScale=f.minScale||0;e.maxScale=f.maxScale||0;b.push(e)});return b},_getTemplateFromTypes:function(a,b){var e;for(e=0;e<a.length;e++)if(a[e].id==b&&a[e].templates&&
0<a[e].templates.length)return a[e].templates[0];return null},_findParentGroup:function(a,b,g){var k,c=b.dynamicLayerInfos||b.layerInfos;for(k=0;k<c.length;k++)if(g==c[k].id){-1<c[k].parentLayerId&&(e.set(f.byId(this.id+"_"+a+"_"+c[k].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,c[k].parentLayerId));break}},_addSubLayersToHide:function(a){function b(e,f){var g=a.layer.dynamicLayerInfos||a.layer.layerInfos,k,c;for(k=0;k<g.length;k++)if(g[k].id===e&&g[k].subLayerIds)for(c=0;c<
g[k].subLayerIds.length;c++){var h=g[k].subLayerIds[c];-1===l.indexOf(f,h)&&(f.push(h),b(h,f))}}a.layer.layerInfos&&l.forEach(this.hideLayersInLegend[a.layer.id],function(e){b(e,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,e){var f,g=!0;if(a.legendResponse&&a.legendResponse.layers)for(f=0;f<a.legendResponse.layers.length;f++){var k=a.legendResponse.layers[f];if(b.id==k.layerId){var c,h;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==k.minScale&&a.tileInfo&&
(c=a.tileInfo.lods[0].scale),0==k.maxScale&&a.tileInfo&&(h=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(c=Math.min(a.minScale,k.minScale)||a.minScale||k.minScale,h=Math.max(a.maxScale,k.maxScale));if(0<c&&c<e||h>e)g=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<e||a.maxScale&&a.maxScale>e)g=!1;return g},_getServiceTitle:function(a){var b=a._titleForLegend;b||(b=a.url,a.url?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+
1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:
this["NLS_"+a.vectorFieldPixelFilter.inputUnit],C.isDefined(a)&&(b+=" ("+a+")"));return z.encode(b)},_getEffectiveScale:function(a,b){var e=b.minScale,f=b.maxScale;if(C.isDefined(b.parentLayerId)){a=a.layerInfos;b=b.parentLayerId;var g;for(g=a.length-1;0<=g;g--)if(a[g].id==b)if(0==e&&0<a[g].minScale?e=a[g].minScale:0<e&&0==a[g].minScale||0<e&&0<a[g].minScale&&(e=Math.min(e,a[g].minScale)),f=Math.max(f||0,a[g].maxScale||0),-1<a[g].parentLayerId)b=a[g].parentLayerId;else break}return{minScale:e,maxScale:f}},
_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===
a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1},isHostedTileService:function(a){var b=/(https?:)?\/\/services.*\.arcgis\.com/i;return"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass&&b.test(a.url)?!0:!1},getField:function(a,b,e){if(a.getField)return a.getField(b);if(e&&e.fields){var f;l.forEach(e.fields,function(a){a.name===b&&(f=a)});return f}return null}});m.mixin(U,{ALIGN_LEFT:0,ALIGN_RIGHT:1});h("extend-esri")&&m.setObject("dijit.Legend",
U,A);return U})},"dojo/debounce":function(){define([],function(){return function(r,d){var m;return function(){m&&clearTimeout(m);var l=this,c=arguments;m=setTimeout(function(){r.apply(l,c)},d)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(r,d,m,l){var c=function(c,d){return c-d},t={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(c){var d=String(c),h=d.match(t._reNumber);c={integer:0,fractional:0};h&&h[1]?(c.integer=h[1].split("").length,
c.fractional=h[3]?h[3].split("").length:0):-1<d.toLowerCase().indexOf("e")&&(h=d.split("e"),d=h[0],h=h[1],d&&h&&(d=Number(d),h=Number(h),(c=0<h)||(h=Math.abs(h)),d=t.getDigits(d),c?(d.integer+=h,d.fractional=h>d.fractional?0:d.fractional-h):(d.fractional+=h,d.integer=h>d.integer?1:d.integer-h),c=d));return c},getFixedNumbers:function(c,d){var h;h=Number(c.toFixed(d));h<c?c=h+1/Math.pow(10,d):(c=h,h-=1/Math.pow(10,d));h=Number(h.toFixed(d));c=Number(c.toFixed(d));return[h,c]},getPctChange:function(c,
d,h,n){var k={prev:null,next:null},a;null!=h&&(a=c-h,k.prev=Math.floor(Math.abs(100*(d-h-a)/a)));null!=n&&(a=n-c,k.next=Math.floor(Math.abs(100*(n-d-a)/a)));return k},round:function(d,p){d=d.slice(0);var h,n,k,a,g,f,b,e,u=p&&null!=p.tolerance?p.tolerance:2,l=p&&p.indexes,q=p&&null!=p.strictBounds?p.strictBounds:!1;if(l)l.sort(c);else for(l=[],g=0;g<d.length;g++)l.push(g);for(g=0;g<l.length;g++)if(e=l[g],p=d[e],h=0===e?null:d[e-1],n=e===d.length-1?null:d[e+1],k=t.getDigits(p),k=k.fractional){f=0;for(b=
!1;f<=k&&!b;)a=t.getFixedNumbers(p,f),a=q&&0===g?a[1]:a[0],b=t.hasMinimalChange(p,a,h,n,u),f++;b&&(d[e]=a)}return d},hasMinimalChange:function(c,d,h,n,k){c=t.getPctChange(c,d,h,n);d=null==c.prev||c.prev<=k;h=null==c.next||c.next<=k;return d&&h||c.prev+c.next<=2*k},_reAllZeros:new RegExp("\\"+m.decimal+"0+$","g"),_reSomeZeros:/(\d)0*$/g,format:function(c,p){p=p||{places:20,round:-1};(c=d.format(c,p))&&(c=c.replace(t._reSomeZeros,"$1").replace(t._reAllZeros,""));return c}};r("extend-esri")&&(l.numberUtils=
t);return t})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(r,d,m,l,c,t,q,p){function h(a){return a&&d.map(a,function(a){return new q(a)})}function n(b,e,f){var g="";0===e?g=a.lt+" ":e===f&&(g=a.gt+" ");return g+b}var k={},a={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},g={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},f={millisecond:{dateOptions:{formatLength:"long"},
timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},b={formatLength:"short",fullYear:!0},e={formatLength:"short"};r.mixin(k,
{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(a,f){var g=[];null==a||a instanceof Date||(a=new Date(a));f=f||{};f=r.mixin({},f);var k=f.selector?f.selector.toLowerCase():null,c=!k||-1<k.indexOf("time"),k=!k||-1<k.indexOf("date");c&&(f.timeOptions=f.timeOptions||e,f.timeOptions&&(f.timeOptions=r.mixin({},f.timeOptions),f.timeOptions.selector=f.timeOptions.selector||"time",g.push(f.timeOptions)));k&&(f.dateOptions=f.dateOptions||b,f.dateOptions&&
(f.dateOptions=r.mixin({},f.dateOptions),f.dateOptions.selector=f.dateOptions.selector||"date",g.push(f.dateOptions)));g&&g.length?(g=d.map(g,function(b){return l.format(a,b)}),f=1==g.length?g[0]:p["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,b){return g[b]})):f=l.format(a);return f},createColorStops:function(a){var b=a.values,e=a.colors,f=a.labelIndexes,g=a.isDate,c=a.dateFormatOptions;a=[];return a=d.map(b,function(a,h){var u=null;if(!f||-1<d.indexOf(f,h)){var p;(p=
g?k.formatDate(a,c):t.format(a))&&(u=n(p,h,b.length-1))}return{value:a,color:e[h],label:u}})},updateColorStops:function(a){var b=a.stops,e=a.changes,f=a.isDate,g=a.dateFormatOptions,c=[],h,u=d.map(b,function(a){return a.value});d.forEach(e,function(a){c.push(a.index);u[a.index]=a.value});h=t.round(u,{indexes:c});d.forEach(b,function(a,e){a.value=u[e];if(null!=a.label){var c,d=null;(c=f?k.formatDate(h[e],g):t.format(h[e]))&&(d=n(c,e,b.length-1));a.label=d}})},createClassBreakLabel:function(b){var e=
b.minValue,f=b.maxValue,g=b.isFirstBreak?"":a.gt+" ";b="percent-of-total"===b.normalizationType?a.pct:"";e=null==e?"":t.format(e);f=null==f?"":t.format(f);return g+e+b+" \u2013 "+f+b},setLabelsForClassBreaks:function(a){var b=a.classBreaks,e=a.classificationMethod,f=a.normalizationType,g=[];b&&b.length&&("standard-deviation"===e?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):a.round?(g.push(b[0].minValue),d.forEach(b,function(a){g.push(a.maxValue)}),
g=t.round(g),d.forEach(b,function(a,b){a.label=k.createClassBreakLabel({minValue:0===b?g[0]:g[b],maxValue:g[b+1],isFirstBreak:0===b,normalizationType:f})})):d.forEach(b,function(a,b){a.label=k.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===b,normalizationType:f})}))},updateClassBreak:function(a){var b=a.classBreaks,e=a.normalizationType,f=a.change,g=f.index,f=f.value,c=-1,h=-1,d=b.length;"standard-deviation"===a.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):
(0===g?c=g:g===d?h=g-1:(h=g-1,c=g),-1<c&&c<d&&(a=b[c],a.minValue=f,a.label=k.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===c,normalizationType:e})),-1<h&&h<d&&(a=b[h],a.maxValue=f,a.label=k.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===h,normalizationType:e})))},calculateDateFormatInterval:function(a){var b,e,f=a.length,k,c,h,u,n,p,l=Infinity,q;a=d.map(a,function(a){return new Date(a)});for(b=0;b<f-1;b++){k=a[b];h=[];n=Infinity;p=
"";for(e=b+1;e<f;e++)c=a[e],c=k.getFullYear()!==c.getFullYear()&&"year"||k.getMonth()!==c.getMonth()&&"month"||k.getDate()!==c.getDate()&&"day"||k.getHours()!==c.getHours()&&"hour"||k.getMinutes()!==c.getMinutes()&&"minute"||k.getSeconds()!==c.getSeconds()&&"second"||"millisecond",u=g[c],u<n&&(n=u,p=c),h.push(c);n<l&&(l=n,q=p)}return q},createUniqueValueLabel:function(a){var b=a.value,e=a.fieldInfo,g=a.domain;a=a.dateFormatInterval;var c=String(b);(g=g&&g.codedValues?g.getName(b):null)?c=g:"number"===
typeof b&&(c=e&&"esriFieldTypeDate"===e.type?k.formatDate(b,a&&f[a]):t.format(b));return c},cloneColorInfo:function(a){var b;a&&(b=r.mixin({},a),b.colors=h(b.colors),b.stops=b.stops&&d.map(b.stops,function(a){a=r.mixin({},a);a.color&&(a.color=new q(a.color));return a}),b.legendOptions&&(b.legendOptions=r.mixin({},b.legendOptions)));return b},cloneOpacityInfo:function(a){var b;if(a){b=r.mixin({},a);if(a=b.opacityValues)b.opacityValues=a.slice(0);if(a=b.stops)b.stops=d.map(a,function(a){return r.mixin({},
a)});if(a=b.legendOptions)b.legendOptions=r.mixin({},a)}return b},cloneSizeInfo:function(a){var b;a&&(b=r.mixin({},a),b.stops&&(b.stops=d.map(b.stops,function(a){return r.mixin({},a)})),(a=b.minSize)&&"object"===typeof a&&(b.minSize=k.cloneSizeInfo(a)),(a=b.maxSize)&&"object"===typeof a&&(b.maxSize=k.cloneSizeInfo(a)),a=b.legendOptions)&&(b.legendOptions=r.mixin({},a),a=a.customValues)&&(b.legendOptions.customValues=a.slice(0));return b},getClassCodesForRelationship:function(){return r.clone({2:["L",
"H"],3:["L","M","H"],4:["L","M1","M2","H"]})},getClassValuesForRelationship:function(){return r.clone({2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]})}});m("extend-esri")&&r.setObject("renderer.utils",k,c);return k})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define("dojo/_base/declare dojo/_base/array dojo/Deferred esri/lang jimu/utils ./LayerInfo".split(" "),
function(r,d,m,l,c,t){return r(t,{constructor:function(){},_getExtent:function(){var d=new m,p=this.layerObject.items,h=this.layerObject.fullExtent||this.layerObject.initialExtent;0===p.length?d.resolve(h):d.resolve(c.graphicsExtent(p));return d},_resetLayerObjectVisiblity:function(c){var d=c?c[this.id]:null;if(d){var h={},n;for(n in c)c.hasOwnProperty(n)&&"function"!==typeof c[n]&&(h[n]=c[n].visible);this._setSubLayerVisibleByCheckedInfo(h);this._setTopLayerVisible(d.visible)}},_setSubLayerVisibleByCheckedInfo:function(c){d.forEach(this.newSubLayers,
function(d){l.isDefined(c[d.id])&&d.layerObject.setVisibility(c[d.id])},this)},_initVisible:function(){var c=!1,d;for(d=0;d<this.newSubLayers.length;d++)c=c||this.newSubLayers[d].layerObject.visible;c&&(this._visible=!0)},_setTopLayerVisible:function(c){this._visible=c?!0:!1;d.forEach(this.newSubLayers,function(c){c.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var c=[],p=this.layerObject.getFeatureLayers();d.forEach(p,function(h){h=this._layerInfoFactory.create({layerObject:h,
title:h.label||h.title||h.name||h.id||" ",id:h.id||" ",subId:h.id||" ",collection:{layerInfo:this},selfType:"geo_rss",parentLayerInfo:this});c.push(h);h.init()},this);this._markInvalidSubLayerInfoThatAsRootLayer(p);return c},_markInvalidSubLayerInfoThatAsRootLayer:function(c){var p;d.forEach(c,function(c){if(p=this._getLayerInfosObj()._findTopLayerInfoById(c.id))p._flag._invalid=!0},this)},_needToRenew:function(){var c=this.layerObject.getFeatureLayers();return(c?c.length:0)===this.newSubLayers.length?
!1:!0},_obtainLayerIndexesInMap:function(){var c=[],d,h;for(h=0;h<this.newSubLayers.length;h++)(d=this._getLayerIndexesInMapByLayerId(this.newSubLayers[h].layerObject.id))&&c.push(d);return c},moveLeftOfIndex:function(c){var d;for(d=this.newSubLayers.length-1;0<=d;d--)this.map.reorderLayer(this.newSubLayers[d].layerObject,c)},moveRightOfIndex:function(c){var d;for(d=0;d<this.newSubLayers.length;d++)this.map.reorderLayer(this.newSubLayers[d].layerObject,c)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS esri/layers/FeatureLayer esri/lang".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k){return r(p,{constructor:function(a,g){},_getExtent:function(){var a=new c;a.resolve(this.layerObject.extent||this.layerObject.fullExtent);return a},_initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(a){this._visible=a;this.layerObject.setVisibility(a)},_setSubLayerVisible:function(a){var g=[],f,g=m.clone(this.originOperLayer.layerObject.visibleLayers),b;for(b in a)if(a.hasOwnProperty(b)&&"function"!==typeof a[b]){var e=a[b],
k=b.toString();f=d.indexOf(g,k);e?0>f&&g.push(k):0<=f&&g.splice(f,1)}this._setVisibleLayersBySelfFlag=!0;this.layerObject.setVisibleLayers(g)},_resetLayerObjectVisiblity:function(a){var g=a?a[this.id]:null,f=!1;if(a){g&&this.layerObject.setVisibility(g.visible);var g={},b;for(b in a)a.hasOwnProperty(b)&&"function"!==typeof a[b]&&(f=!0,g[b]=a[b].visible);f&&this._setSubLayerVisibleByCheckedInfo(g)}},_setSubLayerVisibleByCheckedInfo:function(a){var g={};this.traversal(function(f){f.isRootLayer()||k.isDefined(a[f.id])&&
f._setVisible(a[f.id])});this.traversal(function(a){0===a.getSubLayers().length&&(g[a.subId]=a._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(g)},_getServiceDefinition:function(){var a=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(a)},_serviceDefinitionRequest:function(a){return this._normalRequest(a,{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var a=[];d.forEach(this.layerObject.layerInfos,function(g,f){g=this._getOperLayerFromWMSLayerInfo(g,
this);g=this._layerInfoFactory.create(g);a.push(g);g.init()},this);return a},_getOperLayerFromWMSLayerInfo:function(a,g){return{layerObject:this.layerObject,title:a.label||a.title||a.name||" ",id:this.id+"_"+(a.name||a.title+"-"+Math.random()),subId:a.name||"-",wms:{layerInfo:this,subId:a.name||"-",wmsLayerInfo:a},selfType:"wms",parentLayerInfo:g}},_bindEvent:function(){this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&q.after(this.layerObject,"setVisibleLayers",m.hitch(this,this._onVisibleLayersChanged))},
_onVisibleLayersChanged:function(){var a=[];this._setVisibleLayersBySelfFlag||(this.traversal(function(a){a.isRootLayer()||a._initVisible()}),this._setVisibleLayersBySelfFlag=!1);this.traversal(function(g){g.isRootLayer()||a.push(g)});this._setVisibleLayersBySelfFlag=!1;l.publish("layerInfos/layerInfo/visibleChanged",a);this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),
function(r,d,m,l,c,t){return r(t,{constructor:function(c,d){this.layerObject=c.layerObject},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var c=!1;this.traversal(function(p){if(0<=d.indexOf(p.layerObject.visibleLayers,p.subId))return c=!0});this._visible=c},_setVisible:function(c){this._visible=c?!0:!1},_setTopLayerVisible:function(c){var d=this.originOperLayer.wms;this._visible=c?!0:!1;var h={};this.traversal(function(c){0===c.getSubLayers().length&&(h[c.subId]=c._isAllSubLayerVisibleOnPath())});
d.layerInfo._setSubLayerVisible(h)},_getServiceDefinition:function(){var c=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(c)},_serviceDefinitionRequest:function(c){return this._normalRequest(c,{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var c=[],p=this.originOperLayer.wms;d.forEach(p.wmsLayerInfo.subLayers,function(h){h=p.layerInfo._getOperLayerFromWMSLayerInfo(h,this);h=this._layerInfoFactory.create(h);c.push(h);h.init()},this);
return c},drawLegends:function(c){this._initLegendsNode(c)},_initLegendsNode:function(d){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var p=l.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});c(p,"load",function(){l.empty(d);var c=l.create("div",{"class":"legend-div"},d);m.place(p,c)})}else l.empty(d)},getOpacity:function(){},setOpacity:function(c){},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.originOperLayer.wms.layerInfo.getScaleRange()}})})},
"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(r,d){return r(d,{constructor:function(d,l){},_initVisible:function(){var d=!1,l=this.originOperLayer.mapService;l&&l.layerInfo._subLayerVisible[l.subId]&&(d=!0);this._visible=d},_setTopLayerVisible:function(d){var l=this.originOperLayer.mapService;if(l){l.layerInfo._subLayerVisible[l.subId]=d?!0:!1;this._visible=d;var c={};this.traversal(function(d){0===d.getSubLayers().length&&
(c[d.originOperLayer.mapService.subId]=d._isAllSubLayerVisibleOnPath())});l.layerInfo._setSubLayerVisible(c)}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/dom-construct ./LayerInfoForDefault ./LayerObjectFacory".split(" "),function(r,d,m,l,c,t,q){return r(t,{_legendsNode:null,_layerObjectFacory:null,constructor:function(){this._layerObjectFacory=new q(this)},_resetLayerObjectVisiblity:function(){},_loadLegends:function(c){var h=
new l;this.originOperLayer.mapService.layerInfo.getLegendInfo(c).then(m.hitch(this,function(c){h.resolve(c)}));return h},drawLegends:function(c,h){this._loadLegends(h).then(m.hitch(this,function(h){this._initLegendsNode(h,c)}))},_initLegendsNode:function(p,h){var n=this.originOperLayer.mapService;if(p){c.empty(h);for(var k=null,a=0;a<p.length;a++)if(p[a].layerId===n.subId){k=p[a];break}if(k){var g=c.create("table",{"class":"legend-table",style:"font-size: 12px"},h);d.forEach(k.legend,function(a){if("\x3call other values\x3e"!==
a.label){var b=c.create("tr",{"class":"legend-tr",style:"border: 1px solid"},g),e=c.create("td",{"class":"legend-symbol-td",style:""},b),f=null,f=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;c.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",src:f},e);c.create("td",{"class":"legend-label-td",innerHTML:a.label||" ",style:"padding-left: 5px"},b)}},this)}}},_initControlPopup:function(){var c=this.originOperLayer.mapService.layerInfo.layerObject,
h=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:c.infoTemplates&&c.infoTemplates[h]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var c=this.originOperLayer.mapService.layerInfo.layerObject,h=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&c.infoTemplates&&delete c.infoTemplates[h]},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},
_getServiceDefinition:function(){return this.originOperLayer.mapService.layerInfo._getSubserviceDefinition(this.originOperLayer.mapService.mapServiceSubId)},_getLayerObject:function(c){var h=new l;(c?this._layerObjectFacory.getLayerObjectWithUrl(c):this._layerObjectFacory.getLayerObject()).then(m.hitch(this,function(c){this.layerObject.empty&&c&&(this.layerObject=c);h.resolve(c)}));return h},getLayerObject:function(){return this._getLayerObject()},getLayerObjectTryUsingFeatureService:function(){var c;
return this.isItemLayer()?this.getItemInfo().then(m.hitch(this,function(h){h&&h.getItemData()&&h.getItemData().layers&&d.some(h.getItemData().layers,function(h){if(h.id===this.subId)return c=h.layerUrl,!0},this);return c?this._getLayerObject(c):this._getLayerObject()})):this.getLayerObject()},getPopupInfo:function(){var c=null,h=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(h)for(var d=0;d<h.length;d++)if(h[d].id===this.originOperLayer.mapService.subId){c=h[d].popupInfo;break}return c},
getFilterOfWebmap:function(){var c=null,h=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(h)for(var d=0;d<h.length;d++)if(h[d].id===this.originOperLayer.mapService.subId){c=h[d].layerDefinition?h[d].layerDefinition.definitionExpression:null;break}return c},getFilter:function(){var c=this.originOperLayer.mapService;return c.layerInfo.layerObject&&c.layerInfo.layerObject.layerDefinitions?c.layerInfo.layerObject.layerDefinitions[c.subId]:null},setFilter:function(c){var h,n=this.originOperLayer.mapService;
n.layerInfo.layerObject&&n.layerInfo.layerObject.setLayerDefinitions&&(h=n.layerInfo.layerObject.layerDefinitions?d.map(n.layerInfo.layerObject.layerDefinitions,function(k){return k}):[],h[n.subId]=c,n.layerInfo.layerObject.setLayerDefinitions(h))},getLayerType:function(){var c=new l;0<this.getSubLayers().length?c.resolve("GroupLayer"):this._getServiceDefinition().then(m.hitch(this,function(h){h?c.resolve(h.type.replace(/\ /g,"")):c.resolve(null)}),function(){c.resolve(null)});return c},getSupportTableInfo:function(){var c=
new l,h={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(m.hitch(this,function(d){h.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(h.isSupportedLayer=!0);this._getServiceDefinition().then(m.hitch(this,function(k){k&&0<=k.capabilities.indexOf("Data")&&(h.isSupportQuery=!0);c.resolve(h)}),function(){c.resolve(h)})}),function(){c.resolve(h)});return c},enablePopup:function(){var c=this.originOperLayer.mapService.layerInfo,h=c.layerObject,d=this.originOperLayer.mapService.subId;
return this.loadInfoTemplate().then(m.hitch(this,function(){return c.controlPopupInfo.infoTemplates&&c.controlPopupInfo.infoTemplates[d]?(this.controlPopupInfo.enablePopup=!0,h.infoTemplates||(h.infoTemplates={}),h.infoTemplates[d]=c.controlPopupInfo.infoTemplates[d],!0):!1}))},disablePopup:function(){var c=this.originOperLayer.mapService.layerInfo.layerObject,h=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!1;c.infoTemplates&&delete c.infoTemplates[h]},loadInfoTemplate:function(){var c=
new l,h=this.originOperLayer.mapService.layerInfo,d=this.originOperLayer.mapService.subId;h.controlPopupInfo.infoTemplates&&h.controlPopupInfo.infoTemplates[d]&&h.controlPopupInfo.infoTemplates[d].infoTemplate?c.resolve(h.controlPopupInfo.infoTemplates[d].infoTemplate):(h.controlPopupInfo.infoTemplates||(h.controlPopupInfo.infoTemplates={}),this.getLayerObject().then(m.hitch(this,function(k){k=this._getDefaultPopupTemplate(k);h.controlPopupInfo.infoTemplates[d]={infoTemplate:k,layerUrl:null};c.resolve(k)}),
m.hitch(this,function(){c.resolve(null)})));return c},getInfoTemplate:function(){var c=this.originOperLayer.mapService.layerInfo,h=this.originOperLayer.mapService.subId;return c.controlPopupInfo.infoTemplates&&c.controlPopupInfo.infoTemplates[h]&&c.controlPopupInfo.infoTemplates[h].infoTemplate?c.controlPopupInfo.infoTemplates[h].infoTemplate:null},getScaleRange:function(){var c=this.originOperLayer.mapService;return(c=c.layerInfo._getJsapiLayerInfoById(c.subId))&&0<=c.minScale&&0<=c.maxScale?{minScale:c.minScale,
maxScale:c.maxScale}:{minScale:0,maxScale:0}},_onVisibilityChanged:function(){}})})},"jimu/LayerInfos/LayerObjectFacory":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred ./RequestBuffer esri/layers/FeatureLayer esri/layers/RasterLayer esri/layers/StreamLayer esri/layers/ArcGISImageServiceLayer esri/layers/ArcGISImageServiceVectorLayer".split(" "),function(r,d,m,l,c,t,q,p,h,n){return r(null,{_layerInfo:null,_layerObjectBuffer:null,constructor:function(k){this._layerInfo=
k;this._initLayerObjectBuffer()},_initLayerObjectBuffer:function(){this._layerObjectBuffer=new c(d.hitch(this,this._getLayerObject))},getLayerObject:function(){var k=this._layerInfo.getUrl();return this._layerObjectBuffer.getRequest(this._layerInfo.subId).request(k)},getLayerObjectWithUrl:function(k){return this._layerObjectBuffer.getRequest(this._layerInfo.subId+"_url").request(k)},_getLayerObject:function(k){var a,g=new l;this._layerInfo.getLayerType().then(d.hitch(this,function(f){var b=d.mixin(this._getLayerOptionsForCreateLayerObject(),
this._layerInfo.originOperLayer.options||{})||{};switch(f){case "FeatureLayer":a=new t(k,b);break;case "RasterLayer":a=new q(k);break;case "StreamLayer":a=new p(k);break;case "ArcGISImageServiceLayer":a=new h(k);break;case "ArcGISImageServiceVectorLayer":a=new n(k);break;case "Table":if(this._layerInfo.layerObject&&!this._layerInfo.layerObject.empty)return this._setLayerObjectProperties(this._layerInfo.layerObject),g.resolve(this._layerInfo.layerObject),g;if(this._layerInfo.layerObject&&this._layerInfo.layerObject.url)a=
new t(k,b);else return this._layerInfo.layerObject&&this._layerInfo.layerObject.featureCollectionData?(a=new t(this._layerInfo.layerObject.featureCollectionData,b),this._setLayerObjectProperties(a),g.resolve(a)):g.resolve(null),g;break;case "GroupLayer":return g=this._getGroupLayerObject();default:return g.resolve(null),g}var e=a.on("load",d.hitch(this,function(){this._setLayerObjectProperties(a);g.resolve(a);e.remove&&e.remove()})),c=a.on("error",d.hitch(this,function(a){g.reject(a);c.remove&&c.remove()}))}),
d.hitch(this,function(){g.reject()}));return g},_getGroupLayerObject:function(){var k=new l;this._layerInfo._getServiceDefinition().then(d.hitch(this,function(a){if(null===a)k.reject();else{var g=this._layerInfo.getUrl();a.url=g;a.id=this._layerInfo.id;k.resolve(a)}}));return k},_getLayerOptionsForCreateLayerObject:function(){var k={},a=[],g=this._layerInfo.getInfoTemplate();g&&g.info&&g.info.fieldInfos?m.forEach(g.info.fieldInfos,function(f){f.visible&&a.push(f.fieldName)},this):a=["*"];k.outFields=
a;return k},_setLayerObjectProperties:function(k){k.name&&!d.getObject("_wabProperties.originalLayerName",!1,k)&&(d.setObject("_wabProperties.originalLayerName",k.name,k),k.name=this._layerInfo.title);k.id=this._layerInfo.id;this._layerInfo.loadInfoTemplate().then(d.hitch(this,function(a){k.infoTemplate=a}))}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../lang ../domUtils ./BaseRasterLayer ./ImageServiceLayerMixin ./pixelFilters/StretchFilter ../SpatialReference ../geometry/Point".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b){return r([k,a],{declaredClass:"esri.layers.RasterLayer",constructor:function(a,b){this.pixelData=null;null!==this.format&&void 0!==this.format||this.setImageFormat("LERC",!0)},_setDefaultFilter:function(){if(this.loaded&&this.drawType&&!this._isVectorData()&&(!this.pixelFilter||this._isDefaultPixelFilter))if("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))this._isDefaultPixelFilter&&(this.pixelFilter=
null,this._isDefaultPixelFilter=!1);else{var a,b;if(this.minValues&&this.maxValues&&this.stdvValues&&this.meanValues){a=[];for(b=0;b<this.minValues.length;b++)a.push([this.minValues[b],this.maxValues[b],this.meanValues[b],this.stdvValues[b]]);this.bandCount!==a.length&&(a=null)}b=0;var f=!1;"U8"===this.pixelType?(b=5,f=a?!1:!0):a?(b=5,f=!1):(b=6,f=!0);this.renderingRule&&(b=5,f=!0);this.pixelFilter=(new g({stretchType:b,min:0,max:255,dra:f,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,
statistics:a,numberOfStandardDeviations:2.5})).filter;this._isDefaultPixelFilter=!0}}})})},"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a,g,f){var b=n.defaults.map.zoomDuration;return r([f],{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,
opacity:1,constructor:function(a,b){this.drawMode=b&&void 0!==b.drawMode?b.drawMode:!0;this.drawType=b&&b.drawType?b.drawType:"2d";this.pixelData=null;this._initialize(a,b)},setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){this.opacity!==a&&(this.opacity=a,this.onOpacityChange(a))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>c("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},
clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var a=this._map.__visibleDelta;this._left=this._tdx=a.x;this._top=this._tdy=a.y;q.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(d.hitch(this,function(){this._extentChangeHandler(this._map.extent,
null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var a=this._map.extent;return new g((a.xmax-a.xmin)/this._map.width,(a.ymax-a.ymin)/this._map.height,a.spatialReference)},setPixelFilter:function(a,b){this.pixelFilter=a;b||this.redraw()},_toggleTime:function(){},_setMap:function(a,b){this.inherited(arguments);
this._dragOrigin={x:0,y:0};var e=this._div=t.create("div",null,b),f={width:a.width+"px",height:a.height+"px",position:"absolute"};"css-transforms"===a.navigationMode?(f[h._css.names.transform]=h._css.translate(a.__visibleDelta.x,a.__visibleDelta.y),this._left=a.__visibleDelta.x,this._top=a.__visibleDelta.y):this._left=this._top=0;q.set(e,f);this._canvas=t.create("canvas",{id:"canvas",width:a.width+"px",height:a.height+"px",style:"position: absolute;"},e);k.isDefined(this.opacity)&&q.set(e,"opacity",
this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(m.connect(a,"onPan",this,this._panHandler));this._connects.push(m.connect(a,"onPanEnd",this,this._panEndHandler));"css-transforms"===a.navigationMode?this._connects.push(m.connect(a,"onScale",this,this._onScaleHandler)):(this._connects.push(m.connect(a,
"onZoom",this,this._onZoomHandler)),this._connects.push(m.connect(a,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(m.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(m.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(m.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(m.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};
this.evaluateSuspension();if(this.suspended&&!a.loaded)var g=m.connect(a,"onLoad",this,function(){m.disconnect(g);g=null;this.evaluateSuspension()});return e},_unsetMap:function(a,b){l.forEach(this._connects,m.disconnect,this);var e=this._div;e&&(b.removeChild(e),t.destroy(e));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(a){"CancelError"!==
a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var a=this._useBrowserDecoding();!a&&this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,q.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top)),q.set(this._canvas,h._css.names.transform,h._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});if(this._canDraw&&
this.drawMode)if(a)this._fireUpdateEnd();else if(this.drawMode)if(this.pixelData&&this.pixelData.pixelBlock){var a=this.pixelData.pixelBlock,b=this._context,f=b.createImageData(a.width,a.height);f.data.set(a.getAsRGBA());var g=this.pixelData.extent,k=this._map.extent,c=this.getCurrentResolution(),d=0,n=0;Math.abs(g.xmin-k.xmin)>c.x&&(d=Math.round((g.xmin-k.xmin)/c.x));Math.abs(k.ymax-g.ymax)>c.y&&(n=Math.round((k.ymax-g.ymax)/c.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=
this._left,this._tdy=this._top,this._multiply=null,q.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top)),q.set(this._canvas,h._css.names.transform,h._css.translate(-this._left,-this._top))):(q.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),q.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};b.putImageData(f,d,n,0,0,a.width,a.height);this._fireUpdateEnd()}else this.clear()},
_panHandler:function(a,b){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+b.x,this._top=this._map.__visibleDelta.y+b.y,q.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top))):q.set(this._div,{left:this._startRect.left+b.x+"px",top:this._startRect.top+b.y+"px"})},_panEndHandler:function(a,b){b&&(this._startRect.left+=b.x,this._startRect.top+=b.y)},_onScaleHandler:function(a,f){var e={},g=h._css.names;q.set(this._canvas,g.transition,f?"none":
g.transformName+" "+b+"ms ease");this._matrix=a;a=this._multiply?p.multiply(a,this._multiply):a;if(this._tdx||this._tdy)a=p.multiply(a,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});e[g.transform]=h._css.matrix(a);q.set(this._canvas,e)},_onZoomHandler:function(a,b,f){var e=this._startRect;a=e.width*b;b*=e.height;var g=e.left-(a-e.width)*(f.x-e.left)/e.width;f=e.top-(b-e.height)*(f.y-e.top)/e.height;q.set(this._canvas,{left:g+"px",top:f+"px",width:a+"px",height:b+"px"});this._endRect={left:g,top:f,
width:a,height:b}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,b,f){q.set(this._div,{width:b+"px",height:f+"px"});q.set(this._canvas,{width:b+"px",height:f+"px"});this._startRect.width=this._canvas.width=b;this._startRect.height=this._canvas.height=f},_extentChangeHandler:function(a,b,f,g){this.suspended||b&&0===b.x&&0===b.y&&!f||("css-transforms"===this._map.navigationMode&&(b&&(this._dragOrigin.x+=b.x,this._dragOrigin.y+=b.y),f||(this._left=
this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,q.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top))),f&&(q.set(this._canvas,h._css.names.transition,"none"),this._multiply=this._multiply?p.multiply(this._matrix,this._multiply):this._matrix)),this._fireUpdateStart(),a=this._map,this._requestData(a.extent,a.width,a.height))},_visibilityChangeHandler:function(b){b?a.show(this._div):a.hide(this._div)},_opacityChangeHandler:function(a){q.set(this._div,"opacity",
a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z,A,E,y,C,F,B,G,H,L,J){r=r(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasHistograms minValues maxValues meanValues stdvValues serviceDataType".split(" "),_rasterFunctionTemplateInfos:{},_customRenderingRuleId:{},_pixelTypeRanges:{U1:[0,1],U2:[0,3],U4:[0,15],U8:[0,255],S8:[-128,127],
U16:[0,65535],S16:[-32768,32767]},_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},constructor:function(a,b){this.useMapTime=b&&b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0},_initialize:function(a,b){this._url=e.urlToObject(a);this.raster=new E(this._url.path);this.infoTemplate=b&&b.infoTemplate;this.format=(a=b&&b.imageServiceParameters)&&a.format;this.compressionTolerance=a&&a.compressionTolerance?a.compressionTolerance:.01;this.interpolation=
a?a.interpolation:null;this.compressionQuality=a?a.compressionQuality:null;this.bandIds=a?a.bandIds:null;this.mosaicRule=a?a.mosaicRule:null;this.renderingRule=a?a.renderingRule:null;this.renderer=a?a.renderer:null;this.useMapDimensionValue=b&&b.hasOwnProperty("useMapDimensionValue")?!!b.useMapDimensionValue:!0;this.hasImageFilter=b&&b.hasImageFilter;this.activeMapDimensions=b&&b.activeMapDimensions;this._params=d.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,
compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},a?a.toJson():{});this.pixelFilter=b&&b.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=d.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=d.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=d.hitch(this,this._initLayer);this._queryVisibleRastersHandler=d.hitch(this,this._queryVisibleRastersHandler);
this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=b&&b.loadCallback;(b=b&&b.resourceInfo)?this._initLayer(b):f({url:this._url.path,content:d.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,b){if(null!==a&&void 0!==a){this._findCredential();
(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();b=this.minScale;var e=this.maxScale;d.mixin(this,a);this.minScale=b;this.maxScale=e;this.initialExtent=this.fullExtent=this.extent=new u(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);var f=this.minValues,k=this.maxValues,c=this.meanValues,h=this.stdvValues,n=this.bands=[];b=0;for(e=this.bandCount;b<e;b++)n[b]={min:f[b],max:k[b],
mean:c[b],stddev:h[b]};this.timeInfo=(b=this.timeInfo)&&b.timeExtent?new B(b):null;e=this.fields=[];if(f=a.fields)for(b=0;b<f.length;b++)e.push(new G(f[b]));this._updateInfoTemplateFields(this.fields);this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);g.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);g.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);b={};a.defaultMosaicMethod?(b.method=a.defaultMosaicMethod,
b.operation=a.mosaicOperator,b.sortField=a.sortField,b.sortValue=a.sortValue):b.method=D.METHOD_NONE;this.defaultMosaicRule=new D(b);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType;this._setDefaultRenderingRule(!0);this.renderingRule&&this.getRenderingRuleServiceInfo(this.renderingRule).then(d.hitch(this,function(a){a.hasRasterAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:this.renderingRule}).then(d.hitch(this,
function(){!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh()}))}));this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(d.hitch(this,function(a){a&&(a.features&&a.fields&&(this.rasterAttributeTable=d.clone(a)),
a.features&&0<a.features.length&&(this._rasterAttributeTableFeatures=d.clone(a.features)),a.fields&&0<a.fields.length&&(this._rasterAttributeTableFields=d.clone(a.fields)),this.renderingRule||!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh())}));this._initVectorPixelFilter();10.3<=this.version&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&this.getRasterFunctionInfos().then(d.hitch(this,
function(a){if(a&&a.length){this.rasterFunctionInfos=a;var b=[],e;l.forEach(a,function(a){if(a){var f=a.functionType;e=e||1===f||2===f;b.push(a.name)}},this);this._hasItemLevelRFT=e;this._rasterFunctionNames=b;e&&(this._initVectorPixelFilter(),this.refresh())}}));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(a=this._loadCallback)delete this._loadCallback,a(this)}},_updateInfoTemplateFields:function(a){if(a&&!(1>a.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&
!(1>this.infoTemplate.info.fieldInfos.length)){var b,e,f,g;g=this.infoTemplate.info.fieldInfos;for(b=0;b<a.length;b++)for(f=a[b],e=0;e<g.length;e++)if(g[e].fieldName.toLowerCase()===f.name.toLowerCase()&&g[e].fieldName!==f.name){g[e].fieldName=f.name;break}}},getKeyProperties:function(a){var e=this._url.path+"/keyProperties",g=new m(b._dfdCanceller),k={f:"json"};a&&a.renderingRule&&(k.renderingRule=c.toJson(a.renderingRule.toJson()));10<this.version?(g._pendingDfd=f({url:e,content:k,handleAs:"json",
callbackParamName:"callback"}),g._pendingDfd.then(function(a){g.callback(a)},function(a){g.errback(a)})):(a=Error("Layer does not have key properties"),a.log=!!t.isDebug,g.errback(a));return g},getRasterAttributeTable:function(a){var e=this._url.path+"/rasterAttributeTable",g=new m(b._dfdCanceller),k={f:"json"},h=this.hasRasterAttributeTable;a&&a.renderingRule&&(k.renderingRule=c.toJson(a.renderingRule.toJson()),h=!0);10<this.version&&h?(g._pendingDfd=f({url:e,content:k,handleAs:"json",callbackParamName:"callback"}),
g._pendingDfd.then(function(a){g.callback(a)},function(a){g.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=!!t.isDebug,g.errback(a));return g},getRenderingRuleAttributeTable:function(a){var e=new m(b._dfdCanceller);if(!a||!a.renderingRule)return e.errback(Error("Rendering rule is not specified")),e;a=a.renderingRule;var f=this._getRenderingRuleId(a);this._renderingRuleAttributeTable&&f&&this._renderingRuleAttributeTable.hasOwnProperty(f)?e.resolve(this._renderingRuleAttributeTable[f]):
e=this.getRasterAttributeTable({renderingRule:a}).then(d.hitch(this,function(a){var b;a&&a.features&&a.features.length&&a.fields&&a.fields.length&&(b={features:d.clone(a.features),fields:d.clone(a.fields)},f&&(this._renderingRuleAttributeTable[f]=b));return b}));return e},_initVectorPixelFilter:function(){var a;this._hasItemLevelRFT&&this.renderingRule&&(a=this._getItemLevelRenderingRule(this.renderingRule));if(a=a||this.renderingRule)return this.getRenderingRuleServiceInfo(a).then(d.hitch(this,function(a){a&&
this._isVectorData(a)&&!g.isDefined(this.pixelFilter)&&"esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&(this.vectorFieldPixelFilter=new C,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===a.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(d.hitch(this,this._setFlowRepresentation)),this._applyVectorResamplingType(a.serviceDataType))}))},_applyVectorResamplingType:function(a){if(a){var b=
this.renderingRule;b&&"Resample"===b.functionName&&((b.functionArguments||{}).ResamplingType="esriImageServiceDataTypeVector-UV"===a?7:10,this.setRenderingRule(new z(b.toJson())))}},_getRasterAttributeTableFeatures:function(){var a=new m;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(d.hitch(this,function(a){a&&a.features&&
0<a.features.length&&(this._rasterAttributeTableFeatures=d.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},_getRenderingRuleAttributeTableFeatures:function(a){a=a&&a.renderingRule;return a?this.getRenderingRuleAttributeTable({renderingRule:a}).then(function(a){return a&&a.features}):(a=new m,a.errback(Error("Rendering rule is not specified")),a)},getCustomRasterFields:function(a){var b=a?a.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;a=10.3<=this.version?
"esriFieldTypeDouble":"esriFieldTypeString";var e={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:a},f={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:a},k={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},c=this.fields?d.clone(this.fields):[];a=c.length;c[a]=f;10.4<=this.version&&
"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRenderingRuleAProcessingTemplate({functionName:"none"}))&&(a++,c[a]=k);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a++,c[a]=e;!g.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(e={name:this._rasterFieldPrefix+
"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},f={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},a++,c[a]=e,a++,c[a]=f);a=this._rasterAttributeTableFields;(e=this.renderingRule&&this._getRenderingRuleId(this.renderingRule))&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(e)&&(a=this._renderingRuleAttributeTable[e].fields);a&&0<a.length&&(a=l.filter(a,function(a){return"esriFieldTypeOID"!==
a.type&&"value"!==a.name.toLowerCase()}),a=l.map(a,function(a){var e=d.clone(a);e.name=b+a.name;return e}),c=c.concat(a));var h=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&l.forEach(this.rasterFunctionInfos,function(a){a&&a.name&&"none"!==a.name.toLowerCase()&&(a={name:h+a.name.replace(/ /gi,"_"),alias:a.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},c.push(a))});return c},_prepareGetImageParameters:function(a,b,e,f){f=g.isDefined(f)?
f:this._params;if(this.renderer||this._hasItemLevelRFT&&this.renderingRule){var k=this.getExportImageRenderingRule();f.renderingRule=k?c.toJson(k.toJson()):null;k=this.getExportImageMosaicRule(f);f.mosaicRule=k?c.toJson(k.toJson()):null}k=a.spatialReference.wkid||c.toJson(a.spatialReference.toJson(!1));delete f._ts;d.mixin(f,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:k,bboxSR:k,size:b+","+e},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete f.compressionTolerance;f.format&&
"LERC"===f.format.toUpperCase()&&(f.compressionTolerance=this.compressionTolerance);f.token=this._getToken()},getImageUrl:function(b,k,c,u,n){n=g.isDefined(n)?n:this._params;this._prepareGetImageParameters(b,k,c,n);b=d.clone(n);this._cleanupRequestParams(b);k=this._url.path+"/exportImage?";c=e.addProxy(k+h.objectToQuery(d.mixin(b,{f:"image"})));var p=b.token;c.length>a.defaults.io.postLength||this.useMapImage?this._jsonRequest=f({url:k,content:d.mixin(b,{f:"json"}),callbackParamName:"callback",load:function(a,
b){a=a.href;p&&(a+=-1===a.indexOf("?")?"?token\x3d"+p:"\x26token\x3d"+p);u(e.addProxy(a))},error:this._errorHandler}):u(c)},onRenderingChange:function(){},onMosaicRuleChange:function(){},onRendererChange:function(){},setInterpolation:function(a,b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setCompressionTolerance:function(a,b){this.compressionTolerance=a;b||
this.refresh(!0)},setBandIds:function(a,b){var e=!1;this.bandIds!==a&&(e=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(e&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,b){var e=!1;this.mosaicRule!==a&&(e=!0);this.mosaicRule=a;this._params.mosaicRule=c.toJson(a.toJson());if(e&&!b)this.onMosaicRuleChange();b||
this.refresh(!0)},getRasterFunctionInfos:function(){if(10.3>this.version||!this.rasterFunctionInfos||!this.rasterFunctionInfos.length)console.log("Layer doesn't support /rasterFunctionInfos resource.");else return f({url:this._url.path+"/rasterFunctionInfos",content:{f:"json"},handleAs:"json",load:function(a){return a&&a.rasterFunctionInfos}})},setRenderingRule:function(a,b){var e=!1;this.renderingRule!==a&&(e=!0);this.renderingRule=a;this._params.renderingRule=a?c.toJson(a.toJson()):null;this._useRenderingRuleAttributeTable&&
this.getRenderingRuleAttributeTable({renderingRule:a});if(e)this.onRenderingChange();this._setDefaultFilter();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;this._setDefaultFilter();b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a;this._updateInfoTemplateFields(this.fields)},setDefinitionExpression:function(a,b){var e=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?e=this.defaultMosaicRule.toJson():e.method=
D.METHOD_NONE);e.where=a;a=new D(e);this.setMosaicRule(a,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a;this._isDefaultPixelFilter=!1},getPixelData:function(a){return a?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},getExportImageRenderingRule:function(){var a;
this._hasItemLevelRFT&&this.renderingRule&&(a=this._getServiceLevelRenderingRule(this.renderingRule));a=a||this.renderingRule;return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),a)},getExportImageMosaicRule:function(){var a=this.mosaicRule,b;this._hasItemLevelRFT&&this.renderingRule&&(b=this._getItemLevelRenderingRule(this.renderingRule));b&&(a=a||this.defaultMosaicRule||new D,a.itemRenderingRule=b);return a},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},
getHistograms:function(){var a=new m(b._dfdCanceller);if(this.hasHistograms)a._pendingDfd=f({url:this._url.path+"/histograms",content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),a._pendingDfd.then(function(b){a.callback(b)},function(b){a.errback(b)});else{var e=Error("Layer does not have histograms.");e.log=!!t.isDebug;a.errback(e)}return a},computeHistograms:function(a){var e=new m(b._dfdCanceller);if(10.1<=this.currentVersion){a=a||{};var g=a.geometry||this.fullExtent,k=(a.geometry||
this.fullExtent).toJson(),g="extent"===g.type?"esriGeometryEnvelope":"esriGeometryPolygon",c=a.renderingRule||this.renderingRule||this.defaultRenderingRule,c=c?c.toJson():null,h=a.mosaicRule||this.mosaicRule||this.defaultMosaicRule,h=h?h.toJson():null;a=a.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};e._pendingDfd=f({url:this._url.path+"/computeHistograms",content:d.mixin({f:"json",geometry:JSON.stringify(k),geometryType:g,renderingRule:JSON.stringify(c),mosaicRule:JSON.stringify(h),pixelSize:JSON.stringify(a),
callbackParamName:"callback"}),handleAs:"json"});e._pendingDfd.then(function(a){e.callback(a)},function(a){e.errback(a)})}else k=Error("Layer doesn't support computeHistograms."),k.log=!!t.isDebug,e.errback(k);return e},getRenderingRuleServiceInfo:function(a){var e=new b._fixDfd(new m(b._dfdCanceller));if(!a)return e.errback(Error("Rendering rule is not specified")),e;var g=this._getRenderingRuleId(a);return g&&this._rasterFunctionTemplateInfos[g]?(e.resolve(this._rasterFunctionTemplateInfos[g]),
e):f({url:this._url.path,content:d.mixin(d.mixin({f:"json",renderingRule:JSON.stringify(a.toJson())},this._url.query)),callbackParamName:"callback",load:d.hitch(this,function(a){var b={};l.forEach(this._rasterFunctionServiceInfoProps,function(e){b[e]=a[e]});return this._rasterFunctionTemplateInfos[g]=b}),error:this._errorHandler})},queryVisibleRasters:function(a,e,f,g){var k=this._map,c=b._fixDfd(new m(b._dfdCanceller));this._visibleRasters=[];var h,u,n=!0,p=!0,t=null,q=this.infoTemplate?this.infoTemplate.info:
null,y=q?d.clone(this.infoTemplate.info.fieldInfos):null;e=e||{};if(q&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var x=[];l.forEach(this.infoTemplate.info.mediaInfos,function(a){x=x.concat(a&&a.value&&a.value.fields||[])});x.length&&l.forEach(y,function(a){a&&-1<x.indexOf(a.fieldName)&&(a.visible=!0)})}if(y&&0<y.length)for(n=!1,h=0;h<y.length;h++)if((u=y[h])&&u.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(u.visible||q.title&&
-1<q.title.toLowerCase().indexOf(u.fieldName.toLowerCase()))){n=!0;break}this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("returnTopmostRaster")&&(t=this.infoTemplate.info.layerOptions.returnTopmostRaster?1:null);y&&0<y.length&&(p=!1,l.some(y,function(a){if(a&&a.fieldName.toLowerCase()===this._rasterFieldPrefix.toLowerCase()+"itempixelvalue"&&a.visible)return p=!0},this));var r=(u=this._removeVisualizationStretchFunction(this.renderingRule))&&
u.functionName,E=[];if(10.4<=this.version){var D=!1;if(this.rasterFunctionInfos&&y){var C=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;l.forEach(this.rasterFunctionInfos,function(a){var b=C+a.name.replace(/ /gi,"_");l.some(y,function(a){return a.visible&&a.fieldName===b})&&(D=D||r&&r===a.name,E.push(new z({rasterFunction:a.name})))})}u&&!D&&E.push(u)}h=new J;h.geometry=a.geometry;h.returnGeometry=this._map.spatialReference.equals(this.spatialReference);h.returnCatalogItems=n;h.timeExtent=
a.timeExtent;h.returnPixelValues=p;h.maxItemCount=t||a.maxItemCount;this._params.time&&this.mosaicRule?(a=d.clone(this.mosaicRule),a=this._filterOutTimeDimension(a),h.mosaicRule=a):h.mosaicRule=this.mosaicRule||null;h.renderingRule=10.4>this.version&&u||null;h.renderingRules=E||null;10.61>this.version&&(h.returnPixelValues=void 0,h.maxItemCount=void 0);k&&(k=new v((k.extent.xmax-k.extent.xmin)/k.width,(k.extent.ymax-k.extent.ymin)/k.height,k.extent.spatialReference),h.pixelSize=k);e.requestParams=
h;var A=this,k=new L(this.url);(c._pendingDfd=k.execute(h)).addCallbacks(function(a){A._queryVisibleRastersHandler(a,e,f,g,c)},function(a){A._resolve([a],null,g,c,!0)});return c},_queryVisibleRastersHandler:function(a,b,e,k,h){function n(){var a=this.getCustomRasterFields(b),f=this._getDomainFields(a),k=b?b.returnDomainValues:!1,c=b&&b.rasterAttributeTableFieldPrefix,n,v,x,r,E,D,z,C,L,F,a=(a=this._getRenderingRuleId(this.renderingRule))&&this._rasterFunctionTemplateInfos[a];this.renderingRule&&(this._useRenderingRuleAttributeTable||
a)?(a=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),F=p):a=this._getRasterAttributeTableFeatures();a.then(d.hitch(this,function(a){for(n=0;n<m.length;n++){I=m[n];I.setInfoTemplate(this.infoTemplate);I._layer=this;if(p){L=p.replace(/ /gi,"").split(",");v=p;x=L;q&&q.length>=n&&(v=q[n].replace(/ /gi,", "),x=q[n].split(" "));I.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=x;I.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=L;t&&(I.attributes[this._rasterFieldPrefix+
"ServicePixelValue.Raw"]=t.replace(/ /gi,"").split(","));if(this.pixelFilter){var b=new y({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});l.forEach(x,function(a){b.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:b,extent:new u(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)I.attributes[this._rasterFieldPrefix+"Magnitude"]=
b.pixels[0][0],I.attributes[this._rasterFieldPrefix+"Direction"]=b.pixels[1][0]}l.forEach(A,function(a){I.attributes[a.name]=a.value});var G=F||v;if(a&&0<a.length&&(r=l.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==G:a.attributes.VALUE==G}),0<r.length&&(E=d.clone(r[0]),c&&E))){C={};for(D in E.attributes)E.attributes.hasOwnProperty(D)&&(z=c+D,C[z]=E.attributes[D]);E.attributes=C;I.attributes=d.mixin(I.attributes,E.attributes)}}k&&f&&0<f.length&&
l.forEach(f,function(a){if(a){var b=I.attributes[a.name];g.isDefined(b)&&(b=this._getDomainValue(a.domain,b),g.isDefined(b)&&(I.attributes[a.name]=b))}},this);P.push(I);this._visibleRasters.push(I)}this._resolve([P,null,!0],null,e,h)}))}var p=a.value,t=a.value,q,m,v=0,r=0,E=this,D=this.objectIdField,z,C,A=[];k=b.requestParams.renderingRules;var L=a.processedValues,F=this.renderingRule&&c.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(k&&L&&k.length===L.length){var G=
this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;l.forEach(k,function(a,b){if(a.functionName){var e={name:G+a.functionName.replace(/ /gi,"_"),value:L[b].replace(/ /gi,"").split(",")};A.push(e);F&&F===c.toJson(a.toJson())&&(p=L[b])}})}k=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(a.catalogItems){var B=0,K,J,O=a.catalogItems.features.length;
C=0;m=Array(O);q=Array(O);z=Array(O);if(a.properties&&a.properties.Values){O=a.properties.Values.length;for(v=0;v<O;v++)-1<a.properties.Values[v].toLowerCase().indexOf("nodata")&&C++;K=O-C;for(v=0;v<O;v++)C=!0,-1<a.properties.Values[v].toLowerCase().indexOf("nodata")?(J=K++,k||(C=!1,m.length--,q.length--,z.length--)):J=B++,C&&(m[J]=a.catalogItems.features[v],q[J]=a.properties.Values[v],z[J]=m[J].attributes[D])}else{for(v=0;v<O;v++)m[v]=a.catalogItems.features[v],z[v]=m[v].attributes[D];q=null}}this._visibleRasters=
[];var I;(a=-1<p.toLowerCase().indexOf("nodata"))&&!k&&(m=[],q=[],z=[]);!p||m||a||(D="ObjectId",m=[],I=new H(new u(this.fullExtent),null,{ObjectId:0}),m.push(I));var P=[];m?!this._map.spatialReference.equals(this.spatialReference)&&z&&0<z.length?f({url:this._url.path+"/query",content:{f:"json",objectIds:z.join(","),returnGeometry:!0,outSR:c.toJson(E._map.spatialReference.toJson()),outFields:D},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)E._resolve([P,null,
null],null,e,h);else{for(v=0;v<a.features.length;v++)for(r=0;r<m.length;r++)m[r].attributes[D]==a.features[v].attributes[D]&&(m[r].geometry=new x(a.features[v].geometry),m[r].geometry.setSpatialReference(E._map.spatialReference));n.call(E)}},error:function(a){E._resolve([P,null,null],null,e,h)}}):n.call(this):this._resolve([P,null,null],null,e,h)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],e;for(e in a)a.hasOwnProperty(e)&&b.push(a[e]);return b},_getDomainFields:function(a){if(a){var b=
[];l.forEach(a,function(a){if(a.domain){var e={};e.name=a.name;e.domain=a.domain;b.push(e)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var e;l.some(a.codedValues,function(a){return a.code===b?(e=a.name,!0):!1});return e}},_requestData:function(a,b,e){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=d.clone(a);var f=a._normalize(!0);this._prepareGetImageParameters(f,b,e);b=d.clone(this._params);this._cleanupRequestParams(b);b.extent=a;b.format=b.format||(10.3<=this.version?
"lerc":"jpgpng");"lerc"===b.format.toLowerCase()&&!b.lercVersion&&10.5<=this.version&&(b.lercVersion=2);e=null;this._useBrowserDecoding()&&(e=new F({ctx:this._context}));b={imageServiceParameters:b,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:e?d.hitch(e,"decode"):null};this._rasterReadPromise=this.raster.read(b,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=
a,this.hasDataChanged=!0,this._setPixelData(a))},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=null)},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=d.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=a.clone();return b},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(a,
b,e){a=a.getImageData(0,0,b,e).data;for(var f=b*e,g=0,k=0,c=new Uint8Array(f),h=new Uint8Array(f),d=new Uint8Array(f),u=new Uint8Array(f),n=Infinity,p=Infinity,l=Infinity,t=-Infinity,q=-Infinity,v=-Infinity,m,x,r,g=0;g<f;g++)m=a[k++],x=a[k++],r=a[k++],n=n<m?n:m,t=t>m?t:m,p=p<x?p:x,q=q>x?q:x,l=l<r?l:r,v=v>r?v:r,c[g]=m,h[g]=x,d[g]=r,u[g]=a[k++]&1;return new y({width:b,height:e,pixels:[c,h,d],pixelType:"U8",mask:u,statistics:[{minValue:n,maxValue:t},{minValue:p,maxValue:q},{minValue:l,maxValue:v}]})},
_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=this._url.path+"/multiDimensionalInfo",e=new m(b._dfdCanceller);if(this._multidimensionalInfo)return e.resolve(this._multidimensionalInfo),e;10.3<=this.version&&this.hasMultidimensions?(e._pendingDfd=f({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),
e._pendingDfd.then(d.hitch(this,function(a){this._multidimensionalInfo=a.multidimensionalInfo;e.callback(a.multidimensionalInfo)}),function(a){e.errback(a)})):(a=Error("Layer does not support multidimensional info"),a.log=!!t.isDebug,e.errback(a));return e},getDefaultMultidimensionalDefinition:function(){var a,e,f,g=[],k=new m(b._dfdCanceller),c;if(this._defaultMultidimensionalDefinition)return k.resolve(d.clone(this._defaultMultidimensionalDefinition)),k;k._pendingDfd=this.getMultidimensionalInfo();
k._pendingDfd.then(d.hitch(this,function(b){a=b;e=a.variables[0].dimensions;for(f in e)e.hasOwnProperty(f)&&"StdTime"!==e[f].name&&(c=e[f],g.push(new A({variableName:"",dimensionName:c.name,isSlice:!c.hasRanges,values:[this._getDefaultDimensionValue(c)]})));this._defaultMultidimensionalDefinition=g;k.callback(d.clone(g))}),function(a){k.errback(a)});return k},_getDefaultDimensionValue:function(a){if(a&&a.values&&a.values.length){var b,e,f=Infinity,g,k;if(a.hasRanges)return a.values[0];if(a.name&&
"stdz"===a.name.toLowerCase()){for(k=0;k<a.values.length&&(g=a.values[k],e=Math.abs(g-0),e<f&&(f=e,b=g),0!==e);k++);return b}return a.extent[0]}},_setDefaultMultidimensionalDefinition:function(a){var b,e={};this.getDefaultMultidimensionalDefinition().then(d.hitch(this,function(f){b=f;0<b.length&&(this.mosaicRule?(e=d.clone(this.mosaicRule),e.multidimensionalDefinition=b):this.defaultMosaicRule?(e=d.clone(this.defaultMosaicRule),e.multidimensionalDefinition=b):e=new D({multidimensionalDefinition:b}),
this.setMosaicRule(e,a))}))},_setDefaultRenderingRule:function(a){var b={},e=this.renderingRule;if(!e&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())b.rasterFunction=this.rasterFunctionInfos[0].name;else if("esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version&&(!e||"Resample"!==e.functionName)){var f="esriImageServiceDataTypeVector-UV"===
this.serviceDataType?7:10;b.rasterFunction="Resample";b.rasterFunctionArguments={ResamplingType:f,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}};e&&(b.rasterFunctionArguments.Raster=e.toJson())}b.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new z(b),this.setRenderingRule(this.defaultRenderingRule,a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var b=new D(c.fromJson(a.mosaicRule)),b=this._filterOutTimeDimension(b);a.mosaicRule=c.toJson(b.toJson())}var b=
"displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" "),e;for(e in b)a.hasOwnProperty(b[e])&&delete a[b[e]];return a},_filterOutTimeDimension:function(a){if(a&&a.multidimensionalDefinition&&0<a.multidimensionalDefinition.length){var b=l.filter(a.multidimensionalDefinition,function(a){return"StdTime"!==a.dimensionName});a.multidimensionalDefinition=b}return a},_removeVisualizationStretchFunction:function(a){var b=a&&a.functionName;if(!b||"stretch"!==
b.toLowerCase())return a;var e=a.functionArguments.Raster;return e&&e.functionName&&l.some(this.rasterFunctionInfos,function(a){return e.functionName===a.name})?e:a},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(a){a=(a=a||this)&&a.serviceDataType;return"esriImageServiceDataTypeVector-UV"===a||"esriImageServiceDataTypeVector-MagDir"===
a},_isRenderingRuleAProcessingTemplate:function(a){var b=a&&a.functionName;return!b||a.functionArguments?!1:l.some(b&&(this.rasterFunctionInfos||[]),function(a){return a&&a.name&&a.name.toLowerCase()===b.toLowerCase()})},_getRenderingRuleId:function(a){var b=a&&a.functionName;if(b){if(this._isRenderingRuleAProcessingTemplate(a))return b;var e=this._customRenderingRuleId[b];if(e){if(e!==a){for(var f in this._customRenderingRuleId)if(this._customRenderingRuleId[f]===a)return f;for(e=0;this._customRenderingRuleId[g];)e+=
1;var g;this._customRenderingRuleId[b+e]=a}}else this._customRenderingRuleId[b]=a;return b}},_createPixelData:function(a){a=new y({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var b=this.fullExtent.getCenter(),b=new u(b.x,b.y,b.x+this.pixelSizeX,b.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,extent:b}},_convertRendererToRenderingRule:function(a){var b=a&&a.declaredClass;if(!b||"esri.renderer.UniqueValueRenderer"!==b&&"esri.renderer.ClassBreaksRenderer"!==b&&"esri.renderer.StretchRenderer"!==
b)return null;var e=null;"esri.renderer.StretchRenderer"===b?e=a.toRenderingRule({convertToColormap:10.6>this.version}):"esri.renderer.ClassBreaksRenderer"===b?e=this._convertClassifyRenderer(a):"esri.renderer.UniqueValueRenderer"===b&&(e=this._convertUniqueValueRenderer(a));return e},_getValueField:function(a){if(a&&a.length){var b,e;l.some(a,function(a){if((e=a.name)&&"value"===e.toLowerCase())return b=e,!0});return b}},_convertClassifyRenderer:function(a){var b,e=[],f=[],g=[],k=[],c;b=this.renderingRule&&
this._getRenderingRuleId(this.renderingRule);var h,d,u=this.hasRasterAttributeTable,n,p;b&&(u=this._rasterFunctionTemplateInfos[b]?this._rasterFunctionTemplateInfos[b].hasRasterAttributeTable:this.hasRasterAttributeTable,d=this._renderingRuleAttributeTable[b],p=this._rasterFunctionTemplateInfos[b]);h=d&&d.features?d.features:this._rasterAttributeTableFeatures;n=this._getValueField(d&&d.fields?d.fields:this._rasterAttributeTableFields);u&&h?(l.forEach(a.infos,function(b,e){var f,g=b.symbol.color;g.a&&
l.forEach(h,function(c){f=c.attributes[a.attributeField];(f>=b.minValue&&f<b.maxValue||e===a.infos.length-1&&f>=b.minValue)&&k.push([c.attributes[n],g.r,g.g,g.b])},this)},this),b=p&&p.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(k,b),b=new z,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=k,b.variableName="Raster"):(l.forEach(a.infos,function(a,b){c=a.symbol&&a.symbol.color;c.a?(0===b?e.push.call(e,a.minValue,a.maxValue+1E-6):e.push.call(e,a.minValue+
1E-6,a.maxValue+1E-6),f.push(b),k.push([b,c.r,c.g,c.b])):g.push(a.minValue,a.maxValue)}),b=p&&p.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(k,b),b=new z,b.functionName="Remap",b.functionArguments={InputRanges:e,OutputValues:f,NoDataRanges:g},b.variableName="Raster",d=new z,d.functionName="Colormap",d.functionArguments={Colormap:k,Raster:b},b=d);return b},_convertUniqueValueRenderer:function(a){var b=[],e=this.renderingRule&&this._getRenderingRuleId(this.renderingRule),f,g,k,c;e&&
(g=this._renderingRuleAttributeTable[e],c=this._rasterFunctionTemplateInfos[e]);f=g&&g.features?g.features:this._rasterAttributeTableFeatures;k=this._getValueField(g&&g.fields?g.fields:this._rasterAttributeTableFields);l.forEach(a.infos,function(e){var g=e.symbol.color;g.a&&(a.attributeField!==k&&f?l.forEach(f,function(f){f.attributes[a.attributeField]==e.value&&b.push([f.attributes[k],g.r,g.g,g.b])},this):b.push([e.value,g.r,g.g,g.b]))},this);this._adjustColormapToPixelTypeRange(b,c&&c.pixelType||
this.pixelType);e=new z;e.functionName="Colormap";e.functionArguments={};e.functionArguments.Colormap=b;e.variableName="Raster";return e},_adjustColormapToPixelTypeRange:function(a,b){(b=this._pixelTypeRanges[b])&&a.push([Math.floor(b[0]-1),0,0,0],[Math.ceil(b[1]+1),0,0,0]);return a},_combineRenderingRule:function(a,b){if(!a||!b)return a||b;var e=function(a){var b=a.Raster;return b=b&&"esri.layers.RasterFunction"===b.declaredClass?e(b.functionArguments):a};a=d.clone(a);"none"!==b.functionName.toLocaleLowerCase()&&
(e(a.functionArguments).Raster=b);return a},_isItemLevelRasterFunction:function(a){var b=a&&a.functionName;if(!b||!this._hasItemLevelRFT)return!1;var e=!1;l.some(this.rasterFunctionInfos,function(a){if(a&&a.name===b){if(1===a.functionType||2===a.functionType)e=!0;return!0}});return e},_getServiceLevelRenderingRule:function(a){if(!this._hasItemLevelRFT||!a)return a;a=new z(a.toJson());var b;b=a.functionArguments;for(var e;;)if((e=b&&b.Raster)&&e.functionArguments&&e.functionArguments.Raster)b=e,b=
b.functionArguments;else{this._isItemLevelRasterFunction(e)&&delete b.Raster;break}return a},_getItemLevelRenderingRule:function(a){if(!this._hasItemLevelRFT||!a)return null;a=new z(a.toJson());for(a=a.functionArguments;;)if((a=a&&a.Raster)&&a.functionArguments&&a.functionArguments.Raster)a=a.functionArguments;else{if(this._isItemLevelRasterFunction(a))return a;break}},_resolve:function(a,e,f,g,k){e&&this[e].apply(this,a);f&&f.apply(null,a);g&&b._resDfd(g,a,k)},_toggleTime:function(){var a=this._map;
this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=q.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(q.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,b){this.useMapTime=a;this._toggleTime();!b&&this._map&&this.refresh(!0)},_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||
(this._setTime(a),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()}});p("extend-esri")&&d.setObject("layers.ImageServiceLayerMixin",r,k);return r})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point ./RasterFunction".split(" "),function(r,d,m,l,c,t,q){var p=r(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,
viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],itemRenderingRule:null,constructor:function(c){d.isObject(c)&&(d.mixin(this,c),c.mosaicMethod&&(this.method=c.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),c.mosaicOperation&&(this.operation=c.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),c.fids&&(this.objectIds=
c.fids),c.viewpoint&&(this.viewpoint=new t(c.viewpoint)),c.itemRenderingRule&&(this.itemRenderingRule=new q(c.itemRenderingRule)),this.multidimensionalDefinition=c.multidimensionalDefinition||[])},toJson:function(){var h=null,n=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(n)for(var h=[],k=0;k<n;k++)h.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[k].declaredClass?this.multidimensionalDefinition[k].toJson():this.multidimensionalDefinition[k]);
h={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:d.clone(this.lockRasterIds),viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:d.clone(this.objectIds),mosaicOperation:this.operation,multidimensionalDefinition:h,itemRenderingRule:this.itemRenderingRule?this.itemRenderingRule.toJson():null};return c.filter(h,function(a){if(null!==a)return!0})},_getMethodEnum:function(c){if(c){var h=p.METHOD_NONE;switch(c.toLowerCase()){case "byattribute":h=
p.METHOD_ATTRIBUTE;break;case "center":h=p.METHOD_CENTER;break;case "lockraster":h=p.METHOD_LOCKRASTER;break;case "nadir":h=p.METHOD_NADIR;break;case "northwest":h=p.METHOD_NORTHWEST;break;case "seamline":h=p.METHOD_SEAMLINE;break;case "viewpoint":h=p.METHOD_VIEWPOINT}return h}},_getOperatorEnum:function(c){if(c)switch(c.toLowerCase()){case "first":return p.OPERATION_FIRST;case "last":return p.OPERATION_LAST;case "max":return p.OPERATION_MAX;case "min":return p.OPERATION_MIN;case "blend":return p.OPERATION_BLEND;
case "mean":return p.OPERATION_MEAN;case "sum":return p.OPERATION_SUM}}});d.mixin(p,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",
OPERATION_SUM:"MT_SUM"});m("extend-esri")&&d.setObject("layers.MosaicRule",p,l);return p})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(r,d,m,l,c){r=r(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(c){d.isObject(c)&&d.mixin(this,c)},toJson:function(){var l={variableName:this.variableName,dimensionName:this.dimensionName,
values:d.clone(this.values),isSlice:this.isSlice};return c.filter(l,function(c){return null!==c})}});m("extend-esri")&&d.setObject("layers.DimensionalDefinition",r,l);return r})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u){var v,x,D,z,A,E;d=d(n,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(a,b,e){var g=this,h=new l(f._dfdCanceller);if(10>p("ie"))throw"This browser is not supported.";
if(!a.imageServiceParameters)throw"Insufficient parameters to read data";var d=m.clone(a.imageServiceParameters),u=a.pixelType;c.some(this.validPixelTypes,function(a){return a===u})||(d.pixelType="F32");c.some(this.validFormats,function(a){return a.toLowerCase()===d.format.toLowerCase()})||(d.format="lerc");var n=a.decodeFunc,t;this._prepareGetImageParameters(d);var q=d.width,v=d.height,y=d.extent;delete d.width;delete d.height;delete d.extent;h._pendingDfd=k({url:this.imageServiceUrl+"/exportImage",
handleAs:"arraybuffer",content:m.mixin(d,{f:"image"}),load:function(a){g.decode(a,{width:q,height:v,planes:null,pixelType:u,noDataValue:d.noData,format:d.format,decodeFunc:n}).then(function(a){t={pixelBlock:a,extent:y};g._resolve([t,d],"onRasterReadComplete",b,h)},function(a){g._resolve([a],null,e,h,!0)})},error:function(a){g._resolve([a],null,e,h,!0)}});return h.promise},decode:function(a,b){if(void 0===b||null===b)throw"missing decode options";var e,f;b.format&&(e=b.format.toUpperCase());"BSQ"!==
e&&"BIP"!==e&&(e=this._getFormat(a));f=b.decodeFunc;if(void 0===f||null===f)f=this._getFormatDecoderDfd(e);return f(a,b)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(b){if(b.size&&b.bbox){var e=b.size.split(",");b.width=parseFloat(e[0]);b.height=parseFloat(e[1]);b.extent||(e=b.bbox.split(","),b.extent=new a(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),new g(b.bboxSR)))}else{if(!b.width||Math.floor(b.width)!==b.width||!b.height||Math.floor(b.height)!==
b.height)throw"Incorrect Image Dimensions";if(!b.extent||"esri.geometry.Extent"!==b.extent.declaredClass)throw"Incorrect extent";var e=b.extent,f=e.spatialReference.wkid||q.toJson(e.spatialReference.toJson());delete b._ts;m.mixin(b,{bbox:e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,imageSR:f,bboxSR:f,size:b.width+","+b.height},b.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,e){var f=a.ymax-a.ymin,g=a.xmax-a.xmin;e>=b?a.ymax=a.ymin+g*b/e:a.xmax=a.xmin+f*e/b;return a},
_resolve:function(a,b,e,g,k){b&&this[b].apply(this,a);e&&e.apply(null,a);g&&f._resDfd(g,a,k)},_getFormatDecoderDfd:function(a){var b=null;switch(a){case "LERC":b=this._decodeLerc;break;case "LERC2":b=this._decodeLerc2;break;case "JPEG":b=this._decodeJpeg;break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip;break;case "TIFF":b=this._decodeTiff;break;default:b=function(a,b){throw"The raster format is not supported";}}b=m.hitch(this,b);return function(e,
f){var g=new l;try{var k;"LERC"===a||!0===A?(k=b(e,f),g.resolve(k)):E.then(function(){k=b(e,f);g.resolve(k)})}catch(O){g.reject(O)}return g}},_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";if(255===a[0]&&216===a[1])b="JPEG";else if(137===a[0]&&80===a[1]&&78===a[2]&&71===a[3])b="PNG";else if(67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9])b="LERC";else if(76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5])b=
"LERC2";else if(-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error"))b="ERROR";else if(73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3])b="TIFF";return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,e){if(!v)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(e);a=(new v).decode(a);
if(!B(a,e))throw"The decoded image dimensions are incorrect.";e=[];var f,g;for(f=0;f<a.pixels.length;f++)g=a.pixels[f],e.push(this._calculateBandStatistics(g));return new b({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:e})},_decodePng:function(a,e){if(!x)throw"The png decoder module is not loaded.";this._validateDecodeParams(e);a=new Uint8Array(a);var f=new x(a);a=new Uint8Array(e.width*e.height*4);f.copyToImageData(a,f.decodePixels());for(var g=f=0,k,g=new Uint8Array(e.width*
e.height),f=0;f<e.width*e.height;f++)g[f]=a[4*f+3];for(var c=new b({width:e.width,height:e.height,pixels:[],pixelType:"U8",mask:g,statistics:[]}),f=0;3>f;f++){k=new Uint8Array(e.width*e.height);for(g=0;g<e.width*e.height;g++)k[g]=a[4*g+f];c.addData({pixels:k,statistics:this._calculateBandStatistics(k)})}return c},_decodeBsq:function(a,e){if(!D)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(e);C=e.noDataValue;e.pixelType=F(e.pixelType);a=D.decodeBSQ(a,{bandCount:e.planes,width:e.width,
height:e.height,pixelType:y,noDataValue:C});var f=[],g,k=null;for(g=0;g<a.pixels.length;g++)k=a.pixels[g],f.push(this._calculateBandStatistics(k));return new b({width:e.width,height:e.height,pixels:a.pixels,pixelType:e.pixelType,mask:a.maskData,statistics:f})},_decodeBip:function(a,e){this._validateDecodeParams(e);C=e.noDataValue;e.pixelType=F(e.pixelType);a=D.decodeBIP(a,{bandCount:e.planes,width:e.width,height:e.height,pixelType:y,noDataValue:C});var f=[],g,k=null;for(g=0;g<a.pixels.length;g++)k=
a.pixels[g],f.push(this._calculateBandStatistics(k));return new b({width:e.width,height:e.height,pixels:a.pixels,pixelType:e.pixelType,mask:a.maskData,statistics:f})},_decodeTiff:function(a,e){this._validateDecodeParams(e);C=e.noDataValue;e.pixelType=F(e.pixelType);a=z.decode(a);e=[];var f,g=null;for(f=0;f<a.pixels.length;f++)g=a.pixels[f],e.push(this._calculateBandStatistics(g,a.maskData));return new b({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType,mask:a.maskData,statistics:e})},
_decodeLerc:function(a,f){this._validateDecodeParams(f);C=f.noDataValue;f.pixelType=F(f.pixelType);for(var g=0,k,c=0,h,d=a.byteLength-10;c<d;){var u=e.decode(a,{inputOffset:c,encodedMaskData:k,returnMask:0===g?!0:!1,returnEncodedMask:0===g?!0:!1,returnFileInfo:!0,pixelType:y,noDataValue:C}),c=u.fileInfo.eofOffset;0===g&&(k=u.encodedMaskData,h=new b({width:f.width,height:f.height,pixels:[],pixelType:f.pixelType,mask:u.maskData,statistics:[]}));g++;if(!B(u,f))throw"The decoded image dimensions are incorrect";
h.addData({pixels:u.pixelData,statistics:{minValue:u.minValue,maxValue:u.maxValue,noDataValue:u.noDataValue}})}return h},_decodeLerc2:function(a,e){this._validateDecodeParams(e);C=e.noDataValue;e.pixelType=F(e.pixelType);for(var f=0,g,k,c=0,h,d=a.byteLength-10,n=[];c<d;){k=u.decode(a,{inputOffset:c,maskData:g,returnFileInfo:!0});c=k.fileInfo.eofOffset;0===f&&(g=k.maskData,h=new b({width:e.width,height:e.height,pixels:[],pixelType:k.fileInfo.pixelType,mask:k.maskData,statistics:[]}));k.fileInfo.mask&&
0<k.fileInfo.mask.numBytes&&n.push(k.maskData);f++;if(!B(k,e))throw"The decoded image dimensions are incorrect";h.addData({pixels:k.pixelData,statistics:{minValue:k.minValue,maxValue:k.maxValue,noDataValue:k.noDataValue}})}if(1<n.length){k=h.width*h.height;h.bandMasks=n;g=new Uint8Array(k);g.set(n[0]);for(e=1;e<n.length;e++)for(a=n[e],f=0;f<k;f++)g[f]&=a[f];h.maskData=g}return h},_calculateBandStatistics:function(a,b){var e=Infinity,f=-Infinity,g=a.length,k,c=0;if(b)for(k=0;k<g;k++)b[k]&&(c=a[k],
e=c<e?c:e,f=c>f?c:f);else for(k=0;k<g;k++)c=a[k],e=c<e?c:e,f=c>f?c:f;return{minValue:e,maxValue:f}},_loadRasterFormatModules:function(){A||(E||(E=new l),10>p("ie")?E.isRejected()||E.reject("unsupported browser version"):r(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(a,b,e,f){v=a;x=b;D=e;z=f;A=!0;E.isResolved()||E.resolve(!0)}))}});var y=null,C=null,F=function(a){if("U1"===a||"U2"===a||"U4"===a||"U8"===a)return C=
Math.pow(2,8)-1,y=Uint8Array,"U8";"U16"===a?(C=C||Math.pow(2,16)-1,y=Uint16Array):"U32"===a?(C=C||Math.pow(2,32)-1,y=Uint32Array):"S8"===a?(C=C||0-Math.pow(2,7),y=Int8Array):"S16"===a?(C=C||0-Math.pow(2,15),y=Int16Array):"S32"===a?(C=C||0-Math.pow(2,31),y=Int32Array):y=Float32Array;return a},B=function(a,b){return a.height!==b.height||a.width!==b.width?!1:!0};p("extend-esri")&&m.setObject("layers.Raster",d,h);return d})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel"],function(r,d,m,l){r=r([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],constructor:function(c){if(c){if(!c.width||Math.floor(c.width)!==c.width)throw"PixelBlock: incorrect width";if(!c.height||Math.floor(c.height)!==c.height)throw"PixelBlock: incorrect height";if(!c.pixels||!c.statistics)throw"PixelBlock: pixel data or statistics not present";this.width=c.width;this.height=c.height;this.pixels=c.pixels;this.pixelType=
c.pixelType||null;this.statistics=c.statistics;this.mask=c.mask||null}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(c){if(!c.pixels||!c.statistics)throw"Pixel data or statistics are not present";if(c.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(c.statistics);this.pixels.push(c.pixels)},getAsRGBA:function(){var c=new ArrayBuffer(this.width*
this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(c);break;default:this._fillFrom8Bit(c)}return new Uint8ClampedArray(c)},getAsRGBAFloat:function(){var c=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(c);return c},clone:function(){var c=new this.constructor;c.width=this.width;c.height=this.height;c.pixelType=this.pixelType;this.mask&&(c.mask=new Uint8Array(this.mask));var l,q;if(this.pixels)for(c.pixels=
[],q=this.pixels.length,l=0;l<q;l++)c.pixels[l]=new Float32Array(this.pixels[l]);if(this.statistics)for(c.statistics=[],q=this.statistics.length,l=0;l<q;l++)c.statistics[l]=d.clone(this.statistics[l]);return c},_fillFrom8Bit:function(c){var d=this.pixels,l=this.mask;if(!c||!d||!d.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var p,h,n;p=h=n=d[0];3<=d.length&&(h=d[1],n=d[2]);var d=new Uint32Array(c),k=this.width*this.height;if(p.length!==k)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");
if(l&&l.length===k)for(c=0;c<k;c++)l[c]&&(d[c]=-16777216|n[c]<<16|h[c]<<8|p[c]);else for(c=0;c<k;c++)d[c]=-16777216|n[c]<<16|h[c]<<8|p[c]},_fillFromNon8Bit:function(c){var d=this.pixels,l=this.mask,p=this.statistics;if(!c||!d||!d.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var h=1,n=0;p&&0<p.length?(n=p[0].minValue,h=255/(p[0].maxValue-p[0].minValue)):(h=255,"S8"===this.pixelType?(n=-128,h=127):"U16"===this.pixelType?h=65535:"S16"===this.pixelType?(n=
-32768,h=32767):"U32"===this.pixelType?h=4294967295:"S32"===this.pixelType?(n=-2147483648,h=2147483647):"F32"===this.pixelType?(n=-3.4*1E39,h=3.4*1E39):"F64"===this.pixelType&&(n=-Number.MAX_VALUE,h=Number.MAX_VALUE),h=255/(h-n));c=new Uint32Array(c);var p=this.width*this.height,k,a,g;k=d[0];if(k.length!==p)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=d.length)if(a=d[1],g=d[2],l&&l.length===p)for(d=0;d<p;d++)l[d]&&(c[d]=-16777216|(g[d]-n)*h<<16|(a[d]-n)*h<<8|
(k[d]-n)*h);else for(d=0;d<p;d++)c[d]=-16777216|(g[d]-n)*h<<16|(a[d]-n)*h<<8|(k[d]-n)*h;else if(l&&l.length===p)for(d=0;d<p;d++)a=(k[d]-n)*h,l[d]&&(c[d]=-16777216|a<<16|a<<8|a);else for(d=0;d<p;d++)a=(k[d]-n)*h,c[d]=-16777216|a<<16|a<<8|a},_fillFrom32Bit:function(c){var d=this.pixels,l=this.mask;if(!c||!d||!d.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var p,h,n;p=h=n=d[0];3<=d.length&&(h=d[1],n=d[2]);var k=this.width*this.height;if(p.length!==k)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");
var a=0;if(l&&l.length===k)for(d=0;d<k;d++)c[a++]=p[d],c[a++]=h[d],c[a++]=n[d],c[a++]=l[d];else for(d=0;d<k;d++)c[a++]=p[d],c[a++]=h[d],c[a++]=n[d],c[a++]=255}});m("extend-esri")&&d.setObject("layers.PixelBlock",r,l);return r})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var r={defaultNoDataValue:-3.4027999387901484E38,decode:function(m,l){var c;l=l||{};var t=l.inputOffset||0,q=l.encodedMaskData||null===l.encodedMaskData,p={},h=new Uint8Array(m,t,10);p.fileIdentifierString=
String.fromCharCode.apply(null,h);if("CntZImage"!=p.fileIdentifierString.trim())throw"Unexpected file identifier string: "+p.fileIdentifierString;t+=10;h=new DataView(m,t,24);p.fileVersion=h.getInt32(0,!0);p.imageType=h.getInt32(4,!0);p.height=h.getUint32(8,!0);p.width=h.getUint32(12,!0);p.maxZError=h.getFloat64(16,!0);t+=24;if(!q)if(h=new DataView(m,t,16),p.mask={},p.mask.numBlocksY=h.getUint32(0,!0),p.mask.numBlocksX=h.getUint32(4,!0),p.mask.numBytes=h.getUint32(8,!0),p.mask.maxValue=h.getFloat32(12,
!0),t+=16,0<p.mask.numBytes){var q=new Uint8Array(Math.ceil(p.width*p.height/8)),h=new DataView(m,t,p.mask.numBytes),n=h.getInt16(0,!0),k=2,a=0;do{if(0<n)for(;n--;)q[a++]=h.getUint8(k++);else for(var g=h.getUint8(k++),n=-n;n--;)q[a++]=g;n=h.getInt16(k,!0);k+=2}while(k<p.mask.numBytes);if(-32768!==n||a<q.length)throw"Unexpected end of mask RLE encoding";p.mask.bitset=q;t+=p.mask.numBytes}else 0===(p.mask.numBytes|p.mask.numBlocksY|p.mask.maxValue)&&(q=new Uint8Array(Math.ceil(p.width*p.height/8)),
p.mask.bitset=q);h=new DataView(m,t,16);p.pixels={};p.pixels.numBlocksY=h.getUint32(0,!0);p.pixels.numBlocksX=h.getUint32(4,!0);p.pixels.numBytes=h.getUint32(8,!0);p.pixels.maxValue=h.getFloat32(12,!0);t+=16;q=p.pixels.numBlocksX;h=p.pixels.numBlocksY;q+=0<p.width%q?1:0;n=h+(0<p.height%h?1:0);p.pixels.blocks=Array(q*n);for(a=k=0;a<n;a++)for(g=0;g<q;g++){var f=0,h=new DataView(m,t,Math.min(10,m.byteLength-t)),b={};p.pixels.blocks[k++]=b;var e=h.getUint8(0);f++;b.encoding=e&63;if(3<b.encoding)throw"Invalid block encoding ("+
b.encoding+")";if(2===b.encoding)t++;else{if(0!==e&&2!==e){e>>=6;b.offsetType=e;if(2===e)b.offset=h.getInt8(1),f++;else if(1===e)b.offset=h.getInt16(1,!0),f+=2;else if(0===e)b.offset=h.getFloat32(1,!0),f+=4;else throw"Invalid block offset type";if(1===b.encoding)if(e=h.getUint8(f),f++,b.bitsPerPixel=e&63,e>>=6,b.numValidPixelsType=e,2===e)b.numValidPixels=h.getUint8(f),f++;else if(1===e)b.numValidPixels=h.getUint16(f,!0),f+=2;else if(0===e)b.numValidPixels=h.getUint32(f,!0),f+=4;else throw"Invalid valid pixel count type";
}t+=f;if(3!=b.encoding)if(0===b.encoding){e=(p.pixels.numBytes-1)/4;if(e!==Math.floor(e))throw"uncompressed block has invalid length";h=new ArrayBuffer(4*e);f=new Uint8Array(h);f.set(new Uint8Array(m,t,4*e));h=new Float32Array(h);b.rawData=h;t+=4*e}else 1===b.encoding&&(e=Math.ceil(b.numValidPixels*b.bitsPerPixel/8),h=new ArrayBuffer(4*Math.ceil(e/4)),f=new Uint8Array(h),f.set(new Uint8Array(m,t,e)),b.stuffedData=new Uint32Array(h),t+=e)}}p.eofOffset=t;m=null!=l.noDataValue?l.noDataValue:r.defaultNoDataValue;
var q=l.encodedMaskData,e=l.returnMask,n=0,k=p.pixels.numBlocksX,a=p.pixels.numBlocksY,g=Math.floor(p.width/k),b=Math.floor(p.height/a),f=2*p.maxZError,t=Number.MAX_VALUE,u,q=q||(p.mask?p.mask.bitset:null),v,h=new (l.pixelType||Float32Array)(p.width*p.height);e&&q&&(v=new Uint8Array(p.width*p.height));for(var e=new Float32Array(g*b),x,D,z=0;z<=a;z++){var A=z!==a?b:p.height%a;if(0!==A)for(var E=0;E<=k;E++){var y=E!==k?g:p.width%k;if(0!==y){var C=z*p.width*b+E*g,F=p.width-y,B=p.pixels.blocks[n],G,H;
if(2>B.encoding){if(0===B.encoding)G=B.rawData;else{G=B.stuffedData;H=B.bitsPerPixel;u=B.numValidPixels;x=B.offset;D=f;var L=e,J=p.pixels.maxValue,K=(1<<H)-1,I=0,O=void 0,P=0,R=void 0,N=void 0,Q=Math.ceil((J-x)/D);G[G.length-1]<<=8*(4*G.length-Math.ceil(H*u/8));for(O=0;O<u;O++)0===P&&(N=G[I++],P=32),P>=H?(R=N>>>P-H&K,P-=H):(P=H-P,R=(N&K)<<P&K,N=G[I++],P=32-P,R+=N>>>P),L[O]=R<Q?x+R*D:J;G=e}H=0}else c=2===B.encoding?0:B.offset;var M;if(q)for(D=0;D<A;D++){C&7&&(M=q[C>>3],M<<=C&7);for(x=0;x<y;x++)C&7||
(M=q[C>>3]),M&128?(v&&(v[C]=1),u=2>B.encoding?G[H++]:c,t=t>u?u:t,h[C++]=u):(v&&(v[C]=0),h[C++]=m),M<<=1;C+=F}else if(2>B.encoding)for(D=0;D<A;D++){for(x=0;x<y;x++)u=G[H++],t=t>u?u:t,h[C++]=u;C+=F}else for(t=t>c?c:t,D=0;D<A;D++){for(x=0;x<y;x++)h[C++]=c;C+=F}if(1===B.encoding&&H!==B.numValidPixels)throw"Block and Mask do not match";n++}}}c=v;v={width:p.width,height:p.height,pixelData:h,minValue:t,maxValue:p.pixels.maxValue,noDataValue:m};c&&(v.maskData=c);l.returnEncodedMask&&p.mask&&(v.encodedMaskData=
p.mask.bitset?p.mask.bitset:null);if(l.returnFileInfo&&(v.fileInfo=d(p),l.computeUsedBitDepths)){l=v.fileInfo;c=p.pixels.numBlocksX*p.pixels.numBlocksY;M={};for(G=0;G<c;G++)H=p.pixels.blocks[G],0===H.encoding?M.float32=!0:1===H.encoding?M[H.bitsPerPixel]=!0:M[0]=!0;p=Object.keys(M);l.bitDepths=p}return v}},d=function(d){return{fileIdentifierString:d.fileIdentifierString,fileVersion:d.fileVersion,imageType:d.imageType,height:d.height,width:d.width,maxZError:d.maxZError,eofOffset:d.eofOffset,mask:d.mask?
{numBlocksX:d.mask.numBlocksX,numBlocksY:d.mask.numBlocksY,numBytes:d.mask.numBytes,maxValue:d.mask.maxValue}:null,pixels:{numBlocksX:d.pixels.numBlocksX,numBlocksY:d.pixels.numBlocksY,numBytes:d.pixels.numBytes,maxValue:d.pixels.maxValue,noDataValue:this.noDataValue}}};return r})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var r={unstuff:function(d,c,t,q,p,h,n,k){var a=(1<<t)-1,g=0,f,b=0,e,u;d[d.length-1]<<=8*(4*d.length-Math.ceil(t*q/8));if(p)for(f=0;f<q;f++)0===b&&(u=
d[g++],b=32),b>=t?(e=u>>>b-t&a,b-=t):(b=t-b,e=(u&a)<<b&a,u=d[g++],b=32-b,e+=u>>>b),c[f]=p[e];else for(p=Math.ceil((k-h)/n),f=0;f<q;f++)0===b&&(u=d[g++],b=32),b>=t?(e=u>>>b-t&a,b-=t):(b=t-b,e=(u&a)<<b&a,u=d[g++],b=32-b,e+=u>>>b),c[f]=e<p?h+e*n:k},unstuffLUT:function(d,c,t,q,p,h){var n=(1<<c)-1,k=0,a=0,g=0,f=g=0,b,e=[];d[d.length-1]<<=8*(4*d.length-Math.ceil(c*t/8));for(var u=Math.ceil((h-q)/p),a=0;a<t;a++)0===g&&(b=d[k++],g=32),g>=c?(f=b>>>g-c&n,g-=c):(g=c-g,f=(b&n)<<g&n,b=d[k++],g=32-g,f+=b>>>g),
e[a]=f<u?q+f*p:h;e.unshift(q);return e},unstuff2:function(d,c,t,q,p,h,n,k){var a=(1<<t)-1,g=0,f,b=0,e=0,u,l,m;if(p)for(f=0;f<q;f++)0===b&&(l=d[g++],b=32,e=0),b>=t?(u=l>>>e&a,b-=t,e+=t):(m=t-b,u=l>>>e&a,l=d[g++],b=32-m,u|=(l&(1<<m)-1)<<t-m,e=m),c[f]=p[u];else for(p=Math.ceil((k-h)/n),f=0;f<q;f++)0===b&&(l=d[g++],b=32,e=0),b>=t?(u=l>>>e&a,b-=t,e+=t):(m=t-b,u=l>>>e&a,l=d[g++],b=32-m,u|=(l&(1<<m)-1)<<t-m,e=m),c[f]=u<p?h+u*n:k;return c},unstuffLUT2:function(d,c,t,q,p,h){for(var n=(1<<c)-1,k=0,a=0,g=0,
f=0,b=0,e=0,u,l=[],m=Math.ceil((h-q)/p),a=0;a<t;a++)0===f&&(u=d[k++],f=32,e=0),f>=c?(b=u>>>e&n,f-=c,e+=c):(g=c-f,b=u>>>e&n,u=d[k++],f=32-g,b|=(u&(1<<g)-1)<<c-g,e=g),l[a]=b<m?q+b*p:h;l.unshift(q);return l},originalUnstuff:function(d,c,t,q){var p=(1<<t)-1,h=0,n,k=0,a,g;d[d.length-1]<<=8*(4*d.length-Math.ceil(t*q/8));for(n=0;n<q;n++)0===k&&(g=d[h++],k=32),k>=t?(a=g>>>k-t&p,k-=t):(k=t-k,a=(g&p)<<k&p,g=d[h++],k=32-k,a+=g>>>k),c[n]=a;return c},originalUnstuff2:function(d,c,t,q){var p=(1<<t)-1,h=0,n,k=0,
a=0,g,f,b;for(n=0;n<q;n++)0===k&&(f=d[h++],k=32,a=0),k>=t?(g=f>>>a&p,k-=t,a+=t):(b=t-k,g=f>>>a&p,f=d[h++],k=32-b,g|=(f&(1<<b)-1)<<t-b,a=b),c[n]=g;return c}},d={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(d){for(var c=65535,l=65535,q=d.length,p=Math.floor(q/2),h=0;p;){var n=359<=p?359:p,p=p-n;do c+=d[h++]<<8,l+=c+=d[h++];while(--n);c=(c&65535)+(c>>>16);l=(l&65535)+(l>>>16)}q&1&&(l+=c+=d[h]<<8);return((l&65535)+(l>>>16)<<16|(c&65535)+(c>>>16))>>>0},readHeaderInfo:function(d,c){var l=
c.ptr,q=new Uint8Array(d,l,6),p={};p.fileIdentifierString=String.fromCharCode.apply(null,q);if(0!==p.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+p.fileIdentifierString;var l=l+6,q=new DataView(d,l,8),h=q.getInt32(0,!0);p.fileVersion=h;l+=4;3<=h&&(p.checksum=q.getUint32(4,!0),l+=4);q=new DataView(d,l,12);p.height=q.getUint32(0,!0);p.width=q.getUint32(4,!0);l+=8;4<=h?(p.numDims=q.getUint32(8,!0),l+=4):p.numDims=1;q=new DataView(d,l,40);p.numValidPixel=
q.getUint32(0,!0);p.microBlockSize=q.getInt32(4,!0);p.blobSize=q.getInt32(8,!0);p.imageType=q.getInt32(12,!0);p.maxZError=q.getFloat64(16,!0);p.zMin=q.getFloat64(24,!0);p.zMax=q.getFloat64(32,!0);l+=40;c.headerInfo=p;c.ptr=l;if(3<=h&&(d=this.computeChecksumFletcher32(new Uint8Array(d,l-(4<=h?52:48),p.blobSize-14)),d!==p.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(d,c){var l=c.headerInfo,q=this.getDataTypeArray(l.imageType),p=l.numDims*this.getDataTypeSize(l.imageType),h=
this.readSubArray(d,c.ptr,q,p);d=this.readSubArray(d,c.ptr+p,q,p);c.ptr+=2*p;p=!0;for(c=0;c<l.numDims;c++)if(h[c]!==d[c]){p=!1;break}l.minValues=h;l.maxValues=d;return p},readSubArray:function(d,c,t,q){if(t===Uint8Array)d=new Uint8Array(d,c,q);else{var p=new ArrayBuffer(q);(new Uint8Array(p)).set(new Uint8Array(d,c,q));d=new t(p)}return d},readMask:function(d,c){var l=c.ptr,q=c.headerInfo,p=q.width*q.height,h=q.numValidPixel,n=new DataView(d,l,4),q={};q.numBytes=n.getUint32(0,!0);l+=4;if((0===h||
p===h)&&0!==q.numBytes)throw"invalid mask";if(0===h)h=new Uint8Array(Math.ceil(p/8)),q.bitset=h,n=new Uint8Array(p),c.pixels.resultMask=n,l+=q.numBytes;else if(0<q.numBytes){h=new Uint8Array(Math.ceil(p/8));n=new DataView(d,l,q.numBytes);d=n.getInt16(0,!0);var k=2,a=0,g=0;do{if(0<d)for(;d--;)h[a++]=n.getUint8(k++);else for(g=n.getUint8(k++),d=-d;d--;)h[a++]=g;d=n.getInt16(k,!0);k+=2}while(k<q.numBytes);if(-32768!==d||a<h.length)throw"Unexpected end of mask RLE encoding";n=new Uint8Array(p);for(k=
k=d=0;k<p;k++)k&7?(d=h[k>>3],d<<=k&7):d=h[k>>3],d&128&&(n[k]=1);c.pixels.resultMask=n;q.bitset=h;l+=q.numBytes}c.ptr=l;c.mask=q;return!0},readDataOneSweep:function(l,c,t){var q=c.ptr,p=c.headerInfo,h=p.numDims,n=p.width*p.height,p=p.numValidPixel*d.getDataTypeSize(p.imageType)*h,k=c.pixels.resultMask;if(t===Uint8Array)l=new Uint8Array(l,q,p);else{var a=new ArrayBuffer(p);(new Uint8Array(a)).set(new Uint8Array(l,q,p));l=new t(a)}if(l.length===n*h)c.pixels.resultPixels=l;else{c.pixels.resultPixels=
new t(n*h);var g=a=t=0,f=0;if(1<h)for(g=0;g<h;g++)for(f=g*n,a=0;a<n;a++)k[a]&&(c.pixels.resultPixels[f+a]=l[t++]);else for(a=0;a<n;a++)k[a]&&(c.pixels.resultPixels[a]=l[t++])}c.ptr=q+p;return!0},readHuffmanTree:function(l,c){var t=this.HUFFMAN_LUT_BITS_MAX,q=new DataView(l,c.ptr,16);c.ptr+=16;if(2>q.getInt32(0,!0))throw"unsupported Huffman version";var p=q.getInt32(4,!0),h=q.getInt32(8,!0),q=q.getInt32(12,!0);if(h>=q)return!1;var n=new Uint32Array(q-h);d.decodeBits(l,c,n);var k=[],a,g,f;for(a=h;a<
q;a++)g=a-(a<p?0:p),k[g]={first:n[a-h],second:null};a=l.byteLength-c.ptr;n=new ArrayBuffer(4*Math.ceil(a/4));(new Uint8Array(n)).set(new Uint8Array(l,c.ptr,a));l=new Uint32Array(n);c=0;var b,n=0;b=l[0];for(a=h;a<q;a++)g=a-(a<p?0:p),f=k[g].first,0<f&&(k[g].second=b<<c>>>32-f,32-c>=f?(c+=f,32===c&&(c=0,n++,b=l[n])):(c+=f-32,n++,b=l[n],k[g].second|=b>>>32-c));var e=b=0,u=new m;for(a=0;a<k.length;a++)void 0!==k[a]&&(b=Math.max(b,k[a].first));e=b>=t?t:b;30<=b&&console.log("WARning, large NUM LUT BITS IS "+
b);var t=[],v,x;for(a=h;a<q;a++)if(g=a-(a<p?0:p),f=k[g].first,0<f)if(h=[f,g],f<=e)for(g=k[g].second<<e-f,v=1<<e-f,f=0;f<v;f++)t[g|f]=h;else for(g=k[g].second,v=u,--f;0<=f;f--)(x=g>>>f&1)?(v.right||(v.right=new m),v=v.right):(v.left||(v.left=new m),v=v.left),0!==f||v.val||(v.val=h[1]);return{decodeLut:t,numBitsLUTQick:e,numBitsLUT:b,tree:u,stuffedData:l,srcPtr:n,bitPos:c}},readHuffman:function(d,c,t){var l=c.headerInfo,p=l.numDims,h=c.headerInfo.height,n=c.headerInfo.width,k=n*h,a=this.readHuffmanTree(d,
c);d=a.decodeLut;var g=a.tree,f=a.stuffedData,b=a.srcPtr,e=a.bitPos,u=a.numBitsLUTQick,a=a.numBitsLUT,m=0===c.headerInfo.imageType?128:0,x,r,z=c.pixels.resultMask,A,E,y,C,F,B,G=0;0<e&&(b++,e=0);var H=f[b],L=1===c.encodeMode,J=new t(k*p),K=J,I;for(I=0;I<l.numDims;I++){1<p&&(K=new t(J.buffer,k*I,k),G=0);if(c.headerInfo.numValidPixel===n*h)for(y=F=0;y<h;y++)for(C=0;C<n;C++,F++){r=0;x=A=H<<e>>>32-u;32-e<u&&(x=A|=f[b+1]>>>64-e-u);if(d[x])r=d[x][1],e+=d[x][0];else for(x=A=H<<e>>>32-a,32-e<a&&(x=A|=f[b+
1]>>>64-e-a),x=g,B=0;B<a;B++)if(x=(E=A>>>a-B-1&1)?x.right:x.left,!x.left&&!x.right){r=x.val;e=e+B+1;break}32<=e&&(e-=32,b++,H=f[b]);r-=m;L?(r=0<C?r+G:0<y?r+K[F-n]:r+G,r&=255,G=K[F]=r):K[F]=r}else for(y=F=0;y<h;y++)for(C=0;C<n;C++,F++)if(z[F]){r=0;x=A=H<<e>>>32-u;32-e<u&&(x=A|=f[b+1]>>>64-e-u);if(d[x])r=d[x][1],e+=d[x][0];else for(x=A=H<<e>>>32-a,32-e<a&&(x=A|=f[b+1]>>>64-e-a),x=g,B=0;B<a;B++)if(x=(E=A>>>a-B-1&1)?x.right:x.left,!x.left&&!x.right){r=x.val;e=e+B+1;break}32<=e&&(e-=32,b++,H=f[b]);r-=
m;L?(r=0<C&&z[F-1]?r+G:0<y&&z[F-n]?r+K[F-n]:r+G,r&=255,G=K[F]=r):K[F]=r}c.ptr=c.ptr+4*(b+1)+(0<e?4:0)}c.pixels.resultPixels=J},decodeBits:function(d,c,t,q,p){var h=c.headerInfo,n=h.fileVersion,k=0,a=new DataView(d,c.ptr,5),g=a.getUint8(0);k++;var f=g>>6,b=0===f?4:3-f,e=0<(g&32)?!0:!1,f=g&31,g=0;if(1===b)g=a.getUint8(k),k++;else if(2===b)g=a.getUint16(k,!0),k+=2;else if(4===b)g=a.getUint32(k,!0),k+=4;else throw"Invalid valid pixel count type";var b=2*h.maxZError,u,l;p=1<h.numDims?h.maxValues[p]:h.zMax;
if(e){c.counter.lut++;e=a.getUint8(k);k++;h=Math.ceil((e-1)*f/8);u=Math.ceil(h/4);u=new ArrayBuffer(4*u);l=new Uint8Array(u);c.ptr+=k;l.set(new Uint8Array(d,c.ptr,h));k=new Uint32Array(u);c.ptr+=h;for(a=0;e-1>>>a;)a++;h=Math.ceil(g*a/8);u=Math.ceil(h/4);u=new ArrayBuffer(4*u);l=new Uint8Array(u);l.set(new Uint8Array(d,c.ptr,h));d=new Uint32Array(u);c.ptr+=h;c=3<=n?r.unstuffLUT2(k,f,e-1,q,b,p):r.unstuffLUT(k,f,e-1,q,b,p);3<=n?r.unstuff2(d,t,a,g,c):r.unstuff(d,t,a,g,c)}else c.counter.bitstuffer++,a=
f,c.ptr+=k,0<a&&(h=Math.ceil(g*a/8),u=Math.ceil(h/4),u=new ArrayBuffer(4*u),l=new Uint8Array(u),l.set(new Uint8Array(d,c.ptr,h)),d=new Uint32Array(u),c.ptr+=h,3<=n?null==q?r.originalUnstuff2(d,t,a,g):r.unstuff2(d,t,a,g,!1,q,b,p):null==q?r.originalUnstuff(d,t,a,g):r.unstuff(d,t,a,g,!1,q,b,p))},readTiles:function(l,c,t){var q=c.headerInfo,p=q.width,h=q.height,n=q.microBlockSize,k=q.imageType,a=d.getDataTypeSize(k),g=Math.ceil(p/n),f=Math.ceil(h/n);c.pixels.numBlocksY=f;c.pixels.numBlocksX=g;for(var b=
c.pixels.ptr=0,e=0,u=0,m=0,x=0,r=0,z=0,A=0,E=b=0,y=0,C=0,z=z=b=z=0,F,B=new t(n*n),G=h%n||n,H=p%n||n,q=q.numDims,L,J=c.pixels.resultMask,K=c.pixels.resultPixels,u=0;u<f;u++)for(x=u!==f-1?n:G,m=0;m<g;m++)for(r=m!==g-1?n:H,y=u*p*n+m*n,C=p-r,L=0;L<q;L++){1<q&&(K=new t(c.pixels.resultPixels.buffer,p*h*L*a,p*h));z=l.byteLength-c.ptr;e=new DataView(l,c.ptr,Math.min(10,z));F={};z=0;A=e.getUint8(0);z++;b=A>>6&255;E=A>>2&15;if(E!==(m*n>>3&15))throw"integrity issue";A&=3;if(3<A)throw c.ptr+=z,"Invalid block encoding ("+
A+")";if(2===A)c.counter.constant++,c.ptr+=z;else if(0===A){c.counter.uncompressed++;c.ptr+=z;z=x*r*a;b=l.byteLength-c.ptr;z=z<b?z:b;b=new ArrayBuffer(0===z%a?z:z+a-z%a);e=new Uint8Array(b);e.set(new Uint8Array(l,c.ptr,z));F=new t(b);z=0;if(J)for(b=0;b<x;b++){for(e=0;e<r;e++)J[y]&&(K[y]=F[z++]),y++;y+=C}else for(b=0;b<x;b++){for(e=0;e<r;e++)K[y++]=F[z++];y+=C}c.ptr+=z*a}else if(b=d.getDataTypeUsed(k,b),F=d.getOnePixel(F,z,b,e),z+=d.getDataTypeSize(b),3===A)if(c.ptr+=z,c.counter.constantoffset++,J)for(b=
0;b<x;b++){for(e=0;e<r;e++)J[y]&&(K[y]=F),y++;y+=C}else for(b=0;b<x;b++){for(e=0;e<r;e++)K[y++]=F;y+=C}else if(c.ptr+=z,d.decodeBits(l,c,B,F,L),z=0,J)for(b=0;b<x;b++){for(e=0;e<r;e++)J[y]&&(K[y]=B[z++]),y++;y+=C}else for(b=0;b<x;b++){for(e=0;e<r;e++)K[y++]=B[z++];y+=C}}},formatFileInfo:function(l){return{fileIdentifierString:l.headerInfo.fileIdentifierString,fileVersion:l.headerInfo.fileVersion,imageType:l.headerInfo.imageType,height:l.headerInfo.height,width:l.headerInfo.width,numValidPixel:l.headerInfo.numValidPixel,
microBlockSize:l.headerInfo.microBlockSize,blobSize:l.headerInfo.blobSize,maxZError:l.headerInfo.maxZError,pixelType:d.getPixelType(l.headerInfo.imageType),eofOffset:l.eofOffset,mask:l.mask?{numBytes:l.mask.numBytes}:null,pixels:{numBlocksX:l.pixels.numBlocksX,numBlocksY:l.pixels.numBlocksY,maxValue:l.headerInfo.zMax,minValue:l.headerInfo.zMin,noDataValue:l.noDataValue}}},constructConstantSurface:function(d){var c=d.headerInfo.zMax,l=d.headerInfo.numDims,q=d.headerInfo.height*d.headerInfo.width,p=
q*l,h=0,n=0,k=0,a=d.pixels.resultMask;if(a)if(1<l)for(h=0;h<l;h++)for(k=h*q,n=0;n<q;n++)a[n]&&(d.pixels.resultPixels[k+n]=c);else for(n=0;n<q;n++)a[n]&&(d.pixels.resultPixels[n]=c);else if(d.pixels.resultPixels.fill)d.pixels.resultPixels.fill(c);else for(n=0;n<p;n++)d.pixels.resultPixels[n]=c},getDataTypeArray:function(d){switch(d){case 0:d=Int8Array;break;case 1:d=Uint8Array;break;case 2:d=Int16Array;break;case 3:d=Uint16Array;break;case 4:d=Int32Array;break;case 5:d=Uint32Array;break;case 6:d=Float32Array;
break;case 7:d=Float64Array;break;default:d=Float32Array}return d},getPixelType:function(d){switch(d){case 0:d="S8";break;case 1:d="U8";break;case 2:d="S16";break;case 3:d="U16";break;case 4:d="S32";break;case 5:d="U32";break;case 6:d="F32";break;case 7:d="F64";break;default:d="F32"}return d},isValidPixelValue:function(d,c){if(null==c)return!1;switch(d){case 0:d=-128<=c&&127>=c;break;case 1:d=0<=c&&255>=c;break;case 2:d=-32768<=c&&32767>=c;break;case 3:d=0<=c&&65536>=c;break;case 4:d=-2147483648<=
c&&2147483647>=c;break;case 5:d=0<=c&&4294967296>=c;break;case 6:d=-3.4027999387901484E38<=c&&3.4027999387901484E38>=c;break;case 7:d=4.9E-324<=c&&1.7976931348623157E308>=c;break;default:d=!1}return d},getDataTypeSize:function(d){var c=0;switch(d){case 0:case 1:c=1;break;case 2:case 3:c=2;break;case 4:case 5:case 6:c=4;break;case 7:c=8;break;default:c=d}return c},getDataTypeUsed:function(d,c){var l=d;switch(d){case 2:case 4:l=d-c;break;case 3:case 5:l=d-2*c;break;case 6:l=0===c?d:1===c?2:1;break;
case 7:l=0===c?d:d-2*c+1;break;default:l=d}return l},getOnePixel:function(d,c,t,q){d=0;switch(t){case 0:d=q.getInt8(c);break;case 1:d=q.getUint8(c);break;case 2:d=q.getInt16(c,!0);break;case 3:d=q.getUint16(c,!0);break;case 4:d=q.getInt32(c,!0);break;case 5:d=q.getUInt32(c,!0);break;case 6:d=q.getFloat32(c,!0);break;case 7:d=q.getFloat64(c,!0);break;default:throw"the decoder does not understand this pixel type";}return d}},m=function(d,c,t){this.val=d;this.left=c;this.right=t};return{decode:function(l,
c){c=c||{};var t=c.noDataValue,q=0,p={};p.ptr=c.inputOffset||0;p.pixels={};if(d.readHeaderInfo(l,p)){var q=p.headerInfo,h=q.fileVersion,n=d.getDataTypeArray(q.imageType);d.readMask(l,p);q.numValidPixel===q.width*q.height||p.pixels.resultMask||(p.pixels.resultMask=c.maskData);var k=q.width*q.height;p.pixels.resultPixels=new n(k*q.numDims);p.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==q.numValidPixel)if(q.zMax===q.zMin)d.constructConstantSurface(p);else if(4<=
h&&d.checkMinMaxRanges(l,p))d.constructConstantSurface(p);else{var a=new DataView(l,p.ptr,2),g=a.getUint8(0);p.ptr++;if(g)d.readDataOneSweep(l,p,n);else if(1<h&&1>=q.imageType&&1E-5>Math.abs(q.maxZError-.5)){a=a.getUint8(1);p.ptr++;p.encodeMode=a;if(2<a||4>h&&1<a)throw"Invalid Huffman flag "+a;a?d.readHuffman(l,p,n):d.readTiles(l,p,n)}else d.readTiles(l,p,n)}p.eofOffset=p.ptr;c.inputOffset?(l=p.headerInfo.blobSize+c.inputOffset-p.ptr,1<=Math.abs(l)&&(p.eofOffset=c.inputOffset+p.headerInfo.blobSize)):
(l=p.headerInfo.blobSize-p.ptr,1<=Math.abs(l)&&(p.eofOffset=p.headerInfo.blobSize));l={width:q.width,height:q.height,pixelData:p.pixels.resultPixels,minValue:q.zMin,maxValue:q.zMax,validPixelCount:q.numValidPixel,dimCount:q.numDims,dimStats:{minValues:q.minValues,maxValues:q.maxValues},maskData:p.pixels.resultMask};if(p.pixels.resultMask&&d.isValidPixelValue(q.imageType,t)){h=p.pixels.resultMask;for(q=0;q<k;q++)h[q]||(l.pixelData[q]=t);l.noDataValue=t}p.noDataValue=t;c.returnFileInfo&&(l.fileInfo=
d.formatFileInfo(p));return l}},getBandCount:function(l){for(var c=0,t=0,q={ptr:0,pixels:{}};t<l.byteLength-58;)d.readHeaderInfo(l,q),t+=q.headerInfo.blobSize,c++,q.ptr=t;return c}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(r,d,m,l,c,t){r=r(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour",
"esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(c){d.mixin(this,c);this.isDataUV=c&&c.isDataUV?c.isDataUV:!1;this.computeMagnitudeAndDirection=d.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(c,d){this.inputUnit=c;this.outputUnit=d;this.unitConversionFactor=1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var c=t.indexOf(this.speedUnits,this.inputUnit),d=t.indexOf(this.speedUnits,this.outputUnit);
if(this.inputUnit&&this.outputUnit&&0<=c&&0<=d){var h=[1,.277778,.514444,.3048,.44704,0];this.unitConversionFactor=h[c]/h[d]}},computeMagnitudeAndDirection:function(d){if(!c.isDefined(d))throw"Could not compute magnitude and direction. No pixel data is available.";var p=d.pixelBlock;if(!c.isDefined(p)||2!==p.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";var h=d.extent,n=(h.xmax-h.xmin)/p.width,k=(h.ymax-h.ymin)/p.height,a=h.xmin+n/2,h=h.ymax-
k/2;p.statistics[0].minValue=0;p.statistics[0].maxValue=0;var g=180/Math.PI,f=[],b=0,e=0,u=0,l=!c.isDefined(p.mask),q,t,m,r,E,y,C,F;E=C=Infinity;y=F=-Infinity;for(b=0;b<p.height;b++)for(e=0;e<p.width;e++,u++)if(f.push([a+n*e,h-k*b]),l||p.mask[u])m=q=p.pixels[0][u]*this.unitConversionFactor,r=t=p.pixels[1][u],this.isDataUV&&(m=Math.sqrt(q*q+t*t),r=90-g*Math.atan2(t,q),p.pixels[0][u]=m*this.unitConversionFactor,p.pixels[1][u]=r),m>y&&(y=m),m<E&&(E=m),r>F&&(F=r),r<C&&(C=r);p.statistics[0].maxValue=y;
p.statistics[0].minValue=E;p.statistics[1].maxValue=F;p.statistics[1].minValue=C;d.locations=f;return d}});m("extend-esri")&&d.setObject("layers.pixelFilters.VectorFieldPixelFilter",r,l);return r})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(r,d,m,l){var c;return d(null,{constructor:function(c){this.ctx=c.ctx;this._loadRasterFormatModule()},decode:function(c,d){if(!d.width||!d.height)throw"Native decoding requires the image format, width and height";
var p=new m,h,n=new Uint8Array(c);c=this._getFormat(c);if("error"===c)throw"invalid format";"jpeg"===c&&(h=this._getMask(n,d));var k="",a,g;for(a=0;a<n.length;a+=65535)g=n.subarray(a,a+65535>n.length-1?n.length-1:a+65535),k+=String.fromCharCode.apply(null,g);var n="data:image/"+c+";base64,"+window.btoa(k),f=new Image,b;f.src=n;var e=this;f.onload=function(){e.ctx.clearRect(0,0,d.width,d.height);e.ctx.drawImage(f,0,0);var g=e.ctx.getImageData(0,0,f.width,f.height);b=g.data;if(h)for(a=0;a<h.length;a++)b[4*
a+3]=h[a]?255:0;e.ctx.putImageData(g,0,0);p.resolve(null)};f.onerror=function(){p.reject("cannot load image")};return p},_getFormat:function(c){c=new Uint8Array(c,0,10);var d="error";255===c[0]&&216===c[1]?d="jpeg":137===c[0]&&80===c[1]&&78===c[2]&&71===c[3]&&(d="png");return d},_getMask:function(d,l){var p;try{if(!c)throw"The zlib decoder module is not loaded.";var h=0,n=0,k=Math.round(d.length/2);1===k%2&&(k+=1);for(var a=d.length-2,h=k;h<a&&(255!==d[h]||217!==d[h+1]);h++);k=h+=2;if(k<d.length-
1){var g=(new c(d.subarray(k))).getBytes();p=new Uint8Array(l.width*l.height);for(h=d=0;h<g.length;h++)for(n=7;0<=n;n--)p[d++]=g[h]>>n&1}}catch(f){}return p},_loadRasterFormatModule:function(){10>l("ie")||r(["./Zlib"],function(d){c=d})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(r,d,m,l,c,t,q,p){r=r(q,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",
constructor:function(c){this._url.path+="/identify";this._handler=d.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(c,d,k,a,g){try{var f=new p(c);this._successHandler([f],"onComplete",k,g)}catch(b){this._errorHandler(b,a,g)}},execute:function(h,n,k,a){var g=a.assembly;h=this._encode(d.mixin({},this._url.query,{f:"json"},h.toJson(g&&g[0])));var f=this._handler,b=this._errorHandler;return c({url:this._url.path,content:h,callbackParamName:"callback",
load:function(b,g){f(b,g,n,k,a.dfd)},error:function(e){b(e,k,a.dfd)}})},onComplete:function(){}});t._createWrappers(r);m("extend-esri")&&d.setObject("tasks.ImageServiceIdentifyTask",r,l);return r})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(r,d,m,l,c,t){r=r(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(d){d.catalogItems&&(this.catalogItems=
new t(d.catalogItems));d.location&&(this.location=c.fromJson(d.location));this.catalogItemVisibilities=d.catalogItemVisibilities;this.name=d.name;this.objectId=d.objectId;this.value=d.value;this.processedValues=d.processedValues;this.properties=d.properties}});m("extend-esri")&&d.setObject("tasks.ImageServiceIdentifyResult",r,l);return r})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(r,d,m,l,c,t,q,p){r=r(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,maxItemCount:null,returnPixelValues:!0,toJson:function(c){var d=c&&c.geometry||this.geometry;c={geometry:d,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?m.toJson(this.mosaicRule.toJson()):
null,renderingRule:this.renderingRule?m.toJson(this.renderingRule.toJson()):null};d&&(c.geometryType=p.getJsonType(d));d=this.timeExtent;c.time=d?d.toJson().join(","):null;q.isDefined(this.pixelSizeX)&&q.isDefined(this.pixelSizeY)?c.pixelSize=m.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(c.pixelSize=this.pixelSize?m.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(c.renderingRules=m.toJson(l.map(this.renderingRules,function(c){return c.toJson()})));
q.isDefined(this.returnPixelValues)&&(c.returnPixelValues=this.returnPixelValues);q.isDefined(this.maxItemCount)&&(c.maxItemCount=this.maxItemCount);return c}});c("extend-esri")&&d.setObject("tasks.ImageServiceIdentifyParameters",r,t);return r})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare","dojo/_base/lang","../PixelBlock"],function(r,d,m){var l;return r(null,{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,
maxPercent:.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(c){this.stretchType=c.stretchType||c.StretchType||this.stretchType;this.min=c.min||c.Min||this.min;this.max=c.max||c.Max||this.max;this.numberOfStandardDeviations=c.numberOfStandardDeviations||c.NumberOfStandardDeviations||this.numberOfStandardDeviations;this.statistics=c.statistics||c.Statistics||this.statistics;this.dra=c.dra||c.DRA||c.dRA||this.dra;this.minPercent=c.minPercent||c.MinPercent||
this.minPercent;this.maxPercent=c.maxPercent||c.MaxPercent||this.maxPercent;this.useGamma=c.useGamma||c.UseGamma||this.useGamma;this.gamma=c.gamma||c.Gamma||this.gamma;this.computeGamma=c.computeGamma||c.ComputeGamma||this.computeGamma;this.raster=c.raster||c.Raster||this.raster;this.outputPixelType=c.outputPixelType||c.OutputPixelType||this.outputPixelType;this.raster=c.raster||c.Raster||this.raster;l=this},filter:function(c){if(null!==c&&null!==c.pixelBlock&&null!==c.pixelBlock.pixels){var d=c.pixelBlock,
q=d.pixels,p=d.width*d.height,h=q.length,n;(n=6===l.stretchType||3===l.stretchType&&l.dra)&&l._calculateStatisticsHistograms(c);if(l.dra)if(n)l._statistics=d.statistics,l._histograms=d.histograms;else{var k=d.statistics;l._statistics=[];for(n=0;n<h;n++)l._statistics[n]=[k[n].minValue,k[n].maxValue,0,0]}else l._statistics=l.statistics,l._histograms=l.histograms;l.computeGamma&&(l.gamma=l._computeGammaValues(d.pixelType),l.useGamma=!0);l._createLUT(c);if(void 0===l.LUT||null===l.LUT)return l._filterNoLUT(c);
var k=l.LUT,a=l.LUTOffset,g,f;for(n=0;n<h;n++)for(f=k[n],d=0;d<p;d++)g=q[n][d],q[n][d]=f[g-a];c.pixelBlock.pixelType="U8";return c}},_calculateStatisticsHistograms:function(c){c=c.pixelBlock;var l=c.pixelType,q=c.pixels,p=c.mask,h=q.length,n,k,a,g,f=function(a){this.min=-.5;this.max=255.5;this.size=256;d.mixin(this,a);this.counts=this.counts||new Uint32Array(this.size)},b=[],e,u,m,x,r,z;for(a=0;a<h;a++){e=new f;u=e.counts;x=q[a];if("U8"===l)if(p)for(g=0;g<c.width*c.height;g++)p[g]&&u[x[g]]++;else for(g=
0;g<c.width*c.height;g++)u[x[g]]++;else{n=c.statistics[a].minValue;k=c.statistics[a].maxValue;e.min=n;e.max=k;k=(k-n)/256;m=new Uint32Array(257);if(p)for(g=0;g<c.width*c.height;g++)p[g]&&m[Math.floor((x[g]-n)/k)]++;else for(g=0;g<c.width*c.height;g++)m[Math.floor((x[g]-n)/k)]++;for(g=0;255>g;g++)u[g]=m[g];u[255]=m[255]+m[256]}b.push(e);x=[];n=c.statistics[a].minValue;k=c.statistics[a].maxValue;for(g=z=r=m=0;g<e.size;g++)m+=u[g],r+=g*u[g];r/=m;for(g=0;g<e.size;g++)z+=u[g]*Math.pow(g-r,2);u=Math.sqrt(z/
(m-1));g=(r+.5)*(e.max-e.min)/e.size+e.min;e=u*(e.max-e.min)/e.size;x.push(n);x.push(k);x.push(g);x.push(e);c.statistics[a]=x}c.histograms=b},_getCutOffPoints:function(c){c=c.pixelBlock.pixels.length;var d=[],q=[],p,h,n,k,a,g;switch(l.stretchType){case 5:for(a=0;a<c;a++)d[a]=l._statistics[a][0],q[a]=l._statistics[a][1];break;case 3:for(a=0;a<c;a++)d[a]=l._statistics[a][2]-l.numberOfStandardDeviations*l._statistics[a][3],q[a]=l._statistics[a][2]+l.numberOfStandardDeviations*l._statistics[a][3],d[a]<
l._statistics[a][0]&&(d[a]=l._statistics[a][0]),q[a]>l._statistics[a][1]&&(q[a]=l._statistics[a][1]);break;case 6:for(a=0;a<c;a++){p=l._histograms[a];k=new Uint32Array(p.size);n=p.counts;for(g=h=0;g<p.size;g++)h+=n[g],k[g]=h;n=l.minPercent*h/100;for(g=1;g<p.size;g++)if(k[g]>n){d[a]=p.min+(p.max-p.min)/p.size*(g-.5);break}n=(1-l.maxPercent/100)*h;for(g=p.size-2;0<=g;g--)if(k[g]<n){q[a]=p.min+(p.max-p.min)/p.size*(g+.5);break}}break;default:for(a=0;a<c;a++)d[a]=0,q[a]=255}return{minCutOff:d,maxCutOff:q}},
_createLUT:function(c){var d=c.pixelBlock,q=d.pixelType;if("U8"===q||"U16"===q||"S8"===q||"S16"===q){if(l._LUTSignature&&(q=l._computeLutSignature(),q.length===l._LUTSignature.length&&!q.some(function(a,b){return a!==l._LUTSignature[b]})))return;var q=d.pixels.length,p=[],h=[],n=[],k,a,g,f=l.max,b=l.min,e=l.gamma,u=f-b,m=l._getCutOffPoints(c);c=m.minCutOff;var m=m.maxCutOff,x=0,r=256,z;"S8"===d.pixelType?x=-127:"S16"===d.pixelType&&(x=-32767);if("U16"===d.pixelType||"S16"===d.pixelType)r=65536;for(d=
0;d<q;d++)p[d]=m[d]-c[d];if(l.useGamma&&null!==e&&e.length===q)for(d=0;d<q;d++)n[d]=1<e[d]?2<e[d]?6.5+Math.pow(e[d]-2,2.5):6.5+100*Math.pow(2-e[d],4):1;if(l.useGamma)for(var A,d=0;d<q;d++){z=[];for(k=0;k<r;k++)a=k+x,A=(a-c[d])/p[d],g=1,1<e[d]&&(g-=Math.pow(1/u,A*n[d])),a<m[d]&&a>c[d]?z[k]=Math.floor(g*u*Math.pow(A,1/e[d]))+b:a>m[d]?z[k]=f:a<c[d]&&(z[k]=b);h[d]=z}else for(d=0;d<q;d++){z=[];for(k=0;k<r;k++)a=k+x,z[k]=a<c[d]?b:a>m[d]?f:Math.floor((a-c[d])/p[d]*u)+b;h[d]=z}l.LUT=h;l.LUTOffset=x;l._LUTSignature=
l._computeLutSignature()}},_computeLutSignature:function(){var c=[],d,q;c.push(l.stretchType);c.push(l.min);c.push(l.max);c.push(l.numberOfStandardDeviations);if(l._statistics)for(d=0;d<l._statistics.length;d++)for(q=0;q<l._statistics[d].length;q++)c.push(l._statistics[d][q]);c.push(l.dra?1:0);c.push(l.minPercent);c.push(l.maxPercent);if(l.gamma)for(d=0;d<l._statistics.length;d++)c.push(l.gamma[d]);c.push(l.useGamma?1:0);return c},_filterNoLUT:function(c){if(null!==c&&null!==c.pixelBlock&&null!==
c.pixelBlock.pixels){var d=c.pixelBlock,q=d.pixels,p=d.mask,d=d.width*d.height,h=q.length,n=[],k=[],a,g,f,b,e,u=l.max,m=l.min,x=l.gamma,r=u-m;a=l._getCutOffPoints(c);var z=a.minCutOff,A=a.maxCutOff;for(a=0;a<h;a++)n[a]=A[a]-z[a];if(l.useGamma&&null!==x&&x.length===h)for(a=0;a<h;a++)k[a]=1<x[a]?2<x[a]?6.5+Math.pow(x[a]-2,2.5):6.5+100*Math.pow(2-x[a],4):1;if(l.useGamma)if(void 0!==p&&null!==p)for(g=0;g<d;g++){if(p[g])for(a=0;a<h;a++)f=q[a][g],e=(f-z[a])/n[a],b=1,1<x[a]&&(b-=Math.pow(1/r,e*k[a])),f<
A[a]&&f>z[a]?q[a][g]=Math.floor(b*r*Math.pow(e,1/x[a]))+m:f>A[a]?q[a][g]=u:f<z[a]&&(q[a][g]=m)}else for(g=0;g<d;g++)for(a=0;a<h;a++)f=q[a][g],e=(f-z[a])/n[a],b=1,1<x[a]&&(b-=Math.pow(1/r,e*k[a])),f<A[a]&&f>z[a]?q[a][g]=Math.floor(b*r*Math.pow(e,1/x[a]))+m:f>A[a]?q[a][g]=u:f<z[a]&&(q[a][g]=m);else if(void 0!==p&&null!==p)for(g=0;g<d;g++){if(p[g])for(a=0;a<h;a++)f=q[a][g],f<A[a]&&f>z[a]?q[a][g]=Math.floor((f-z[a])/n[a]*r)+m:f>A[a]?q[a][g]=u:f<z[a]&&(q[a][g]=m)}else for(g=0;g<d;g++)for(a=0;a<h;a++)f=
q[a][g],f<A[a]&&f>z[a]?q[a][g]=Math.floor((f-z[a])/n[a]*r)+m:f>A[a]?q[a][g]=u:f<z[a]&&(q[a][g]=m);c.pixelBlock.pixelType="U8";return c}},_computeGammaValues:function(c){var d=this._statistics.length,l,p=[],h;for(l=0;l<d;l++)h=this._statistics[l][2],"U8"!==c&&(h=255*(h-this._statistics[l][0])/(this._statistics[l][1]-this._statistics[l][0])),p.push(this._computeGammaValue(h));return p},_computeGammaValue:function(c){if(0!==c&&!(255<c||0>c)){var d=0;0<c&&150!=c&&255>c&&(d=150>=c?45*Math.cos(.01047*c):
17*Math.sin(.021*c));d=Math.log((c+d)/255);if(0!==d&&(c=Math.log(c/255)/d,!isNaN(c)))return Math.min(9.9,Math.max(.01,c))}}})})},"esri/layers/StreamLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/_base/lang dojo/Deferred dojo/has dojo/io-query dojo/on dojo/aspect ../kernel ../request ../graphic ./FeatureLayer ./StreamMode ./StreamTrackManager ../geometry/jsonUtils ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../renderers/SimpleRenderer ./PurgeOptions".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z,A){r=r([f],{declaredClass:"esri.layers.StreamLayer",_preventInit:!0,constructor:function(e,g){g=g||{};g.mode&&g.mode!==f.MODE_STREAM||(this._isStream=!0,this.currentMode=this.mode=f.MODE_STREAM,this._mode=new b(this));this.purgeOptions=new A(this,g.purgeOptions||{});this.purgeInterval=g.purgeInterval||0;this._reconnectAttempts=0;this.maxReconnectAttempts=10;this.socket=this._reconnectTimeoutId=null;this._keepLatestQueried=!1;this._keepLatestUrl=null;
this._relatedQueried=!1;this._joinField=this._relatedUrl=null;this._refreshing=!1;this._attemptReconnect=c.hitch(this,this._attemptReconnect);this._purge=c.hitch(this,this._purge);this._processServiceJson=c.hitch(this,this._processServiceJson);if(c.isObject(e)&&e.layerDefinition)this._initFeatureLayer(e,g);else{var k=this;a({url:e,content:c.mixin({f:"json"}),callbackParamName:"callback"}).then(function(a){k._processServiceJson(a,g)},function(a){k._errorHandler(a)})}},_processServiceJson:function(b,
e){var f=this;b.relatedFeatures&&b.relatedFeatures.featuresUrl&&b.relatedFeatures.joinField?(this._relatedUrl=b.relatedFeatures.featuresUrl,this.objectIdField=this._joinField=b.relatedFeatures.joinField,a({url:this._relatedUrl,content:{f:"json"},callbackParamName:"callback"}).then(function(a){a=a.fields||[];var g=m.map(b.fields,function(a){return a.name.toLowerCase()});m.forEach(a,function(a){-1===m.indexOf(g,a.name.toLowerCase())&&b.fields.push(a)});e.resourceInfo=b;f._initFeatureLayer(f._url,e)},
function(a){f.onError({error:a})})):(e.resourceInfo=b,this._initFeatureLayer(this._url,e))},_initLayer:function(a,b){this.inherited(arguments);if(a){var e;if(a.layerDefinition)this.purgeOptions=new A(this,this._params.purgeOptions||{}),this.socketUrl=this._params.socketUrl||a.layerDefinition.socketUrl||void 0;else{if(this._params.socketUrl)this.socketUrl=this._params.socketUrl;else{var f=this._getWebsocketConnectionInfo(a),g=f.urls;g&&g.length?(this._socketUrls=g,this.socketUrl=g[0],this.socketDirection=
"broadcast"===this._params.socketDirection?"broadcast":"subscribe",this.socketUrl+="/"+this.socketDirection,this._websocketToken=f.token,g.length>this.maxReconnectAttempts&&(this.maxReconnectAttempts=g.length)):(this.socketUrl=void 0,f="No web socket urls were retrieved from the Stream Service. Layer will not attempt to connect.","https:"===location.protocol&&(f+=" An insecure web socket connection cannot be made from a secure web page."),this.onError(Error(f)))}if(this._params.filter)try{this._filter=
e=this._makeFilter(this._params.filter)}catch(G){this.onError(Error("Error trying to create filter object: "+G+". Layer will not have filter applied")),this._filter=null}if(this._params.geometryDefinition||this._outFields||this._defnExpr){e=e||{};e.geometry=this._params.geometryDefinition;e.outFields=this._outFields;e.where=this._defnExpr;try{this._filter=e=this._makeFilter(e)}catch(G){this.onError(Error("Error trying to create filter object: "+G+". Layer will not have filter applied")),this._filter=
null}}}this.maximumTrackPoints=this._params.maximumTrackPoints||0===this._params.maximumTrackPoints?this._params.maximumTrackPoints:1;(this._params.refreshRate||0===this._params.refreshRate)&&this._mode&&this._mode._setRefreshRate&&this._mode._setRefreshRate(this._params.refreshRate);this._keepLatestUrl=a.keepLatestArchive?a.keepLatestArchive.featuresUrl:null;a.relatedFeatures&&a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField&&(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=
this._joinField=a.relatedFeatures.joinField);this.objectIdField||this._makeObjectIdField();this._map&&this.socketUrl&&!this._connected&&this.connect()}},_isWebGLCompatible:function(){return!1},_setMap:function(a){var b=this.inherited(arguments),f=this._getRenderer();this.timeInfo&&(this._trackIdField||f&&(f.latestObservationRenderer||f.trackRenderer))&&(this._trackManager=new e(this),this._trackManager.initialize(a));this.socketUrl&&!this._connected&&this._map&&this.connect();return b},_unsetMap:function(a,
b){m.forEach(this._connects,d.disconnect);(this._connected||this._reconnecting||this.socket)&&this.disconnect();this._togglePurgeT();this.inherited(arguments);this._map=null},_suspend:function(){this._togglePurgeT();this.inherited(arguments)},_resume:function(){this.inherited(arguments);this._togglePurgeT(!0)},clear:function(){try{this._mode&&this._mode._clearDrawBuffer&&this._mode._clearDrawBuffer(),this._mode&&this._mode._clearTimeBin&&this._mode._clearTimeBin(),this._mode&&this._mode._clearFeatureMap&&
this._mode._clearFeatureMap(),this._trackManager&&this._trackManager.clearTracks()}catch(E){}this.inherited(arguments);this._trackManager&&this._trackManager.createTracklineContainer()},redraw:function(){this._mode&&this._mode._flushDrawBuffer&&this._mode._flushDrawBuffer();this.inherited(arguments)},setDefinitionExpression:function(a){this.setFilter({where:a})},getDefinitionExpression:function(){var a;this._filter&&(a=this._filter.where);return a},destroy:function(){this.disconnect();this.inherited(arguments)},
onResume:function(a){this.inherited(arguments)},setGeometryDefinition:function(a){this.setFilter({geometry:a})},getGeometryDefinition:function(){var a;this._filter&&(a=this._filter.geometry);return a},connect:function(a){var b=new t,e={},f=this._filter,g,c,k=this.socketUrl,d;try{this._connected||this._connecting?b.reject(Error("Cannot start new connection process. Layer is connecting.")):(this._connecting=!0,this._getRelatedFeatures().then(function(){return this._getKeepLatestFeatures()}.bind(this)).then(function(){this._websocketToken&&
(e.token=this._websocketToken);this._map&&this._map.spatialReference&&this.spatialReference&&this._map.spatialReference.wkid!==this.spatialReference.wkid&&(e.outSR=this._map.spatialReference.wkid);if(f)for(c in f)null!==f[c]&&(g="geometry"===c?JSON.stringify(f[c]):f[c],e[c]=g);k+="?"+p.objectToQuery(e);d=this._createConnection(k,a);b.resolve(d)}.bind(this)).otherwise(function(a){b.reject(a)}))}catch(J){a&&(a(J,!1),b.reject(J)),this.onConnectionError({error:J})}return b.promise},disconnect:function(a){var b=
this._refreshing?"Disconnecting as part of layer refresh cycle":"Connection closed from client",e=this._refreshing?!0:!1;this._reconnectTimeoutId&&clearTimeout(this._reconnectTimeoutId);this._refreshing=this._reconnecting=this._connecting=this._connected=!1;this.socket&&this.socket.close();this.onDisconnect({willReconnect:e,message:b});a&&a(null,!0)},setFilter:function(a){var b,e;if(this._collection)return this.onError("Filter can only be set when the source of the layer is a Stream Service"),!1;
try{if(void 0!==a.outFields)return e=Error("Outfields property cannot be changed after layer is created"),this.onFilterChange({filter:this.getFilter(),error:e}),!1;b=this._makeFilter(a)}catch(F){return e=Error(F),this.onFilterChange({filter:this.getFilter(),error:e}),!1}if(this.socket)a={filter:b},this.socket.send(JSON.stringify(a));else h.once(this,"connect",function(a){this.setFilter(b)});return!0},getFilter:function(){var a=this._filter,b={},e=["geometry","outFields","where"];a&&m.forEach(e,function(e){var f=
a[e];f&&("geometry"===e?f=u.fromJson(f):"outFields"===e&&(f=f.split(",")),b[e]=f)});return b},setMaximumTrackPoints:function(a){if(!a&&0!==a)return!1;this.maximumTrackPoints=a;this._mode.propertyChangeHandler(3)},getUniqueValues:function(a){var b,e={},f=[];b=this._getField(a,!0);if(!b)return f;a=b.name;m.forEach(this.graphics||[],function(b){b=(b.attributes||{})[a];void 0===b||e[b]||(e[b]=1,f.push(b))});f.sort(function(a,b){return a<b?-1:a>b?1:0});return f},getLatestObservations:function(){var a=
[];return a=this._trackManager?this._trackManager.getLatestObservations():this.graphics},setPurgeInterval:function(a){var b=this.purgeInterval;this.purgeInterval=a;this._togglePurgeT();a&&this._togglePurgeT(!0);if(b!==a)this.onPurgeIntervalChange();return this},_togglePurgeT:function(a){if(a&&this.purgeInterval){var b=this;clearTimeout(this._purgeT);this._mode&&this._mode._flushDrawBuffer&&(this._purgeT=setTimeout(function(){b.updating||b.suspended||(b._mode._flushDrawBuffer(),b._togglePurgeT(!0))},
6E4*this.purgeInterval))}else this._purgeT&&(clearTimeout(this._purgeT),this._refreshT=null)},onMessage:function(){},onConnect:function(){},onDisconnect:function(){},onFilterChange:function(){},onAttemptReconnect:function(){},onConnectionError:function(){},onPurgeIntervalChange:function(){},_createConnection:function(a,b){var e=this,f=new WebSocket(a);f.onopen=function(){e.socket=f;e._connected=!0;e._connecting=!1;e._reconnecting=!1;e._reconnectAttempts=0;e._bind();e.onConnect();b&&b(null,!0)};f.onclose=
function(a){var b,f=!0,g=e._connected,c=null;if(e._connected||e._reconnecting){if(a.code)if(b="Connection failed: ",1001===a.code)b+=a.reason||"Service is going away.",f=!1;else if(4400===a.code)b+=a.reason||"Invalid url parameters. Check filter properties.",f=!1;else if(4404===a.code)b+="Service not found",f=!1;else if(4401===a.code||4403===a.code)b+="Not authorized",f=!1;f&&(e._reconnectAttempts+=1,e._reconnectAttempts>e.maxReconnectAttempts&&(b="Maximum reconnect attempts exceeded",f=!1,g=!0));
e._connected=!1;g&&(b&&(c=Error(b)),e.onDisconnect({error:c,willReconnect:f}));f?e._attemptReconnect():e.socket=null}else e.socket||(c=Error("Could not make connection to service"),e.onConnectionError({error:c})),e.socket=null,e._connected=!1};f.onerror=function(a){console.log("Socket error")};return f},_getKeepLatestFeatures:function(){var a=new t;this._map&&this._keepLatestUrl&&!this._keepLatestQueried&&this._mode._fetchArchive?this._mode._fetchArchive(this._keepLatestUrl).then(function(){a.resolve()}.bind(this)).otherwise(function(b){a.reject(b)}).always(function(){this._keepLatestQueried=
!0}.bind(this)):a.resolve();return a.promise},_getRelatedFeatures:function(){var a=new t;this._map&&this._relatedUrl&&!this._relatedQueried&&this._mode._fetchArchive?this._mode._fetchArchive(this._relatedUrl).then(function(){a.resolve()}.bind(this)).otherwise(function(b){a.reject(b)}).always(function(){this._relatedQueried=!0}.bind(this)):a.resolve();return a.promise},_purge:function(){var a,b=[],e;if(this.purgeOptions.displayCount&&this.graphics.length>this.purgeOptions.displayCount)for(a=0;a<this.graphics.length-
this.purgeOptions.displayCount;a++)e=this.graphics[a],b.push(e);0<b.length&&(this._mode._removeFeatures(b),this._trackManager&&this._trackManager.removeFeatures(b))},_bind:function(){var a=this;this.socket.onmessage=function(b){a._onMessage(JSON.parse(b.data))}},_onMessage:function(a){var b=this;this.onMessage(a);var e={create:function(a){b._create(a)},update:function(a){b._update(a)},"delete":function(a){b._delete(a)}};if(a.type)e[a.type](a.feature);else a.hasOwnProperty("filter")?b._handleFilterMessage(a):
this._create(a)},_create:function(a){function b(a){if(!e._featureHasOID(a,f)){if(!a.geometry)return!1;a.attributes=a.attributes||{};a.attributes[f]=e._nextId++}a=a.declaredClass?a:new g(a);e._mode.drawFeature(a)}var e=this,f=e.objectIdField;a.length?a.forEach(function(a){a&&b(a)}):a&&b(a)},_delete:function(a){var b=this,e=a[b.objectIdField]||a.attributes[b.objectIdField],f=!1;this.graphics.forEach(function(a){a.attributes[b.objectIdField]==e&&(f=a)});f&&this.remove(f)},_update:function(a){var b=this,
e=!1;this.graphics.forEach(function(f){f.attributes[b.objectIdField]==a.attributes[b.objectIdField]&&(e=f)});e&&(a.attributes&&e.setAttributes(a.attributes),a.geometry&&e.setGeometry(u.fromJson(a.geometry)))},_makeFilter:function(a){var b,e=null;a=a||{};if(void 0!==a.geometry)if(e=e||{},null===a.geometry)e.geometry=null;else{b="string"===typeof a.geometry?u.fromJson(JSON.parse(a.geometry)):a.geometry.declaredClass?a.geometry:u.fromJson(a.geometry);if(!b||"point"===b.type)throw"Query object contains invalid geometry";
"extent"!==b.type&&(b=b.getExtent());if(!b||0===b.getHeight()&&0===b.getWidth())throw"Invalid filter geometry: Extent cannot have a height and width of 0";e.spatialRel="esriSpatialRelIntersects";e.geometryType="esriGeometryEnvelope";e.geometry=b.toJson()}void 0!==a.where&&(e=e||{},e.where=a.where);if(void 0!==a.outFields&&(e=e||{},a="string"===typeof a.outFields?"*"===a.outFields?null:a.outFields.replace(/,\s+/g,",").split(","):null===a.outFields?null:a.outFields,a=this._makeOutFields(a))){if(a.errors&&
0<a.errors.length)throw"Invalid filter outFields. "+a.errors.join(",");e.outFields=a.fields?a.fields.join(","):null}return e},_makeOutFields:function(a){var b=this,e=[],f=[],g={fields:null};if(!a||0===a.length)return g;m.forEach(a,function(a){if("*"===a)return g;var c=b._getField(a,!0);c?e.push(c.name):f.push("Field named "+a+" not found in schema.")});a=b._getOutFields();m.forEach(a,function(a){b._getField(a)&&-1===m.indexOf(e,a)&&e.push(a)});g.fields=e;g.errors=f;return g},_handleFilterMessage:function(a){a.error?
(a=Error(a.error.join(",")),this.onFilterChange({filter:this.getFilter(),error:a})):(a=a.filter,a.geometry&&"string"===typeof a.geometry&&(a.geometry=JSON.parse(a.geometry)),this._filter=a,this.onFilterChange({filter:this.getFilter()}))},_getWebsocketConnectionInfo:function(a){var b={urls:[]},e,f=[],g=[],c,k,d;a.streamUrls&&m.forEach(a.streamUrls,function(a){"ws"===a.transport&&(e=a.urls,b.token=a.token)});if(!e)return b;m.forEach(e,function(a){0===a.lastIndexOf("wss",0)?g.push(a):f.push(a)});a="https:"===
location.protocol||0===this.url.lastIndexOf("https:",0)?g:0===f.length?g:f;if(1<a.length)for(c=0;c<a.length-1;c++)k=c+Math.floor(Math.random()*(a.length-c)),d=a[k],a[k]=a[c],a[c]=d;b.urls=a;return b},_attemptReconnect:function(){var a=this,b;this._reconnectTimeoutId=null;a._connected=!1;if(!a._socketUrls)return!1;if(!a._collection&&!a._reconnecting&&a.socket&&a.credential)return a._reconnecting=!0,a._getServiceConnectionMetadata(a._attemptReconnect),!1;a._reconnecting=!0;a.socket=null;if(a._reconnectAttempts>
a.maxReconnectAttempts)return a._reconnecting=!1;a.socketUrl=a._socketUrls[a._reconnectAttempts>a._socketUrls.length-1?a._reconnectAttempts%a._socketUrls.length:a._reconnectAttempts];a.socketUrl+="/"+a.socketDirection;b=a._randomIntFromInterval(0,1E3);this._reconnectTimeoutId=setTimeout(function(){a.onAttemptReconnect({count:a._reconnectAttempts,url:a.socketUrl});a.connect()},1E3*a._reconnectAttempts+b)},_getServiceConnectionMetadata:function(b){var e=this,f=e._url.path;b="function"===typeof b?b:
null;a({url:f,content:c.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(function(a){a=e._getWebsocketConnectionInfo(a);e._websocketToken=a.token;b&&b()},function(a){e.onError(Error(a))})},_setDefaultRenderer:function(){var a=this.geometryType,b=new l([5,112,176,.8]),e=new l([255,255,255]),e=new x(x.STYLE_SOLID,e,1),f;if("esriGeometryPoint"===a||"esriGeometryMultipoint"===a)f=new D(D.STYLE_CIRCLE,10,e,b);else if("esriGeometryPolyline"===a)f=new x(x.STYLE_SOLID,b,2);else if("esriGeometryPolygon"===
a||"esriGeometryEnvelope"===a)b=new l([5,112,176,.2]),e=new l([5,112,176,.8]),e=new x(x.STYLE_SOLID,e,1),f=new v(v.STYLE_SOLID,e,b);f&&this.setRenderer(new z(f))},_makeObjectIdField:function(){var a=1,b,e,f=[];if(!this.objectIdField){b=this.fields.length;for(e=0;e<b;e++)f.push(this.fields[e].name.toLowerCase());for(;-1!==m.indexOf(f,"objectid_"+a);)a+=1;this.objectIdField="objectid_"+a;this.fields.push({name:"objectid_"+a,type:"esriFieldTypeOID",alias:"objectid_"+a,nullable:!1})}},_featureHasOID:function(a,
b){return a.attributes&&(a.attributes[b]||0===a.attributes[b])},_randomIntFromInterval:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)}});q("extend-esri")&&c.setObject("layers.StreamLayer",r,k);return r})},"esri/layers/StreamTrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Point ../geometry/Polyline ./TrackManager".split(" "),function(r,d,m,l,c,t,q,p,h){r=r([h],{declaredClass:"esri.layers._StreamTrackManager",constructor:function(c){this.inherited(arguments);
var k=c.getMap().spatialReference;this.isWebMercator=k.isWebMercator();this.canWrap=k._isWrappable();this.wrapThreshold=this.isWebMercator?2.0037508342788905E7:180},initialize:function(c){this.inherited(arguments)},addFeatures:function(c,k){function a(a,b){var f,c,k;g[a]||(g[a]=[]);a=g[a];0<e&&(b.length>e&&b.splice(0,b.length-e),c=b.length+a.length,c>e&&(f=a.splice(0,c-e)));c=b.length;for(k=0;k<c;k+=1)a.push(b[k]);return{deletes:f,adds:b}}var g,f,b,e,d={},h={},n;if(k)return this.inherited(arguments),
d;g=this.trackMap;f=this.layer;b=f._trackIdField;e=f.maximumTrackPoints||0;m.forEach(c,function(a){var e=a.attributes[b];a.visible&&(h[e]||(h[e]=[]),h[e].push(a))});for(n in h)h.hasOwnProperty(n)&&(f=a(n,h[n]),d[n]=f);return d},removeFeatures:function(c){var k=[],a=this.layer.objectIdField,g=this.layer._trackIdField;c&&(m.forEach(c,function(f){var b,e,c,d;e=f.attributes[g];b=f.attributes[a];if(c=this.trackMap[e])for(f=0;f<c.length;f+=1)if(d=c[f],d.attributes[a]===b){this.trackMap[e].splice(f,1);-1===
m.indexOf(e)&&k.push(e);break}},this),0<c.length&&this.refreshTracks(k))},drawTracks:function(c){function k(c){var k=f[c],d=k&&1<k.length,h=a.trackLineMap[c];h&&!d&&(g.remove(h),delete a.trackLineMap[c],h=null);if(!d)return!1;for(var u,d=[],n=[],l,m=k.length,v=0;v<m;v++)if(l=k[v].geometry){l=l.normalize();var r=l.x,G=0,H=!1;u&&a.canWrap&&(G=r-u.x,Math.abs(G)>a.wrapThreshold&&(H=!0));H?(n.push([a.getWrappedX(r),l.y]),d.push(n.slice(0)),n=[[r,l.y]]):n.push([r,l.y]);u=new q(r,l.y,b)}1<n.length&&d.push(n);
k={};k[e]=c;if(d.length)if(h){for(var L=h.geometry;L.paths.length;)L.removePath(L.paths.length-1);d.forEach(function(a){L.addPath(a)});h.setGeometry(L)}else h=new t(new p({paths:d,spatialReference:b}),null,k),g.add(h),a.trackLineMap[c]=h}var a=this,g=this.container,f,b,e,d;if(g)if(f=this.trackMap,b=this.map.spatialReference,e=this.layer._trackIdField,c)m.forEach(c,function(a){k(a)});else for(d in f)f.hasOwnProperty(d)&&k(d)},refreshTracks:function(c){function k(b){var e,f;b=a[b]||[];e=b.length;for(f=
0;f<e;f++)g._repaint(b[f],null,!0)}var a=this.trackMap,g=this.layer,f;this.drawTracks(c);if(c)m.forEach(c,function(a){k(a)});else for(f in a)a.hasOwnProperty(f)&&k(f)},getLatestObservations:function(){var c,k,a=this.trackMap,g=[];for(c in a)a.hasOwnProperty(c)&&(k=a[c],g.push(k[k.length-1]));return g},destroy:function(){this.inherited(arguments);this.trackLineMap=null},getWrappedX:function(c){var k=this.isWebMercator,a=k?2.0037508342788905E7:180,k=k?-2.0037508342788905E7:-180;return(0<c?k:a)-((0<
c?a:k)-c)}});l("extend-esri")&&d.setObject("layers._StreamTrackManager",r,c);return r})},"esri/layers/PurgeOptions":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/has","../kernel"],function(r,d,m,l,c){r=r([m],{declaredClass:"esri.layers.PurgeOptions",constructor:function(c,d){this.parent=c;for(var p in d)this[p]=d[p]},_displayCountSetter:function(c){this.displayCount=c;this.parent.refresh()}});l("extend-esri")&&d.setObject("layers.PurgeOptions",r,c);return r})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),
function(r,d,m,l,c,t,q){r=r([t,q],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(c,d){this._initialize(c,d);this.useMapImage=d&&d.useMapImage||!1},refresh:function(c){if(c)this.inherited(arguments);else{var d=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=d}},setRenderer:function(c,d){this.renderer=c;this.onRendererChange();d||this.refresh(!0)},exportMapImage:function(p,h){var n=c.defaults.map;p=d.mixin({size:n.width+
","+n.height},this._params,p?p.toJson(this.normalization):{},{f:"json"});delete p._ts;this._exportMapImage(this._url.path+"/exportImage",p,h)}});m("extend-esri")&&d.setObject("layers.ArcGISImageServiceLayer",r,l);return r})},"esri/layers/ArcGISImageServiceVectorLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/sniff ../kernel ../lang ./GraphicsLayer ./ImageServiceLayerMixin ../renderers/VectorFieldRenderer ../geometry/Point ../geometry/Extent ../graphic dojox/gfx".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f){r=r([p,h],{declaredClass:"esri.layers.ArcGISImageServiceVectorLayer",constructor:function(a,e){this.symbolTileSize=e&&e.symbolTileSize?e.symbolTileSize:50;this._maxMag=this._minMag=null;var b=d.clone(this._params);delete b.imageServiceParameters;delete b.pixelFilter;delete b.rendererStyle;delete b.symbolTileSize;this._initialize(a,e);this.renderer||this.setVectorRendererStyle(e&&e.rendererStyle?e.rendererStyle:n.STYLE_SINGLE_ARROW);this.geometryType="esriGeometryPoint";
this.symbolTileSizeUnits="Pixels";d.mixin(this._params,b)},getField:function(a){return this._getField(a,!0)},setVectorRendererStyle:function(a){this.rendererStyle=a;this._updateVectorFieldRenderer();this.useDefaultRenderer=!0},setRenderer:function(){this.useDefaultRenderer=!1;this.inherited(arguments)},getFlowRepresentation:function(){return this._vectorFlowRepresentation},onResume:function(){this.inherited(arguments);this._toggleTime()},onSuspend:function(){this.inherited(arguments);this._toggleTime()},
_refresh:function(a){if(10>c("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else if(this._map){this.setImageFormat("LERC",!0);a=this.fullExtent&&this.fullExtent.xmin;var b=this.fullExtent&&this.fullExtent.ymax,f=d.clone(this._map.extent),g=1/this.symbolTileSize*this._map.width,g=g?Math.ceil(g):50,k=1/this.symbolTileSize*this._map.height,k=k?Math.ceil(k):Math.ceil((f.ymax-f.ymin)/(f.xmax-f.xmin)*g),h=(f.xmax-f.xmin)/g,n=(f.ymax-f.ymin)/k;f.xmin=
a+Math.floor((f.xmin-a)/h)*h;f.xmax=a+Math.ceil((f.xmax-a)/h)*h;f.ymin=b+Math.floor((f.ymin-b)/n)*n;f.ymax=b+Math.ceil((f.ymax-b)/n)*n;this._requestData(f,g,k)}},_drawPixelData:function(){this.clear();if(this.pixelData){var b=this.pixelData.pixelBlock,e=this.pixelData.extent,c=this.pixelData.locations,d=q.isDefined(b.mask)&&0<b.mask.length;if(b&&e&&c){if(this.useDefaultRenderer&&this.renderer&&(!q.isDefined(this._minMag)||!q.isDefined(this._maxMag))){var h=this._getServiceMinMaxStats();h?(this._minMag=
h.min,this._maxMag=h.max):(this._minMag=b.statistics[0].minValue,this._maxMag=b.statistics[0].maxValue);var h={type:"sizeInfo",minSize:f.px2pt(.2*this.symbolTileSize),maxSize:f.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},n=[];n.push(h);n.push({type:"colorInfo"});this.renderer.setVisualVariables(n)}for(var p=n=h=0,m,t=e.spatialReference?e.spatialReference._getInfo():null,h=0;h<b.height;h++)for(n=0;n<b.width;n++,p++)if(m=c[p],(!d||b.mask[p])&&m&&2===m.length){m=
new k(m[0],m[1],e.spatialReference);t&&(m.x=a.prototype._normalizeX(m.x,t).x);var y={Magnitude:b.pixels[0][p],Direction:b.pixels[1][p],Location:l.toJson(m.toJson())};m=new g(m,null,y);this.add(m)}}}},_getServiceMinMaxStats:function(){if(!q.isDefined(this.minValues)||!q.isDefined(this.maxValues)||2>this.minValues.length||2>this.maxValues.length)return null;var a=this.minValues[0],e=this.maxValues[0],f=this.minValues[1],g=this.maxValues[1];if(this.pixelFilter&&a&&e&&f&&g){var c=[];c.push([a,e]);c.push([f,
g]);f=this._createPixelData(c);this.pixelFilter(f);f&&f.pixelBlock&&f.pixelBlock.pixels&&0<f.pixelBlock.pixels.length&&(a=f.pixelBlock.pixels[0][0],e=f.pixelBlock.pixels[0][1])}return a&&e?{min:a,max:e}:null},_updateVectorFieldRenderer:function(){var a={type:"sizeInfo",minSize:f.px2pt(.2*this.symbolTileSize),maxSize:f.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},e=[];e.push(a);a=new n({style:this.rendererStyle,visualVariables:e,flowRepresentation:this._vectorFlowRepresentation});
this.setRenderer(a)},_getField:function(a,e){if(q.isDefined(a))return e&&(a=a.toLowerCase()),"magnitude"!==a&&"direction"!==a?null:{name:a,alias:a,domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"}},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_setFlowRepresentation:function(a){a&&this.renderer&&q.isDefined(a.FlowDirection)&&(this._vectorFlowRepresentation="oceanographic"===a.FlowDirection.toLowerCase()?this.renderer.FLOW_TO:this.renderer.FLOW_FROM);
this.renderer&&(this.renderer.flowRepresentation=this._vectorFlowRepresentation)}});c("extend-esri")&&d.setObject("layers.ArcGISImageServiceVectorLayer",r,t);return r})},"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(r,d){return r(d,{constructor:function(d,l){this.isTiled=!0},_initVisible:function(){},_setTopLayerVisible:function(d){},setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},setOpacity:function(d){},
isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred dojo/aspect ./LayerInfoForDefault ./LayerObjectFacory esri/dijit/PopupTemplate".split(" "),function(r,d,m,l,c,t,q,p){return r(t,{_layerObjectFacory:null,constructor:function(){this.newSubLayers=[];this.isTable=!0;this._layerObjectFacory=new q(this)},init:function(){},_getLayerObject:function(){var c=
new l;this._layerObjectFacory.getLayerObject().then(d.hitch(this,function(d){this.layerObject.empty&&d&&(this.layerObject=d,this._bindEventAfterLayerObjectLoaded());c.resolve(d)}));return c},getLayerObject:function(){return this._getLayerObject()},getPopupInfoFromLayerObject:function(){var c=this.getPopupInfo();c||!this.layerObject||this.layerObject.empty||(c=this._getDefaultPopupInfo(this.layerObject));return c},loadPopupInfo:function(){var c=new l,n=this.getPopupInfo();n?c.resolve(n):this.getLayerObject().then(d.hitch(this,
function(){n=this._getDefaultPopupInfo(this.layerObject);c.resolve(n)}));return c},getLayerType:function(){var c=new l;c.resolve("Table");return c},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return m.create("div",{"class":"legends-div"})},_initControlPopup:function(){this.inherited(arguments);this.controlPopupInfo={enablePopup:this.originOperLayer.popupInfo?!0:!1,infoTemplate:this.originOperLayer.popupInfo?new p(this.originOperLayer.popupInfo):
null}},_bindEventAfterLayerObjectLoaded:function(){var h=c.after(this.layerObject,"setDefinitionExpression",d.hitch(this,this._onFilterChanged));this._eventHandles.push(h)},getFilter:function(){var c;this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?(c=this.layerObject.getDefinitionExpression(),void 0===c&&(c=this.getFilterOfWebmap())):c=this.getFilterOfWebmap();return c}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/aspect esri/request ./LayerInfoForDefault".split(" "),
function(r,d,m,l,c,t,q,p,h){return r(h,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=!this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-UV"!==this.layerObject.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.layerObject.serviceDataType?"ArcGISImageServiceLayer":"ArcGISImageServiceVectorLayer"},_initLegendsNode:function(c){10.2<=this.layerObject.version?this._legendRequestServer().then(l.hitch(this,
function(k){d.empty(c);m.forEach(k.layers,function(a){m.forEach(a.legend,function(a){if("\x3call other values\x3e"!==a.label){var f=d.create("div",{"class":"legend-div"},c),b=d.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},f),e=null,e=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;d.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:e},b);d.create("div",
{"class":"legend-label jimu-float-leading",innerHTML:a.label||" "},f)}},this)},this)}),l.hitch(this,function(){d.empty(c)})):d.empty(c)},_legendRequestServer:function(){var c=this.layerObject.url+"/legend",k={f:"json"};this.layerObject._params.bandIds&&(k.bandIds=this.layerObject._params.bandIds);this.layerObject._params.renderingRule&&(k.renderingRule=this.layerObject._params.renderingRule);return p({url:c,content:k,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var d=
new c,k={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},a=this.getLayerType(),g=this.getLayerObject();t({type:a,layerObject:g}).then(l.hitch(this,function(a){var b=a.type;a=a.layerObject;k.layerType=b;0<=this._getLayerTypesOfSupportTable().indexOf(b)&&(k.isSupportedLayer=!0);a.capabilities&&0<=a.capabilities.indexOf("Catalog")?k.isSupportQuery=!0:k.isSupportedLayer=!1;d.resolve(k)}),function(){d.resolve(k)});return d},_getServiceDefinition:function(){var c=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(c)},
_bindEvent:function(){var c;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(c=q.after(this.layerObject,"setRenderingRule",l.hitch(this,this._onRendererChanged)),this._eventHandles.push(c))}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(r,d,m,l,c){return r(c,{getSupportTableInfo:function(){var c=new m,q={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,
otherReasonCanNotSupport:!0},p=this.getLayerType(),h=this.getLayerObject();l({type:p,layerObject:h}).then(d.hitch(this,function(d){var k=d.type;d=d.layerObject;q.layerType=k;0<=this._getLayerTypesOfSupportTable().indexOf(k)&&(q.isSupportedLayer=!0);(k=d.getLatestObservations())&&0<k.length&&(q.otherReasonCanNotSupport=!1);c.resolve(q)}),function(){c.resolve(q)});return c}})})},"jimu/LayerInfos/LayerInfoForDefaultKML":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/dom-construct",
"./LayerInfoForDefault"],function(r,d,m,l){return r(l,{constructor:function(c,d){this.layerObject=c.layerObject},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var c=this.originOperLayer.kml,d=c.layerInfo.originOperLayer.visibleFolders;c.layerInfo.isRootLayer()&&d?-1<d.indexOf(this.subId)?this._visible=!0:this._visible=!1:this._visible=this.originOperLayer.kml.currentFolder.visible},_setTopLayerVisible:function(c){var d=this.originOperLayer.kml.currentFolder;this._visible=c;this.originOperLayer.kml.layerInfo.layerObject.setFolderVisibility(d,
c)},obtainNewSubLayers:function(){var c=[],l=this.originOperLayer.kml;l.currentFolder&&d.forEach(l.layerInfo._getOperLayerByParentFolderId(l.currentFolder.id,this),function(d){d=this._layerInfoFactory.create(d);c.push(d);d.init()},this);return c},getOpacity:function(){},setOpacity:function(c){},drawLegends:function(c){m.empty(c)},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.getRootLayerInfo().getScaleRange()}})})},"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale dojo/number esri/lang dojo/data/ItemFileWriteStore jimu/utils moment/moment".split(" "),
function(r,d,m,l,c,t,q,p,h){var n=r([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:86399E3,MinuteInMS:59E3,SecInMS:1E3,fieldsStore:null,isHosted:!1,constructor:function(){String.prototype.startsWith=function(c){return 0===this.indexOf(c)};String.prototype.endsWith=function(c){return this.substring(this.length-
c.length)===c};String.prototype.count=function(c){return this.split(c).length-1};String.prototype.trim||(String.prototype.trim=d.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes)},OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",
stringOperatorContains:"stringOperatorContains",stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsAnyOf:"stringOperatorIsAnyOf",stringOperatorIsNoneOf:"stringOperatorIsNoneOf",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",
numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",numberOperatorIsAnyOf:"numberOperatorIsAnyOf",numberOperatorIsNoneOf:"numberOperatorIsNoneOf",numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",
dateOperatorIsOnOrBefore:"dateOperatorIsOnOrBefore",dateOperatorIsOnOrAfter:"dateOperatorIsOnOrAfter",dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast",dateOperatorIsIn:"dateOperatorIsIn",dateOperatorIsNotIn:"dateOperatorIsNotIn",dateOperatorMinutes:"dateOperatorMinutes",
dateOperatorHours:"dateOperatorHours",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",dateOperatorMonths:"dateOperatorMonths",dateOperatorYears:"dateOperatorYears"},prepare:function(c,a){this.isHosted=p.isHostedService(c);a=a||[];this.setFieldsStoreByFieldInfos(a)},isPartsObjHasError:function(c){var a=!1;c&&(a=c.parts&&0<=c.parts.length?m.every(c.parts,d.hitch(this,function(a){return a.parts?0<a.parts.length?m.every(a.parts,d.hitch(this,function(a){return!a.error})):!1:!a.error})):
!1);return!a},isAskForValues:function(c){return n.isAskForValues(c)},hasVirtualDate:function(c){return n.hasVirtualDate(c)},setFieldsStoreByFieldInfos:function(c){c=m.filter(c,d.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)}));c=m.map(c,function(a,g){var f;switch(a.type){case "esriFieldTypeString":f="string";break;case "esriFieldTypeDate":f="date";break;default:f="number"}return{id:g,label:a.name,shortType:f,alias:a.alias,editable:a.editable,name:a.name,nullable:a.nullable,
type:a.type}},this);this.fieldsStore=new q({data:{identifier:"id",label:"label",items:c}});return c.length},_validatePartsObj:function(c){return c&&"object"===typeof c},_isObject:function(c){return c&&"object"===typeof c},_isString:function(c){return c&&"string"===typeof c},containsNonLatinCharacter:function(c){for(var a=0;a<c.length;a++)if(255<c.charCodeAt(a))return!0;return!1},containsNonLatinCharacterBatch:function(c){for(var a=!1,g=0;g<c.length;g++){var f=c[g],f=d.isObject(f)?f.value:f;a||(a=
this.containsNonLatinCharacter(f))}return a},getExprByFilterObj:function(c){if(!m.every(c.parts,function(a){return!!a}))return null;if(!this.isPartsObjReadyToBuild(c))return c.expr="",c.displaySQL="",c.expr;this._handleVirtualDate(c);var a="",g="",f,b;if(0===c.parts.length)g=a="1\x3d1";else if(1===c.parts.length)f=c.parts[0],f.valueObj&&d.isArray(f.valueObj.value)&&"multiple"!==f.valueObj.type?(b=this._checkIfValObjArrayAndChecked(f.valueObj.value))?(a=this.builtFilterString(f),g=f.displaySQL):g=
a="1\x3d1":(a=this.builtFilterString(f),g=f.displaySQL);else for(var e="",k=0;k<c.parts.length;k++){f=c.parts[k];f.valueObj&&d.isArray(f.valueObj.value)&&"multiple"!==f.valueObj.type?(b=this._checkIfValObjArrayAndChecked(f.valueObj.value))?(b=this.builtFilterString(f),f=f.displaySQL):f=b="1\x3d1":(b=this.builtFilterString(f),f=f.displaySQL);if(!t.isDefined(b))return null;a+=e+"("+b+")";g+=e+"("+f+")";e=e||" "+c.logicalOperator+" "}c.expr=a;c.displaySQL=g;return a},_checkIfValObjArrayAndChecked:function(c){var a=
!1,g;for(g in c)if(c[g].isChecked){a=!0;break}return a},_handleVirtualDate:function(c){this.hasVirtualDate(c)&&m.forEach(c.parts,d.hitch(this,function(a){a.parts?m.forEach(a.parts,d.hitch(this,function(a){this._updateRealDateByVirtualDate(a)})):this._updateRealDateByVirtualDate(a)}))},_updateRealDateByVirtualDate:function(c){var a;a=[this.OPERATORS.dateOperatorIsOn,this.OPERATORS.dateOperatorIsNotOn,this.OPERATORS.dateOperatorIsBefore,this.OPERATORS.dateOperatorIsAfter,this.OPERATORS.dateOperatorIsOnOrBefore,
this.OPERATORS.dateOperatorIsOnOrAfter];c.valueObj.virtualDate?c.operator===this.OPERATORS.dateOperatorIsIn||c.operator===this.OPERATORS.dateOperatorIsNotIn?(a=n.getRealDateByVirtualDate(c.valueObj.virtualDate),c.value1=a[0],c.value2=a[1],c.valueObj.value1=a[0].toDateString(),c.valueObj.value2=a[1].toDateString()):-1<a.indexOf(c.operator)&&(a=n.getRealDateByVirtualDate(c.valueObj.virtualDate),c.value=a,c.valueObj.value=a.toDateString()):(c.valueObj.virtualDate1&&(a=n.getRealDateByVirtualDate(c.valueObj.virtualDate1),
c.value1=a,c.valueObj.value1=a.toDateString()),c.valueObj.virtualDate2&&(a=n.getRealDateByVirtualDate(c.valueObj.virtualDate2),c.value2=a,c.valueObj.value2=a.toDateString()))},isPartsObjReadyToBuild:function(c){return m.every(c.parts,d.hitch(this,function(a){return a.parts?m.every(a.parts,d.hitch(this,function(a){return this._isPartReadyToBuild(a)})):this._isPartReadyToBuild(a)}))},_isPartReadyToBuild:function(c){var a=c.fieldObj.shortType,g=c.operator,f=c.valueObj;c=f.type||"value";var b=f.value,
e=f.value1,f=f.value2;if("value"===c){if("string"===a)return g===this.OPERATORS.stringOperatorIsBlank||g===this.OPERATORS.stringOperatorIsNotBlank?!0:p.isNotEmptyString(b);if("number"===a)return g===this.OPERATORS.numberOperatorIsBlank||g===this.OPERATORS.numberOperatorIsNotBlank?!0:g===this.OPERATORS.numberOperatorIsBetween||g===this.OPERATORS.numberOperatorIsNotBetween?p.isValidNumber(e)&&p.isValidNumber(f):p.isValidNumber(b);if("date"===a)return g===this.OPERATORS.dateOperatorIsBlank||g===this.OPERATORS.dateOperatorIsNotBlank?
!0:g===this.OPERATORS.dateOperatorIsBetween||g===this.OPERATORS.dateOperatorIsNotBetween||g===this.OPERATORS.dateOperatorIsIn||g===this.OPERATORS.dateOperatorIsNotIn?p.isNotEmptyString(e)&&p.isNotEmptyString(f):g===this.OPERATORS.dateOperatorInTheLast||g===this.OPERATORS.dateOperatorNotInTheLast?void 0!==b&&null!==b:p.isNotEmptyString(b)}else{if("field"===c)return p.isNotEmptyString(b);if("unique"===c){if("string"===a)return p.isNotEmptyString(b);if("number"===a)return p.isValidNumber(b);if("date"===
a)return p.isValidDate(b)}else if("multiple"===c){if("string"===a)return p.isNotEmptyStringArray(b);if("number"===a)return p.isValidNumberArray(b)}else if("values"!==c&&("uniquePredefined"===c||"multiplePredefined"===c)){if("string"===a)return p.isNotEmptyStringArray(b);if("number"===a)return p.isValidNumberArray(b)}}return!1},builtFilterString:function(c){var a="",g="";if(c.parts)for(var f="",b=0;b<c.parts.length;b++){var e=c.parts[b],d=this.builtSingleFilterString(e);e.expr=d.whereClause;if(!t.isDefined(d.whereClause))return null;
a+=f+d.whereClause;g+=f+e.displaySQL;f=" "+c.logicalOperator+" "}else c&&c.valueObj&&"multiple"===c.valueObj.type&&0===c.valueObj.value.length?a=g="1\x3d1":(a=this.builtSingleFilterString(c).whereClause,g=c.displaySQL);c.expr=a;c.displaySQL=g;return a},_preBuiltSingleFilterString:function(c){if("string"===c.fieldObj.shortType&&"\x3cNull\x3e"===c.valueObj.value){if(c.operator===this.OPERATORS.stringOperatorIs)return{whereClause:c.fieldObj.name+" IS NULL"};if(c.operator===this.OPERATORS.stringOperatorIsNot)return{whereClause:c.fieldObj.name+
" IS NOT NULL"}}if("number"===c.fieldObj.shortType&&"\x3cNull\x3e"===c.valueObj.value){if(c.operator===this.OPERATORS.numberOperatorIs)return{whereClause:c.fieldObj.name+" IS NULL"};if(c.operator===this.OPERATORS.numberOperatorIsNot)return{whereClause:c.fieldObj.name+" IS NOT NULL"}}return null},_handlePrefixStringsForIn:function(c,a){for(var g=[],f=0;f<a.length;f++){var b=a[f],b=b.replace(/\'/g,"''");g.push(b)}return""+c+"'"+g.join("',"+c+"'")+"'"},builtSingleFilterString:function(c,a){this.isHosted&&
(c.caseSensitive=!1);if(t.isDefined(c.valueObj.isValid)&&!c.valueObj.isValid)return{whereClause:null};var g=this._preBuiltSingleFilterString(c);if(g)return g;var f=c.valueObj.value,b=c.valueObj.value1,e=c.valueObj.value2,k=!1;c.interactiveObj&&t.isDefined(a)&&(k=!0,t.isDefined(c.valueObj.value)&&(f="{"+a+"}"),t.isDefined(c.valueObj.value1)&&(b="{"+a+"}"),t.isDefined(c.valueObj.value2)&&(e="{"+(a+1)+"}"));var h=g="",h="",n=[];if("string"===c.fieldObj.shortType){var p="";k&&this.isHosted?p="N":f&&"field"!==
c.valueObj.type&&this.isHosted&&(d.isArray(f)&&this.containsNonLatinCharacterBatch(f)||!d.isArray(f)&&this.containsNonLatinCharacter(f))&&(p="N");if(f&&"multiple"===c.valueObj.type){if(c.operator===this.OPERATORS.stringOperatorIsAnyOf||c.operator===this.OPERATORS.stringOperatorIsNoneOf)f=this._handlePrefixStringsForIn(p,f)}else!f||"multiplePredefined"!==c.valueObj.type&&"uniquePredefined"!==c.valueObj.type||(n=[],m.forEach(f,d.hitch(this,function(a){a.isChecked&&n.push(a.value)})),f=c.operator===
this.OPERATORS.stringOperatorIs||c.operator===this.OPERATORS.stringOperatorIsNot?n[0]:c.operator===this.OPERATORS.stringOperatorIsAnyOf||c.operator===this.OPERATORS.stringOperatorIsNoneOf?this._handlePrefixStringsForIn(p,n):n);var l=[];switch(c.operator){case this.OPERATORS.stringOperatorIs:"field"===c.valueObj.type?g=c.fieldObj.name+" \x3d "+f:"multiple"===c.valueObj.type?(h=f.join("','"),g=c.caseSensitive?c.fieldObj.name+" IN ("+p+"'"+h.replace(/\'/g,"'")+"')":"UPPER("+c.fieldObj.name+") IN ("+
p+"'"+h.replace(/\'/g,"'").toUpperCase()+"')"):g=c.caseSensitive?c.fieldObj.name+" \x3d "+p+"'"+f.replace(/\'/g,"''")+"'":"UPPER("+c.fieldObj.name+") \x3d "+p+"'"+f.replace(/\'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorIsNot:"field"===c.valueObj.type?g=c.fieldObj.name+" \x3c\x3e "+f:"multiple"===c.valueObj.type?(h=f.join("','"),g=c.caseSensitive?c.fieldObj.name+" NOT IN ("+p+"'"+h.replace(/\'/g,"'")+"')":"UPPER("+c.fieldObj.name+") NOT IN ("+p+"'"+h.replace(/\'/g,"'").toUpperCase()+
"')"):g=c.caseSensitive?c.fieldObj.name+" \x3c\x3e "+p+"'"+f.replace(/\'/g,"''")+"'":"UPPER("+c.fieldObj.name+") \x3c\x3e "+p+"'"+f.replace(/\'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorStartsWith:l=[];"multiple"===c.valueObj.type||"multiplePredefined"===c.valueObj.type||"uniquePredefined"===c.valueObj.type?(m.forEach(f,d.hitch(this,function(a){c.caseSensitive?l.push(c.fieldObj.name+" LIKE "+p+"'"+a.replace(/\'/g,"''")+"%'"):l.push("UPPER("+c.fieldObj.name+") LIKE "+p+"'"+
a.replace(/\'/g,"''").toUpperCase()+"%'")})),g="(("+l.join(") or (")+"))"):g=c.caseSensitive?c.fieldObj.name+" LIKE "+p+"'"+f.replace(/\'/g,"''")+"%'":"UPPER("+c.fieldObj.name+") LIKE "+p+"'"+f.replace(/\'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorEndsWith:l=[];"multiple"===c.valueObj.type||"multiplePredefined"===c.valueObj.type||"uniquePredefined"===c.valueObj.type?(m.forEach(f,d.hitch(this,function(a){c.caseSensitive?l.push(c.fieldObj.name+" LIKE "+p+"'%"+a.replace(/\'/g,
"''")+"'"):l.push("UPPER("+c.fieldObj.name+") LIKE "+p+"'%"+a.replace(/\'/g,"''").toUpperCase()+"'")})),g="(("+l.join(") or (")+"))"):g=c.caseSensitive?c.fieldObj.name+" LIKE "+p+"'%"+f.replace(/\'/g,"''")+"'":"UPPER("+c.fieldObj.name+") LIKE "+p+"'%"+f.replace(/\'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorContains:l=[];"multiple"===c.valueObj.type||"multiplePredefined"===c.valueObj.type||"uniquePredefined"===c.valueObj.type?(m.forEach(f,d.hitch(this,function(a){c.caseSensitive?
l.push(c.fieldObj.name+" LIKE "+p+"'%"+a.replace(/\'/g,"''")+"%'"):l.push("UPPER("+c.fieldObj.name+") LIKE "+p+"'%"+a.replace(/\'/g,"''").toUpperCase()+"%'")})),g="(("+l.join(") or (")+"))"):g=c.caseSensitive?c.fieldObj.name+" LIKE "+p+"'%"+f.replace(/\'/g,"''")+"%'":"UPPER("+c.fieldObj.name+") LIKE "+p+"'%"+f.replace(/\'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorDoesNotContain:l=[];"multiple"===c.valueObj.type||"multiplePredefined"===c.valueObj.type||"uniquePredefined"===
c.valueObj.type?(m.forEach(f,d.hitch(this,function(a){c.caseSensitive?l.push(c.fieldObj.name+" NOT LIKE "+p+"'%"+a.replace(/\'/g,"''")+"%'"):l.push("UPPER("+c.fieldObj.name+") NOT LIKE "+p+"'%"+a.replace(/\'/g,"''").toUpperCase()+"%'")})),g="(("+l.join(") or (")+"))"):g=c.caseSensitive?c.fieldObj.name+" NOT LIKE "+p+"'%"+f.replace(/\'/g,"''")+"%'":"UPPER("+c.fieldObj.name+") NOT LIKE "+p+"'%"+f.replace(/\'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorIsAnyOf:g=c.fieldObj.name+
" IN ("+f+")";break;case this.OPERATORS.stringOperatorIsNoneOf:g=c.fieldObj.name+" NOT IN ("+f+")";break;case this.OPERATORS.stringOperatorIsBlank:g=c.fieldObj.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:g=c.fieldObj.name+" IS NOT NULL"}}else if("number"===c.fieldObj.shortType)switch(!f||"uniquePredefined"!==c.valueObj.type&&"multiplePredefined"!==c.valueObj.type?f&&"multiple"===c.valueObj.type&&(f=f.join(",")):(n=[],m.forEach(f,d.hitch(this,function(a){a.isChecked&&n.push(a.value)})),
f=n.join(",")),c.operator){case this.OPERATORS.numberOperatorIs:g=c.fieldObj.name+" \x3d "+f;break;case this.OPERATORS.numberOperatorIsNot:g=c.fieldObj.name+" \x3c\x3e "+f;break;case this.OPERATORS.numberOperatorIsAtLeast:g=c.fieldObj.name+" \x3e\x3d "+f;break;case this.OPERATORS.numberOperatorIsLessThan:g=c.fieldObj.name+" \x3c "+f;break;case this.OPERATORS.numberOperatorIsAtMost:g=c.fieldObj.name+" \x3c\x3d "+f;break;case this.OPERATORS.numberOperatorIsGreaterThan:g=c.fieldObj.name+" \x3e "+f;break;
case this.OPERATORS.numberOperatorIsAnyOf:g=c.fieldObj.name+" IN ("+f+")";break;case this.OPERATORS.numberOperatorIsNoneOf:g=c.fieldObj.name+" NOT IN ("+f+")";break;case this.OPERATORS.numberOperatorIsBetween:g=c.fieldObj.name+" BETWEEN "+b+" AND "+e;break;case this.OPERATORS.numberOperatorIsNotBetween:g=c.fieldObj.name+" NOT BETWEEN "+b+" AND "+e;break;case this.OPERATORS.numberOperatorIsBlank:g=c.fieldObj.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:g=c.fieldObj.name+" IS NOT NULL"}else switch(t.isDefined(f)&&
"field"!==c.valueObj.type&&"string"===typeof f&&(f=new Date(f)),"field"!==c.valueObj.type&&(f&&(f=new Date(f)),b&&(b=new Date(b)),e&&(e=new Date(e))),c.operator){case this.OPERATORS.dateOperatorIsOn:g="field"===c.valueObj.type?c.fieldObj.name+" \x3d "+f:k?c.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+a+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(a+1)+"}'":c.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"' AND "+(this.isHosted?"":"timestamp ")+
"'"+this.formatDate(this.addDay(f))+"'";break;case this.OPERATORS.dateOperatorIsNotOn:g="field"===c.valueObj.type?c.fieldObj.name+" \x3c\x3e "+f:k?c.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+a+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(a+1)+"}'":c.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(f))+"'";break;case this.OPERATORS.dateOperatorIsBefore:g="field"===
c.valueObj.type?c.fieldObj.name+" \x3c "+f:c.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"'";break;case this.OPERATORS.dateOperatorIsAfter:g="field"===c.valueObj.type?c.fieldObj.name+" \x3e "+f:c.fieldObj.name+" \x3e "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(f))+"'";break;case this.OPERATORS.dateOperatorIsOnOrBefore:g="field"===c.valueObj.type?c.fieldObj.name+" \x3c\x3d "+f:c.fieldObj.name+" \x3c\x3d "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(f))+
"'";break;case this.OPERATORS.dateOperatorIsOnOrAfter:g="field"===c.valueObj.type?c.fieldObj.name+" \x3e\x3d "+f:c.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(f)+"'";break;case this.OPERATORS.dateOperatorInTheLast:g=c.fieldObj.name+" BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(c.valueObj.value,c.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorNotInTheLast:g=c.fieldObj.name+" NOT BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(c.valueObj.value,
c.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorIsBetween:case this.OPERATORS.dateOperatorIsIn:g=k?c.fieldObj.name+" BETWEEN '"+b+"' AND '"+e+"'":c.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(e))+"'";break;case this.OPERATORS.dateOperatorIsNotBetween:case this.OPERATORS.dateOperatorIsNotIn:g=k?c.fieldObj.name+" NOT BETWEEN '"+b+"' AND '"+e+"'":c.fieldObj.name+
" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(e))+"'";break;case this.OPERATORS.dateOperatorIsBlank:g=c.fieldObj.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:g=c.fieldObj.name+" IS NOT NULL"}"date"===c.fieldObj.shortType?(a=d.clone(c.valueObj),a.dateFormat=c.fieldObj.dateFormat,h=this.getDisplaySQL(c.fieldObj.name,a,c.operator)):h=g;c.displaySQL=h;return{whereClause:g}},_dateENUM:{dateOperatorIsOn:"is on ",
dateOperatorIsNotOn:"is not on ",dateOperatorIsIn:"is in ",dateOperatorIsNotIn:"is not in ",dateOperatorIsBefore:"is before ",dateOperatorIsAfter:"is after ",dateOperatorIsOnOrBefore:"is on or before ",dateOperatorIsOnOrAfter:"is on or after ",dateOperatorInTheLast:["is in the last "," from CURRENT_TIMESTAMP"],dateOperatorNotInTheLast:["is not in the last "," from CURRENT_TIMESTAMP"],dateOperatorIsBetween:["is between "," and "],dateOperatorIsNotBetween:["is not between "," and "],dateOperatorIsBlank:"is blank",
dateOperatorIsNotBlank:"is not blank"},_getDisplayDates:function(c){var a={value:c.virtualDate,value1:c.virtualDate1,value2:c.virtualDate2},g=""===c.dateFormat?{}:{format:{dateFormat:c.dateFormat}};if(""===c.virtualDate||void 0===c.virtualDate)a.value=p.localizeDateByFieldInfo(new Date(c.value),g);""===c.virtualDate1&&(a.value1=p.localizeDateByFieldInfo(new Date(c.value1),g));""===c.virtualDate2&&(a.value2=p.localizeDateByFieldInfo(new Date(c.value2),g));return a},getDisplaySQL:function(c,a,g){var f=
"",f=this._dateENUM[g];0<g.indexOf("InTheLast")?f=f[0]+a.value+" "+this._getDateRangeEnum(a.value,a.range)+f[1]:(a=this._getDisplayDates(a,g),f=0<g.indexOf("Between")?f[0]+a.value1+f[1]+a.value2:0<g.indexOf("Blank")?this._dateENUM[g]:this._dateENUM[g]+a.value);return c+" "+f},_getDateRangeEnum:function(c,a){a={dateOperatorYears:"year",dateOperatorDays:"day",dateOperatorMonths:"month",dateOperatorWeeks:"week",dateOperatorHours:"hour",dateOperatorMinutes:"minute"}[a];return 1<c?a+"s":a},_convertRangeToDays:function(c,
a){var g=c;a===this.OPERATORS.dateOperatorYears?g=365*c:a===this.OPERATORS.dateOperatorMonths?g=30*c:a===this.OPERATORS.dateOperatorWeeks?g=7*c:a===this.OPERATORS.dateOperatorHours?g=c/24:a===this.OPERATORS.dateOperatorMinutes&&(g=c/1440);return g=Math.round(1E6*g)/1E6},formatDate:function(d){d=new Date(d);return""+d.getUTCFullYear()+"-"+c.format(d.getUTCMonth()+1,{pattern:"00"})+"-"+c.format(d.getUTCDate(),{pattern:"00"})+" "+c.format(d.getUTCHours(),{pattern:"00"})+":"+c.format(d.getUTCMinutes(),
{pattern:"00"})+":"+c.format(d.getSeconds(),{pattern:"00"})},addDay:function(c){return new Date(c.getTime()+this.dayInMS)},addMinute:function(c){return new Date(c.getTime()+this.MinuteInMS)},addSec:function(c){return new Date(c.getTime()+this.SecInMS)},getFilterObjByExpr:function(c){if(c&&this.fieldsStore){var a=this.replaceStrings(c);c=a.defExpr;var g=this.findParts(c,"AND");1===g.parts.length&&(g=this.findParts(c,"OR"),1===g.parts.length&&(g.logicalOperator="AND"));m.forEach(g.parts,function(a){a.expr=
a.expr.trim();if(a.expr.startsWith("(")&&-1<a.expr.search(/\)$/)){var b=a.expr.substring(1,a.expr.length-1),e=b.indexOf("("),f=b.indexOf(")");if(-1===e&&-1===f||e<f)a.expr=b}b=this.findParts(a.expr,"AND");1===b.parts.length&&(b=this.findParts(a.expr,"OR"));1<b.parts.length&&(a.parts=b.parts,a.logicalOperator=b.logicalOperator)},this);this.parseExpr(g);this.reReplaceStrings(a,g,d.hitch(this,function(){g&&g.parts&&m.forEach(g.parts,d.hitch(this,function(a){a&&(a.parts?m.forEach(a.parts,d.hitch(this,
function(a){this._handleParsedValuesForSinglePart(a);this._addDefalutValueTypeForSinglePart(a)})):(this._handleParsedValuesForSinglePart(a),this._addDefalutValueTypeForSinglePart(a)))}))}));this.isPartsObjHasError(g)&&(g=null);return g}},_handleParsedValuesForSinglePart:function(c){c&&c.fieldObj&&"number"===c.fieldObj.shortType&&c.valueObj&&(c.valueObj.hasOwnProperty("value")&&(c.valueObj.value=parseFloat(c.valueObj.value)),c.valueObj.hasOwnProperty("value1")&&(c.valueObj.value1=parseFloat(c.valueObj.value1)),
c.valueObj.hasOwnProperty("value2")&&(c.valueObj.value2=parseFloat(c.valueObj.value2)))},_addDefalutValueTypeForSinglePart:function(c){c&&c.valueObj&&!c.valueObj.type&&(c.valueObj.type="value")},replaceStrings:function(c){for(var a=c,g=function(a,b,e){var f=-1,f=a.indexOf("'",e+1);return f===e+1?(f=a.indexOf("'",f+1),g(a,b,f)):e},f=[],b=c.indexOf("'");-1<b;){var e=b,b=c.indexOf("'",b+1),d=0,b=g(c,e,b);"%"===c[e+1]&&e++;"%"===c[b-1]&&(--b,d++);var k=c.substring(e+1,b);"N"===c[e-1]&&(c=c.substring(0,
e-1)+c.substring(e),--e,--b);this.isDateString(k)||-1!==k.indexOf("{")?b=c.indexOf("'",b+1+d):(f.push(k),c=c.substring(0,e+1)+"#"+(f.length-1)+"#"+c.substring(b),b=c.indexOf("'",c.lastIndexOf("#")+2+d))}return{origDefExpr:a,defExpr:c,savedStrings:f}},reReplaceStrings:function(c,a,g){var f=c.savedStrings;if(!f.length)g&&"function"===typeof g&&g();else if(f.length){var b=function(a,b){if(void 0===a.valueObj||null===a.valueObj||void 0===a.valueObj.value||null===a.valueObj.value||"string"!==a.fieldObj.shortType)return!1;
var e=a.valueObj.value.indexOf("#"),f=a.valueObj.value.lastIndexOf("#");return t.isDefined(a.valueObj.value)&&-1<e?(a.valueObj.value=b[parseInt(a.valueObj.value.substring(e+1,f),10)].replace(/\'\'/g,"'"),this.builtSingleFilterString(a),!0):!1},b=d.hitch(this,b),e=!1;m.forEach(a.parts,function(a){if(a.parts){var c=!1;m.forEach(a.parts,function(a){c=b(a,f)||c});c&&(e=c,a.expr=this.builtFilterString(a))}else(e=b(a,f)||e)&&this.builtFilterString(a)},this);g&&"function"===typeof g&&g();e&&(a.expr=null,
this.getExprByFilterObj(a))}},isDateString:function(c){return 19===c.length&&"-"===c.charAt(4)&&"-"===c.charAt(7)&&" "===c.charAt(10)&&":"===c.charAt(13)&&":"===c.charAt(16)?!0:!1},findParts:function(c,a){for(var g=c.toLowerCase(),f=" "+a.toLowerCase()+" ",b=[],e=0,d=g.indexOf(f);0<d;){var k=c.substring(e,d),h=k.toLowerCase(),n=k.count("("),p=k.count(")"),l=k.count("'");n!==p||1===l%2?d=g.indexOf(f,d+1):-1<h.indexOf(" between ")&&-1===h.indexOf(" and ")?d=g.indexOf(f,d+1):(b.push({expr:k}),e=d+f.length,
d=g.indexOf(f,e))}b.push({expr:c.substring(e)});for(g=b.length-1;0<=g;g--)!this.hasOperator(b[g].expr)&&0<g&&(b[g-1].expr+=" "+a+" "+b[g].expr,b.splice(g,1));return{expr:c,parts:b,logicalOperator:a}},hasOperator:function(c){c=c.toLowerCase();return-1<c.indexOf("{")&&-1<c.indexOf("}")||-1<c.indexOf(" \x3d ")||-1<c.indexOf(" \x3c ")||-1<c.indexOf(" \x3e ")||-1<c.indexOf(" \x3c\x3e ")||-1<c.indexOf(" \x3c\x3d ")||-1<c.indexOf(" \x3e\x3d ")||-1<c.indexOf(" like ")||-1<c.indexOf(" between ")||-1<c.indexOf(" date")||
-1<c.indexOf(" is null")||-1<c.indexOf(" is not null")?!0:!1},parseExpr:function(c){m.forEach(c.parts,function(a){a.parts?this.parseExpr(a):this.parseSingleExpr(a)},this)},_preParseSingleExpr:function(c){var a=null;try{if(a=d.clone(c),a.expr=a.expr.trim(),/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(a.expr)){var g=c="",f=a.expr.match(/^UPPER\((.*)\)\s+/i);if(f&&2<=f.length)c=f[1];else return null;var b=a.expr.match(/UPPER\(N?'(.*)'\)$/i);if(b&&2<=b.length)g="'"+b[1]+"'";else return null;
a.expr=a.expr.replace(/^UPPER\((.*)\)\s+/i,c+" ");a.expr=a.expr.replace(/UPPER\(N?'(.*)'\)$/i,g);a.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(a.expr)&&(a.caseSensitive=!0)}catch(e){return console.log(e),null}a&&this.isHosted&&(a.caseSensitive=!1);return a},_removeOperator:function(c,a,g){a=a.substring(g).trim();"date"===c&&!this.isHosted&&a.toLowerCase().startsWith("timestamp ")&&(a=a.substring(10).trim());return a},parseSingleExpr:function(c){var a=this._preParseSingleExpr(c);
a&&(c=d.mixin(c,a));var a=c.expr.trim(),g=a.indexOf(" "),f=a.substring(0,g);c.fieldObj={name:f};c.valueObj={};this.getFieldItemByName({name:f},function(a){c.fieldObj.shortType=a.shortType[0];c.fieldObj.label=a.label[0]},function(){c.error={msg:"unknown field name ("+f+")",code:1}});a=a.substring(g+1).trim();g=a.toLowerCase();g.startsWith("\x3d ")?(a=this._removeOperator(c.fieldObj.shortType,a,2),this.storeValue(a,c),c.operator="date"===c.fieldObj.shortType?this.OPERATORS.dateOperatorIsOn:"string"===
c.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):g.startsWith("\x3c ")?(a=this._removeOperator(c.fieldObj.shortType,a,2),this.storeValue(a,c),"date"===c.fieldObj.shortType?c.operator=this.OPERATORS.dateOperatorIsBefore:"number"===c.fieldObj.shortType?c.operator=this.OPERATORS.numberOperatorIsLessThan:c.error={msg:"operator ("+g+") not supported for string",code:3}):g.startsWith("\x3e ")?(a=this._removeOperator(c.fieldObj.shortType,a,2),this.storeValue(a,c),"date"===
c.fieldObj.shortType?c.operator=this.OPERATORS.dateOperatorIsAfter:"number"===c.fieldObj.shortType?c.operator=this.OPERATORS.numberOperatorIsGreaterThan:c.error={msg:"operator ("+g+") not supported for string",code:3}):g.startsWith("\x3c\x3e ")?(a=this._removeOperator(c.fieldObj.shortType,a,3),this.storeValue(a,c),c.operator="date"===c.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:"string"===c.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):g.startsWith("\x3c\x3d ")?
(a=this._removeOperator(c.fieldObj.shortType,a,3),this.storeValue(a,c),"date"===c.fieldObj.shortType?c.operator=this.OPERATORS.dateOperatorIsOnOrBefore:"number"===c.fieldObj.shortType?c.operator=this.OPERATORS.numberOperatorIsAtMost:c.error={msg:"operator ("+g+") not supported for string",code:3}):g.startsWith("\x3e\x3d ")?(a=this._removeOperator(c.fieldObj.shortType,a,3),this.storeValue(a,c),"date"===c.fieldObj.shortType?c.operator=this.OPERATORS.dateOperatorIsOnOrAfter:"number"===c.fieldObj.shortType?
c.operator=this.OPERATORS.numberOperatorIsAtLeast:c.error={msg:"operator ("+g+") not supported for string",code:3}):g.startsWith("like ")?(a=a.substring(5).trim(),a.startsWith("N'")&&(a=a.substring(1,a.length)),a.startsWith("'%")&&a.endsWith("%'")?(this.storeValue(a.substring(2,a.length-2),c),c.operator=this.OPERATORS.stringOperatorContains):a.startsWith("'%")&&a.endsWith("'")?(this.storeValue(a.substring(2,a.length-1),c),c.operator=this.OPERATORS.stringOperatorEndsWith):a.startsWith("'")&&a.endsWith("%'")?
(this.storeValue(a.substring(1,a.length-2),c),c.operator=this.OPERATORS.stringOperatorStartsWith):c.error={msg:"value ("+g+") not supported for LIKE",code:3}):g.startsWith("not like ")?(a=a.substring(9).trim(),a.startsWith("N'")&&(a=a.substring(1,a.length)),a.startsWith("'%")&&a.endsWith("%'")?(this.storeValue(a.substring(2,a.length-2),c),c.operator=this.OPERATORS.stringOperatorDoesNotContain):c.error={msg:"value ("+g+") not supported for NOT LIKE",code:3}):g.startsWith("between ")?this._updatePartForBetween(a,
!0,c):g.startsWith("not between ")?this._updatePartForBetween(a,!1,c):"is null"===g?(c.valueObj.value=null,c.operator="date"===c.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===c.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):"is not null"===g?(c.valueObj.value=null,c.operator="date"===c.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===c.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:this.OPERATORS.numberOperatorIsNotBlank):
c.error={msg:"unknown operator ("+g+")",code:2};if(t.isDefined(c.valueObj.value)&&"string"===typeof c.valueObj.value&&c.valueObj.value.startsWith("{")&&c.valueObj.value.endsWith("}")||t.isDefined(c.valueObj.value1)&&"string"===typeof c.valueObj.value1&&c.valueObj.value1.startsWith("{")&&c.valueObj.value1.endsWith("}"))c.isInteractive=!0},getFieldItemByName:function(c,a,g){this.fieldsStore.fetch({query:c,onComplete:d.hitch(this,function(f){f&&f.length?a(f[0]):g()})})},subtractDay:function(c){return new Date(c.getTime()-
this.dayInMS)},_updatePartForBetween:function(c,a,g){var f,b,e,d,k;c=this._removeOperator(g.fieldObj.shortType,c,(a?"between ":"not between ").length);f=c.toLowerCase().indexOf(" and ");if(-1<f)if(b=c.substring(0,f).trim(),b.startsWith("CURRENT_TIMESTAMP "))if(b=b.substring(18).trim(),b.startsWith("-")){g.operator=a?this.OPERATORS.dateOperatorInTheLast:this.OPERATORS.dateOperatorNotInTheLast;try{k=parseFloat(b.substring(1).trim()),1<=k?(e=this.OPERATORS.dateOperatorDays,d=k/365,1E-4>Math.abs(d-Math.round(d))?
(k=Math.round(d),e=this.OPERATORS.dateOperatorYears):(d=k/30,1E-4>Math.abs(d-Math.round(d))?(k=Math.round(d),e=this.OPERATORS.dateOperatorMonths):(d=k/7,1E-4>Math.abs(d-Math.round(d))&&(k=Math.round(d),e=this.OPERATORS.dateOperatorWeeks)))):(e=this.OPERATORS.dateOperatorMinutes,k*=24,1E-4>Math.abs(k-Math.round(k))?e=this.OPERATORS.dateOperatorHours:k*=60),g.valueObj.value=k,g.valueObj.range=e}catch(x){g.error={msg:"missing count for '"+(a?"":"not ")+"in the last'",code:3}}}else g.error={msg:"'"+(a?
"":"not ")+"in the next' not supported",code:3};else if(c=this._removeOperator(g.fieldObj.shortType,c.substring(f),5),this.storeValue1(b,g),this.storeValue2(c,g),"date"===g.fieldObj.shortType){if(g.operator=a?this.OPERATORS.dateOperatorIsBetween:this.OPERATORS.dateOperatorIsNotBetween,"object"===typeof g.valueObj.value1&&"object"===typeof g.valueObj.value2)try{1E3>Math.abs(this.subtractDay(g.valueObj.value2).getTime()-g.valueObj.value1.getTime())&&(g.valueObj.value=g.valueObj.value1,delete g.valueObj.value1,
delete g.valueObj.value2,g.operator=a?this.OPERATORS.dateOperatorIsOn:this.OPERATORS.dateOperatorIsNotOn)}catch(x){}}else"number"===g.fieldObj.shortType||"oid"===g.fieldObj.shortType?g.operator=a?this.OPERATORS.numberOperatorIsBetween:this.OPERATORS.numberOperatorIsNotBetween:g.error={msg:g.fieldObj.shortType+" field not supported for "+(a?"":"NOT ")+"BETWEEN",code:3};else g.error={msg:"missing AND operator for "+(a?"":"NOT ")+"BETWEEN",code:3}},storeValue:function(c,a){if(c.startsWith("{")&&c.endsWith("}"))a.valueObj.value=
c;else if(c.startsWith("'{")&&c.endsWith("}'"))a.valueObj.value=c.substring(1,c.length-1);else if("date"===a.fieldObj.shortType)if(c.startsWith("'")&&c.endsWith("'")){var g=c.substring(1,c.length-1);a.valueObj.value=this.parseDate(g)}else a.valueObj.value=c,a.valueObj.type="field";else"string"===a.fieldObj.shortType?(c.startsWith("#")||c.startsWith("%#"))&&(c.endsWith("#")||c.endsWith("#%"))?a.valueObj.value=c:c.startsWith("'")&&c.endsWith("'")?a.valueObj.value=c.substring(1,c.length-1).replace(/\'\'/g,
"'"):(a.valueObj.value=c,a.valueObj.type="field",this.getFieldItemByName({name:c},function(f){a.valueObj.label=f.label[0]},function(){a.error={msg:"unknown field name ("+c+")",code:1}})):(a.valueObj.value=c,isNaN(c)&&(a.valueObj.type="field",this.getFieldItemByName({name:c},function(f){a.valueObj.label=f.label[0]},function(){a.error={msg:"unknown field name ("+c+")",code:1}})))},storeValue1:function(c,a){c.startsWith("{")&&c.endsWith("}")?a.valueObj.value1=c:c.startsWith("'{")&&c.endsWith("}'")?a.valueObj.value1=
c.substring(1,c.length-1):"date"===a.fieldObj.shortType?c.startsWith("'")&&c.endsWith("'")?(c=c.substring(1,c.length-1),a.valueObj.value1=this.parseDate(c)):(a.valueObj.value1=c,a.valueObj.type="field"):(a.valueObj.value1=c,isNaN(c)&&(a.valueObj.type="field"))},storeValue2:function(c,a){c.startsWith("{")&&c.endsWith("}")?a.valueObj.value2=c:c.startsWith("'{")&&c.endsWith("}'")?a.valueObj.value2=c.substring(1,c.length-1):"date"===a.fieldObj.shortType?c.startsWith("'")&&c.endsWith("'")?(c=c.substring(1,
c.length-1),a.valueObj.value2=this.parseDate(c)):(a.valueObj.value2=c,a.valueObj.type="field"):(a.valueObj.value2=c,isNaN(c)&&(a.valueObj.type="field"))},parseDate:function(c){var a=l.parse(c,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});a||(a=l.parse(c.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(a=l.parse(c.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return a}});n.VIRTUAL_DATE_TODAY="today";n.VIRTUAL_DATE_YESTERDAY="yesterday";n.VIRTUAL_DATE_TOMORROW=
"tomorrow";n.VIRTUAL_DATE_THIS_WEEK="thisWeek";n.VIRTUAL_DATE_THIS_MONTH="thisMonth";n.VIRTUAL_DATE_THIS_QUARTER="thisQuarter";n.VIRTUAL_DATE_THIS_YEAR="thisYear";n.isAskForValues=function(c){var a=!1;return a=m.some(c.parts,function(a){return a.parts?m.some(a.parts,function(a){return!!a.interactiveObj}):!!a.interactiveObj})};n.hasVirtualDate=function(c){var a=!1;return a=m.some(c.parts,function(a){return a.parts?m.some(a.parts,function(a){return!!a.valueObj.virtualDate||!!a.valueObj.virtualDate1||
!!a.valueObj.virtualDate2}):!!a.valueObj.virtualDate||!!a.valueObj.virtualDate1||!!a.valueObj.virtualDate2})};n.getRealDateByVirtualDate=function(c){var a=null,g=new Date,f=g.getTime();switch(c){case n.VIRTUAL_DATE_TODAY:a=g;break;case n.VIRTUAL_DATE_YESTERDAY:a=new Date(f-864E5);break;case n.VIRTUAL_DATE_TOMORROW:a=new Date(f+864E5);break;case n.VIRTUAL_DATE_THIS_WEEK:a=[h().startOf("week").toDate(),h().endOf("week").toDate()];break;case n.VIRTUAL_DATE_THIS_MONTH:a=[h().startOf("month").toDate(),
h().endOf("month").toDate()];break;case n.VIRTUAL_DATE_THIS_QUARTER:a=[h().startOf("quarter").toDate(),h().endOf("quarter").toDate()];break;case n.VIRTUAL_DATE_THIS_YEAR:a=[h().startOf("year").toDate(),h().endOf("year").toDate()]}return a};return n})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),function(r,d,m,l,c,t,q){return d("dojo.data.ItemFileWriteStore",t,{constructor:function(c){this._features["dojo.data.api.Write"]=
!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=function(c){return q.toISOString(c,{zulu:!0})});c&&!1===c.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(c){if(!c)throw Error("assertion failed in ItemFileWriteStore");},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},
newItem:function(c,d){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=typeof c&&"undefined"!=typeof c)throw Error("newItem() was passed something other than an object");var h=null,k=this._getIdentifierAttribute();if(k===Number)h=this._arrayOfAllItems.length;else{h=c[k];if("undefined"===typeof h)throw Error("newItem() was not passed an identity for the new item");if(r.isArray(h))throw Error("newItem() was not passed an single-valued identity");}this._itemsByIdentity&&
this._assert("undefined"===typeof this._itemsByIdentity[h]);this._assert("undefined"===typeof this._pending._newItems[h]);this._assert("undefined"===typeof this._pending._deletedItems[h]);var a={};a[this._storeRefPropName]=this;a[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[h]=a,a[k]=[h]);this._arrayOfAllItems.push(a);k=null;if(d&&d.parent&&d.attribute){var k={item:d.parent,attribute:d.attribute,oldValue:void 0},g=this.getValues(d.parent,d.attribute);
if(g&&0<g.length){var f=g.slice(0,g.length);k.oldValue=1===g.length?g[0]:g.slice(0,g.length);f.push(a);this._setValueOrValues(d.parent,d.attribute,f,!1);k.newValue=this.getValues(d.parent,d.attribute)}else this._setValueOrValues(d.parent,d.attribute,a,!1),k.newValue=a}else a[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(a);this._pending._newItems[h]=a;for(var b in c){if(b===this._storeRefPropName||b===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");
d=c[b];r.isArray(d)||(d=[d]);a[b]=d;if(this.referenceIntegrity)for(h=0;h<d.length;h++)g=d[h],this.isItem(g)&&this._addReferenceToMap(g,a,b)}this.onNew(a,k);return a},_removeArrayElement:function(c,d){d=m.indexOf(c,d);return-1!=d?(c.splice(d,1),!0):!1},deleteItem:function(c){this._assert(!this._saveInProgress);this._assertIsItem(c);var d=c[this._itemNumPropName],n=this.getIdentity(c);if(this.referenceIntegrity){var k=this.getAttributes(c);c[this._reverseRefMap]&&(c["backup_"+this._reverseRefMap]=r.clone(c[this._reverseRefMap]));
m.forEach(k,function(a){m.forEach(this.getValues(c,a),function(b){this.isItem(b)&&(c["backupRefs_"+this._reverseRefMap]||(c["backupRefs_"+this._reverseRefMap]=[]),c["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(b),attr:a}),this._removeReferenceFromMap(b,c,a))},this)},this);if(k=c[this._reverseRefMap])for(var a in k){var g=null;if(g=this._itemsByIdentity?this._itemsByIdentity[a]:this._arrayOfAllItems[a])for(var f in k[a]){var b=this.getValues(g,f)||[],e=m.filter(b,function(a){return!(this.isItem(a)&&
this.getIdentity(a)==n)},this);this._removeReferenceFromMap(c,g,f);e.length<b.length&&this._setValueOrValues(g,f,e,!0)}}}this._arrayOfAllItems[d]=null;c[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[n];this._pending._deletedItems[n]=c;c[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,c);this.onDelete(c);return!0},setValue:function(c,d,n){return this._setValueOrValues(c,d,n,!0)},setValues:function(c,d,n){return this._setValueOrValues(c,
d,n,!0)},unsetAttribute:function(c,d){return this._setValueOrValues(c,d,[],!0)},_setValueOrValues:function(c,d,n,k){this._assert(!this._saveInProgress);this._assertIsItem(c);this._assert(r.isString(d));this._assert("undefined"!==typeof n);var a=this._getIdentifierAttribute();if(d==a)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var a=this._getValueOrValues(c,d),g=this.getIdentity(c);if(!this._pending._modifiedItems[g]){var f={},b;for(b in c)f[b]=
b===this._storeRefPropName||b===this._itemNumPropName||b===this._rootItemPropName?c[b]:b===this._reverseRefMap?r.clone(c[b]):c[b].slice(0,c[b].length);this._pending._modifiedItems[g]=f}g=!1;if(r.isArray(n)&&0===n.length){if(g=delete c[d],n=void 0,this.referenceIntegrity&&a){b=a;r.isArray(b)||(b=[b]);for(var e=0;e<b.length;e++)f=b[e],this.isItem(f)&&this._removeReferenceFromMap(f,c,d)}}else{g=r.isArray(n)?n.slice(0,n.length):[n];if(this.referenceIntegrity)if(a){b=a;r.isArray(b)||(b=[b]);var h={};m.forEach(b,
function(a){this.isItem(a)&&(a=this.getIdentity(a),h[a.toString()]=!0)},this);m.forEach(g,function(a){if(this.isItem(a)){var b=this.getIdentity(a);h[b.toString()]?delete h[b.toString()]:this._addReferenceToMap(a,c,d)}},this);for(e in h)this._removeReferenceFromMap(this._itemsByIdentity?this._itemsByIdentity[e]:this._arrayOfAllItems[e],c,d)}else for(e=0;e<g.length;e++)f=g[e],this.isItem(f)&&this._addReferenceToMap(f,c,d);c[d]=g;g=!0}if(k)this.onSet(c,d,a,n);return g},_addReferenceToMap:function(c,
d,n){d=this.getIdentity(d);var k=c[this._reverseRefMap];k||(k=c[this._reverseRefMap]={});(c=k[d])||(c=k[d]={});c[n]=!0},_removeReferenceFromMap:function(c,d,n){d=this.getIdentity(d);var k=c[this._reverseRefMap],a;if(k){for(a in k)a==d&&(delete k[a][n],this._isEmpty(k[a])&&delete k[a]);this._isEmpty(k)&&delete c[this._reverseRefMap]}},_dumpReferenceMap:function(){var c;for(c=0;c<this._arrayOfAllItems.length;c++){var d=this._arrayOfAllItems[c];d&&d[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(d)+
"] is referenced by: "+l.toJson(d[this._reverseRefMap]))}},_getValueOrValues:function(c,d){var h=void 0;this.hasAttribute(c,d)&&(c=this.getValues(c,d),h=1==c.length?c[0]:c);return h},_flatten:function(c){if(this.isItem(c))return{_reference:this.getIdentity(c)};if("object"===typeof c)for(var d in this._datatypeMap){var n=this._datatypeMap[d];if(r.isObject(n)&&!r.isFunction(n)){if(c instanceof n.type){if(!n.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+d+"]");
return{_type:d,_value:n.serialize(c)}}}else if(c instanceof n)return{_type:d,_value:c.toString()}}return c},_getNewFileContentString:function(){var c={},d=this._getIdentifierAttribute();d!==Number&&(c.identifier=d);this._labelAttr&&(c.label=this._labelAttr);c.items=[];for(d=0;d<this._arrayOfAllItems.length;++d){var n=this._arrayOfAllItems[d];if(null!==n){var k={},a;for(a in n)if(a!==this._storeRefPropName&&a!==this._itemNumPropName&&a!==this._reverseRefMap&&a!==this._rootItemPropName){var g=this.getValues(n,
a);if(1==g.length)k[a]=this._flatten(g[0]);else for(var f=[],b=0;b<g.length;++b)f.push(this._flatten(g[b])),k[a]=f}c.items.push(k)}}return l.toJson(c,!0)},_isEmpty:function(c){var d=!0;if(r.isObject(c))for(var n in c){d=!1;break}else r.isArray(c)&&0<c.length&&(d=!1);return d},save:function(d){this._assert(!this._saveInProgress);this._saveInProgress=!0;var h=this,n=function(){h._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};h._saveInProgress=!1;d&&d.onComplete&&d.onComplete.call(d.scope||
c.global)},k=function(a){h._saveInProgress=!1;d&&d.onError&&d.onError.call(d.scope||c.global,a)};if(this._saveEverything){var a=this._getNewFileContentString();this._saveEverything(n,k,a)}this._saveCustom&&this._saveCustom(n,k);this._saveEverything||this._saveCustom||n()},revert:function(){this._assert(!this._saveInProgress);for(var c in this._pending._modifiedItems){var d=this._pending._modifiedItems[c],n=null,n=this._itemsByIdentity?this._itemsByIdentity[c]:this._arrayOfAllItems[c];d[this._storeRefPropName]=
this;for(var k in n)delete n[k];r.mixin(n,d)}var a;for(c in this._pending._deletedItems)a=this._pending._deletedItems[c],a[this._storeRefPropName]=this,d=a[this._itemNumPropName],a["backup_"+this._reverseRefMap]&&(a[this._reverseRefMap]=a["backup_"+this._reverseRefMap],delete a["backup_"+this._reverseRefMap]),this._arrayOfAllItems[d]=a,this._itemsByIdentity&&(this._itemsByIdentity[c]=a),a[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(a);for(c in this._pending._deletedItems)a=this._pending._deletedItems[c],
a["backupRefs_"+this._reverseRefMap]&&(m.forEach(a["backupRefs_"+this._reverseRefMap],function(c){this._addReferenceToMap(this._itemsByIdentity?this._itemsByIdentity[c.id]:this._arrayOfAllItems[c.id],a,c.attr)},this),delete a["backupRefs_"+this._reverseRefMap]);for(c in this._pending._newItems)d=this._pending._newItems[c],d[this._storeRefPropName]=null,this._arrayOfAllItems[d[this._itemNumPropName]]=null,d[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,d),this._itemsByIdentity&&
delete this._itemsByIdentity[c];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(c){return c?(c=this.getIdentity(c),(new Boolean(this._pending._newItems[c]||this._pending._modifiedItems[c]||this._pending._deletedItems[c])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},onSet:function(c,d,n,k){},onNew:function(c,d){},onDelete:function(c){},close:function(c){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");
this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),function(r,d,m,l,c,t,q,p,h){m=m("dojo.data.ItemFileReadStore",[t],{constructor:function(c){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=c.url;this._jsonData=c.data;this.data=null;this._datatypeMap=c.typeMap||
{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(c){return h.fromISOString(c)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==c.urlPreventCache&&(this.urlPreventCache=c.urlPreventCache?!0:!1);void 0!==c.hierarchical&&(this.hierarchical=c.hierarchical?
!0:!1);c.clearOnClose&&(this.clearOnClose=!0);"failOk"in c&&(this.failOk=c.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(c){if(!this.isItem(c))throw Error(this.declaredClass+": Invalid item argument.");},_assertIsAttribute:function(c){if("string"!==typeof c)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(c,d,a){c=this.getValues(c,d);return 0<c.length?c[0]:a},getValues:function(c,
d){this._assertIsItem(c);this._assertIsAttribute(d);return(c[d]||[]).slice(0)},getAttributes:function(c){this._assertIsItem(c);var d=[],a;for(a in c)a!==this._storeRefPropName&&a!==this._itemNumPropName&&a!==this._rootItemPropName&&a!==this._reverseRefMap&&d.push(a);return d},hasAttribute:function(c,d){this._assertIsItem(c);this._assertIsAttribute(d);return d in c},containsValue:function(c,d,a){var g=void 0;"string"===typeof a&&(g=q.patternToRegExp(a,!1));return this._containsValue(c,d,a,g)},_containsValue:function(c,
k,a,g){return l.some(this.getValues(c,k),function(f){if(null!==f&&!d.isObject(f)&&g){if(f.toString().match(g))return!0}else if(a===f)return!0})},isItem:function(c){return c&&c[this._storeRefPropName]===this&&this._arrayOfAllItems[c[this._itemNumPropName]]===c?!0:!1},isItemLoaded:function(c){return this.isItem(c)},loadItem:function(c){this._assertIsItem(c.item)},getFeatures:function(){return this._features},getLabel:function(c){if(this._labelAttr&&this.isItem(c))return this.getValue(c,this._labelAttr)},
getLabelAttributes:function(c){return this._labelAttr?[this._labelAttr]:null},filter:function(c,d,a){var g=[],f,b;if(c.query){var e;f=c.queryOptions?c.queryOptions.ignoreCase:!1;var k={};for(b in c.query)e=c.query[b],"string"===typeof e?k[b]=q.patternToRegExp(e,f):e instanceof RegExp&&(k[b]=e);for(f=0;f<d.length;++f){var h=!0,n=d[f];if(null===n)h=!1;else for(b in c.query)e=c.query[b],this._containsValue(n,b,e,k[b])||(h=!1);h&&g.push(n)}}else for(f=0;f<d.length;++f)b=d[f],null!==b&&g.push(b);a(g,c)},
_fetchItems:function(h,k,a){var g=this;if(this._loadFinished)this.filter(h,this._getItemsArray(h.queryOptions),k);else if(this._jsonFileUrl!==this._ccUrl?(r.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:h,
filter:d.hitch(g,"filter"),findCallback:d.hitch(g,k)});else{this._loadInProgress=!0;var f=c.get({url:g._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});f.addCallback(function(b){try{g._getItemsFromLoadedData(b),g._loadFinished=!0,g._loadInProgress=!1,g.filter(h,g._getItemsArray(h.queryOptions),k),g._handleQueuedFetches()}catch(u){g._loadFinished=!0,g._loadInProgress=!1,a(u,h)}});f.addErrback(function(b){g._loadInProgress=!1;a(b,h)});var b=null;h.abort&&
(b=h.abort);h.abort=function(){var a=f;a&&-1===a.fired&&(a.cancel(),a=null);b&&b.call(h)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,g.filter(h,this._getItemsArray(h.queryOptions),k)}catch(e){a(e,h)}else a(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),h)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var c=0;c<this._queuedFetches.length;c++){var d=
this._queuedFetches[c],a=d.args,g=d.filter,d=d.findCallback;g?g(a,this._getItemsArray(a.queryOptions),d):this.fetchItemByIdentity(a)}this._queuedFetches=[]}},_getItemsArray:function(c){return c&&c.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(c){this.clearOnClose&&this._loadFinished&&!this._loadInProgress&&(""!=this._jsonFileUrl&&null!=this._jsonFileUrl||""!=this.url&&null!=this.url||null!=this.data||console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),
this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(c){function k(a){return null!==a&&"object"===typeof a&&(!d.isArray(a)||g)&&!d.isFunction(a)&&(a.constructor==Object||d.isArray(a))&&"undefined"===typeof a._reference&&"undefined"===typeof a._type&&"undefined"===typeof a._value&&f.hierarchical}function a(b){f._arrayOfAllItems.push(b);for(var e in b){var c=b[e];if(c)if(d.isArray(c))for(var g=
0;g<c.length;++g){var h=c[g];k(h)&&a(h)}else k(c)&&a(c)}}var g=!1,f=this;this._labelAttr=c.label;var b,e;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=c.items;for(b=0;b<this._arrayOfTopLevelItems.length;++b)e=this._arrayOfTopLevelItems[b],d.isArray(e)&&(g=!0),a(e),e[this._rootItemPropName]=!0;var h={},n;for(b=0;b<this._arrayOfAllItems.length;++b)for(n in e=this._arrayOfAllItems[b],e){if(n!==this._rootItemPropName){var l=e[n];null!==l?d.isArray(l)||(e[n]=[l]):e[n]=[null]}h[n]=n}for(;h[this._storeRefPropName];)this._storeRefPropName+=
"_";for(;h[this._itemNumPropName];)this._itemNumPropName+="_";for(;h[this._reverseRefMap];)this._reverseRefMap+="_";if(h=c.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=h,b=0;b<this._arrayOfAllItems.length;++b)if(e=this._arrayOfAllItems[b],c=e[h],c=c[0],Object.hasOwnProperty.call(this._itemsByIdentity,c)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+
h+"].  Value collided: ["+c+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+h+"].  Value collided: ["+c+"]");}else this._itemsByIdentity[c]=e;else this._features["dojo.data.api.Identity"]=Number;for(b=0;b<this._arrayOfAllItems.length;++b)e=this._arrayOfAllItems[b],e[this._storeRefPropName]=this,e[this._itemNumPropName]=b;for(b=0;b<this._arrayOfAllItems.length;++b)for(n in e=this._arrayOfAllItems[b],
e)for(c=e[n],h=0;h<c.length;++h)if(l=c[h],null!==l&&"object"==typeof l){if("_type"in l&&"_value"in l){var p=l._type,q=this._datatypeMap[p];if(q)if(d.isFunction(q))c[h]=new q(l._value);else if(d.isFunction(q.deserialize))c[h]=q.deserialize(l._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+
p+"'");}if(l._reference){l=l._reference;if(d.isObject(l))for(p=0;p<this._arrayOfAllItems.length;++p){var q=this._arrayOfAllItems[p],m=!0,t;for(t in l)q[t]!=l[t]&&(m=!1);m&&(c[h]=q)}else c[h]=this._getItemByIdentity(l);this.referenceIntegrity&&(l=c[h],this.isItem(l)&&this._addReferenceToMap(l,e,n))}else this.isItem(l)&&this.referenceIntegrity&&this._addReferenceToMap(l,e,n)}},_addReferenceToMap:function(c,d,a){},getIdentity:function(c){var d=this._features["dojo.data.api.Identity"];return d===Number?
c[this._itemNumPropName]:(c=c[d])?c[0]:null},fetchItemByIdentity:function(d){var h,a;if(this._loadFinished)h=this._getItemByIdentity(d.identity),d.onItem&&(a=d.scope?d.scope:r.global,d.onItem.call(a,h));else{var g=this;this._jsonFileUrl!==this._ccUrl?(r.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=
this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:d}):(this._loadInProgress=!0,a=c.get({url:g._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),a.addCallback(function(a){var b=d.scope?d.scope:r.global;try{g._getItemsFromLoadedData(a),g._loadFinished=!0,g._loadInProgress=!1,h=g._getItemByIdentity(d.identity),d.onItem&&d.onItem.call(b,h),g._handleQueuedFetches()}catch(e){g._loadInProgress=
!1,d.onError&&d.onError.call(b,e)}}),a.addErrback(function(a){g._loadInProgress=!1;d.onError&&d.onError.call(d.scope?d.scope:r.global,a)})):this._jsonData&&(g._getItemsFromLoadedData(g._jsonData),g._jsonData=null,g._loadFinished=!0,h=g._getItemByIdentity(d.identity),d.onItem&&(a=d.scope?d.scope:r.global,d.onItem.call(a,h)))}},_getItemByIdentity:function(c){var d=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,c)&&(d=this._itemsByIdentity[c]):Object.hasOwnProperty.call(this._arrayOfAllItems,
c)&&(d=this._arrayOfAllItems[c]);void 0===d&&(d=null);return d},getIdentityAttributes:function(c){c=this._features["dojo.data.api.Identity"];return c===Number?null:[c]},_forceLoad:function(){var d=this;this._jsonFileUrl!==this._ccUrl?(r.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=
this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var h=c.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});h.addCallback(function(a){try{if(!0!==d._loadInProgress&&!d._loadFinished)d._getItemsFromLoadedData(a),d._loadFinished=!0;else if(d._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(g){throw console.log(g),g;}});h.addErrback(function(a){throw a;
})}else this._jsonData&&(d._getItemsFromLoadedData(d._jsonData),d._jsonData=null,d._loadFinished=!0)}});d.extend(m,p);return m})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(r){var d={};r.setObject("dojo.data.util.filter",d);d.patternToRegExp=function(d,l){for(var c="^",m=null,q=0;q<d.length;q++)switch(m=d.charAt(q),m){case "\\":c+=m;q++;c+=d.charAt(q);break;case "*":c+=".*";break;case "?":c+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":c+=
"\\";default:c+=m}c+="$";return l?new RegExp(c,"mi"):new RegExp(c,"m")};return d})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(r,d,m){var l={};r.setObject("dojo.data.util.simpleFetch",l);l.errorHandler=function(c,l){l.onError&&l.onError.call(l.scope||d.global,c,l)};l.fetchHandler=function(c,l){var q=l.abort||null,p=!1,h=l.start?l.start:0,n=l.count&&Infinity!==l.count?h+l.count:c.length;l.abort=function(){p=!0;q&&q.call(l)};var k=l.scope||
d.global;l.store||(l.store=this);l.onBegin&&l.onBegin.call(k,c.length,l);l.sort&&c.sort(m.createSortFunction(l.sort,this));if(l.onItem)for(var a=h;a<c.length&&a<n;++a){var g=c[a];p||l.onItem.call(k,g,l)}l.onComplete&&!p&&(a=null,l.onItem||(a=c.slice(h,n)),l.onComplete.call(k,a,l))};l.fetch=function(c){c=c||{};c.store||(c.store=this);this._fetchItems(c,r.hitch(this,"fetchHandler"),r.hitch(this,"errorHandler"));return c};return l})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(r){var d=
{};r.setObject("dojo.data.util.sorter",d);d.basicComparator=function(d,l){var c=-1;null===d&&(d=void 0);null===l&&(l=void 0);if(d==l)c=0;else if(d>l||null==d)c=1;return c};d.createSortFunction=function(m,l){function c(a,f,b,e){return function(c,g){c=e.getValue(c,a);g=e.getValue(g,a);return f*b(c,g)}}for(var t=[],q,p=l.comparatorMap,h=d.basicComparator,n=0;n<m.length;n++){q=m[n];var k=q.attribute;if(k){q=q.descending?-1:1;var a=h;p&&("string"!==typeof k&&"toString"in k&&(k=k.toString()),a=p[k]||h);
t.push(c(k,q,a,l))}}return function(a,f){for(var b=0;b<t.length;){var e=t[b++](a,f);if(0!==e)return e}return 0}};return d})},"jimu/Query":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/Deferred jimu/utils jimu/ServiceDefinitionManager esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet".split(" "),function(r,d,m,l,c,t,q,p,h,n){var k=r(null,{queryType:0,nextPageIndex:1,pageSizeOption:null,layerDefinition:null,layerDefinitionDef:null,type1CountDef:null,
type2ObjectIdsDef:null,type3QueryDef:null,sdf:null,url:null,query:null,pageSize:1E3,constructor:function(a){this.sdf=q.getInstance();this.url=a.url;this.query=a.query;this.pageSizeOption=a.pageSize;this.query.outFields&&0!==this.query.outFields.length||(this.query.outFields=["*"]);this.pageSize=0<a.pageSize?a.pageSize:1E3;this.getFeatureCount()},getFeatureCount:function(){return this._getQueryType().then(d.hitch(this,function(a){return 1===a?this._getCountForQueryType1():2===a?this._getCountForQueryType2():
this._getCountForQueryType3()}))},getPageCount:function(){return this.getFeatureCount().then(d.hitch(this,function(a){return 0===a?0:Math.ceil(a/this.pageSize)}))},getAllFeatures:function(){return this.getPageCount().then(d.hitch(this,function(a){if(0<a){for(var c=[],f=1;f<=a;f++)c.push(this.queryByPage(f));return l(c).then(d.hitch(this,function(a){for(var b=[],f=0;f<a.length;f++)a[f].features&&0<a[f].features.length&&(b=b.concat(a[f].features));b=this._setOrderByFieldValue(b);a=a[0];a.features=b;
return a}))}this._getEmptyFeatureSet().then(d.hitch(this,function(a){return a}))}))},_setOrderByFieldValue:function(a){if(2===this.queryType||3===this.queryType){var c=this.query.outFields;a.sort(function(a,b){a=a.attributes[c];b=b.attributes[c];return"string"===typeof a&&"string"===typeof b?a.localeCompare(b):a<b?-1:a===b?0:1})}return a},_getEmptyFeatureSet:function(){var a=new c;this.layerDefinition&&this.layerDefinition.geometryType?a.resolve(this._getEmptyFeatureSetHandler()):this._getLayerDefinition().then(d.hitch(this,
function(){a.resolve(this._getEmptyFeatureSetHandler())}));return a},_getEmptyFeatureSetHandler:function(){var a=new n;a.features=[];a.geometryType=this.layerDefinition.geometryType;a.fields=[];var c=d.clone(this.layerDefinition.fields);0<=this.query.outFields.indexOf("*")?a.fields=c:a.fields=m.filter(c,d.hitch(this,function(a){return 0<=this.query.outFields.indexOf(a.name)}));return a},getCurrentPageIndex:function(){return this.nextPageIndex},queryNextPage:function(){var a=this.nextPageIndex;this.nextPageIndex++;
return this.queryByPage(a)},queryByPage:function(a){var g=null;0>=a?(g=new c,this._getEmptyFeatureSet().then(d.hitch(this,function(a){g.resolve(a)}))):g=this.getPageCount().then(d.hitch(this,function(f){a>f&&this._getEmptyFeatureSet().then(d.hitch(this,function(a){return a}));return 1===this.queryType?this._queryPageForType1(a):2===this.queryType?this._queryPageForType2(a):this._queryPageForType3(a)}));return g},_getQueryType:function(){var a=new c;if(0<this.queryType)a.resolve(this.queryType);else return this._getLayerDefinition().then(d.hitch(this,
function(a){return this.queryType=k.getQueryType(a)}));return a},_getDefStatus:function(a){return a?a.isFulfilled()?a.isResolved()?2:-1:1:0},_getLayerDefinition:function(){0>=this._getDefStatus(this.layerDefinitionDef)&&(this.layerDefinitionDef=this.sdf.getServiceDefinition(this.url).then(d.hitch(this,function(a){this.layerDefinition=a;var c=a.maxRecordCount;0<c&&(!(0<this.pageSizeOption)||this.pageSize>a.maxRecordCount)&&(this.pageSize=c);return this.layerDefinition})));return this.layerDefinitionDef},
_getCountForQueryType1:function(){0>=this._getDefStatus(this.type1CountDef)&&(this.type1CountDef=this._queryCount());return this.type1CountDef},_getCountForQueryType2:function(){return this._getObjectIdsForQueryType2().then(d.hitch(this,function(a){return a.length}))},_getObjectIdsForQueryType2:function(){0>=this._getDefStatus(this.type2ObjectIdsDef)&&(this.type2ObjectIdsDef=this._queryIds());return this.type2ObjectIdsDef},_getCountForQueryType3:function(){return this._doQueryForQueryType3().then(d.hitch(this,
function(a){return(a.features||[]).length}))},_doQueryForQueryType3:function(){0>=this._getDefStatus(this.type3QueryDef)&&(this.type3QueryDef=this._query());return this.type3QueryDef},_queryPageForType1:function(a){return this._queryWithPaginationAndOrder((a-1)*this.pageSize)},_queryPageForType2:function(a){return this._getObjectIdsForQueryType2().then(d.hitch(this,function(c){var f=(a-1)*this.pageSize;c=c.slice(f,f+this.pageSize);return this._queryByObjectIds(c)}))},_queryPageForType3:function(a){return this._doQueryForQueryType3().then(d.hitch(this,
function(c){var f=d.mixin({},c);f.features=[];var b=(a-1)*this.pageSize;f.features=(c.features||[]).slice(b,b+this.pageSize);return f}))},_tryLocaleNumber:function(a){var c=t.localizeNumber(a);if(null===c||void 0===c)c=a;return c},_tryLocaleDate:function(a){var c=t.localizeDate(a);c||(c=a.toLocaleDateString());return c},_getLayerIndexByLayerUrl:function(a){var c=a.lastIndexOf("/");a=a.slice(c+1,a.length);return parseInt(a,10)},_getServiceUrlByLayerUrl:function(a){var c=a.lastIndexOf("/");return a.slice(0,
c)},_isImageServiceLayer:function(a){return-1<a.indexOf("/ImageServer")},_isTable:function(a){return"Table"===a.type},_getObjectIdField:function(){return this.layerDefinition.objectIdField},_query:function(a){var c=new p;c.where=a||this.query.where;c.geometry=this.query.geometry;c.outSpatialReference=this.query.outSpatialReference;c.returnGeometry=this.query.returnGeometry;c.spatialRelationship=this.query.spatialRelationship;c.outFields=this.query.outFields;c.returnDistinctValues=this.query.returnDistinctValues;
return(new h(this.url)).execute(c)},_queryIds:function(){var a=new p;a.where=this.query.where;a.geometry=this.query.geometry;a.returnGeometry=!1;a.spatialRelationship=this.query.spatialRelationship;a.outSpatialReference=this.query.outSpatialReference;return(new h(this.url)).executeForIds(a).then(d.hitch(this,function(a){a||(a=[]);return a}))},_queryByObjectIds:function(a){var g=new c,f=new p;f.returnGeometry=this.query.returnGeometry;f.outSpatialReference=this.query.outSpatialReference;f.spatialRelationship=
this.query.spatialRelationship;f.outFields=this.query.outFields;f.objectIds=a;(new h(this.url)).execute(f).then(d.hitch(this,function(a){g.resolve(a)}),d.hitch(this,function(b){if(400===b.code){var e=this._getObjectIdField(),c="",f=a.length;m.forEach(a,d.hitch(this,function(a,b){c+=e+" \x3d "+a;b!==f-1&&(c+=" OR ")}));this._query(c).then(d.hitch(this,function(a){g.resolve(a)}),d.hitch(this,function(a){g.reject(a)}))}else g.reject(b)}));return g},_queryCount:function(){var a=new p;a.where=this.query.where;
a.geometry=this.query.geometry;a.outSpatialReference=this.query.outSpatialReference;a.spatialRelationship=this.query.spatialRelationship;a.returnGeometry=!1;return(new h(this.url)).executeForCount(a)},_queryWithPaginationAndOrder:function(a){var c=new p;c.where=this.query.where;c.geometry=this.query.geometry;c.outSpatialReference=this.query.outSpatialReference;c.returnGeometry=this.query.returnGeometry;c.spatialRelationship=this.query.spatialRelationship;c.outFields=this.query.outFields;c.returnDistinctValues=
this.query.returnDistinctValues;c.start=a;c.num=this.pageSize;(a=this.query.orderByFields)&&0<a.length&&(c.orderByFields=a,a=m.map(a,d.hitch(this,function(a){return a.split(" ")[0]})),m.forEach(a,d.hitch(this,function(a){0>c.outFields.indexOf(a)&&c.outFields.push(a)})));return(new h(this.url)).execute(c)}});k._isServiceSupportsOrderBy=function(a){var c=!1;a.advancedQueryCapabilities&&a.advancedQueryCapabilities.supportsOrderBy&&(c=!0);return c};k._isServiceSupportsPagination=function(a){var c=!1;
a.advancedQueryCapabilities&&a.advancedQueryCapabilities.supportsPagination&&(c=!0);return c};k._isSupportObjectIds=function(a){var c=0;a.currentVersion&&(c=parseFloat(a.currentVersion));return 10<=c||a.hasOwnProperty("typeIdField")};k.getQueryType=function(a){var c=-1;return c=k._isServiceSupportsOrderBy(a)&&k._isServiceSupportsPagination(a)?1:k._isSupportObjectIds(a)?2:3};return k})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager","./utils"],function(r,d){function m(){this.versions=
[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(d){return d},compatible:!0},{version:"1.1",description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(d){d.widgetOnScreen&&d.widgetOnScreen.panel&&("themes/FoldableTheme/panels/TitlePanel/Panel"===d.widgetOnScreen.panel.uri||"jimu/BaseWidgetPanel"===d.widgetOnScreen.panel.uri)&&(d.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel");return d},compatible:!0},{version:"1.2",
description:"The version embedded in online3.7.",upgrader:function(d){var c=0;if(d.widgetOnScreen&&d.widgetOnScreen.widgets){for(var l=!1,c=0;c<d.widgetOnScreen.widgets.length;c++)"widgets/Splash/Widget"===d.widgetOnScreen.widgets[c].uri&&(l=!0);l||d.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});l=!1;for(c=0;c<d.widgetOnScreen.widgets.length;c++)"widgets/TimeSlider/Widget"===d.widgetOnScreen.widgets[c].uri&&(l=!0);l||d.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",
visible:!1,position:{bottom:55,left:7},version:"1.2"});l=!1;for(c=0;c<d.widgetOnScreen.widgets.length;c++)"widgets/Swipe/Widget"===d.widgetOnScreen.widgets[c].uri&&(l=!0);l||d.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return d},compatible:!0},{version:"1.3",description:"The version embedded in online3.8 \x26 online3.9.",upgrader:function(l){(function(c){d.visitElement(c,function(c){c.positionRelativeTo&&(c.position?c.position.relativeTo=
c.positionRelativeTo:c.position={relativeTo:c.positionRelativeTo},c.panel&&(c.panel.position?c.panel.position.relativeTo=c.panel.positionRelativeTo:c.panel.position={relativeTo:c.panel.positionRelativeTo}))});var l=c.widgetOnScreen;l&&l.panel&&l.panel.positionRelativeTo&&(l.panel.position?l.panel.position.relativeTo=l.panel.positionRelativeTo:l.panel.position={relativeTo:l.panel.positionRelativeTo});(l=c.widgetPool)&&l.panel&&l.panel.positionRelativeTo&&(l.panel.position?l.panel.position.relativeTo=
l.panel.positionRelativeTo:l.panel.position={relativeTo:l.panel.positionRelativeTo})})(l);l.widgetOnScreen&&l.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===l.widgetOnScreen.panel.uri&&(l.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");(function(c){if(c.widgetOnScreen&&c.widgetOnScreen.widgets&&c.theme&&"FoldableTheme"===c.theme.name){var d=null,l=null;if(d=c.widgetOnScreen.widgets[4])void 0!==d.position.top?(d={position:{left:205,top:45}},l={position:{left:255,top:45}}):(d={position:{left:205,
bottom:55}},l={position:{left:255,bottom:55}}),c.widgetOnScreen.widgets.splice(7,0,d,l)}})(l);(function(){for(var c=0,d=0,q=!1,c=0;c<l.widgetOnScreen.widgets.length;c++)if("widgets/Geocoder/Widget"===l.widgetOnScreen.widgets[c].uri){q=!0;break}for(var p=!1,d=0;d<l.widgetOnScreen.widgets.length;d++)if("widgets/Search/Widget"===l.widgetOnScreen.widgets[d].uri){p=!0;break}!p&&q&&(c=l.widgetOnScreen.widgets[c],c.uri="widgets/Search/Widget",c.name="Search")})(l);(function(c){for(var d=0,d=c.widgetOnScreen.widgets.length-
1;0<=d;d--){var l=c.widgetOnScreen.widgets[d];if("widgets/Swipe/Widget"===l.uri&&!l.closeable&&(c.widgetOnScreen.widgets.splice(d,1),!1!==l.visible)){l.closeable=!0;var p;a:{for(p=p=0;p<c.widgetOnScreen.widgets.length;p++)if(!c.widgetOnScreen.widgets[p].uri)break a;p=-1}0<=p&&(l.position=c.widgetOnScreen.widgets[p].position,c.widgetOnScreen.widgets[p]=l)}"widgets/TimeSlider/Widget"===l.uri&&(!1===l.visible?c.widgetOnScreen.widgets.splice(d,1):l.closeable=!0)}})(l);l.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",
position:{top:5,left:7},version:"1.3"});l.loadingPage||(l.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return l},compatible:!0},{version:"1.4",description:"The version embedded in online3.10.",upgrader:function(d){if(d.theme){var c=d.theme.name;if(("FoldableTheme"===c||"JewelryBoxTheme"===c)&&d.widgetOnScreen){var l=d.widgetOnScreen.widgets;if(l&&0<l.length)for(var c="themes/"+
c+"/widgets/HeaderController/Widget",q=null,p=0;p<l.length;p++)(q=l[p])&&q.uri===c&&q.position&&310===q.position.paddingRight&&(q.position.paddingRight=275)}}return d},compatible:!0},{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(d){d.keepAppState=!0;return d},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(d){return d},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(d){return d},
compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(d){return d},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",upgrader:function(d){return d},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(d){function c(d,h){if(!d||!h)return!1;for(var n in h)if(h.hasOwnProperty(n))if("object"===typeof h[n]){if(!c(d[n],h[n]))return!1}else if(d[n]!==h[n])return!1;return!0}function l(d){function h(){var a=c(d[3],
{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),g=c(d[12],{position:{top:10,right:195}});return a&&g}function n(){var a=c(d[3],{uri:"widgets/MyLocation/Widget",position:{left:15,bottom:45}}),g=c(d[12],{position:{left:15,top:233}});return a&&g}function k(){var a=c(d[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),g=c(d[12],{position:{right:15,top:195}});return a&&g}(function(){var a=c(d[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),g=c(d[12],{position:{left:240,
top:53}});return a&&g})()?d.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):h()?d.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):n()?d.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,bottom:195},version:"2.3"}):k()&&d.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"})}function q(d){function h(){var h=c(d[9],{uri:"widgets/MyLocation/Widget",
position:{left:7,top:110}}),a=c(d[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),g=c(d[4],{position:{left:7,bottom:70}});return h&&a&&g}function n(){var h=c(d[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),a=c(d[2],{uri:"widgets/Search/Widget",position:{right:2,top:2,relativeTo:"browser"}}),g=c(d[4],{position:{left:7,bottom:70}});return h&&a&&g}(function(){var h=c(d[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),a=c(d[2],{uri:"widgets/Search/Widget",position:{left:55,
top:5}}),g=c(d[4],{position:{left:55,top:45}});return h&&a&&g}()||h()||n())&&d.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:148,left:7},version:"2.3"})}(function(d,h,n){d=d.theme&&d.theme.name;if("FoldableTheme"===d)if(c(h[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}))h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:150,left:7},version:"2.3"});else if(c(h[11],{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}}))h.push({uri:"widgets/ExtentNavigate/Widget",
visible:!1,position:{left:12,bottom:203},version:"2.3"}),n&&n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:12,top:211},version:"2.3"});else{if(c(h[11],{uri:"widgets/MyLocation/Widget",position:{left:164,bottom:14}})){h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:203,bottom:14,height:30},version:"2.3"});for(d=0;d<h.length;d++){var k=h[d];c(k,{uri:"widgets/Scalebar/Widget",position:{left:220,bottom:5}})&&(k.position.left=288);c(k,{uri:"widgets/Coordinate/Widget",
position:{left:395,bottom:5}})&&(k.position.left=463)}n&&n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:209,left:12},version:"2.3"})}}else if("BillboardTheme"===d)l(h);else if("BoxTheme"===d)h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:10,top:131},version:"2.3"});else if("JewelryBoxTheme"===d)q(h);else if("LaunchpadTheme"===d){if(c(h[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}})||c(h[6],{uri:"widgets/MyLocation/Widget",position:{left:25,
top:215}}))h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:255,left:25},version:"2.3"}),n&&n.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:10,bottom:238},version:"2.3"})}else"PlateauTheme"===d?(c(h[6],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:2.3}),c(h[6],{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}})&&h.push({uri:"widgets/ExtentNavigate/Widget",
visible:!1,position:{left:12,bottom:201},version:2.3})):"TabTheme"===d&&c(h[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:"2.3"})})(d,d.widgetOnScreen.widgets,d.mobileLayout&&d.mobileLayout.widgetOnScreen&&d.mobileLayout.widgetOnScreen.widgets);return d},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",upgrader:function(d){return d},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",
upgrader:function(d){function c(d,l){if(!d||!l)return!1;for(var p in l)if(l.hasOwnProperty(p))if("object"===typeof l[p]){if(!c(d[p],l[p]))return!1}else if(d[p]!==l[p])return!1;return!0}(function(d,l){d=d.theme&&d.theme.name;if("BillboardTheme"===d){d=c(l[8],{position:{left:60,top:53}});var p=c(l[8],{position:{left:15,top:53}});d||p?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},
version:"2.5"})}else if("BoxTheme"===d){a:{d=0;for(p=l.length;d<p;d++){var h=l[d];if(h&&h.uri&&"themes/BoxTheme/widgets/BoxController/Widget"===h.uri){d=h;break a}}d=null}c(d,{position:{right:0,bottom:0}})?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:8},version:"2.5"})}else"DartTheme"===d?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):
"FoldableTheme"===d?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"DashboardTheme"===d?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"JewelryBoxTheme"===d?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"LaunchpadTheme"===d?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:70,top:20},version:"2.5"}):"PlateauTheme"===d?l.push({uri:"widgets/FullScreen/Widget",
visible:!1,position:{right:8,top:8},version:"2.5"}):"TabTheme"===d&&(c(l[7],{position:{left:45,top:45}})?l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):l.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},version:"2.5"}))})(d,d.widgetOnScreen.widgets);return d},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",upgrader:function(d){return d},compatible:!0},{version:"2.7",description:"The version for Online 5.4.",
upgrader:function(d){return d},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",upgrader:function(d){function c(c){var d=[];if("object"===typeof c)for(var l in c){var h=c[l];"FeatureStatistics"===h.type&&d.push(h)}return d}(function(d){(d=d.dataSource&&d.dataSource.dataSources)&&(d=c(d))&&d.length&&d.forEach(function(c){(c=c.dataSchema&&c.dataSchema.statistics)&&c.length&&c.forEach(function(c){if(c&&"count"===c.statisticType&&"count"===c.outStatisticFieldName)c.outStatisticFieldName=
"STAT_COUNT";else{var d;d=(d=c.outStatisticFieldName)&&d.toUpperCase();c.outStatisticFieldName=d}})})})(d);return d},compatible:!0},{version:"2.9",description:"The version for Online 6.2.",upgrader:function(d){return d},compatible:!0},{version:"2.10",description:"The version for Online 6.3.",upgrader:function(d){return d},compatible:!0}];this.isCompatible=function(d,c){d=this.getVersionIndex(d);c=this.getVersionIndex(c);for(d+=1;d<=c;d++)if(!1===this.versions[d].compatible)return!1;return!0}}m.prototype=
new r;return m.prototype.constructor=m})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(r,d,m){d=this.getVersionIndex(d);m=this.getVersionIndex(m);if(d>m)throw Error("New version should higher than old version.");for(d+=1;d<=m;d++)this.versions[d].upgrader&&(r=this.versions[d].upgrader(r));return r};this.getVersionIndex=function(r){r=this.fixVersion(r);var d,m;for(m=0;m<this.versions.length;m++)this.versions[m].version===r&&
(d=m);null===r&&(d=-1);void 0===d&&(d=this.versions.length-1);return d};this.fixVersion=function(r){return r?r:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/IdentityManager esri/config esri/urlUtils esri/arcgis/utils".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z){var A=null,E;E=r(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a,b){this._removeHash(a);this.urlParams=a||{};this.widgetManager=k.getInstance();d.mixin(this,b)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(d.hitch(this,function(a){var b=this.checkConfig(a);if(b)throw Error(b);this.rawAppConfig=d.clone(a);u.getInstance().setRawAppConfig(this.rawAppConfig);
a=this._upgradeAppConfig(a);this._processAfterTryLoad(a);this.appConfig=a;if(this.urlParams.id)return this.loadWidgetsManifest(a).then(d.hitch(this,function(){return this.loadAndUpgradeAllWidgetsConfig(a)})).then(d.hitch(this,function(a){return this.updateNecessaryAttrOfResourceUrlInAppConfig(a,this.urlParams.id)})).then(d.hitch(this,function(){this._configLoaded=!0;this._setDocumentTitle(a);this._readAndSetSharedTheme(a);return this.getAppConfig()}));g.setPortalUrl(a.portalUrl);z.arcgisUrl=e.getBaseItemUrl(a.portalUrl);
return this._proesssWebTierAndSignin(a).then(d.hitch(this,function(){return this.urlParams.appid?window.appInfo.isRunInPortal?this._getAppConfigFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(d.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})):this._processNotInPortalAppProtocol(a).then(d.hitch(this,function(a){return this._getAppDataAddTemplateDataFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(d.hitch(this,function(b){b.appData.appConfig&&
(a=b.appData.appConfig);a._appData=b.appData;a.templateConfig=b.templateData;a.isTemplateApp=!0;return a}))})):this._processNotInPortalAppProtocol(a)})).then(d.hitch(this,function(a){this._processAfterTryLoad(a);this.appConfig=a;return a.map.itemId?a:(a.map["3D"]?f.getDefaultWebScene(a.portalUrl):f.getDefaultWebMap(a.portalUrl)).then(function(b){a.map.itemId=b;return a})})).then(d.hitch(this,function(a){return this.loadWidgetsManifest(a)})).then(d.hitch(this,function(a){return a._appData?a._appData.values&&
a._appData.values.webmap?f.getPortal(a.portalUrl).getItemById(a._appData.values.webmap).then(d.hitch(this,function(b){return n.template.mergeTemplateAppConfigToAppConfig(a,a._appData,b)})):n.template.mergeTemplateAppConfigToAppConfig(a,a._appData):a})).then(d.hitch(this,function(a){return this.loadAndUpgradeAllWidgetsConfig(a)})).then(d.hitch(this,function(a){return a._wabAppId?this.processResourceInAppConfigForConfigLoader(a,this.urlParams):a.appItemId&&-1<window.JSON.stringify(a).indexOf("${itemId}")?
this.updateNecessaryAttrOfResourceUrlInAppConfig(a,a.appItemId):a})).then(d.hitch(this,function(a){this.appConfig=a;this._configLoaded=!0;this._setDocumentTitle(a);this._readAndSetSharedTheme(a);return this.getAppConfig()}))}),d.hitch(this,function(a){this.showError(a);var b=new q;b.reject(a);return b}))},processResourceInAppConfigForConfigLoader:function(a,e){var c=a.portalUrl,g=a.appItemId,h=e.appid,k=new q,u=d.clone(a);this.updateNecessaryAttrOfResourceUrlInAppConfig(u,h).then(function(){if("config"===
e.mode){var d=this.getResourceUrlsOfAppConfig(a).result;0!==d.length?f.getItemResources(c,h).then(function(a){if(0===a.length)return d=d.map(function(a){return{resUrl:a}}),b.AddResourcesToItemForAppSave(c,d,g,h).then(function(){k.resolve(u)},function(a){console.warn("Add resource to template based app error:"+a.message||a);k.resolve(u)});k.resolve(u)},function(a){console.warn("Get resource of template based item error:"+a.message||a);k.resolve(u)}):k.resolve(u)}else k.resolve(u)}.bind(this),function(a){console.warn("Insert appId to resource url of appConfig error:"+
a.message||a);k.resolve(u)});return k},getResourceUrlsOfAppConfig:function(a){var b={test:function(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items\/(.)+\/resources\/inConfig\//.test(a)},func:d.hitch(this,function(a){return a.value})};return n.processItemResourceOfAppConfig(a,b)},updateNecessaryAttrOfResourceUrlInAppConfig:function(a,b){function e(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items\/(.)+\/resources\/inConfig\//.test(a)}function c(a,b){a=h.processItemIDAndTokenOfResources(b.value,
a);a=h.setResouceProtocolForHttps(a);var e=b.obj,c=b.key;"number"===typeof b.i?e[c][b.i]=a:e[c]=a;return!0}var g=a.portalUrl,h=this;return f.getPortal(g).getItemById(b).then(d.hitch(this,function(f){f={test:e,func:d.hitch(this,c,{appId:b,isPublic:"public"===f.access,portalUrl:g})};return n.processItemResourceOfAppConfig(a,f).appConfig}))},setResouceProtocolForHttps:function(a){var b=a;"https:"===window.location.protocol&&(b=a.replace(/^http(s?):\/\//i,"https://"));return b},processItemIDAndTokenOfResources:function(a,
b){0<a.indexOf("${itemId}")&&(a=a.replace("${itemId}",b.appId));/(\?|\&)token=.+/.test(a)&&(a=a.replace(/(\?|\&)token=.+/,""));b.isPublic||(b=g.getPortalCredential(b.portalUrl))&&(a+="?token\x3d"+b.token);return a},_setDocumentTitle:function(a){!window.isBuilder&&a&&a.title&&(document.title=n.stripHTML(a.title))},getAppConfig:function(){var a=d.clone(this.appConfig);a.getConfigElementById=function(a){return n.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return n.getConfigElementsByName(this,
a)};a.visitElement=function(a){n.visitElement(this,a)};this._addAuthorizedCrossOriginDomains(this.portalSelf,a);return a},_addAuthorizedCrossOriginDomains:function(a,b){a&&a.authorizedCrossOriginDomains&&g.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains);b&&b.authorizedCrossOriginDomains&&g.addAuthorizedCrossOriginDomains(b.authorizedCrossOriginDomains)},checkConfig:function(){return!1},processProxy:function(a){x.defaults.io.alwaysUseProxy=a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.alwaysUseProxy;
x.defaults.io.proxyUrl="";x.defaults.io.proxyRules=[];a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.url&&(x.defaults.io.proxyUrl=a.httpProxy.url);a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.rules&&m.forEach(a.httpProxy.rules,function(a){D.addProxyRule(a)})},addNeedValues:function(a){this._processNoUriWidgets(a);this._processEmptyGroups(a);this._addElementId(a);this._fixRepeatedId(a)},showError:function(a){a&&a.message&&l.create("div",{"class":"app-error",innerHTML:n.sanitizeHTML(a.message)},document.body)},
_tryLoadConfig:function(){"stemapp"===this.urlParams.id&&(this.urlParams.config=window.appInfo.appPath+"config.json",delete this.urlParams.id);if(this.urlParams.config)return this.configFile=this.urlParams.config,h(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(d.hitch(this,function(a){g.setPortalUrl(a.portalUrl);a.portalUrl&&(window.portalUrl=a.portalUrl);return this.urlParams.token?g.registerToken(this.urlParams.token).then(function(){return a}):a}));if(this.urlParams.id){window.appInfo.isRunInPortal=
!0;var a=e.getPortalUrlFromLocation(),b=new q;g.setPortalUrl(a);window.portalUrl=a;z.arcgisUrl=e.getBaseItemUrl(a);var c;this.urlParams.token?c=g.registerToken(this.urlParams.token):(c=new q,c.resolve());c.then(d.hitch(this,function(){f.getPortal(a).loadSelfInfo().then(d.hitch(this,function(c){this.portalSelf=c;c.allSSL&&"http:"===window.location.protocol?(console.log("redirect from http to https"),window.location.href=e.setHttpsProtocol(window.location.href),b.reject()):this._processSignIn(a).then(d.hitch(this,
function(){this._getAppConfigFromAppId(a,this.urlParams.id).then(d.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})).then(function(a){b.resolve(a)},function(a){b.reject(a)})}))}))}),d.hitch(this,function(a){this.showError(a)}));return b}this.configFile="config.json";return h(this.configFile,{handleAs:"json"}).then(d.hitch(this,function(a){g.setPortalUrl(a.portalUrl);a.portalUrl&&(window.portalUrl=a.portalUrl);return this.urlParams.token?
g.registerToken(this.urlParams.token).then(function(){return a}):a}))},_upgradeAppConfig:function(a){var b=window.wabVersion,e=a.wabVersion;a.configWabVersion=a.wabVersion;if(b===e)return a;var c=this.versionManager.getVersionIndex(e),f=this.versionManager.getVersionIndex(b);if(c>f)throw Error("Bad version number, "+e);a=this.versionManager.upgrade(a,e,b);a.wabVersion=b;return a},loadAndUpgradeAllWidgetsConfig:function(b){var e=new q,c=[];a.visitElement(b,d.hitch(this,function(a){a.uri&&(a=this.widgetManager.tryLoadWidgetConfig(a),
c.push(a))}));p(c).then(d.hitch(this,function(){e.resolve(b)}),function(a){e.reject(a)});return e},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);v.tokenValidity=10080;return a},_readAndSetSharedTheme:function(a){a.theme.sharedTheme||(a.theme.sharedTheme={useHeader:!1,useLogo:!1},a.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?
!0:!1);a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},a.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):console.error("Portal does not support sharedTheme."));a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?
this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!a.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(a.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),a.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(a){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var b=e.getPortalUrlFromLocation(),
b=e.getStandardPortalUrl(b);e.isOnline(b)&&(b=e.updateUrlProtocolByOtherUrl(b,a.portalUrl),a.map.portalUrl&&e.isSamePortalUrl(a.portalUrl,a.map.portalUrl)&&(a.map.portalUrl=b),a.portalUrl=b,a.httpProxy&&a.httpProxy.url&&(a.httpProxy.url=e.getPortalProxyUrl(b)))}},_processWidgetJsons:function(b){a.visitElement(b,function(a,b){b.isWidget&&a.uri&&n.widgetJson.processWidgetJson(a)})},_processNoUriWidgets:function(b){var e=0;a.visitElement(b,function(a,b){b.isWidget&&!a.uri&&(e++,a.placeholderIndex=e)})},
_processEmptyGroups:function(a){var b=0;a.widgetOnScreen.groups&&m.forEach(a.widgetOnScreen.groups,function(a){if(!a.widgets||a.widgets&&0===a.widgets.length)b++,a.placeholderIndex=b})},_addElementId:function(b){var e=0,c;a.visitElement(b,function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var b=a.id.lastIndexOf("_");-1<b&&(c=a.id.substr(b+1),e=Math.max(e,c))}});a.visitElement(b,function(a){a.id||(e++,a.id=a.itemId?a.itemId+"_"+e:a.uri?a.uri.replace(/\//g,"_")+"_"+e:"_"+e)})},_setPortalUrl:function(a){if(a.portalUrl){var b=
e.getPortalUrlFromLocation(),c=e.isOnline(b);e.isSamePortalUrl(a.portalUrl,b)||c||(window.appInfo.isRunInPortal=!1)}else window.isXT&&t("wab_portalurl")?a.portalUrl=t("wab_portalurl"):(window.appInfo.isRunInPortal=!0,a.portalUrl=e.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(a,b){a.portalUrl=e.setProtocol(a.portalUrl,b);a.map.portalUrl&&(a.map.portalUrl=e.setProtocol(a.map.portalUrl,b));a.httpProxy&&(a.httpProxy.url=e.setProtocol(a.httpProxy.url,b),a.httpProxy&&a.httpProxy.rules&&
m.forEach(a.httpProxy.rules,d.hitch(this,function(a){a.proxyUrl=e.setProtocol(a.proxyUrl,b)})))},_processInPortalAppProtocol:function(a){var b=new q,c=f.getPortal(a.portalUrl),g=d.hitch(this,function(c){if("https:"===window.location.protocol)this._changePortalUrlProtocol(a,"https");else{if(c){console.log("redirect from http to https");window.location.href=e.setHttpsProtocol(window.location.href);b.reject();return}this._changePortalUrlProtocol(a,"http")}this._checkLocale();b.resolve(a)});c.loadSelfInfo().then(d.hitch(this,
function(b){this.portalSelf=b;"private"===b.access?(b=0===a.portalUrl.toLowerCase().indexOf("https://"),g(b)):g(b.allSSL)}),d.hitch(this,function(a){b.reject(a)}));return b},_processNotInPortalAppProtocol:function(a){var b=new q;a.portalUrl?f.getPortal(a.portalUrl).loadSelfInfo().then(d.hitch(this,function(c){this.portalSelf=c;var f="https:"===window.location.protocol;(c.allSSL||f)&&this._changePortalUrlProtocol(a,"https");0!==a.portalUrl.toLowerCase().indexOf("https://")||f||g.isInConfigOrPreviewWindow()?
b.resolve(a):(console.log("redirect from http to https"),window.location.href=e.setHttpsProtocol(window.location.href),b.reject())}),d.hitch(this,function(a){b.reject(a)})):b.resolve(a);return b},_proesssWebTierAndSignin:function(a){var b=new q,e=!1,c=a.portalUrl;this._processWebTier(a).then(d.hitch(this,function(a){e=a;return f.getPortal(c).loadSelfInfo()})).then(d.hitch(this,function(a){this.portalSelf=a;return this._processSignIn(c,e)})).then(d.hitch(this,function(){b.resolve()}),function(a){b.reject(a)});
return b},_processWebTier:function(a){var b=new q,c=a.portalUrl;a.isWebTier?(g.addAuthorizedCrossOriginDomains([c]),g.isWebTierPortal(c).then(d.hitch(this,function(){var f=g.getPortalCredential(c);f&&f.ssl&&"http:"===window.location.protocol&&!g.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=e.setHttpsProtocol(window.location.href)):b.resolve(a.isWebTier)}),d.hitch(this,function(a){b.reject(a)}))):b.resolve(!1);return b},_processSignIn:function(a,b){var c=
new q,h=f.getPortal(a),k=e.getSharingUrl(a);window.appInfo.isRunInPortal?(b=v.checkSignInStatus(k),b.promise.always(d.hitch(this,function(){c.resolve()}))):(!g.isInBuilderWindow()&&!g.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&this.rawAppConfig&&this.rawAppConfig.appId&&!b&&g.registerOAuthInfo(a,this.rawAppConfig.appId),b=v.checkSignInStatus(k),b.promise.always(d.hitch(this,function(){g.xtGetCredentialFromCookie(a);h.loadSelfInfo().then(d.hitch(this,function(a){this.portalSelf=a;
this._checkLocale();c.resolve()}))})));return c},_checkLocale:function(){if(!g.isInConfigOrPreviewWindow()){var a=this.portalSelf.user&&this.portalSelf.user.culture||c.locale,a=a.toLowerCase();!this.urlParams.locale&&n.isLocaleChanged(c.locale,a)&&(t("wab_app_locale",a),window.location.reload())}},_getAppConfigFromTemplateAppId:function(a,b){var e=f.getPortal(a);return this._getWabAppIdAndDataFromTemplateAppId(a,b).then(d.hitch(this,function(b){var c=b.appId,f=b.appData;return p([this._getAppConfigFromAppId(a,
c),e.getItemData(f.source)]).then(d.hitch(this,function(a){var b;f.appConfig?(b=f.appConfig,delete f.appConfig):b=a[0];b=this._upgradeAppConfig(b);a=a[1];b._appData=f;b._wabAppId=c;b.templateConfig=a;b.isTemplateApp=!0;return b}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(a,b){var e=f.getPortal(a);return e.getItemData(b).then(function(a){return e.getItemData(a.source).then(function(b){return{appData:a,templateData:b}})})},_getWabAppIdAndDataFromTemplateAppId:function(a,b){var e=new q,
c=f.getPortal(a);c.getItemData(b).then(d.hitch(this,function(a){c.getItemById(a.source).then(d.hitch(this,function(b){b=D.urlToObject(b.url);e.resolve({appId:b.query.id,appData:a})}))}),function(a){e.reject(a)});return e},_getAppConfigFromAppId:function(a,b){return f.getPortal(a).getItemData(b)},_removeHash:function(a){for(var b in a)a[b]&&(a[b]=a[b].replace("#",""))},loadWidgetsManifest:function(b){function e(a,e,d){function g(e){return a.loadWidgetManifest(e).then(function(a){return a},function(a){console.log("Widget failed to load, it is removed.",
e.name);a.stack?console.error(a.stack):console.log(a);c(b,e)})}return e.itemId?f.getPortal(d).getItemById(e.itemId).then(function(a){e.uri=n.widgetJson.getUriFromItem(a);return g(e)},function(a){console.log("Widget is not loaded, it is removed.",e.name,a);c(b,e)}):g(e)}function c(a,b){function e(e){a[e]&&a[e].widgets&&(a[e].widgets=a[e].widgets.filter(function(a){if(b)return a.id!==b.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}));
a[e]&&a[e].groups&&a[e].groups.forEach(function(a){a.widgets&&(a.widgets=a.widgets.filter(function(a){if(b)return a.id!==b.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}))})}e("widgetOnScreen");e("widgetPool")}var g=[],h=new q;this.urlParams.manifest&&b._buildInfo&&b._buildInfo.widgetManifestsMerged&&delete b._buildInfo.widgetManifestsMerged;b._buildInfo&&b._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(d.hitch(this,
function(c){a.visitElement(b,d.hitch(this,function(a){a.widgets||!a.uri&&!a.itemId||(a.uri&&c[a.uri]?(this._addNeedValuesForManifest(c[a.uri],a.uri),n.widgetJson.addManifest2WidgetJson(a,c[a.uri])):g.push(e(this.widgetManager,a,b.portalUrl)))}));p(g).then(function(){h.resolve(b)})})):(a.visitElement(b,d.hitch(this,function(a){a.widgets||!a.uri&&!a.itemId||g.push(e(this.widgetManager,a,b.portalUrl))})),p(g).then(function(){h.resolve(b)}));setTimeout(function(){h.isResolved()||(c(b),h.resolve(b))},
6E4);return h},_addNeedValuesForManifest:function(a,b){d.mixin(a,n.getUriInfo(b));n.manifest.addManifestProperies(a);n.manifest.processManifestLabel(a,c.locale)},_loadMergedWidgetManifests:function(){return h(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_fixRepeatedId:function(b){var e=[];a.visitElement(b,function(a){0<=e.indexOf(a.id)&&(a.id+="_");e.push(a.id)})},_processUrlParams:function(a){var b=this.urlParams.itemid||this.urlParams.webmap;b&&a.map.itemId!==b&&(a.map.mapOptions&&
n.deleteMapOptions(a.map.mapOptions),a.map.itemId=b);this.urlParams.mode&&(a.mode=this.urlParams.mode);a.map.mapOptions||(a.map.mapOptions={});this.urlParams.scale&&(a.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)a.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});E.getInstance=function(a,b){null===A?A=new E(a,b):(A.urlParams=a||{},A.options=b);return A};return E})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all",
"jimu/portalUtils","jimu/utils"],function(r,d,m,l){return{AddResourcesToItemForAppSave:function(c,t,q,p){t=t||[];if(0===t.length){var h=new r;h.resolve(t);return h}t=t.map(function(c){var d=c.resUrl.split("resources/")[1],a=new r;c.b64?(c=l.b64toBlob(c.b64),a.resolve({blob:c,fileName:d.split("/")[1],prefixName:d.split("/")[0]})):(c=c.resUrl,0<c.indexOf("${itemId}")&&(c=c.replace("${itemId}",q)),l.resourcesUrlToBlob(c).then(function(c){a.resolve({blob:c,fileName:d.split("/")[1],prefixName:d.split("/")[0]},
function(c){console.error(c.message||c);a.reject(c)})}));return a});return d(t).then(function(h){if(h instanceof Array&&0<h.length)return h=h.map(function(d){var a=q;p&&(a=p);return m.addResource(c,a,d.blob,d.fileName,d.prefixName)}.bind(this)),d(h).then(function(c){return c})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(r,
d,m,l,c,t,q,p,h){var n=null,k=r(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(a){this.rawAppConfig=a},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var a=l.stringify(this.rawAppConfig.map);this.mapMd5=p(a)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var a=new m,d={};if(h.isInConfigOrPreviewWindow()||
!this.rawAppConfig||!this.rawAppConfig.map)return a.resolve(d),a;var f=this._getAppStateKey(),b=q.get(f);b&&b.appStateMd5===this._getAppStateMd5()?(f=b.map&&b.map.extent,b=b.map&&b.map.layers,f&&(d.extent=new c(f.xmin,f.ymin,f.xmax,f.ymax,new t(f.spatialReference))),b&&(d.layers=b)):q.remove(f);a.resolve(d);return a},saveWabAppState:function(a,c){if(a&&!h.isInConfigOrPreviewWindow()){var f=this._getAppStateKey(),b={extent:{xmin:a.extent.xmin,xmax:a.extent.xmax,ymin:a.extent.ymin,ymax:a.extent.ymax,
spatialReference:{wkid:a.extent.spatialReference.wkid,wkt:a.extent.spatialReference.wkt}},layers:{}};c&&c.traversal&&c.traversal(d.hitch(this,function(a){b.layers[a.id]={visible:a.isVisible()}}));q.set(f,{map:b,appStateMd5:this._getAppStateMd5()})}}});k.getInstance=function(a){null===n&&(n=new k);n.urlParams=a;return n};return k})},"jimu/dijit/AGOLLoading":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/AGOLLoading.html","dojo/_base/html"],
function(r,d,m,l,c){return r([d,m],{baseClass:"jimu-agol-loading",declaredClass:"jimu.dijit.AGOLLoading",templateString:l,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&c.setStyle(this.domNode,"display","none");c.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||c.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=
this.loadingText)},show:function(d){this.domNode&&this.hidden&&("string"===typeof d&&(this.textNode.innerHTML=d),c.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(c.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g){var f=null,b;b=r([l],{constructor:function(a,b){this.own(c.subscribe("appConfigLoaded",d.hitch(this,this._onAppConfigLoaded)));this.own(c.subscribe("appConfigChanged",d.hitch(this,this._onAppConfigChanged)));this.own(c.subscribe("mapLoaded",d.hitch(this,this._onMapLoaded)));this.own(c.subscribe("mapChanged",d.hitch(this,this._onMapChanged)));this.own(c.subscribe("beforeMapDestory",d.hitch(this,this._onBeforeMapDestory)));this.own(c.subscribe("preloadModulesLoaded",
d.hitch(this,this._onPreloadModulesLoaded)));this.own(c.subscribe("openWidget",d.hitch(this,this._onOpenWidgetRequest)));this.own(c.subscribe("builder/actionTriggered",d.hitch(this,this._onActionTriggered)));g.isMobileUa()||this.own(t(window,"resize",n(d.hitch(this,this.resize),200)));this.id=b;this.preloadModulesLoadDef=new p},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",mapDiv:null,hlDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},
_onAppConfigLoaded:function(a){this.appConfig=d.clone(a);this.preloadModulesLoadDef.then(d.hitch(this,function(){this._loadLayoutManager(this.appConfig).then(d.hitch(this,function(a){this.layoutManager=a;this.layoutManager.onEnter(this.appConfig,this.mapId).then(d.hitch(this,function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))}))},_loadLayoutManager:function(a){a=a.layoutDefinition?a.layoutDefinition.manager:
"jimu/layoutManagers/AbsolutePositionLayoutManager";var b=new p;k([a],d.hitch(this,function(a){a=a.getInstance();this.map&&a.setMap(this.map);b.resolve(a)}));return b},_loadMap:function(b){this.mapManager=a.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},b);this.mapManager.showMap()},_onMapLoaded:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onPreloadModulesLoaded:function(){this.preloadModulesLoadDef.resolve()},_loadTheme:function(a){var b=
new p;k(["themes/"+a.name+"/main"],d.hitch(this,function(){h([this._loadThemeCommonStyle(a),this._loadThemeCurrentStyle(a)]).then(d.hitch(this,function(){this._addCustomStyle(a);this.layoutManager.onThemeLoad();b.resolve()}))}));return b},_loadThemeCommonStyle:function(a){m.addClass(this.domNode,a.name);return g.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css")},_loadThemeCurrentStyle:function(a){m.addClass(this.domNode,a.styles[0]);return g.loadStyleLink(this._getThemeCurrentStyleId(a),
"themes/"+a.name+"/styles/"+a.styles[0]+"/style.css")},_addCustomStyle:function(a){var b=d.getObject("customStyles",!1,a);if(b){var e=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(a=this._getFixedThemeStyles(a))&&(e+=a);e=d.replace(e,b,/\$\{([^\}]+)\}/g);b=m.create("style",{type:"text/css"});try{b.appendChild(document.createTextNode(e))}catch(x){b.styleSheet.cssText=e}b.setAttribute("source","custom");document.head.appendChild(b)}},_getFixedThemeStyles:function(a){var b=
".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";if(a.customStyles.mainBackgroundColor&&g.isLightColor(a.customStyles.mainBackgroundColor))var e=k.toUrl("jimu")+"/css/images/api_popup_light.png",b=b+(".esriPopup .titleButton {background: url("+e+") no-repeat}")+".esriPopup .titlePane {color: black}";"PlateauTheme"===a.name?b+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===a.name?b+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen, .jimu-widget-mylocation .place-holder.nohttps:hover, .jimu-widget-extent-navigate .operation.jimu-state-disabled:hover{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-widget-homebutton .HomeButton .home:hover, .jimu-widget-mylocation .place-holder:not(.nohttps):hover, .jimu-widget-zoomslider.vertical .zoom-in:hover, .jimu-widget-zoomslider.vertical .zoom-out:hover, .jimu-widget-extent-navigate .operation:not(.jimu-state-disabled):hover, .jimu-widget-fullScreen .fullScreen:hover, .jimu-widget-onscreen-icon:hover, .jimu-widget-onscreen-icon.jimu-state-selected{opacity: 1;}":
"BoxTheme"===a.name?b+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-main-background.jimu-widget-zoomslider{background-color: transparent !important}.jimu-widget-homebutton .HomeButton .home:hover, .jimu-widget-mylocation .place-holder:not(.nohttps):hover, .jimu-widget-zoomslider.vertical .zoom-in:hover, .jimu-widget-zoomslider.vertical .zoom-out:hover, .jimu-widget-zoomslider .zoom:hover, .jimu-widget-extent-navigate .operation:not(.jimu-state-disabled):hover, .jimu-widget-fullScreen .fullScreen:hover{background-color: ${mainBackgroundColor} !important; opacity: 1;}":
"TabTheme"===a.name?b+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":"DashboardTheme"===a.name?b+=".jimu-widget-dnd-header{background-color: ${mainBackgroundColor} !important;}":"DartTheme"===a.name?b+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation.jimu-state-disabled,.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation.jimu-state-disabled:hover{color: ${mainBackgroundColor} !important; opacity: 0.6;}.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation,.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation:hover{color: ${mainBackgroundColor} !important; opacity: 1;}":
"PocketTheme"===a.name&&(b+=".jimu-main-background, .jimu-widget-homebutton, .jimu-widget-mylocation, .jimu-widget-onscreen-icon, .jimu-widget-onscreen-icon.jimu-state-selected, .jimu-widget-zoomslider .zoom, .jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen, .esriPopup .titlePane, .esriPopupMobile .titlePane, .esriPopup .pointer.top{background-color: ${mainBackgroundColor} !important;}.esriMobileNavigationBar{background-color: ${mainBackgroundColor} !important; background-image: none !important;}");
return b},_onAppConfigChanged:function(a,b,c){a=d.clone(a);switch(b){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,c);break;case "groupChange":this._onGroupChange(a,c);break;case "widgetPoolChange":this._onWidgetPoolChange(a,c);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,c);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(a,
c);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(a,c);break;case "onScreenOrderChange":this._onOnScreenOrderChange(a,c)}this.appConfig=a},_onMapChanged:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onBeforeMapDestory:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},_onThemeChange:function(a){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);
this._removeCustomStyle();h([this._loadLayoutManager(a),this._loadTheme(a.theme)]).then(d.hitch(this,function(b){var e=b[0];this.layoutManager.name!==e.name?(this.layoutManager.onLeave(),e.onEnter(a,this.mapId).then(d.hitch(this,function(){this.layoutManager=e;this.layoutManager.loadAndLayout(a)}))):this.layoutManager.loadAndLayout(a)}))},_onResetConfig:function(a){var b=this.appConfig;c.publish("appConfigChanged",a,"mapChange",a);this.appConfig=b;this._loadLayoutManager(a).then(d.hitch(this,function(a){this.layoutManager=
a;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},_onLoadingPageChange:function(a,b){"backgroundColor"in b?m.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor):"backgroundImage"in b?(a=a.loadingPage.backgroundImage,a.visible&&a.uri?(m.setStyle(jimuConfig.loadingImageId,"background-image","url('"+a.uri+"')"),m.setStyle(jimuConfig.loadingImageId,"width",
a.width+"px"),m.setStyle(jimuConfig.loadingImageId,"height",a.height+"px")):(m.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),m.setStyle(jimuConfig.loadingImageId,"width","0px"),m.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in b&&(a=a.loadingPage.loadingGif,a.visible&&a.uri?(m.setStyle(jimuConfig.loadingGifId,"background-image","url('"+a.uri+"')"),m.setStyle(jimuConfig.loadingGifId,"width",a.width+"px"),m.setStyle(jimuConfig.loadingGifId,"height",a.height+"px")):
(m.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),m.setStyle(jimuConfig.loadingGifId,"width","0px"),m.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(a.theme);this._removeCustomStyle();this._addCustomStyle(a.theme)},_onLayoutChange:function(a){this.layoutManager.onLayoutChange(a)},_onWidgetChange:function(a,b){this.layoutManager.onWidgetChange(a,b)},_onGroupChange:function(a,
b){this.layoutManager.onGroupChange(a,b)},_onWidgetPoolChange:function(a,b){this.layoutManager.onWidgetPoolChange(a,b)},_onActionTriggered:function(a){this.layoutManager.onActionTriggered(a)},_onLayoutDefinitionChange:function(a,b){this.layoutManager.onLayoutDefinitionChange(a,b)},_onOnScreenGroupsChange:function(a,b){this.layoutManager.onOnScreenGroupsChange(a,b)},_onOnScreenOrderChange:function(a,b){this.layoutManager.onOnScreenOrderChange(a,b)},_removeThemeCommonStyle:function(a){m.removeClass(this.domNode,
a.name);m.destroy(this._getThemeCommonStyleId(a))},_removeThemeCurrentStyle:function(a){m.removeClass(this.domNode,a.styles[0]);m.destroy(this._getThemeCurrentStyleId(a))},_removeCustomStyle:function(){q('style[source\x3d"custom"]',document.head).forEach(function(a){m.destroy(a)})},_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_doPostLoad:function(){k(["dynamic-modules/postload"])},_onOpenWidgetRequest:function(a){this.layoutManager.openWidget(a)}});
b.getInstance=function(a,c){null===f&&(f=new b(a,c),window._layoutManager=f);return f};return b})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/topic dojo/on dojo/aspect dojo/keys dojo/i18n dojo/_base/config esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/arcgis/utils esri/geometry/Extent esri/geometry/Point require ./utils jimu/LayerInfos/LayerInfos jimu/dijit/Message jimu/dijit/AppStatePopup ./MapUrlParamsHandler ./AppStateManager ./PopupManager ./FilterManager".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z,A,E,y,C,F,B){var G=null,H=r(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(a,b){this.appConfig=a.appConfig;this.urlParams=a.urlParams;this.id=this.mapDivId=b;this.appStateManager=C.getInstance(this.urlParams);this.popupManager=F.getInstance(this);this.filterManager=B.getInstance();this.nls=window.jimuNls;t.subscribe("appConfigChanged",d.hitch(this,
this.onAppConfigChanged));t.subscribe("syncExtent",d.hitch(this,this.onSyncExtent));t.subscribe("mapContentModified",d.hitch(this,this.onMapContentModified));q(window,"resize",d.hitch(this,this.onWindowResize));q(window,"beforeunload",d.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(a){console.time("Load Map");a.map["3D"]?a.map.itemId?this._show3DWebScene(a):this._show3DLayersMap(a):a.map.itemId?this._show2DWebMap(a):console.log("No webmap found. Please set map.itemId in config.json.")},
onBeforeUnload:function(){this.appConfig.keepAppState&&this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(a){a&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&(this._mapMobileInfoWindow.destroy(),c("div.esriMobileInfoView.esriMobilePopupInfoView").forEach(function(a){l.destroy(a)}),
c("div.esriMobileNavigationBar").forEach(function(a){l.destroy(a)})),this._mapMobileInfoWindow=new g(null,l.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);D.inMobileSize()&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!D.inMobileSize()&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=!1)},onSyncExtent:function(a){this.map&&
(a=new u(a.extent),this.map.setExtent(a))},_visitConfigMapLayers:function(a,b){m.forEach(a.map.basemaps,function(a,e){a.isOperationalLayer=!1;b(a,e)},this);m.forEach(a.map.operationallayers,function(a,e){a.isOperationalLayer=!0;b(a,e)},this)},_show3DLayersMap:function(a){x(["esri3d/Map"],d.hitch(this,function(b){var e;e=new b(this.mapDivId,{camera:a.map.mapOptions.camera});this._visitConfigMapLayers(a,d.hitch(this,function(a){this.createLayer(e,"3D",a)}));e.usePlugin=b.usePlugin;this._publishMapEvent(e)}))},
_show3DWebScene:function(a){this._getWebsceneData(a.map.itemId).then(d.hitch(this,function(b){x(["esri3d/Map"],d.hitch(this,function(e){var c=new e(this.mapDivId,a.map.mapOptions);m.forEach(b.itemData.operationalLayers,function(a){this.createLayer(c,"3D",a)},this);m.forEach(b.itemData.baseMap.baseMapLayers,function(a){a.type="tile";this.createLayer(c,"3D",a)},this);m.forEach(b.itemData.baseMap.elevationLayers,function(a){a.type="elevation";this.createLayer(c,"3D",a)},this);c.toc=b.itemData.toc;c.bookmarks=
b.itemData.bookmarks;c.tours=b.itemData.tours}))}))},_publishMapEvent:function(a){window._viewerMap=a;y.postProcessUrlParams(this.urlParams,a);console.timeEnd("Load Map");this.map?(this.map=a,this.resetInfoWindow(!0),console.log("map changed."),t.publish("mapChanged",this.map,this.layerInfosObj)):(this.map=a,this.resetInfoWindow(!0),t.publish("mapLoaded",this.map,this.layerInfosObj))},_getWebsceneData:function(a){return b({url:"http://184.169.133.166/sharing/rest/content/items/"+a+"/data",handleAs:"json"})},
_show2DWebMap:function(a){a.map.mapOptions||(a.map.mapOptions={});var b=this._processMapOptions(a.map.mapOptions)||{};b.isZoomSlider=!1;var e=a.map.portalUrl,c=a.map.itemId,b={mapOptions:b,bingMapsKey:a.bingMapsKey,usePopupManager:!0};if(!window.isBuilder&&!a.mode&&a.map.appProxy&&a.map.appProxy.mapItemId===a.map.itemId){var f=[];m.forEach(a.map.appProxy.proxyItems,function(a){a.useProxy&&a.proxyUrl&&f.push({url:a.sourceUrl,mixin:{url:a.proxyUrl}})});0<f.length&&(b.layerMixins=f)}this._createWebMapRaw(e,
c,this.mapDivId,b).then(d.hitch(this,function(b){var e=b.map;e.hideZoomSlider();e.infoWindow.resize(270,316);e.itemId=a.map.itemId;e.itemInfo=b.itemInfo;e.webMapResponse=b;e.enableSnapping({snapKey:h.copyKey});l.setStyle(e.root,"zIndex",0);e._initialExtent=e.extent;this.layerInfosObj=z.getInstanceSyncForInit(e,e.itemInfo);this.layerInfosObj.getLayerInfoArrayOfWebmap().forEach(function(a){a.getLayerObject().then(d.hitch(this,function(a){a&&d.setObject("_wabProperties.originalRefreshinterval",a.refreshInterval,
a)}),d.hitch(this,function(a){console.error("can't get layerObject",a)}))},this);a.map.mapRefreshInterval&&!a.map.mapRefreshInterval.useWebMapRefreshInterval&&this._updateRefreshInterval(a.map.mapRefreshInterval);this._showUnreachableLayersTitleMessage();this._publishMapEvent(e);setTimeout(d.hitch(this,this._checkAppState),500);this._addDataLoadingOnMapUpdate(e)}),d.hitch(this,function(a){console.error(a);this._showError(a);t.publish("mapCreatedFailed")}))},_handleRefreshLayer:function(a){var b=a._mode._drawFeatures,
e=a._mode._clearIIf,c=null;a._mode._drawFeatures=function(e,c){c&&"number"===typeof c.row&&"number"===typeof c.col&&a._mode._removeCell(c.row,c.col);b.apply(a._mode,arguments)};p.before(a,"refresh",function(){c=a._mode._cellMap;a._mode._clearIIf=function(){}});p.after(a,"refresh",function(){a._mode._cellMap=c;a._mode._clearIIf=e});q(a,"update-start",function(){a.isUpdating=!0});q(a,"update-end",function(){a.isUpdating=!1})},_showError:function(a){a&&a.message&&l.create("div",{"class":"app-error",
innerHTML:a.message},document.body)},_createWebMapRaw:function(a,b,c,f){return D.createWebMap(a,b,c,f).then(d.hitch(this,function(a){return a}),d.hitch(this,function(g){console.error(g);if(g&&g instanceof Error&&g.message){var h=d.getObject("arcgis.utils.baseLayerError",!1,n.cache["esri/nls/jsapi/"+k.locale]);if(h&&0<=g.message.indexOf(h))return new A({message:window.jimuNls.map.basemapNotAvailable+window.jimuNls.map.displayDefaultBasemap}),e.getItem(b).then(d.hitch(this,function(b){b.itemData.spatialReference=
{wkid:102100,latestWkid:3857};b.itemData.baseMap={baseMapLayers:[{url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",opacity:1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,id:"defaultBasemap_0"}],title:"Topographic"};return D.createWebMap(a,b,c,f)}))}throw g;}))},_showUnreachableLayersTitleMessage:function(){var a=this.layerInfosObj.getUnreachableLayersTitle(),b="",e=window.jimuNls.map.layerLoadedError||"The layer, ${layers} cannot be added to the map.";e&&
a&&0<a.length&&(m.forEach(a,d.hitch(this,function(a){b=b+a+", "})),new A({message:e.replace("${layers}",b)}))},_addDataLoadingOnMapUpdate:function(a){var b=l.toDom('\x3cdiv class\x3d"map-loading"\x3eLoading...\x3c/div\x3e');l.place(b,a.root);a.updating&&l.addClass(b,"loading");q(a,"update-start",d.hitch(this,function(){l.addClass(b,"loading")}));q(a,"update-end",d.hitch(this,function(){l.removeClass(b,"loading")}));q(a,"unload",d.hitch(this,function(){l.destroy(b);b=null}))},_checkAppState:function(){var a=
"extent center marker find query scale level".split(" "),b=this.appConfig.keepAppState;b&&m.forEach(a,function(a){a in this.urlParams&&(b=!1)},this);b&&this.appStateManager.getWabAppState().then(d.hitch(this,function(a){if(a.extent||a.layers){var b=new E({nls:{title:this.nls.appState.title,restoreMap:this.nls.appState.restoreMap}});b.placeAt("main-page");q(b,"applyAppState",d.hitch(this,function(){this._applyAppState(a,this.map)}));b.startup();b.show()}}))},_applyAppState:function(a,b){this.layerInfosObj.restoreState({layerOptions:a.layers||
null});a.extent&&b.setExtent(a.extent)},_processMapOptions:function(b){if(b)return b.lods||delete b.lods,b.lods&&0===b.lods.length&&delete b.lods,b=d.clone(b),b.extent&&(b.extent=new u(b.extent)),b.center&&!d.isArrayLike(b.center)&&(b.center=new v(b.center)),b.infoWindow&&(b.infoWindow=new a(b.infoWindow,l.create("div",{},this.mapDivId))),b},createLayer:function(a,b,e){x([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer",
"2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer","2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer","2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer","3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[b+
"_"+e.type]],d.hitch(this,function(b){var c,g={};c="label url type icon infoTemplate isOperationalLayer".split(" ");for(var h in e)0>c.indexOf(h)&&(g[h]=e[h]);e.infoTemplate?(c=new f(e.infoTemplate.title,e.infoTemplate.content),g.infoTemplate=c,b=new b(e.url,g),e.infoTemplate.width&&e.infoTemplate.height&&p.after(b,"onClick",d.hitch(this,function(){a.infoWindow.resize(e.infoTemplate.width,e.infoTemplate.height)}),!0)):b=new b(e.url,g);b.isOperationalLayer=e.isOperationalLayer;b.label=e.label;b.icon=
e.icon;a.addLayer(b)}))},onAppConfigChanged:function(a,b,e){this.appConfig=a;"mapChange"===b?this._recreateMap(a):"mapOptionsChange"===b?e.lods&&this._recreateMap(a):"mapRefreshIntervalChange"===b&&this.map&&this.map.itemInfo.itemData&&this.layerInfosObj&&this._updateRefreshInterval(e)},onMapContentModified:function(){this._recreateMap(this.appConfig)},_updateRefreshInterval:function(a){var b=-1,b=a.useWebMapRefreshInterval?-1:a.minutes;this.layerInfosObj.getLayerInfoArrayOfWebmap().forEach(function(a){a.getLayerObject().then(d.hitch(this,
function(a){if(a){var e=d.getObject("_wabProperties.originalRefreshinterval",!1,a);0<e&&"function"===typeof a.setRefreshInterval&&(0>b?a.setRefreshInterval(e):a.setRefreshInterval(b))}}),d.hitch(this,function(a){console.error("can't get layerObject",a)}))},this)},_recreateMap:function(a){this.map&&(t.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(a)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});
H.getInstance=function(a,b){null===G&&(G=new H(a,b));return G};return H})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x){var D=r([v,a,
g,f,u],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:x,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(a){this.inherited(arguments);n.place(this.domNode,a.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[D.ANCHOR_UPPERRIGHT,D.ANCHOR_LOWERRIGHT,D.ANCHOR_LOWERLEFT,D.ANCHOR_UPPERLEFT];if(7>t("ie")){var a="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+
k.getComputedStyle(this._sprite).backgroundImage.replace(/url\(\"/i,"").replace(/\"\)/,"")+"')",b=n.create("div",null,l.body());k.set(b,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:a});var e=setTimeout(function(){n.destroy(b);clearTimeout(e);e=b=null},100);c.query(".sprite",this.domNode).forEach(function(b){b.style.backgroundImage="none";b.style.filter=a})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),
this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(a,b){if(a&&b){var e=k.set;e(this._topleft,{height:b+"px",marginLeft:a+"px"});e(this._topright,{width:a+"px",height:b+"px"});e(this._user,"width",a-8+"px");e(this._hide,"marginLeft",a-22+"px");e(this._title,"width",a-25+"px");e(this._content,"height",b-37+"px");e(this._bottomleft,{marginLeft:a+"px",marginTop:b+"px"});e(this._bottomright,{width:a-
5+"px",marginTop:b+"px"});this.width=a;this.height=b;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(a,b)}},_adjustPosition:function(a,b){var e=k.set;e(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"});b===D.ANCHOR_UPPERLEFT?e(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):b===D.ANCHOR_UPPERRIGHT?e(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):b===D.ANCHOR_LOWERRIGHT?e(this._window,{left:"6px",
right:null,top:"43px",bottom:null}):b===D.ANCHOR_LOWERLEFT&&e(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(a){var b=this.map;return b&&a?(a.y<b.height/2?"lower":"upper")+(a.x<b.width/2?"right":"left"):"upperright"},show:function(a,b,c){if(a){a.spatialReference?(this.mapCoords=a,a=this.coords=this.map.toScreen(a,!0)):(this.mapCoords=null,this.coords=a);var f=this.map._getFrameWidth();if(-1!==f&&(a.x%=f,0>a.x&&(a.x+=f),this.map.width>f))for(var d=(this.map.width-
f)/2;a.x<d;)a.x+=f;b&&-1!==m.indexOf(this._ANCHORS,b)||(b=this._getAnchor(a));h.remove(this._pointer,this.anchor);b=this.anchor=this.fixedAnchor||b;this._adjustPosition(a,b);h.add(this._pointer,b);e.show(this.domNode);this.isShowing=!0;if(!c)this.onShow()}},hide:function(a,b){e.hide(this.domNode);this.isShowing=!1;if(!b)this.onHide()},showTitleBar:function(){e.show(this._titlebar);e.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){e.hide(this._titlebar);e.hide(this._border);this.isTitleBarShowing=
!1},showContent:function(){e.show(this._content);e.show(this._border);this.isContentShowing=!0},hideContent:function(){e.hide(this._content);e.hide(this._border);this.isContentShowing=!1},move:function(a,b){b?a=this.coords.offset(a.x,a.y):(this.coords=a,this.mapCoords&&(this.mapCoords=this.map.toMap(a)));k.set(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"})},setFixedAnchor:function(a){a&&-1===m.indexOf(this._ANCHORS,a)||(this.fixedAnchor=a,this.isShowing&&this.show(this.mapCoords||
this.coords,a),this.onAnchorChange(a))},setTitle:function(a){this.destroyDijits(this._title);this.__setValue("_title",a);return this},setContent:function(a){this.destroyDijits(this._content);this.__setValue("_content",a);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},onResize:function(){},onAnchorChange:function(){}});d.mixin(D,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",
ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});t("extend-esri")&&d.setObject("dijit.InfoWindow",D,b);return D})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z,A){r=d([e,u],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:r.toUrl("./images/whitex.png"),dArrowIcon:r.toUrl("./images/whitedown.png"),lArrowIcon:r.toUrl("./images/whitel.png"),rArrowIcon:r.toUrl("./images/whiter.png"),constructor:function(b,e){this.initialize();m.mixin(this,b);this.domNode=n.byId(e);this._nls=m.mixin({},
A.widgets.popup);b=this.domNode;a.add(b,"esriPopupMobile");k.set(b,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
e=q.query(".titlePane",b)[0];this._arrowButton=q.query(".arrow",e)[0];this._pointerTop=q.query(".top",b)[0];this._pointerBottom=q.query(".bottom",b)[0];this._title=q.query(".title",e)[0];this._footer=q.query(".footer",e)[0];this._prev=q.query(".prev",e)[0];this._next=q.query(".next",e)[0];this._spinner=q.query(".spinner",e)[0];this._eventConnections=[l.connect(q.query(".close",e)[0],"onclick",this,this.hide),l.connect(this._arrowButton,"onclick",this,this._toggleView),l.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),l.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();z.hide(b);this.isShowing=!1},setMap:function(a){this.inherited(arguments);g.place(this.domNode,a.root);this.highlight&&this.enableHighlight(a)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(a,b){this.destroyDijits(this._title);this.place(a,this._title);
this.destroyDijits(this._footer);this.place(b,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(a){this.destroyDijits(this._contentPane);this.place(a,this._contentPane);this.startupDijits(this._contentPane)},show:function(a){if(a){var b=this.map;a.spatialReference?(this.location=a,a=b.toScreen(a)):this.location=b.toMap(a);this._maximized?this.restore():this._setPosition(a);this.isShowing||(z.show(this.domNode),this.isShowing=!0,this.onShow())}else z.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(z.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);c.forEach(this._eventConnections,l.disconnect);g.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");a.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var a=this.selectedIndex;this._updateUI();0<=a&&(this.setContent(this.features[a].getContent()),this.updateHighlight(this.map,this.features[a]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var a=this.map;this._handles=[l.connect(a,"onPanStart",this,this._onPanStart),l.connect(a,"onPan",this,this._onPan),l.connect(a,"onZoomStart",this,this._onZoomStart),l.connect(a,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var a=this._handles;a&&(c.forEach(a,l.disconnect),this._handles=null)},_onPanStart:function(){var a=this.domNode.style;this._panOrigin={left:a.left,top:a.top,right:a.right,
bottom:a.bottom}},_onPan:function(a,e){var c=this._panOrigin;a=e.x;e=e.y;var f=c.left,d=c.top,g=c.right,c=c.bottom;f&&(f=parseFloat(f)+a+"px");d&&(d=parseFloat(d)+e+"px");g&&(g=parseFloat(g)-a+"px");c&&(c=parseFloat(c)-e+"px");b.set(this.domNode,{left:f,top:d,right:g,bottom:c})},_onZoomStart:function(){z.hide(this.domNode)},_onExtentChange:function(a,b,e){e&&(z.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(e){var c=e.x;e=e.y;var d=
f.getContentBox(this.map.container),g=d.w,d=d.h,h=0,k=e+10,u=118,n=g-18;18<c&&c<n?(h=c-130,0>h?h=0:h>g-260&&(h=g-260)):18>=c?h=c-18:c>=n&&(h=g-260+(c-n));118<c&&c<g-130?u=118:118>=c?18<c?u=c-12:18>=c&&(u=6):c>=g-130&&(c<n?u=118+c-(g-130):c>=n&&(u=118+n-(g-130)));e<=d/2?(b.set(this.domNode,{left:h+"px",top:k+"px",bottom:null}),b.set(this._pointerTop,{left:u+"px"}),a.add(this._pointerBottom,"hidden"),a.remove(this._pointerTop,"hidden")):(b.set(this.domNode,{left:h+"px",top:k-64+"px",bottom:null}),b.set(this._pointerBottom,
{left:u+"px"}),a.add(this._pointerTop,"hidden"),a.remove(this._pointerBottom,"hidden"))},_showPointer:function(a){c.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(b){b===a?q.query(".pointer."+b,this.domNode).removeClass("hidden"):q.query(".pointer."+b,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();z.show(this.popupNavigationBar.container);z.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(a){this.popupInfoView.animateTo(0);switch(a.name){case "CloseButton":z.hide(this.popupNavigationBar.container);z.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":z.hide(this.popupNavigationBar.container);z.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var a={};a.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new x(a,g.create("div",{},t.body()));l.connect(this.popupNavigationBar,"onCreate",this,function(a){this._prevFeatureButton=a[3]._node;this._nextFeatureButton=a[4]._node});l.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);l.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();z.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new v({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},g.create("div",{},t.body()));a.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();l.connect(this.popupInfoView,"onCreate",this,function(a){this._contentPane=a[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});l.connect(this.popupInfoView,"onSwipeLeft",this,function(){});l.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var b="\x26nbsp;",e="\x26nbsp;",c=this.selectedIndex,f=this.features,d=this.deferreds,g=this._prevFeatureButton.parentNode,h=this._nextFeatureButton.parentNode,k=this._spinner,u=this._nls;f&&1<=f.length?(b=f[c].getTitle(),e=c+1+" of "+f.length,a.remove(this._arrowButton,"hidden"),0===c?(a.add(g,"hidden"),a.add(this._prev,"hidden")):(a.remove(g,"hidden"),a.remove(this._prev,"hidden")),c===f.length-1?(a.add(h,"hidden"),
a.add(this._next,"hidden")):(a.remove(h,"hidden"),a.remove(this._next,"hidden"))):(a.add(this._arrowButton,"hidden"),a.add(g,"hidden"),a.add(h,"hidden"),a.add(this._prev,"hidden"),a.add(this._next,"hidden"));this.setTitle(b,e);this.popupNavigationBar.getItems()[1]._node.innerHTML=e;d&&d.length?(a.remove(k,"hidden"),this.setTitle(u.NLS_searching+"...","\x26nbsp;")):(a.add(k,"hidden"),f&&f.length||this.setTitle("No Information","\x26nbsp;"))}});p("extend-esri")&&m.setObject("dijit.PopupMobile",r,D);
return r})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a,g){r=r(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(a,b){this.container=p.byId(b);this._touchBase=g(this.container,null);this._slideDiv=n.create("div",
null,this.container,"first");this.events=[];this._items=a.items;a.sections&&(this._sections=a.sections);h.add(this.container,"esriMobileInfoView");if(0===this._sections.length)n.create("div",{},this._slideDiv);else for(a=0;a<this._sections.length;a++)b=n.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv),n.create("div",{innerHTML:this._sections[a].title},b);for(a=0;a<this._items.length;a++){var e;b=0;this._items[a].section&&(b=this._items[a].section);switch(this._items[a].type){case "div":e=
n.create("div",{"class":"esriMobileInfoViewItem",style:this._items[a].style},this._slideDiv.childNodes[b]),e=n.create("div",{innerHTML:this._items[a].text},e)}this._items[a].className&&h.add(e,this._items[a].className);e._index=a;e._item=this._items[a];this._items[a]._node=e}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){m.forEach(this.events,l.disconnect);this._touchBase=null;c.query("img",this.container).forEach(function(a){a._index=null;
a._item=null;n.destroy(a);a=null});this._items=null;n.destroy(this._slideDiv);n.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(a){this._touchBase.setPreventDefault(a)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);this.events.push(l.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(l.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(l.connect(this._touchBase,
"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){l.disconnect(this.events.pop());l.disconnect(this.events.pop());l.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},
onClick:function(a){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(a){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=a.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},_onTouchMoveHandler:function(a){this._moveDirection||(this._moveDirection=Math.abs(a.curY)>Math.abs(a.curX)?"vertical":"horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(a.touches[0].clientY-
this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(a){this._endTime=new Date;this._deltaMovement=a.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===this._moveDirection)if("left"===a.swipeDirection)this.onSwipeLeft();else if("right"===a.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return.2<
Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var a,b;a=k.getContentBox(this.container);var e=0>this._velocity?.001:-.001;b=-(this._velocity*this._velocity)/(2*e);var c=-this._velocity/e,e=3*.6-0,d=1-e,g=0,h=0;if(a.h>this._slideDiv.scrollHeight)this.contentOffsetY=0,h=300;else if(0<this.contentOffsetY+b){a=0;for(b=Math.floor(c/20);a<b;a++)if(g=(20*d*a^3)+(20*e*a^2)+0*a+0,g=0>this._velocity?-g:g,0<this.contentOffsetY+g){h=20*a;break}0===h&&(h=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+
b)+a.h>this._slideDiv.scrollHeight)for(this.contentOffsetY=a.h-this._slideDiv.scrollHeight,a=0,b=Math.floor(c/20);a<b;a++){if(g=(20*d*a^3)+(20*e*a^2)+0*a+0,g=0>this._velocity?-g:g,Math.abs(this.contentOffsetY+g)>this._slideDiv.scrollHeight){h=20*a;break}}else h=c,this.contentOffsetY+=b;this._slideDiv.style.webkitTransition="-webkit-transform "+h+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var a=k.getContentBox(this.container);a.h>this._slideDiv.scrollHeight?
this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+a.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=a.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration="0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(a){this.contentOffsetY=a;this._slideDiv.style.webkitTransform="translate3d(0, "+a+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var a=document.defaultView.getComputedStyle(this._slideDiv,null),
a=new WebKitCSSMatrix(a.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(a.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(a,b){"ON"===b.toggleState?(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))}});t("extend-esri")&&d.setObject("dijit.InfoView",r,a);return r})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),
function(r,d,m,l,c,t){r=r(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(c,d){this.domNode=l.byId(c);this.events=[m.connect(this.domNode,"touchstart",this,this._touchStartHandler),m.connect(this.domNode,"touchmove",this,this._touchMoveHandler),m.connect(this.domNode,"touchend",this,this._touchEndHandler),m.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(c){this._preventDefault=c},disableOnClick:function(){m.disconnect(this.events.pop())},
_clickHandler:function(c){if(this._moved)c.preventDefault();else this.onclick(c)},_touchStartHandler:function(c){this._moved=!1;this.client_x=c.targetTouches[0].clientX;this.client_y=c.targetTouches[0].clientY;this.down_x=c.targetTouches[0].pageX;this.down_y=c.targetTouches[0].pageY;c.downX=this.down_x;c.downY=this.down_y;this.onTouchStart(c)},_touchMoveHandler:function(c){this._preventDefault&&c.preventDefault();this._moved=!0;this.up_x=c.targetTouches[0].pageX;this.cur_x=c.targetTouches[0].pageX-
this.down_x;this.cur_y=c.targetTouches[0].pageY-this.down_y;c.curX=this.cur_x;c.curY=this.cur_y;this.onTouchMove(c)},_touchEndHandler:function(c){this._moved?(c.curX=this.cur_x,c.curY=this.cur_y,this.down_x-this.up_x>this._swipeThreshold?c.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(c.swipeDirection="right")):(c.clientX=this.client_x,c.clientY=this.client_y);this.onTouchEnd(c)},onTouchStart:function(c){},onTouchMove:function(c){},onTouchEnd:function(c){},onclick:function(c){}});
c("extend-esri")&&d.setObject("dijit._TouchBase",r,t);return r})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a){r=r(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(a,c){this.container=p.byId(c);this._touchBase=k(this.container,null);this._slideDiv=n.create("div",
{},this.container,"first");this.events=[m.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=a.items;h.add(this.container,"esriMobileNavigationBar");c=n.create("div",{},this._slideDiv);for(a=0;a<this._items.length;a++){var b,e;switch(this._items[a].type){case "img":e=n.create("div",{"class":"esriMobileNavigationItem"},c);b=n.create("img",{src:this._items[a].src.toString(),style:{width:"100%",height:"100%"}},e);break;case "span":e=n.create("div",{"class":"esriMobileNavigationItem"},
c);b=n.create("span",{innerHTML:this._items[a].text},e);break;case "div":e=n.create("div",{"class":"esriMobileNavigationInfoPanel"},c),b=n.create("div",{innerHTML:this._items[a].text},e)}h.add(e,this._items[a].position);this._items[a].className&&h.add(b,this._items[a].className);b._index=a;b._item=this._items[a];this._items[a]._node=b}},startup:function(){this.onCreate(this._items)},destroy:function(){l.forEach(this.events,m.disconnect);this._touchBase=null;c.query("img",this.container).forEach(function(a){a._index=
null;a._item=null;n.destroy(a);a=null});this._items=null;n.destroy(this._slideDiv);n.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(a){this._markSelected(a._node,a)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},_onClickHandler:function(a){if("img"===a.target.tagName.toLowerCase()){var f=a.target,b=f._item;c.query("img",this.container).forEach(function(a){a!==f&&a._item.toggleGroup===b.toggleGroup&&this._markUnSelected(a,
a._item)},this);this._toggleNode(f,b)}},_toggleNode:function(a,c){"ON"===c.toggleState?(c.toggleState="OFF",c.src&&(a.src=c.src.toString()),this.onUnSelect(c)):(c.toggleState="ON",c.srcAlt&&(a.src=c.srcAlt),this.onSelect(c))},_markSelected:function(a,c){c.toggleState="ON";c.srcAlt&&(a.src=c.srcAlt);this.onSelect(c)},_markUnSelected:function(a,c){"ON"===c.toggleState&&(c.toggleState="OFF",c.src&&(a.src=c.src.toString()),this.onUnSelect(c))}});t("extend-esri")&&d.setObject("dijit.NavigationBar",r,a);
return r})},"jimu/dijit/AppStatePopup":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/mouse dojo/_base/fx dojo/topic dojo/Evented".split(" "),function(r,d,m,l,c,t,q,p,h){var n=1E3,k=1E4;return r([d,h],{baseClass:"jimu-appstate-popup",declaredClass:"jimu.dijit.AppStatePopup",currentState:0,timeoutHandler:void 0,constructor:function(a){this.inherited(arguments);"animationDuration"in a&&(n=a.animationDuration);"autoCloseInterval"in a&&(k=a.autoCloseInterval)},
postCreate:function(){window.appInfo.isRunInMobile&&l.addClass(this.domNode,"mobile");var a=l.create("div",{"class":"appstate-header"});l.create("div",{"class":"appstate-title",innerHTML:this.nls.title},a);var d=l.create("div",{"class":"appstate-close"},a);l.place(a,this.domNode);a=l.create("div",{"class":"appstate-tips",innerHTML:this.nls.restoreMap});l.place(a,this.domNode);this.own(c(a,"click",m.hitch(this,function(){this.emit("applyAppState");this.hide()})));this.own(c(d,"click",m.hitch(this,
function(){this.hide()})));this.own(c(this.domNode,t.enter,m.hitch(this,function(){this._timerStop()})));this.own(c(this.domNode,t.leave,m.hitch(this,function(){this._timerStart()})))},show:function(){q.animateProperty({node:this.domNode,duration:n,properties:window.appInfo.isRunInMobile?{top:{start:-120,end:0}}:{bottom:{start:-100,end:10}},onEnd:m.hitch(this,function(){this.currentState=1})}).play();p.subscribe("splashPopupShow",m.hitch(this,function(){this._timerStop()}));p.subscribe("splashPopupHide",
m.hitch(this,function(){this._timerStart()}));this.timeoutHandler=setTimeout(m.hitch(this,this.hide),k)},hide:function(){0!==this.currentState&&q.animateProperty({node:this.domNode,duration:n,properties:window.appInfo.isRunInMobile?{top:{start:0,end:-120}}:{bottom:{start:10,end:-100}},onEnd:m.hitch(this,function(){this.currentState=0;l.setStyle(this.domNode,"display","none")})}).play()},_timerStart:function(){1!==this.currentState||this.timeoutHandler||(this.timeoutHandler=setTimeout(m.hitch(this,
this.hide),k))},_timerStop:function(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)}})})},"jimu/MapUrlParamsHandler":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/topic dojo/promise/all esri/geometry/Point esri/geometry/Extent esri/geometry/scaleUtils esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/graphic esri/layers/GraphicsLayer esri/InfoTemplate esri/tasks/query ./utils ./LayerInfos/LayerInfos ./shareUtils".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D){function z(a,b){var e=a.center.split(";");1===e.length&&(e=a.center.split(","));if(2===e.length||3===e.length){a=parseFloat(e[0]);var c=parseFloat(e[1]);if(isNaN(a)||isNaN(c))a=parseFloat(e[0]),c=parseFloat(e[1]);if(!isNaN(a)&&!isNaN(c)){var f=4326;3!==e.length||isNaN(e[2])||(f=parseInt(e[2],10));e=new t(a,c,new h(f));K(e.spatialReference,b.spatialReference)?b.centerAt(e):J(e,b.spatialReference,function(a){b.centerAt(a[0])},function(){console.error("Project center point error.")})}}}
function A(a,b){var e=a.extent.split("wkt\x3d"),c=null;2===e.length?(c=e[1],e=e[0],e=e.split(",")):(e=a.extent.split(";"),1===e.length&&(e=a.extent.split(",")));if(4===e.length||5===e.length){a=parseFloat(e[0]);var f=parseFloat(e[1]),d=parseFloat(e[2]),g=parseFloat(e[3]);if(isNaN(a)||isNaN(a)||isNaN(a)||isNaN(a))a=parseFloat(e[0]),f=parseFloat(e[1]),d=parseFloat(e[2]),g=parseFloat(e[3]);if(isNaN(a)||isNaN(f)||isNaN(d)||isNaN(g))console.error("Wrong extent parameters.");else{var k=4326;5!==e.length||
isNaN(e[4])||(k=parseInt(e[4],10));e=null;e=c?new q(a,f,d,g,new h({wkt:c})):new q(a,f,d,g,new h({wkid:k}));K(b.spatialReference,e.spatialReference)?b.setExtent(e):J(e,b.spatialReference,function(a){b.setExtent(a[0])},function(){console.error("Project extent error.")})}}else console.error("Wrong extent parameters.")}function E(a,b){var e=null;if(a.markertemplate){e={title:"",content:"",isIncludeShareUrl:!1};try{var c=JSON.parse(decodeURIComponent(a.markertemplate));r.mixin(e,c)}catch(Y){console.error("urlParams: \x26markertemplate JSON.parse error."+
Y.stack)}}c=a.marker.split(";");1===c.length&&(c=a.marker.split(","));if(2<=c.length&&6>=c.length&&c[0].length&&!isNaN(c[0])&&c[1].length&&!isNaN(c[1])){var f=parseFloat(c[0]),d=parseFloat(c[1]),k=4326;3<=c.length&&c[2].length&&!isNaN(c[2])&&(k=parseInt(c[2],10));var u="";4<=c.length&&(u=c[3]);a=null;5<=c.length&&0===c[4].indexOf("http")&&(a=c[4]);var n=null;6===c.length&&(n=c[5]);var l=g.fromJson({type:"esriPMS",url:a,contentType:"image/png"}),p=null;n&&(p=g.fromJson({color:[0,0,0,255],type:"esriTS",
verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:n}));C(l).then(function(){var a=new t(f,d,new h({wkid:k}));K(a.spatialReference,b.spatialReference)?y(a,l,p,u,e,b):J(a,b.spatialReference,function(a){y(a[0],l,p,u,e,b)},function(){console.error("Project center point error.")})})}}function y(a,c,d,g,h,k){g=new e("",g);if(h){var u=D.getXyContent(h);h.isIncludeShareUrl&&(h=D.getShareUrl(k,
h,!0),h=D.getShareUrlContent(h),u+=h);g.setContent(u)}u=new b({id:"marker-feature-action-layer"});k.addLayer(u);g=new f(a,c,null,g);u.add(g);d&&(d.xoffset=c.width/2,d.yoffset=c.height/2+c.yoffset,c=new f(new t(a.toJson()),d),u.add(c),g._textSymbol=c);k.centerAt(a)}function C(a){var b=new m;a.url?v.getImagesSize(a.url).then(function(e){a.width=e[0];a.height=e[1];b.resolve(a)},function(){a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png";a.width=26;a.height=26;a.setOffset(0,a.height/2);b.resolve(a)}):
(a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png",a.width=26,a.height=26,a.setOffset(0,a.height/2),b.resolve(a));return b}function F(a,b){var e=a.query.split(";");1===e.length&&(e=a.query.split(","));if(2!==e.length&&3!==e.length)console.error("query URL parameter is not correct.");else{var c=e[0];L("name",c,b).then(function(a){null===a?L("id",c,b).then(function(a){null===a?console.error("Invalid layer name or id."):B(b,a,e)}):B(b,a,e)})}}function B(a,b,e){var c=new u,f="";c.outSpatialReference=
a.spatialReference;if(2===e.length)c.where=e[1];else if(3===e.length&&(b.layerObject.url&&v.isHostedService(b.layerObject.url)&&v.containsNonLatinCharacter(e[2])&&(f="N"),d.forEach(b.layerObject.fields,function(a){if(a.alias.toLowerCase()===e[1].toLowerCase()||a.name.toLowerCase()===e[1].toLowerCase())-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeOID"].indexOf(a.type)?c.where=a.name+"\x3d"+e[2]:-1<["esriFieldTypeString"].indexOf(a.type)&&
(c.where=e[1]+"\x3d"+f+"'"+e[2].replace(/\'/g,"''")+"'")},this),!c.where)){console.error("Invalid field name or type in query URL parameter.");return}c.maxAllowableOffset=1E-5;b.layerObject.queryFeatures(c).then(function(e){e=e.features;if(0===e.length)console.log("No result from query URL parameter.");else{if("esriGeometryPoint"===b.layerObject.geometryType&&1===e.length)a.setExtent(p.getExtentForScale(a,1E3)),a.centerAt(e[0].geometry);else{var c=v.graphicsExtent(e);a.setExtent(c)}G(a,b,e)}},function(a){console.error(a)})}
function G(a,b,e){function c(a){d.forEach(e,function(b){b.setInfoTemplate(a)})}function f(){a.infoWindow.setFeatures(e);a.infoWindow.show(H(e[0]))}if(a.getLayer(b.layerInfo.id))f();else{var g=b.layerInfo.getInfoTemplate();g?(c(g),f()):b.layerInfo.loadInfoTemplate().then(function(a){c(a);f()})}}function H(a){a=a.geometry;if("point"!==a.type)if("multipoint"===a.type)a=a.getPoint(0);else if("polyline"===a.type)a=a.getExtent().getCenter();else if("polygon"===a.type)a=a.getExtent().getCenter();else if("extent"===
a.type)a=a.getCenter();else return console.error("Can not get layer geometry type, unknow error."),null;return a}function L(a,b,e){var f=new m,d=[];x.getInstance(e,e.itemInfo).then(function(e){e.traversal(function(e){if(f.isResolved())return!0;("id"===a&&e.id.toLowerCase()===b.toLowerCase()||"name"===a&&e.title.toLowerCase()===b.toLowerCase())&&d.push(c({layerType:e.getLayerType(),layerObject:e.getLayerObject()}).then(function(a){"FeatureLayer"===a.layerType&&f.resolve({layerInfo:e,layerObject:a.layerObject})},
function(a){console.error("Find layer error from query URL parameter",a);f.resolve(null)}))});c(d).then(function(){f.isResolved()||f.resolve(null)})});return f}function J(b,e,c,f){var d=[102113,102100,3857],g;4326===b.spatialReference.wkid&&I(d,e.wkid)?(b.ymin=Math.max(b.ymin,-89.99),b.ymax=Math.min(b.ymax,89.99),b=a.geographicToWebMercator(b),(f=b.spatialReference._getInfo())&&b.xmin>b.xmax&&(d=f.valid[1]-b.xmin,g=b.xmax-f.valid[0],d>g?b.xmax=f.valid[1]+g:b.xmin=f.valid[0]-d),b.spatialReference.wkid=
e.wkid,c([b],null)):I(d,b.spatialReference.wkid)&&4326===e.wkid?(b=a.webMercatorToGeographic(b),(f=b.spatialReference._getInfo())&&b.xmin>b.xmax&&(d=f.valid[1]-b.xmin,g=b.xmax-f.valid[0],d>g?b.xmax=f.valid[1]+g:b.xmin=f.valid[0]-d),c([b],null)):(d=new n,d.geometries=[b],d.outSR=e,k.defaults.geometryService.project(d,function(a){!(a&&0<a.length&&a[0]&&"extent"===a[0].type)||isNaN(a[0].xmin)||isNaN(a[0].ymin)||isNaN(a[0].xmax)||isNaN(a[0].ymax)?a&&0<a.length&&a[0]&&"point"===a[0].type&&!isNaN(a[0].x)&&
!isNaN(a[0].y)&&c(a,null):c(a,null)},f))}function K(a,b){var e=[102113,102100,3857];return a&&b&&a.wkt===b.wkt&&(a.wkid===b.wkid||a.latestWkid&&a.latestWkid===b.wkid||b.latestWkid&&a.wkid===b.latestWkid||a.latestWkid&&a.latestWkid===b.latestWkid)||a&&b&&a.wkid&&b.wkid&&I(e,a.wkid)&&I(e,b.wkid)?!0:!1}function I(a,b){for(var e=a.length;e--;)if(a[e]===b)return!0;return!1}return{postProcessUrlParams:function(a,b){if("extent"in a)return A(a,b);if("center"in a)return z(a,b);if("marker"in a)return E(a,b);
if("find"in a)l.publish("publishData","framework","framework",{searchString:a.find},!0);else if("query"in a)return F(a,b)}}})},"jimu/shareUtils":function(){define("dojo/_base/lang esri/request dojo/promise/all jimu/shared/basePortalUrlUtils dojo/Deferred esri/lang jimu/portalUtils jimu/Role jimu/utils esri/urlUtils".split(" "),function(r,d,m,l,c,t,q,p,h,n){var k={getBaseHrefUrl:function(a){var c="HTML3D"===window.appInfo.appType?"webappviewer3d":"webappviewer",f="";window.isXT?f=window.location.protocol+
"//"+window.location.host+window.appInfo.appPath:(f=h.urlToObject(window.location.href).query||{},f=f.appid?a+"apps/"+c+"/index.html?appid\x3d"+f.appid:f.id?a+"apps/"+c+"/index.html?id\x3d"+f.id:h.getAppHref());return f},addQueryParamToUrl:function(a,c,f,b){a=n.urlToObject(a);a.query||(a.query={});a.query[c]=f;c=a.path;for(var e in a.query)f=a.query[e],!0===b&&(f=encodeURIComponent(f)),c=c===a.path?c+"?"+e+"\x3d"+f:c+"\x26"+e+"\x3d"+f;return c},removeQueryParamFromUrl:function(a,c,f){a=n.urlToObject(a);
a.query&&delete a.query[c];c=a.path;for(var b in a.query){var e=a.query[b];!0===f&&(e=encodeURIComponent(e));c=c===a.path?c+"?"+b+"\x3d"+e:c+"\x26"+b+"\x3d"+e}return c},getShareUrlContent:function(a){return"\x3cdiv class\x3d'marker-feature-action-popup'\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title jimu-float-leading'\x3e"+window.jimuNls.common.url+"\x3c/span\x3e\x3cinput type\x3d'text' class\x3d'jimu-float-leading' readonly\x3d'readonly' value\x3d"+a+"\x3e\x3c/input\x3e\x3c/div\x3e\x3c/div\x3e"},
getShareUrl:function(a,c,f){var b=k.getBaseHrefUrl(window.portalUrl),e="",d,g,h,n,l;c&&(c.longitude&&c.latitude?(d=c.longitude,g=c.latitude,e=c.longitude+","+c.latitude+","):c.x&&c.y&&c.spatialReference&&c.spatialReference.wkid&&(h=c.x,n=c.y,l=c.spatialReference.wkid,e=c.x+","+c.y+","+c.spatialReference.wkid));b=k.addQueryParamToUrl(b,"marker",e,!0);b=k.addQueryParamToUrl(b+",,,","markertemplate",encodeURIComponent(JSON.stringify({title:c.title,x:h,y:n,wkid:l,longitude:d,latitude:g,isIncludeShareUrl:f})));
c=a.getLevel();return b="number"===typeof c&&-1!==c?k.addQueryParamToUrl(b,"level",a.getLevel(),!0):k.addQueryParamToUrl(b,"scale",a.getScale(),!0)},getXyContent:function(a){var c="\x3cdiv class\x3d'marker-feature-action-popup'\x3e";a.longitude&&a.latitude?c+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+window.jimuNls.common.longitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+h.localizeNumber(parseFloat(a.longitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+
window.jimuNls.common.latitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+h.localizeNumber(parseFloat(a.latitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e":a.x&&a.y&&(c+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3ex\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+h.localizeNumber(parseFloat(a.x).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title'\x3ey\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+h.localizeNumber(parseFloat(a.y).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e");
return c+"\x3c/div\x3e"},_isUserOwnTheApp:function(a){return a&&a.username&&a.username===window.appInfo.appOwner?!0:!1},getItemByUserAndItemId:function(a,g,f,b){var e=new c;b=l.getStandardPortalUrl(b);b=b+"/sharing/rest/content/users/"+(g?g.username?g.username:g.email:f.email);if(t.isDefined(a.folderId)&&"/"!==a.folderId||t.isDefined(a.ownerFolder)&&"/"!==a.ownerFolder)b+="/"+(a.folderId||a.ownerFolder);b+="/items/"+a.id;d({url:b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(r.hitch(this,
function(a){e.resolve(a)}),r.hitch(this,function(a){console.error(a);e.reject(a)}));return e},_getProfile:function(a,g){var f=new c;a=l.getUserUrl(g,a.owner);d({url:a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(r.hitch(this,function(a){f.resolve(a)}),r.hitch(this,function(a){console.error(a);f.reject(a)}));return f},_unshareItemById:function(a,g,f){var b=new c;f=l.getStandardPortalUrl(f);f+="/sharing/rest/content/items/"+g+"/unshare";g={f:"json"};g=r.mixin(g,a);d({url:f,
handleAs:"json",content:g,callbackParamName:"callback"},{usePost:!0}).then(r.hitch(this,function(a){b.resolve(a)}),r.hitch(this,function(a){console.error(a);b.reject(a)}));return b},canSharePublic:function(a){return!a.selfUrl||!0!==a.canSharePublic&&!1!==a.canSharePublic?!0:a.canSharePublic},unshareItemsByUser:function(a,g,f){var b=new c;f=l.getStandardPortalUrl(f);f+="/sharing/rest/content/users/"+a+"/unshareItems";a={f:"json"};a=r.mixin(a,g);d({url:f,handleAs:"json",content:a,callbackParamName:"callback"},
{usePost:!0}).then(r.hitch(this,function(a){b.resolve(a)}),r.hitch(this,function(a){console.error(a);b.reject(a)}));return b},unshareItems:function(a,g,f){var b=new c;f=l.getStandardPortalUrl(f);f+="/sharing/rest/content/users/"+(g.owner||a.email)+"/unshareItems";a={f:"json"};a=r.mixin(a,g);d({url:f,handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(r.hitch(this,function(a){b.resolve(a)}),r.hitch(this,function(a){console.error(a);b.reject(a)}));return b},shareItemsByUser:function(a,
g,f){var b=new c;f=l.getStandardPortalUrl(f);f+="/sharing/rest/content/users/"+a+"/shareItems";a={f:"json"};a=r.mixin(a,g);d({url:f,handleAs:"json",content:a,callbackParamName:"callback"},{usePost:!0}).then(r.hitch(this,function(a){b.resolve(a)}),r.hitch(this,function(a){console.error(a);b.reject(a)}));return b},shareItems:function(a,g,f){var b=new c;f=l.getStandardPortalUrl(f);f+="/sharing/rest/content/users/"+(g.owner||a.email)+"/shareItems";a={f:"json"};a=r.mixin(a,g);d({url:f,handleAs:"json",
content:a,callbackParamName:"callback"},{usePost:!0}).then(r.hitch(this,function(a){b.resolve(a)}),r.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getItemsGroups:function(a,g){var f=new c;g=l.getStandardPortalUrl(g);g+="/sharing/rest/content/items/"+a.id+"/groups";d({url:g,handleAs:"json",content:{f:"json"},callbackParamName:"callback"},{usePost:!0}).then(r.hitch(this,function(a){f.resolve(a)}),r.hitch(this,function(a){console.error(a);f.reject(a)}));return f},isSharedToPublic:function(a){return window.isXT?
!1:null===a?!0:"undefined"!==typeof a&&"undefined"!==typeof a.item&&"undefined"!==typeof a.item.access&&"public"===a.item.access?!0:!1},isShowSocialMediaLinks:function(a){return window.isXT?!0:null===a?!0:"undefined"!==typeof a&&"undefined"!==typeof a.item&&"undefined"!==typeof a.item.access&&"private"===a.item.access?!1:!0},getItemShareInfo:function(a){var d=new c,f="";if(window.isXT)return d.resolve(null);f=h.urlToObject(h.getAppHref()).query||{};f=f.id||f.appid;if("undefined"===typeof f||""===
f)return d.resolve(null);q.getPortal(a).getItemById(f).then(r.hitch(this,function(a){var b={};b.item=a;b.item&&"undefined"===typeof b.item.sharing&&b.item.access&&(b.item.sharing={access:b.item.access});d.resolve(b)}),r.hitch(this,function(a){console.log(a);d.resolve(null)}));return d},getShareInfo:function(a){var d=q.getPortal(a),f=new c,b="";if(window.isXT)return f.resolve(null);b=h.urlToObject(h.getAppHref()).query||{};b=b.id||b.appid;if("undefined"===typeof b||""===b)return f.resolve(null);m({getUser:d.getUser(),
loadSelfInfo:d.loadSelfInfo(),getItem:d.getItemById(b)}).then(r.hitch(this,function(b){var e={};e.item=b.getItem;e.item&&e.item.ownerFolder&&e.item.ownerFolder.length&&"/"!==e.item.ownerFolder&&(e.item.folderId=e.item.ownerFolder);"undefined"===typeof e.item.sharing&&e.item.access&&(e.item.sharing={access:e.item.access});e.user=b.getUser;k._setUserRole(b.loadSelfInfo,e);e.currentUser=e.user;e.isAdmin=!1;e.userRole&&(e.userRole.isAdmin()||e.userRole.isCustom()&&e.userRole.canUpdateOrgItems())?(e.isAdmin=
!0,e.item.owner!==e.currentUser.name?k._getProfile(e.item,a).then(r.hitch(this,function(a){e.itemUser=a;e.itemUser.orgId!==e.currentUser.orgId&&(e.isAdmin=!1);f.resolve(e)})):(e.itemUser=e.currentUser,f.resolve(e))):(e.currentUser&&(e.itemUser=e.currentUser),f.resolve(e))}),r.hitch(this,function(a){console.log(a);f.resolve(null)}));return f},_setUserRole:function(a,c){c.userPortalUrl=a.urlKey?a.urlKey+"."+a.customBaseUrl:this.portalUrl;!a||a.code||a.message||(c.organization=a);if(a&&a.user)c.userRole=
new p({id:a.user.roleId?a.user.roleId:a.user.role,role:a.user.role}),c._isCustomRole=c.userRole.isCustom(),c._roleCanShareToGroup=c._isCustomRole&&c.userRole.canShareItemToGroup(),c._roleCanShareToOrg=c._isCustomRole&&c.userRole.canShareItemToOrg(),c._roleCanSharePublic=c._isCustomRole&&c.userRole.canShareItemToPublic(),c._roleCanShare=c._roleCanShareToGroup||c._roleCanShareToOrg||c._roleCanShareToPublic,c._roleCanUpdateItems=c._isCustomRole&&c.userRole.canUpdateOrgItems(),c._roleCanShareOthersItemsToGroup=
c._isCustomRole&&c.userRole.canShareOthersItemsToGroup(),c._roleCanShareOthersItemsToOrg=c._isCustomRole&&c.userRole.canShareOthersItemsToOrg(),c._roleCanShareOthersItemsToPublic=c._isCustomRole&&c.userRole.canShareOthersItemsToPublic(),c._roleCanShareOthersItems=c._isCustomRole&&(c.userRole.canShareOthersItemsToGroup()||c.userRole.canShareOthersItemsToOrg()||c._roleCanShareOthersItemsToPublic),c._orgUserCanSharePublicOrOverride=c.organization&&(!0===c.organization.canSharePublic&&(!c._isCustomRole||
c._roleCanSharePublic||c._roleCanShareOthersItemsToPublic)||c.userRole.isAdmin());else return!1},getItemById:function(a,g){var f=new c;g=l.getStandardPortalUrl(g);g+="/sharing/rest/content/items/"+a.id;d({url:g,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(r.hitch(this,function(a){f.resolve(a)}),r.hitch(this,function(a){console.error(a);f.reject(a)}));return f},disableWebMapPopup:function(a){a&&a.setInfoWindowOnClick&&a.setInfoWindowOnClick(!1)},enableWebMapPopup:function(a){a&&
a.setInfoWindowOnClick&&a.setInfoWindowOnClick(!0)}};return k})},"jimu/PopupManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/topic dojo/on dojo/query ./FeatureActionManager ./utils ./dijit/FeatureActionPopupMenu ./RelatedRecordsPopupProjector".split(" "),function(r,d,m,l,c,t,q,p,h,n){var k=null,a=r(null,{mapManager:null,popupUnion:null,_relatedRecordsPopupProjector:null,constructor:function(a){d.mixin(this,a);this.popupMenu=h.getInstance();this.isInited=!1;this.featureActionManager=
q.getInstance();l.subscribe("mapLoaded",d.hitch(this,this.onMapLoadedOrChanged));l.subscribe("mapChanged",d.hitch(this,this.onMapLoadedOrChanged));l.subscribe("appConfigChanged",d.hitch(this,this._onAppConfigChanged));l.subscribe("widgetsActionsRegistered",d.hitch(this,this._onWidgetsActionsRegistered))},init:function(){this.popupUnion=this.mapManager.getMapInfoWindow();this.popupUnion.bigScreen&&this.popupUnion.mobile&&this.popupUnion.bigScreen.domNode&&this.popupUnion.mobile.domNode&&!this.isInited&&
(this._createPopupMenuButton(),this._bindSelectionChangeEvent(),this.isInited=!0)},_createPopupMenuButton:function(){this.popupMenuButtonDesktop&&m.destroy(this.popupMenuButtonDesktop);this.popupMenuButtonMobile&&m.destroy(this.popupMenuButtonMobile);this.popupMenuButtonDesktop=m.create("span",{"class":"popup-menu-button"},t(".actionList",this.popupUnion.bigScreen.domNode)[0]);var a=t("div.esriMobileInfoView.esriMobilePopupInfoView .esriMobileInfoViewItem").parent()[0],a=m.create("div",{"class":"esriMobileInfoViewItem"},
a);this.popupMenuButtonMobile=m.create("span",{"class":"popup-menu-button"},a);c(this.popupMenuButtonMobile,"click",d.hitch(this,this._onPopupMenuButtonClick));c(this.popupMenuButtonDesktop,"click",d.hitch(this,this._onPopupMenuButtonClick))},_onPopupMenuButtonClick:function(a){a=m.position(a.target);this.popupMenu.show(a)},_bindSelectionChangeEvent:function(){c(this.popupUnion.bigScreen,"selection-change",d.hitch(this,this._onSelectionChange));c(this.popupUnion.mobile,"selection-change",d.hitch(this,
this._onSelectionChange))},_onSelectionChange:function(a){(this.selectedFeature=a.target.getSelectedFeature())?(this.initPopupMenu([this.selectedFeature]),a=this.selectedFeature.getLayer(),(this.selectedFeature.infoTemplate||a&&a.infoTemplate)&&this._createRelatedRecordsPopupProjector(this.selectedFeature)):this._disablePopupMenu()},_disablePopupMenu:function(){m.addClass(this.popupMenuButtonDesktop,"disabled");m.addClass(this.popupMenuButtonMobile,"disabled")},_enablePopupMenu:function(){m.removeClass(this.popupMenuButtonDesktop,
"disabled");m.removeClass(this.popupMenuButtonMobile,"disabled")},initPopupMenu:function(a){if(a){var c=p.toFeatureSet(a);this.featureActionManager.getSupportedActions(c).then(d.hitch(this,function(a){var b="ZoomTo ShowPopup Flash ExportToCSV ExportToFeatureCollection ExportToGeoJSON ShowRelatedRecords SaveToMyContent CreateLayer".split(" ");a=a.filter(d.hitch(this,function(a){return 0>b.indexOf(a.name)}));0===a.length?this._disablePopupMenu():this._enablePopupMenu();a=a.map(d.hitch(this,function(a){a.data=
c;return a}));this.popupMenu.setActions(a)}))}else this._disablePopupMenu(),this.popupMenu.setActions([])},onMapLoadedOrChanged:function(){this.isInited=!1;this.init()},_onAppConfigChanged:function(){this.popupUnion&&(this.popupUnion.bigScreen&&this.popupUnion.bigScreen.hide&&(this.popupUnion.bigScreen.hide(),this.popupMenu.hide()),this.popupUnion.mobile&&this.popupUnion.mobile.hide&&(this.popupUnion.mobile.hide(),this.popupMenu.hide()))},_onWidgetsActionsRegistered:function(){this.init()},_createRelatedRecordsPopupProjector:function(a){try{this._relatedRecordsPopupProjector&&
this._relatedRecordsPopupProjector.domNode&&(this._relatedRecordsPopupProjector.destroy(),this._relatedRecordsPopupProjector=null),this._relatedRecordsPopupProjector=new n({originalFeature:a,popup:this.mapManager.map.infoWindow,popupManager:this})}catch(f){console.warn(f.message)}}});a.getInstance=function(c){null===k&&(k=new a({mapManager:c}));return k};return a})},"jimu/FeatureActionManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Deferred dojo/promise/all ./featureActions/main ./utils".split(" "),
function(r,d,m,l,c,t,q,p){var h=null,n=r(null,{constructor:function(){this._actions=[];window.isBuilder?(l.subscribe("app/mapLoaded",d.hitch(this,this._onMapLoaded)),l.subscribe("app/mapChanged",d.hitch(this,this._onMapChanged))):(l.subscribe("mapLoaded",d.hitch(this,this._onMapLoaded)),l.subscribe("mapChanged",d.hitch(this,this._onMapChanged)));window.isBuilder?(l.subscribe("app/appConfigLoaded",d.hitch(this,this._onAppConfigLoaded)),l.subscribe("app/appConfigChanged",d.hitch(this,this._onAppConfigChanged))):
(l.subscribe("appConfigLoaded",d.hitch(this,this._onAppConfigLoaded)),l.subscribe("appConfigChanged",d.hitch(this,this._onAppConfigChanged)));this._registerFrameworkActions()},getAllActions:function(){return this._actions},getSupportedActions:function(c){c=this._getFeatureSet(c);var a=[];m.forEach(this._actions,function(d){var f=this.testActionSupportFeature(d,c);f.action=d;a.push(f)},this);return t(a).then(d.hitch(this,function(a){return a.map(d.hitch(this,function(a,b){return{result:a,action:this._actions[b]}})).filter(function(a){return a.result}).map(function(a){return a.action})}))},
testActionSupportFeature:function(d,a){a=this._getFeatureSet(a);var g;a.features&&0<a.features.length&&(g=a.features[0].getLayer());d=d.isFeatureSupported(a,g);var f=new c;d&&"function"===typeof d.then?d.then(function(a){f.resolve(a)},function(a){console.error(a);f.resolve(!1)}):f.resolve(d);return f},registerAction:function(h){var a=new c;require([h.uri],d.hitch(this,function(c){var f=new c({map:this.map,appConfig:this.appConfig,label:h.label,name:h.name,widgetId:h.widgetId});m.some(this._actions,
function(a){return f.name===a.name&&f.widgetId===a.widgetId})?(console.warn("Feature/FeatureSet action has been registered.",f.name),a.reject("Feature/FeatureSet action has been registered.",f.name)):(this._actions.push(f),a.resolve(f))}));return a},removeActionsByWidgetId:function(c){this._actions=m.filter(this._actions,function(a){return a.widgetId!==c},this)},getActionsByWidgetId:function(c){return m.filter(this._actions,function(a){return a.widgetId===c},this)},getActionsByActionName:function(c){return m.filter(this._actions,
function(a){return a.name===c},this)},registerWidgetFeatureActions:function(d){var a=new c;if(!d.featureActions||!d.uri)return a.resolve(),a;var g=[];m.forEach(d.featureActions,function(a){g.push(this.registerAction({uri:d.isRemote?d.amdFolder+a.uri+".js":d.amdFolder+a.uri,widgetId:d.id,name:a.name,label:d.manifest["i18nLabels_featureAction_"+a.name][window.dojoConfig.locale]||d.manifest["i18nLabels_featureAction_"+a.name].defaultLabel}))},this);return t(g)},registerAllWidgetFeatureActions:function(c){var a=
[];c.visitElement(d.hitch(this,function(c){c.uri&&c.visible&&a.push(this.registerWidgetFeatureActions(c))}));return t(a).then(function(){l.publish("widgetsActionsRegistered")})},_reRegisterWidgetActions:function(c){var a=[];m.forEach(this.getAllActions(),function(a){var f=c.getConfigElementById(a.widgetId);"framework"===a.widgetId||f&&f.uri&&!1!==f.visible||this.removeActionsByWidgetId(a.widgetId)},this);c.visitElement(d.hitch(this,function(c){c.uri&&c.visible&&0===this.getActionsByWidgetId(c.id).length&&
a.push(this.registerWidgetFeatureActions(c))}));0<a.length&&t(a).then(function(){l.publish("widgetsActionsRegistered")})},_registerFrameworkActions:function(){m.forEach(q,function(c){this.registerAction({uri:c.uri,widgetId:"framework",label:window.jimuNls.featureActions[c.name],name:c.name})},this)},_getFeatureSet:function(c){return"[object Object]"===Object.prototype.toString.call(c)?c.features?c:p.toFeatureSet([c]):p.toFeatureSet(c)},_onAppConfigLoaded:function(c){this.appConfig=c=d.clone(c);this._setActionsAppConfig(c);
this.registerAllWidgetFeatureActions(this.appConfig)},_onAppConfigChanged:function(c){this.appConfig=c=d.clone(c);this._reRegisterWidgetActions(this.appConfig);this._setActionsAppConfig(c)},_onMapLoaded:function(c){this.map=c;this._setActionsMap(c)},_onMapChanged:function(c){this.map=c;this._setActionsMap(c)},_setActionsMap:function(c){m.forEach(this._actions,function(a){a.setMap(c)},this)},_setActionsAppConfig:function(c){m.forEach(this._actions,function(a){a.setAppConfig(c)},this)}});n.getInstance=
function(){null===h&&(h=new n,window._featureActionManager=h);return h};return n})},"jimu/featureActions/main":function(){define("./ZoomTo ./PanTo ./Flash ./ShowPopup ./ExportToCSV ./ExportToFeatureCollection ./ExportToGeoJSON ./ShowStatistics ./CreateLayer ./AddMarker ./RemoveMarker ./SaveToMyContent".split(" "),function(){return[{name:"ZoomTo",uri:"jimu/featureActions/ZoomTo"},{name:"PanTo",uri:"jimu/featureActions/PanTo"},{name:"Flash",uri:"jimu/featureActions/Flash"},{name:"ShowPopup",uri:"jimu/featureActions/ShowPopup"},
{name:"ExportToCSV",uri:"jimu/featureActions/ExportToCSV"},{name:"ExportToFeatureCollection",uri:"jimu/featureActions/ExportToFeatureCollection"},{name:"ExportToGeoJSON",uri:"jimu/featureActions/ExportToGeoJSON"},{name:"ShowStatistics",uri:"jimu/featureActions/ShowStatistics"},{name:"CreateLayer",uri:"jimu/featureActions/CreateLayer"},{name:"AddMarker",uri:"jimu/featureActions/AddMarker"},{name:"RemoveMarker",uri:"jimu/featureActions/RemoveMarker"},{name:"SaveToMyContent",uri:"jimu/featureActions/SaveToMyContent"}]})},
"jimu/featureActions/ZoomTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(r,d,m){return r(d,{name:"ZoomTo",iconClass:"icon-zoomto",isFeatureSupported:function(d){return 0<d.features.length&&d.features[0].geometry},onExecute:function(d){m.featureAction.zoomTo(this.map,d.features)}})})},"jimu/BaseFeatureAction":function(){define(["dojo/_base/declare","dojo/_base/lang"],function(r,d){return r(null,{name:void 0,label:void 0,iconFormat:"svg",iconClass:"",map:null,
appConfig:{},widgetId:null,constructor:function(m){d.mixin(this,m)},isFeatureSupported:function(d,l){return!0},onExecute:function(d,l){},setMap:function(d){this.map=d},setAppConfig:function(d){this.appConfig=d},getIcon:function(d){return"framework"===this.widgetId?require.toUrl("jimu")+"/images/feature_actions/"+this.name+"_"+d+"."+this.iconFormat:this.appConfig.getConfigElementById(this.widgetId).folderUrl+"images/"+this.name+"_"+d+"."+this.iconFormat}})})},"jimu/featureActions/PanTo":function(){define(["dojo/_base/declare",
"../BaseFeatureAction","jimu/utils"],function(r,d,m){return r(d,{name:"PanTo",iconClass:"icon-panto",isFeatureSupported:function(d){return 0<d.features.length&&d.geometryType},onExecute:function(d){m.featureAction.panTo(this.map,d.features)}})})},"jimu/featureActions/Flash":function(){define(["dojo/_base/declare","dojo/_base/lang","../BaseFeatureAction","jimu/utils"],function(r,d,m,l){return r([m],{name:"Flash",iconClass:"icon-flash",isFeatureSupported:function(c,l){if(1>c.features.length||!l)return!1;
c=c.features[0];var m=d.getObject("renderer.symbol",!1,l);return c&&c.geometry&&(c.symbol||m)&&this.map.getLayer(l.id)},onExecute:function(c,d){l.featureAction.flash(c&&c.features,d)}})})},"jimu/featureActions/ShowPopup":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(r,d,m){return r([d],{name:"ShowPopup",iconClass:"icon-show-popup",isFeatureSupported:function(d,c){return d&&d.features&&1===d.features.length&&c&&c.infoTemplate},onExecute:function(d){m.featureAction.showPopup(this.map,
d.features)}})})},"jimu/featureActions/ExportToCSV":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(r,d,m){return r(d,{name:"ExportToCSV",iconClass:"icon-export",isFeatureSupported:function(d){return 0<d.features.length},onExecute:function(d){d=m.createDataSource({type:m.TYPE_FEATURESET,filename:"features",data:d});d.setFormat(m.FORMAT_CSV);d.download()}})})},"jimu/exportUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/graphic esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils jimu/LayerInfos/LayerInfos ./utils ./GeojsonConverters".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e){function u(a,e){var c="",f=e.length,d=a.length,g="",h="",k;try{m.forEach(a,function(a){c="string"===typeof a?c+g+a:c+g+(a.alias||a.name);g=","});for(var c=c+"\r\n",n=0;n<f;n++){g="";k=e[n];for(var u=0;u<d;u++){var l=a[u];(h=k["string"===typeof l?l:l.name])||"number"===typeof h||(h="");h&&("esriFieldTypeDate"===l.type?h=b.localizeDateByFieldInfo(h,l.fieldInfo):!l.fieldInfo||"esriFieldTypeDouble"!==l.type&&"esriFieldTypeSingle"!==l.type&&"esriFieldTypeInteger"!==
l.type&&"esriFieldTypeSmallInteger"!==l.type||(h=b.localizeNumberByFieldInfo(h,l.fieldInfo)));h&&/[",\r\n]/g.test(h)&&(h='"'+h.replace(/(")/g,'""')+'"');c=c+g+h;g=","}c+="\r\n"}return c}catch(I){return""}}var v={createDataSource:function(a){return a.type===v.TYPE_TABLE?new z(a):a.type===v.TYPE_FEATURESET?new D(a):null},TYPE_TABLE:"table",TYPE_FEATURESET:"FeatureSet",FORMAT_CSV:"CSV",FORMAT_FEATURESET:"FeatureSet",FORMAT_GEOJSON:"GeoJSON"},x=r(null,{filename:void 0,suffix:".txt",format:void 0,nls:void 0,
constructor:function(){this.nls=window.jimuNls.exportTo},getExportString:function(){},getSupportExportFormats:function(){},setFormat:function(a){this.format=a},download:function(){this.getExportString().then(d.hitch(this,function(a){var b=this.filename+this.suffix;10>dojo.isIE?saveTextAs(a,b,"utf-8"):(a=new Blob([a],{type:"text/plain;charset\x3dutf-8"}),saveAs(a,b,!0))}))},exportToPortal:function(a,b){}}),D=r(x,{featureSet:null,constructor:function(a){this.inherited(arguments);this.featureSet=a.data;
this.url=a.url;this.filename=a.filename},getExportString:function(){if(this.format===v.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();if(this.format===v.FORMAT_FEATURESET)return this.suffix=".json",this._getAsFeatureSetString();if(this.format===v.FORMAT_GEOJSON)return this.suffix=".geojson",this._getAsGeoJsonString();var a=new c;a.resolve("");return a},getSupportExportFormats:function(){return[{value:v.FORMAT_CSV,label:this.nls.toCSV},{value:v.FORMAT_FEATURESET,label:this.nls.toFeatureCollection},
{value:v.FORMAT_GEOJSON,label:this.nls.toGeoJSON}]},_getFeatureSet:function(){var a=new c;if(this.featureSet)a.resolve(this.featureSet);else if(this.url){var b=new t;b.returnGeometry=!0;b.outFields=["*"];this.queryTask=new q(this.url);this.queryTask.execute(b,d.hitch(this,function(b){a.resolve(b)}),d.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getSpatialReference:function(a){if(a.spatialReference)return a.spatialReference;var b;m.some(a.features,function(a){if(a.geometry&&
a.geometry.spatialReference)return b=a.geometry.spatialReference,!0});return b},_projectToWGS84:function(e){var f=new c,d=this._getSpatialReference(e);if(d)if(4326===parseInt(d.wkid,10))f.resolve(e);else if(d.isWebMercator()){var d=new p,u=[];m.forEach(e.features,function(a){var b=new h;b.attributes=a.attributes;b.geometry=g.webMercatorToGeographic(a.geometry);u.push(b)});d.features=u;f.resolve(d)}else{d=new k;d.geometries=m.map(e.features,function(a){return a.geometry});d.outSR=new n(4326);var l=
a&&a.defaults&&a.defaults.geometryService;l&&"esri.tasks.GeometryService"===l.declaredClass||(l=b.getArcGISDefaultGeometryService());l.project(d).then(function(a){var b=new p,c=[];m.forEach(e.features,function(b,e){var f=new h;f.attributes=b.attributes;f.geometry=a[e];c.push(f)});b.features=c;f.resolve(b)},function(a){console.error(a);f.resolve([])})}else f.resolve([]);return f},_getAsFeatureSetString:function(){return this._getFeatureSet().then(d.hitch(this,function(a){var b="";a&&(a=a.toJson())&&
(b=l.stringify(a));return b}))},_getAsGeoJsonString:function(){return this._getFeatureSet().then(d.hitch(this,function(a){return this._projectToWGS84(a)})).then(d.hitch(this,function(a){var b="";if(a&&a.features&&0<a.features.length){var c={type:"FeatureCollection",features:[]};m.forEach(a.features,function(a){c.features.push(e.arcgisToGeoJSON(a))});b=l.stringify(c)}return b}))},_getAsCSVString:function(){return this._getFeatureSet().then(d.hitch(this,function(a){var b="";a&&(b=this._createCSVFromFeatureSet(a));
return b}))},_createCSVFromFeatureSet:function(a){var b=this._generateFields(a),e=m.map(a.features,function(b){var e=d.clone(b.attributes);"esriGeometryPoint"!==a.geometryType&&"point"!==a.geometryType||!b.geometry||(e.x=b.geometry.x,e.y=b.geometry.y,b.geometry.spatialReference&&b.geometry.spatialReference.wkid&&(e.wkid=b.geometry.spatialReference.wkid));return e});return u(b,e)},_generateFields:function(a){var b=a.features[0],e,c,g;b._layer&&(e=b._layer.fields,g=b._layer.id);e=d.clone(e||a.fields);
if(!e||0===e.length)for(c in e=[],b=b.attributes,b)b.hasOwnProperty(c)&&e.push({name:c});if(c=f.getInstanceSync().getLayerInfoById(g)){var h=c.getPopupInfo();h||(h=c.layerObject.infoTemplate&&c.layerObject.infoTemplate.info);m.forEach(e,d.hitch(this,function(a){a.fieldInfo=this._findFieldInfo(h,a.name)}))}a.fieldAliases&&m.forEach(e,function(b){a.fieldAliases[b.name]&&(b.alias=a.fieldAliases[b.name])});if("esriGeometryPoint"===a.geometryType||"point"===a.geometryType)e.push({name:"x",type:"esriFieldTypeDouble",
alias:"x"}),e.push({name:"y",type:"esriFieldTypeDouble",alias:"y"}),e.push({name:"wkid",type:"esriFieldTypeInteger",alias:"wkid"});return e},_findFieldInfo:function(a,b){if(!a)return null;var e;m.some(a.fieldInfos,function(a){if(a.fieldName===b)return e=a,!0});return e}}),z=r(x,{table:null,constructor:function(a){this.inherited(arguments);this.table=a.data;this.url=a.url;this.filename=a.filename},getExportString:function(){if(this.format===v.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();
var a=new c;a.resolve("");return a},getSupportExportFormats:function(){return[{value:v.FORMAT_CSV,label:this.nls.toCSV}]},_getTableData:function(){var a=new c;if(this.table)a.resolve(this.table);else if(this.url){var b=new t;b.outFields=["*"];this.queryTask=new q(this.url);this.queryTask.execute(b,d.hitch(this,function(b){var e={};e.fields=b.fields;e.datas=m.map(b.features,function(a){return a.attributes});a.resolve(e)}),d.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getAsCSVString:function(){return this._getTableData().then(d.hitch(this,
function(a){var b="";a&&(b="\ufeff"+u(a.fields,a.datas));return b}))}});return v})},"jimu/GeojsonConverters":function(){define([],function(){function r(c){var d;a:{d=c[0];for(var h=0;h<d.length;h++)if(d[h]!==c[c.length-1][h]){d=!1;break a}d=!0}d||c.push(c[0]);return c}function d(c){var d=0,h=0,n=c.length,k=c[h],a;for(h;h<n-1;h++)a=c[h+1],d+=(a[0]-k[0])*(a[1]+k[1]),k=a;return 0<=d}function m(c,d){for(var h=0;h<c.length-1;h++)for(var n=0;n<d.length-1;n++){var k;a:{var a=c[h],g=c[h+1],f=d[n],b=d[n+1],
e=(b[0]-f[0])*(a[1]-f[1])-(b[1]-f[1])*(a[0]-f[0]);k=(g[0]-a[0])*(a[1]-f[1])-(g[1]-a[1])*(a[0]-f[0]);a=(b[1]-f[1])*(g[0]-a[0])-(b[0]-f[0])*(g[1]-a[1]);if(0!==a&&(e/=a,k/=a,0<=e&&1>=e&&0<=k&&1>=k)){k=!0;break a}k=!1}if(k)return!0}return!1}function l(c){var l=[];c=c.slice(0);var h=r(c.shift().slice(0));if(4<=h.length)for(d(h)||h.reverse(),l.push(h),h=0;h<c.length;h++){var n=r(c[h].slice(0));4<=n.length&&(d(n)&&n.reverse(),l.push(n))}return l}function c(c){var d={},h;for(h in c)c.hasOwnProperty(h)&&(d[h]=
c[h]);return d}var t={arcgisToGeoJSON:function(l,p){var h={};"number"===typeof l.x&&"number"===typeof l.y&&(h.type="Point",h.coordinates=[l.x,l.y]);l.points&&(h.type="MultiPoint",h.coordinates=l.points.slice(0));l.paths&&(1===l.paths.length?(h.type="LineString",h.coordinates=l.paths[0].slice(0)):(h.type="MultiLineString",h.coordinates=l.paths.slice(0)));if(l.rings){var n=l.rings.slice(0),h=[],k=[],a,g;for(g=0;g<n.length;g++){var f=r(n[g].slice(0));4>f.length||(d(f)?h.push([f]):k.push(f))}for(f=[];k.length;){g=
k.pop();for(var b=!1,n=h.length-1;0<=n;n--){var e=a=h[n][0],u=g;a=m(e,u);for(var u=u[0],q=!1,x=-1,D=e.length,z=D-1;++x<D;z=x)(e[x][1]<=u[1]&&u[1]<e[z][1]||e[z][1]<=u[1]&&u[1]<e[x][1])&&u[0]<(e[z][0]-e[x][0])*(u[1]-e[x][1])/(e[z][1]-e[x][1])+e[x][0]&&(q=!q);e=q;if(!a&&e){h[n].push(g);b=!0;break}}b||f.push(g)}for(;f.length;){g=f.pop();k=!1;for(n=h.length-1;0<=n;n--)if(a=h[n][0],m(a,g)){h[n].push(g);k=!0;break}k||h.push([g.reverse()])}h=1===h.length?{type:"Polygon",coordinates:h[0]}:{type:"MultiPolygon",
coordinates:h}}if(l.geometry||l.attributes)h.type="Feature",h.geometry=l.geometry?t.arcgisToGeoJSON(l.geometry):null,h.properties=l.attributes?c(l.attributes):null,l.attributes&&(h.id=l.attributes[p]||l.attributes.OBJECTID||l.attributes.FID);return h},geojsonToArcGIS:function(d,p){p=p||"OBJECTID";var h={wkid:4326},n={};switch(d.type){case "Point":n.x=d.coordinates[0];n.y=d.coordinates[1];n.spatialReference=h;break;case "MultiPoint":n.points=d.coordinates.slice(0);n.spatialReference=h;break;case "LineString":n.paths=
[d.coordinates.slice(0)];n.spatialReference=h;break;case "MultiLineString":n.paths=d.coordinates.slice(0);n.spatialReference=h;break;case "Polygon":n.rings=l(d.coordinates.slice(0));n.spatialReference=h;break;case "MultiPolygon":p=n;d=d.coordinates.slice(0);for(var k=[],a=0;a<d.length;a++)for(var g=l(d[a]),f=g.length-1;0<=f;f--){var b=g[f].slice(0);k.push(b)}p.rings=k;n.spatialReference=h;break;case "Feature":d.geometry&&(n.geometry=t.geojsonToArcGIS(d.geometry,p));n.attributes=d.properties?c(d.properties):
{};d.id&&(n.attributes[p]=d.id);break;case "FeatureCollection":n=[];for(h=0;h<d.features.length;h++)n.push(t.geojsonToArcGIS(d.features[h],p));break;case "GeometryCollection":for(n=[],h=0;h<d.geometries.length;h++)n.push(t.geojsonToArcGIS(d.geometries[h],p))}return n}};return t})},"jimu/featureActions/ExportToFeatureCollection":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(r,d,m){return r(d,{name:"ExportToFeatureCollection",iconClass:"icon-export",isFeatureSupported:function(d){return 0<
d.features.length&&d.features[0].geometry},onExecute:function(d){d=m.createDataSource({type:m.TYPE_FEATURESET,filename:"features",data:d});d.setFormat(m.FORMAT_FEATURESET);d.download()}})})},"jimu/featureActions/ExportToGeoJSON":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(r,d,m){return r(d,{name:"ExportToGeoJSON",iconClass:"icon-export",isFeatureSupported:function(d){return 0<d.features.length&&d.features[0].geometry},onExecute:function(d){d=m.createDataSource({type:m.TYPE_FEATURESET,
filename:"features",data:d});d.setFormat(m.FORMAT_GEOJSON);d.download()}})})},"jimu/featureActions/ShowStatistics":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/dijit/FieldStatistics"],function(r,d,m){return r(d,{iconClass:"icon-statistics",isFeatureSupported:function(d,c){return 1<d.features.length&&c&&"esri.layers.GraphicsLayer"!==c.declaredClass&&0<this.getNumbericFields(c).length},onExecute:function(d,c){var l=new m;d={featureSet:d,layer:c,fieldNames:this.getNumbericFields(c).map(function(c){return c.name})};
l.showContentAsPopup(d)},getNumbericFields:function(d){return d.fields.filter(function(c){return-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(c.type)})}})})},"jimu/dijit/FieldStatistics":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/NodeList-manipulate dojo/when dijit/form/Select esri/lang jimu/dijit/Popup jimu/dijit/LoadingIndicator jimu/utils jimu/statisticsUtils".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b){return r([d],{statInfo:null,postMixInProperties:function(){this.nls=window.jimuNls.fieldStatistics;m.mixin(this.nls,window.jimuNls.common)},showContent:function(a){this.statInfo=a;0!==this.statInfo.fieldNames.length&&(a=l.create("div",{className:"stat-container"},this.domNode),this._createFieldDom(a),1===this.statInfo.fieldNames.length&&(this.statInfo.fieldName=this.statInfo.fieldNames[0],this._showOneFieldStatContent(this.statInfo,a)))},showContentAsPopup:function(b){this.statInfo=
b;this._statisticsPopup&&this._statisticsPopup.domNode&&this._statisticsPopup.close();this._statisticsPopup=null;this._statisticsPopup=new a({titleLabel:this.nls.statistics,content:this.domNode,width:270,height:265,buttons:[{label:this.nls.ok}]});this.showContent(b)},_showOneFieldStatContent:function(a,c){var e;b.isStatFromServer(this.statInfo)&&(e=new g,e.placeAt(c),e.show());b.getStatisticsResult(this.statInfo).then(m.hitch(this,function(a){e&&e.destroy();q(".esriAGOTableStatistics",c).remove();
a=this._createStatContent(a);l.place(a,c)}))},_getFieldAliaseFromStatInfo:function(a){var b=this.statInfo.featureSet;(b=b&&b.fieldAliases)&&"undefined"!==typeof b[a]?b=b[a]:this.statInfo.layer?(b=c.filter(this.statInfo.layer.fields,function(b){return b.name===a}),b=b[0]?b[0].alias:""):b=a;return b},_createFieldDom:function(a){var b;if(1<this.statInfo.fieldNames.length){b=l.create("div",{className:"header"},a);l.create("span",{innerHTML:this.nls.field+": "},b);var e=new n({options:this.statInfo.fieldNames.map(m.hitch(this,
function(a){return{value:a,label:this._getFieldAliaseFromStatInfo(a)}})),style:{width:"150px"}});this.own(t(e,"change",m.hitch(this,function(b){this.statInfo.fieldName=b;this._showOneFieldStatContent(this.statInfo,a)})));e.placeAt(b);this.statInfo.fieldName=this.statInfo.fieldNames[0];this._showOneFieldStatContent(this.statInfo,a)}else b=l.create("div",{className:"header",innerHTML:"\x3cspan\x3e"+this.nls.field+"\x3c/span\x3e: "+this._getFieldAliaseFromStatInfo(this.statInfo.fieldNames[0])},a);return b},
_createStatContent:function(a){var b={},e="count sum min max ave stddev".split(" "),f,d,g,h,k,n,p,m;f=l.create("div",{className:"esriAGOTableStatistics",innerHTML:""});l.create("div",{className:"hzLine",innerHTML:""},f);d=l.create("table",{className:"attrTable",innerHTML:"",style:{cellpadding:0,cellspacing:0}},f);for(k in a)a.hasOwnProperty(k)&&(b[k.toLowerCase()]=a[k]);k=b.countfield;m=b.sumfield||"";p=b.minfield||"";n=b.maxfield||"";a=b.avgfield||"";b=b.stddevfield||"";g=l.create("tbody",{},d);
var q=this;c.forEach([k,m,p,n,a,b],function(a,b){""!==a&&(h=l.create("tr",{valign:"top"},g),l.create("td",{"class":"attrName",innerHTML:q.nls[e[b]]},h),l.create("td",{"class":"attrValue",innerHTML:a},h))});l.create("div",{className:"break",innerHTML:""},f);return f}})})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x){function D(a){return function(b){this._isLoaded?this.inherited(a,arguments):this.loadDropDown(p.hitch(this,a,b))}}var z=d("dijit.form._SelectMenu",g,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(h(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var a=!1,b=this.parentWidget.value;
p.isArray(b)&&(b=b[b.length-1]);b&&r.forEach(this.parentWidget._getChildren(),function(e){e.option&&b===e.option.value&&(a=!0,this.focusChild(e,!1))},this);a||this.inherited(arguments)}});c=d("dijit.form.Select"+(n("dojo-bidi")?"_NoBidi":""),[k,a,u],{baseClass:"dijitSelect dijitValidationTextBox",templateString:x,_buttonInputDisabled:n("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=a?a:0].value)}this.dropDown=new z({id:this.id+"_menu",parentWidget:this});l.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(a){if(a.value||a.label){var e=p.hitch(this,"_setValueAttr",a);a=new f({option:a,label:("text"===this.labelType?(a.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a.label)||this.emptyLabel,
onClick:e,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:a.disabled||!1});a.focusNode.setAttribute("role","option");return a}return new b({ownerDocument:this.ownerDocument})},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(A){}},focusChild:function(a){a&&this.set("value",
a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=v.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,e,c){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{r.forEach(this._getChildren(),function(a){a.destroyRecursive()});
var b=new f({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(b)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);m.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?e.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):e.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);e.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=t.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(h(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[q.LEFT_ARROW];delete a[q.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);
l.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);e.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){e.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
n("dojo-bidi")&&(c=d("dijit.form.Select",c,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));c._Menu=z;c.prototype._onContainerKeydown=D("_onContainerKeydown");c.prototype._onContainerKeypress=D("_onContainerKeypress");return c})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g){return c("dijit.form._FormSelectWidget",g,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(h.isArrayLike(a))return r.map(a,"return this.getOptions(item);",this);h.isString(a)&&(a={value:a});h.isObject(a)&&(r.some(b,function(b,c){for(var e in a)if(!(e in b)||b[e]!=a[e])return!1;a=c;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){r.forEach(h.isArrayLike(a)?a:[a],function(a){a&&h.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(h.isArrayLike(a)?
a:[a]);r.forEach(a,function(a){a&&(this.options=r.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){r.forEach(h.isArrayLike(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),c;if(b)for(c in a)b[c]=a[c]},this);this._loadChildren()},setStore:function(a,b,e){p.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,b,e)},_deprecatedSetStore:function(c,b,e){var f=this.store;e=e||{};if(f!==c){for(var g;g=this._notifyConnections.pop();)g.remove();c.get||(h.mixin(c,{_oldAPI:!0,get:function(a){var b=new d;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(b,e){var c=new d(function(){f.abort&&f.abort()});c.total=new d;var f=this.fetch(h.mixin({query:b,onBegin:function(a){c.total.resolve(a)},
onComplete:function(a){c.resolve(a)},onError:function(a){c.reject(a)}},e));return new a(c)}}),c.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[m.after(c,"onNew",h.hitch(this,"_onNewItem"),!0),m.after(c,"onDelete",h.hitch(this,"_onDeleteItem"),!0),m.after(c,"onSet",h.hitch(this,"_onSetItem"),!0)]));this._set("store",c)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);e.query&&this._set("query",e.query);e.queryOptions&&this._set("queryOptions",e.queryOptions);c&&c.query&&(this._loadingStore=!0,this.onLoadDeferred=new d,this._queryRes=c.query(this.query,this.queryOptions),k(this._queryRes,h.hitch(this,function(a){if(this.sortByLabel&&!e.sort&&a.length)if(c.getValue)a.sort(l.createSortFunction([{attribute:c.getLabelAttributes(a[0])[0]}],c));else{var f=this.labelAttr;a.sort(function(a,b){return a[f]>b[f]?1:b[f]>
a[f]?-1:0})}e.onFetch&&(a=e.onFetch.call(this,a,e));r.forEach(a,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(h.hitch(this,function(a,b,e){b==e?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=e&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:b);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(a):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),h.hitch(this,function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)})));return f},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=h.isArrayLike(a)?r.map(a,function(a){return h.isObject(a)?a:{value:a}}):h.isObject(a)?[a]:[{value:a}];a=r.filter(this.getOptions(a),function(a){return a&&a.value});var e=this.getOptions()||[];this.multiple||a[0]&&a[0].value||!e.length||(a[0]=
e[0]);r.forEach(e,function(b){b.selected=r.some(a,function(a){return a.value===b.value})});e=r.map(a,function(a){return a.value});if("undefined"!=typeof e&&"undefined"!=typeof e[0]){var c=r.map(a,function(a){return a.label});this._setDisplay(this.multiple?c:c[0]);this.inherited(arguments,[this.multiple?e:e[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=r.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(r.forEach(this._getChildren(),function(a){a.destroyRecursive()}),r.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;r.forEach(this._getChildren(),function(e){var c=r.some(a,function(a){return e.option&&
a===e.option.value});c&&!b.multiple&&(b.focusedChild=e);q.toggle(e.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),c);e.domNode.setAttribute("aria-selected",c?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=r.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?r.map(r.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){b&&b.parent||this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,e=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:e?b.getIdentity(a):null,label:e,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);t.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?n("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+p._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);m.after(this,"onChange",h.hitch(this,"_updateSelection"));var a=this.store;a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(r,d,m,l){return r("dijit.DropDownMenu",l,{templateString:m,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(c){this._moveToPopup(c);c.stopPropagation();c.preventDefault()},
_onLeftArrow:function(c){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else c.stopPropagation(),c.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b){return d("dijit._MenuBase",[a,
b,f,g],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){c.toggle(this.domNode,"dijitMenuActive",a);c.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var b=k.byNode(a);return a.parentNode==this.containerNode&&
b&&b.focus},postCreate:function(){var a=this,b="string"==typeof this.childSelector?this.childSelector:t.hitch(this,"childSelector");this.own(p(this.containerNode,p.selector(b,q.enter),function(){a.onItemHover(k.byNode(this))}),p(this.containerNode,p.selector(b,q.leave),function(){a.onItemUnhover(k.byNode(this))}),p(this.containerNode,p.selector(b,n),function(b){a.onItemClick(k.byNode(this),b);b.stopPropagation()}),p(this.containerNode,p.selector(b,"focusin"),function(){a._onItemFocus(k.byNode(this))}));
this.inherited(arguments)},onKeyboardSearch:function(a,b,c,f){this.inherited(arguments);if(a&&(-1==f||a.popup&&1==f))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},
_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=
a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&
(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),b=/^key/.test(b._origType||b.type)||0==b.clientX&&0==b.clientY,this._openItemPopup(a,
b)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openItemPopup:function(a,b){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var e=a.popup;e.parentMenu=this;this.own(this._mouseoverHandle=p.once(e.domNode,"mouseover",t.hitch(this,"_onPopupHover")));var c=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&c.focusChild(a);c._cleanUp()},onExecute:t.hitch(this,
"_cleanUp",!0),onClose:function(){c._mouseoverHandle&&(c._mouseoverHandle.remove(),delete c._mouseoverHandle)}},b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(l.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),
this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(r,d,m,l,c,t,q,p,h,n){return d("dijit._KeyNavContainer",[h,n,p],{connectKeyNavHandlers:function(d,a){var g=this._keyNavCodes={},f=t.hitch(this,"focusPrev"),b=t.hitch(this,"focusNext");r.forEach(d,function(a){g[a]=f});r.forEach(a,function(a){g[a]=b});g[c.HOME]=t.hitch(this,"focusFirstChild");g[c.END]=t.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){l.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);r.forEach(this.getChildren(),
t.hitch(this,"_startupChild"))},addChild:function(c,a){this.inherited(arguments);this._startupChild(c)},_startupChild:function(c){c.set("tabIndex","-1")},_getFirst:function(){var c=this.getChildren();return c.length?c[0]:null},_getLast:function(){var c=this.getChildren();return c.length?c[c.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(c){return(c=
q.byNode(c))&&c.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(r,d,m,l,c,t,q,p){return d("dijit._KeyNavMixin",p,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);m.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var d=this._keyNavCodes={};d[l.HOME]=c.hitch(this,"focusFirstChild");d[l.END]=c.hitch(this,
"focusLastChild");d[this.isLeftToRight()?l.LEFT_ARROW:l.RIGHT_ARROW]=c.hitch(this,"_onLeftArrow");d[this.isLeftToRight()?l.RIGHT_ARROW:l.LEFT_ARROW]=c.hitch(this,"_onRightArrow");d[l.UP_ARROW]=c.hitch(this,"_onUpArrow");d[l.DOWN_ARROW]=c.hitch(this,"_onDownArrow")}var n=this,d="string"==typeof this.childSelector?this.childSelector:c.hitch(this,"childSelector");this.own(t(this.domNode,"keypress",c.hitch(this,"_onContainerKeypress")),t(this.domNode,"keydown",c.hitch(this,"_onContainerKeydown")),t(this.domNode,
"focus",c.hitch(this,"_onContainerFocus")),t(this.containerNode,t.selector(d,"focusin"),function(c){n._onChildFocus(q.getEnclosingWidget(this),c)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(c,d){c&&(this.focusedChild&&c!==this.focusedChild&&this._onChildBlur(this.focusedChild),c.set("tabIndex",this.tabIndex),c.focus(d?"end":"start"))},_onContainerFocus:function(c){c.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){m.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(c){m.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(c){c&&c!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),c.set("tabIndex",this.tabIndex),this.lastFocused=c,this._set("focusedChild",c))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(c,d,k,a){c&&this.focusChild(c)},_keyboardSearchCompare:function(c,d){var h=c.domNode;c=(c.label||(h.focusNode?
h.focusNode.label:"")||h.innerText||h.textContent||"").replace(/^\s+/,"").substr(0,d.length).toLowerCase();return d.length&&c==d?-1:0},_isFormElement:function(c){return"INPUT"===c.tagName||"TEXTAREA"===c.tagName||"SELECT"===c.tagName||"BUTTON"===c.tagName},_onContainerKeydown:function(c){if(!this._isFormElement(document.activeElement)){var d=this._keyNavCodes[c.keyCode];d?(d(c,this.focusedChild),c.stopPropagation(),c.preventDefault(),this._searchString=""):c.keyCode!=l.SPACE||!this._searchTimer||
c.ctrlKey||c.altKey||c.metaKey||(c.stopImmediatePropagation(),c.preventDefault(),this._keyboardSearch(c," "))}},_onContainerKeypress:function(c){this._isFormElement(document.activeElement)||c.charCode<=l.SPACE||c.ctrlKey||c.altKey||c.metaKey||(c.preventDefault(),c.stopPropagation(),this._keyboardSearch(c,String.fromCharCode(c.charCode).toLowerCase()))},_keyboardSearch:function(d,n){var h=null,a,g=0;c.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=n;var c=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;a=this._searchString.substr(0,c);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var b=this.focusedChild||null;if(1==c||!b)if(b=this._getNextFocusableChild(b,1),!b)return;c=b;do{var e=this._keyboardSearchCompare(b,a);e&&0==g++&&(h=b);if(-1==e){g=-1;break}b=this._getNextFocusableChild(b,1)}while(b&&b!=c)})();this.onKeyboardSearch(h,d,a,g)},_onChildBlur:function(){},_getNextFocusableChild:function(c,d){var h=
c;do{if(c)c=this._getNext(c,d);else if(c=this[0<d?"_getFirst":"_getLast"](),!c)break;if(null!=c&&c!=h&&c.isFocusable())return c}while(c!=h);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(c,d){if(c)for(c=c.domNode;c;)if((c=c[0>d?"previousSibling":"nextSibling"])&&"getAttribute"in c){var h=q.byNode(c);if(h)return h}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a){q=r("dijit.MenuItem"+(t("dojo-bidi")?"_NoBidi":""),[p,h,n,k],{templateString:a,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var c="",b;b=a.search(/{\S}/);if(0<=b){var c=a.charAt(b+1),e=a.substr(0,b);a=a.substr(b+3);b=e+c+a;a=e+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+c+"\x3c/span\x3e"+a}else b=a;this.domNode.setAttribute("aria-label",b+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",c)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){!a||"label"in this.params||this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);m.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&m.set(this.accelKeyNode,"id",this.id+"_accel");d.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==t("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(g){}},_setSelected:function(a){l.toggle(this.domNode,
"dijitMenuItemSelected",a)},setLabel:function(a){c.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){c.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=
a?"":"none",this.accelKeyNode.innerHTML=a,m.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});t("dojo-bidi")&&(q=r("dijit.MenuItem",q,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return q})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(r,d){return r("dijit._Contained",null,{_getSibling:function(d){var l=this.getParent();return l&&l._getSiblingOfChild&&l._getSiblingOfChild(this,
"previous"==d?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var d=this.getParent();return d&&d.getIndexOfChild?d.getIndexOfChild(this):-1}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(r,d,m,l,c,t){return r("dijit.MenuSeparator",[m,l,c],{templateString:t,
buildRendering:function(){this.inherited(arguments);d.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(r,d,m,l){return r(d,{baseClass:"jimu-loading-indicator jimu-agol-loading",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&m.set(this.domNode,{display:"none"});
m.set(this.domNode,{width:"100%",height:"100%"});l.place(' \x3cdiv class\x3d"loading-container"\x3e\x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\x3c/div\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&this.hidden&&(m.set(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(m.set(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/statisticsUtils":function(){define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),
function(r,d,m,l,c,t,q,p,h){function n(e){var f;f=new c;f.outFields=[e.fieldName];f.outStatistics=[];f.geometry=e.geometry;var d=a(e);r.forEach(d,function(a){var b=new m;b.statisticType=a;b.displayFeildName=e.fieldName;b.onStatisticField=e.fieldName;b.outStatisticFieldName=u[a];f.outStatistics.push(b)});f.where=e.filterExpression?e.filterExpression:e.layer.getDefinitionExpression()?e.layer.getDefinitionExpression():"1\x3d1";e.geometry&&(f.geometry=e.geometry);return(new l(e.layer.url)).execute(f).then(function(a){return a&&
a.features&&0<a.features.length?(a=a.features[0].attributes,b(e,a),a):[]})}function k(e){var c={countField:0,sumField:0},f=a(e),d=0,h=0;e.featureSet.features.forEach(function(a){var b=a.attributes[e.fieldName];null!==b&&"undefined"!==typeof b&&f.forEach(function(a){switch(a){case "count":c.countField++;break;case "sum":c.sumField+=b;break;case "min":c.minField="undefined"===typeof c.minField?b:Math.min(c.minField,b);break;case "max":c.maxField="undefined"===typeof c.maxField?b:Math.max(c.maxField,
b);break;case "avg":d++,h+=b}})});c.avgField=0===d?0:0===d?"":h/d;var k=e.featureSet.features.filter(function(a){a=a.attributes[e.fieldName];return null===a||"undefined"===typeof a?!1:!0}).map(function(a){return a.attributes[e.fieldName]});c.stddevField=g(k);b(e,c);return c}function a(a){return a.statisticTypes&&0<a.statisticTypes.length?e.filter(function(b){return-1<a.statisticTypes.indexOf(b)}):e}function g(a){var b=a.length;if(1>=b)return 0;var e=0;a.forEach(function(a){e+=a});var c=e/b,f=0;a.forEach(function(a){f+=
Math.pow(a-c,2)});return Math.sqrt(1/(b-1)*f)}function f(a){var b=p.getInstanceSync();return a.layer?b.getLayerOrTableInfoById(a.layer.id).loadInfoTemplate().then(function(a){var b={};a.info&&a.info.fieldInfos&&a.info.fieldInfos.forEach(function(a){b[a.fieldName]=a});return b}):d({})}function b(a,b){if(a.fieldInfos&&a.fieldInfos[a.fieldName])for(var e in b)"countField"!==e&&t.isDefined(b[e])&&(b[e]=null===b[e]||"undefined"===typeof b[e]?"":q.localizeNumberByFieldInfo(b[e],a.fieldInfos[a.fieldName]))}
var e="count sum min max avg stddev".split(" "),u={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};h.getStatisticsResult=function(a){return f(a).then(function(b){a.fieldInfos=b;if(a.featureSet)return d(k(a));if(a.layer){if(a.layer.url)return n(a);a.featureSet=q.toFeatureSet(a.layer.graphics);return d(k(a))}})};h.isStatFromServer=function(a){return a.layer&&a.layer.url};h.getStddevVal=g;h.getStatisticsResultFromClientSync=k})},"jimu/featureActions/CreateLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/json dojo/on esri/layers/FeatureLayer esri/renderers/jsonUtils esri/symbols/jsonUtils ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/Search jimu/LayerInfos/LayerInfos jimu/utils".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g){return r(h,{name:"CreateLayer",iconClass:"icon-create-layer",isFeatureSupported:function(a,b){return 0<a.features.length&&a.features[0].geometry&&b&&b.geometryType&&b.fields&&b.objectIdField},onExecute:function(a,b){var e;a={layerDefinition:{geometryType:b.geometryType,fields:d.clone(b.fields),objectIdField:b.objectIdField},featureSet:a.toJson()};a=new t(a);(e=b._json?l.parse(b._json):null)&&e.drawingInfo&&e.drawingInfo.renderer?(e=e.drawingInfo.renderer,e=q.fromJson(e)):
e=q.fromJson(b.renderer.toJson());a.setRenderer(e);(b=b.getSelectionSymbol())&&a.setSelectionSymbol(p.fromJson(b.toJson()));this._popupAddLayer(a)},_popupAddLayer:function(a){var b,e=m.create("div",{style:"padding: 0 10px 0 10px;"}),f=(new k({placeholder:window.jimuNls.layerInfosMenu.labelLayer})).placeAt(e);m.setStyle(f.searchBtn,"display","none");var h=new n({content:e,titleLabel:window.jimuNls.featureActions.CreateLayer,width:525,height:180,buttons:[{label:window.jimuNls.common.ok,onClick:d.hitch(this,
function(){a.name=g.stripHTML(f.getValue());this._addLayerToMap(a);h.close();b&&b.remove&&b.remove()})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:d.hitch(this,function(){h.close();b&&b.remove&&b.remove()})}]});f.inputSearch.focus();h.disableButton(0);b=c(f.inputSearch,"keyup",function(){f.getValue()?h.enableButton(0):h.disableButton(0)})},_addLayerToMap:function(f){var b=a.getInstanceSync(),e=c(b,"layerInfosChanged",d.hitch(this,function(a){f.id===a.id&&(a.enablePopup(),
e.remove())}));this.map.addLayer(f)}})})},"jimu/dijit/Search":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/string","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(r,d,m,l,c){return r([l,c],{baseClass:"jimu-search",declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',
placeholder:"",onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&d.setAttr(this.inputSearch,"placeholder",this.placeholder)},getValue:function(){return m.trim(this.inputSearch.value)},doSearch:function(){if(this.onSearch)this.onSearch(this.getValue())},_onKeyDown:function(c){this.doChange();13===(void 0!==c.keyCode?c.keyCode:c.which)&&this.doSearch();c.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()},
doChange:function(){if(this.onChange)this.onChange(this.getValue())}})})},"jimu/featureActions/AddMarker":function(){define("dojo/_base/declare ../BaseFeatureAction esri/graphic esri/layers/GraphicsLayer esri/symbols/PictureMarkerSymbol esri/InfoTemplate jimu/shareUtils".split(" "),function(r,d,m,l,c,t,q){return r(d,{name:"AddMarker",iconClass:"icon-add",_markerLayer:null,isFeatureSupported:function(c){this._getMarkerLayer();return this._isSupportType(c)&&0<c.features.length&&c.features[0]&&c.features[0].geometry&&
!1===this._isFeatureInMarkerFeatureActionLayer(c)},onExecute:function(c,d){this._addMarker(c,d)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new l({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var c=this.map.snappingManager.layerInfos;c.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(c)}},_addMarker:function(d,
h){var n=d.features[0].geometry,k={};h=h.displayField||d.displayFieldName||h.objectIdField;k.title="";d.features[0].attributes&&h&&(k.title=d.features[0].attributes[h],k.title||(k.title=""));h={};if("point"===n.type)h=n;else if("polygon"===n.type||"polyline"===n.type||"multipoint"===n.type)h=this.map.infoWindow&&this.map.infoWindow.isShowing?this.map.infoWindow.location:n.getExtent().getCenter();h.getLongitude()&&h.getLatitude()?(k.longitude=h.getLongitude(),k.latitude=h.getLatitude()):h.x&&h.y&&
(k.x=h.x,k.y=h.y);var a="";n&&n.spatialReference&&n.spatialReference.wkid&&(a=n.spatialReference.wkid);k.spatialReference={wkid:a};n=q.getXyContent(k);k=q.getShareUrl(this.map,k,!0);k=q.getShareUrlContent(k);k=n+k;n=new c(require.toUrl("jimu")+"/images/EsriBluePinCircle26.png");n.width=26;n.height=26;n.setOffset(0,n.height/2);h=new m(h,n,null,null);h._markerFeatureactionGraphic=d.features[0];h.infoTemplate=this._setInfoTemplate(k);this._markerLayer.add(h);this._closePopupWindow()},_setInfoTemplate:function(c){var d=
new t;d.setContent(c);return d},_closePopupWindow:function(){this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(c){return c.features[0]&&c.features[0]._graphicsLayer&&c.features[0]._graphicsLayer.id&&"marker-feature-action-layer"===c.features[0]._graphicsLayer.id?!0:!1},_isSupportType:function(c){if(c&&c.geometryType){if(c.features&&c.features.length&&1<c.features.length)return!1;c=c.geometryType;return"point"===c||"polygon"===c||"polyline"===
c||"multipoint"===c}return!1}})})},"jimu/featureActions/RemoveMarker":function(){define(["dojo/_base/declare","../BaseFeatureAction","esri/layers/GraphicsLayer"],function(r,d,m){return r(d,{name:"RemoveMarker",iconClass:"icon-close",_markerLayer:null,isFeatureSupported:function(d){this._getMarkerLayer();return 0<d.features.length&&d.geometryType&&d.features[0]&&d.features[0].geometry&&!0===this._isFeatureInMarkerFeatureActionLayer(d)},onExecute:function(d){this._removeMarker(d)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=
this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new m({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var d=this.map.snappingManager.layerInfos;d.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(d)}},_removeMarker:function(d){d=d.features[0];d._textSymbol&&this._markerLayer.remove(d._textSymbol);this._markerLayer.remove(d);this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(d){return d.features[0]&&
d.features[0]._graphicsLayer&&d.features[0]._graphicsLayer.id?"marker-feature-action-layer"===d.features[0]._graphicsLayer.id:!1}})})},"jimu/featureActions/SaveToMyContent":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/graphicsUtils esri/IdentityManager jimu/portalUtils jimu/portalUrlUtils jimu/Role jimu/dijit/Message ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/AddItemForm".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a,g,f){return r(a,{name:"SaveToMyContent",
iconClass:"icon-save",isFeatureSupported:function(a){return 0>=a.features.length||!a.features[0].geometry?!1:!0},onExecute:function(a,c){this.checkPrivilege().then(d.hitch(this,function(b){if(b)var e=new f({appConfig:this.appConfig}),h=new g({content:e,titleLabel:window.jimuNls.featureActions.SaveToMyContent,width:525,height:220,buttons:[{label:window.jimuNls.common.ok,onClick:d.hitch(this,function(){e.showBusy();h.disableButton(0);e.validate().then(d.hitch(this,function(b){b.valid?this._addItem(a,
c,e):(e.hideBusy(),h.enableButton(0))}))})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:d.hitch(this,function(){h.close()})}]});else new k({message:window.jimuNls.noEditPrivileges})}))},checkPrivilege:function(){var a=h.getStandardPortalUrl(this.appConfig.portalUrl),e=p.getPortal(a);if(e){if(e.haveSignIn())return this._hasPrivilege(e);q.useSignInPage=!1;return e.signIn().then(d.hitch(this,function(){q.useSignInPage=!0;return this._hasPrivilege(e)}),d.hitch(this,function(){q.useSignInPage=
!0}))}a=new c;a.resolve(!1);return a},_hasPrivilege:function(a){return a.loadSelfInfo().then(d.hitch(this,function(a){if(a&&a.user){var b=new n({id:a.user.roleId?a.user.roleId:a.user.role,role:a.user.role});a.user.privileges&&b.setPrivileges(a.user.privileges);return b.canCreateItem()&&b.canPublishFeatures()}return!1}),function(){return!1})},_addItem:function(a,c,f){var b=f.getName(),e=f.getFolderId(),g=f.popup;c=c||{};var h={name:c.name||c.id,type:c.type||"Feature Layer",displayField:c.displayField,
description:c.description,copyrightText:c.copyright,geometryType:c.geometryType||a.geometryType,fields:c.fields||a.fields,objectIdField:c.objectIdField};a.features[0].geometry&&(c=t.graphicsExtent(a.features),h.initialExtent=c,h.fullExtent=c,h.extent=c);!h.objectIdField&&h.fields&&m.some(h.fields,function(a){if("esriFieldTypeOID"===a.type)return h.objectIdField=a.name,!0});a={layers:[{layerDefinition:h,featureSet:a.toJson()}]};f.addItem({name:b,title:b,type:"Feature Collection",typeKeywords:"WAB_created",
text:l.stringify(a)},e).then(d.hitch(this,function(a){!0===a.success?g.close():(f.hideBusy(),g.enableButton(0),new k({message:a.error?a.error.message:""}))}),function(a){f.hideBusy();g.enableButton(0);new k({message:a.message})})}})})},"jimu/dijit/AddItemForm":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/AddItemForm.html jimu/portalUtils jimu/portalUrlUtils dojo/data/ItemFileWriteStore dijit/form/ValidationTextBox dijit/form/FilteringSelect jimu/dijit/LoadingShelter".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k){return r([c,t,q],{baseClass:"jimu-item-form",templateString:p,appConfig:null,folderStore:null,portalUser:null,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);var a=n.getStandardPortalUrl(this.appConfig.portalUrl);h.getPortal(a).getUser().then(d.hitch(this,function(a){this.portalUser=a;return a.getContent()})).then(d.hitch(this,function(a){this.folderStore=this._createFolderStore(a.folders,this.portalUser.username);
this.itemFolder.set("store",this.folderStore);this.itemFolder.set("required",!0);this.itemFolder.set("searchAttr","name");this.itemFolder.set("displayedValue",this.portalUser.username)}))},getName:function(){return this.itemName.get("value")},getFolderId:function(){return this.itemFolder.item?this.folderStore.getValue(this.itemFolder.item,"id"):""},showBusy:function(){this.shelter.show()},hideBusy:function(){this.shelter.hide()},validate:function(){var a=new l;this.itemForm.validate()?a.resolve({valid:!0}):
a.resolve({valid:!1,message:"param requried"});return a},addItem:function(a,c){if(this.portalUser)return this.portalUser.addItem(a,c);a=new l;a.resolve({error:{message:"portalUser is null"}});return a},_createFolderStore:function(a,c){var f=new k({data:{identifier:"id",label:"name",items:[]}});f.newItem({name:c,id:""});m.forEach(a,function(a){f.newItem({name:a.title,id:a.id})});return f}})})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox",
"./ComboBoxMixin"],function(r,d,m,l,c){return r("dijit.form.FilteringSelect",[l,c],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(c,d,l,h){d&&d[this.searchAttr]!==this._lastQuery||!d&&c.length&&this.store.getIdentity(c[0])!=this._lastQuery||(c.length?this.set("item",c[0],h):this.set("value",
"",h||void 0===h&&!this.focused,this.textbox.value,null))},_openResultList:function(c,d,l){d[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(c,l,p,h){this._onChangeActive||(l=null);if(void 0===h){if(null===c||""===c)if(c="",!d.isString(p)){this._setDisplayedValueAttr(p||"",l);return}var n=this;this._lastQuery=c;m(this.store.get(c),
function(c){n._callbackSetLabel(c?[c]:[],void 0,void 0,l)})}else this.valueNode.value=c,this.inherited(arguments,[c,l,p,h])},_setItemAttr:function(c,d,l){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(c){return c.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(c,l){null==c&&(c="");if(!this._created){if(!("displayedValue"in this.params))return;l=!1}if(this.store){this.closeDropDown();var p=d.clone(this.query),h=this._getDisplayQueryString(c),
n;this.store._oldAPI?n=h:(n=this._patternToRegExp(h),n.toString=function(){return h});this._lastQuery=p[this.searchAttr]=n;this._lastDisplayedValue=this.textbox.value=c;this._set("displayedValue",c);var k=this,a={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};d.mixin(a,this.fetchProperties);this._fetchHandle=this.store.query(p,a);m(this._fetchHandle,function(c){k._fetchHandle=null;k._callbackSetLabel(c||[],p,a,l)},function(a){k._fetchHandle=null;k._cancelingQuery||console.error("dijit.form.FilteringSelect: "+
a.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(r,d,m,l){return r("dijit.form.MappedTextBox",l,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(c){return c.toString?c.toString():""},toString:function(){var c=this.filter(this.get("value"));return null!=
c?"string"==typeof c?c:this.serialize(c,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=m.place("\x3cinput type\x3d'hidden'"+(this.name&&!d("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(r,d,m,l,c,t,q,p,h){return r("dijit.form.ComboBoxMixin",[p,t],{dropDownClass:q,hasDownArrow:!0,templateString:h,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(c){this._set("hasDownArrow",c);this._buttonNode.style.display=c?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(h){h.get||l.mixin(h,{_oldAPI:!0,get:function(c){var a=new d;this.fetchItemByIdentity({identity:c,
onItem:function(c){a.resolve(c)},onError:function(c){a.reject(c)}});return a.promise},query:function(h,a){var g=new d(function(){f.abort&&f.abort()});g.total=new d;var f=this.fetch(l.mixin({query:h,onBegin:function(a){g.total.resolve(a)},onComplete:function(a){g.resolve(a)},onError:function(a){g.reject(a)}},a));return c(g)}});this._set("store",h)},postMixInProperties:function(){var c=this.params.store||this.store;c&&this._setStoreAttr(c);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var d=this.declaredClass;l.mixin(this.store,{getValue:function(a,c){m.deprecated(d+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return a[c]},getLabel:function(a){m.deprecated(d+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return a.name},fetch:function(a){m.deprecated(d+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
l.hitch(this,function(c){(new c({objectStore:this})).fetch(a)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(r,d,m,l,c,t,q,p,h,n,k){d=d("dijit.form._AutoCompleterMixin",k,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(a){var c=0;if("number"==typeof a.selectionStart)c=a.selectionStart;else if(p("ie")){var f=a.ownerDocument.selection.createRange().duplicate();a=a.createTextRange();f.move("character",0);a.move("character",0);try{a.setEndPoint("EndToEnd",f),c=String(a.text).replace(/\r/g,"").length}catch(b){}}return c},_setCaretPos:function(a,c){c=parseInt(c);n.selectInputText(a,c,c)},_setDisabledAttr:function(a){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",a?"true":"false")},_onKey:function(a){if(!(32<=a.charCode)){var c=a.charCode||a.keyCode;if(c!=l.ALT&&c!=l.CTRL&&c!=l.META&&c!=l.SHIFT){var f=this.dropDown,b=null;this._abortQuery();this.inherited(arguments);if(!(a.altKey||a.ctrlKey||a.metaKey))switch(this._opened&&(b=f.getHighlightedOption()),c){case l.PAGE_DOWN:case l.DOWN_ARROW:case l.PAGE_UP:case l.UP_ARROW:this._opened&&this._announceOption(b);a.stopPropagation();a.preventDefault();break;case l.ENTER:if(b){if(b==
f.nextButton){this._nextSearch(1);a.stopPropagation();a.preventDefault();break}else if(b==f.previousButton){this._nextSearch(-1);a.stopPropagation();a.preventDefault();break}a.stopPropagation();a.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case l.TAB:c=this.get("displayedValue");if(f&&(c==f._messages.previousMessage||c==f._messages.nextMessage))break;b&&this._selectOption(b);case l.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(a){var c=this.focusNode;n.selectInputText(c,c.value.length);var f=this.ignoreCase?"toLowerCase":"substr";0==a[f](0).indexOf(this.focusNode.value[f](0))?(f=this.autoComplete?this._getCaretPos(c):c.value.length,f+1>c.value.length&&(c.value=a,n.selectInputText(c,f))):(c.value=a,n.selectInputText(c))},_openResultList:function(a,d,f){var b=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();a.length||0!=f.start?(this._nextSearch=this.dropDown.onPage=c.hitch(this,
function(b){a.nextPage(-1!==b);this.focus()}),this.dropDown.createOptions(a,f,c.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in f?(f.direction?this.dropDown.highlightFirstOption():f.direction||this.dropDown.highlightLastOption(),b&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(d[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),c=this.dropDown;!c||a!=c._messages.previousMessage&&a!=c._messages.nextMessage?"undefined"==typeof this.item?
(this.item=null,this.set("displayedValue",a)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,c,f){var b="";a&&(f||(f=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),b=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):f);this.set("value",b,c,f,a)},_announceOption:function(a){if(a){var c;
if(a==this.dropDown.nextButton||a==this.dropDown.previousButton)c=a.innerHTML,this.item=void 0,this.value="";else{var f=this.dropDown.items[a.getAttribute("item")];c=(this.store._oldAPI?this.store.getValue(f,this.searchAttr):f[this.searchAttr]).toString();this.set("item",f,!1,c)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",m.get(a,"id"));this._autoCompleteText(c)}},_selectOption:function(a){this.closeDropDown();a&&
this._announceOption(a);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var d=this.id+"_popup";this.dropDown=new (c.isString(this.dropDownClass)?c.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:c.hitch(this,
this._selectOption),id:d,dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new h({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var c=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,c):a[c]}}},postCreate:function(){var a=t('label[for\x3d"'+
this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",a[0].id));this.inherited(arguments);r.after(this,"onSearch",c.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var c=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(a=this.doHighlight(a,this._lastInput),c="html");return{html:"html"==c,label:a}},doHighlight:function(a,c){var f=(this.ignoreCase?"i":"")+("all"==
this.highlightMatch?"g":""),b=this.queryExpr.indexOf("${0}");c=q.escapeString(c);return this._escapeHtml(a.replace(new RegExp((0==b?"^":"")+"("+c+")"+(b==this.queryExpr.length-4?"$":""),f),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},
labelFunc:function(a,c){return(c._oldAPI?c.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(a,c,f,b){this._set("item",b||null);null==a&&(a="");this.inherited(arguments)}});p("dojo-bidi")&&d.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return d})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),
function(r,d,m,l,c,t){function q(c){return{id:c.value,value:c.value,name:m.trim(c.innerText||c.textContent||"")}}return r("dijit.form.DataList",c,{constructor:function(c,h){this.domNode=d.byId(h);m.mixin(this,c);this.id&&t.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:l("option",this.domNode).map(q)}])},destroy:function(){t.remove(this.id)},fetchSelectedItem:function(){var c=l("\x3e option[selected]",this.domNode)[0]||l("\x3e option",this.domNode)[0];return c&&q(c)}})})},
"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(r,d,m,l,c,t,q){return r("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(c){this._set("list",c)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(c){return new RegExp("^"+c.replace(/(\\.)|(\*)|(\?)|\W/g,function(c,d,k,a){return k?".*":
a?".":d?d:"\\"+c})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(c){if(!this.disabled&&
!this.readOnly){c=c.charOrCode;this._prev_key_backspace=!1;if(c==d.DELETE||c==d.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(d){this._abortQuery();var h=this,n=m.clone(this.query),k={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},a=c.substitute(this.queryExpr,
[d.replace(/([\\\*\?])/g,"\\$1")]),g,f=function(){var a=h._fetchHandle=h.store.query(n,k);h.disabled||h.readOnly||g!==h._lastQuery||t(a,function(b){h._fetchHandle=null;h.disabled||h.readOnly||g!==h._lastQuery||t(a.total,function(a){b.total=a;var c=h.pageSize;if(isNaN(c)||c>b.total)c=b.total;b.nextPage=function(a){k.direction=a=!1!==a;k.count=c;a?(k.start+=b.length,k.start>=b.total&&(k.count=0)):(k.start-=c,0>k.start&&(k.count=Math.max(c+k.start,0),k.start=0));0>=k.count?(b.length=0,h.onSearch(b,n,
k)):f()};h.onSearch(b,n,k)})},function(a){h._fetchHandle=null;h._cancelingQuery||console.error(h.declaredClass+" "+a.toString())})};m.mixin(k,this.fetchProperties);this.store._oldAPI?g=a:(g=this._patternToRegExp(a),g.toString=function(){return a});this._lastQuery=n[this.searchAttr]=g;this._queryDeferHandle=this.defer(f,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var c=this.list;c&&(this.store=q.byId(c))}this.inherited(arguments)}})})},
"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(r,d,m,l,c,t,q,p){return r("dijit.form._ComboBoxMenu",[c,t,p,q],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(d.add(this.previousButton,"dijitMenuItemRtl"),d.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var c=this.ownerDocument.createElement("div");c.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");c.setAttribute("role","option");return c},onHover:function(c){d.add(c,"dijitMenuItemHover")},onUnhover:function(c){d.remove(c,
"dijitMenuItemHover")},onSelect:function(c){d.add(c,"dijitMenuItemSelected")},onDeselect:function(c){d.remove(c,"dijitMenuItemSelected")},_page:function(c){var d=0,h=this.domNode.scrollTop,a=m.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();d<a;){var g=this.getHighlightedOption();if(c){if(!g.previousSibling||"none"==g.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!g.nextSibling||"none"==g.nextSibling.style.display)break;this.selectNextNode()}g=
this.domNode.scrollTop;d+=(g-h)*(c?-1:1);h=g}},handleKey:function(c){switch(c.keyCode){case l.DOWN_ARROW:return this.selectNextNode(),!1;case l.PAGE_DOWN:return this._page(!1),!1;case l.UP_ARROW:return this.selectPreviousNode(),!1;case l.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(r,d,m,l,c){var t=d("dijit.form._ComboBoxMenuMixin"+
(l("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=c.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(c){this._set("value",c);this.onChange(c)},onClick:function(c){if(c==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(c==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(c)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(c,d){var h=this._createMenuItem();c=d(c);c.html?h.innerHTML=c.label:h.appendChild(h.ownerDocument.createTextNode(c.label));""==h.innerHTML&&(h.innerHTML="\x26#160;");return h},createOptions:function(c,d,h){this.items=c;this.previousButton.style.display=0==d.start?"none":"";m.set(this.previousButton,"id",this.id+
"_prev");r.forEach(c,function(c,a){c=this._createOption(c,h);c.setAttribute("item",a);m.set(c,"id",this.id+a);this.nextButton.parentNode.insertBefore(c,this.nextButton)},this);var n=!1;c.total&&!c.total.then&&-1!=c.total?d.start+d.count<c.total?n=!0:d.start+d.count>c.total&&d.count==c.length&&(n=!0):d.count==c.length&&(n=!0);this.nextButton.style.display=n?"":"none";m.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var c=this.containerNode;2<c.childNodes.length;)c.removeChild(c.childNodes[c.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});l("dojo-bidi")&&(t=d("dijit.form._ComboBoxMenuMixin",
t,{_createOption:function(){var c=this.inherited(arguments);this.applyTextDir(c);return c}}));return t})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(r,d,m,l){return r("dijit.form._ListMouseMixin",l,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(c,d){this._setSelectedAttr(d,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(d)})},_onMouseDown:function(c,d){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(d,!1)},_onMouseUp:function(c,d){this._isDragging=!1;var l=this.selected,p=this._hoveredNode;l&&d==l?this.defer(function(){this._onClick(c,
l)}):p&&this.defer(function(){this._onClick(c,p)})},_onMouseOut:function(c,d){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(c,d){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=d;this.onHover(d);this._isDragging&&this._setSelectedAttr(d,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(r,d,m){return r("dijit.form._ListBase",null,{selected:null,_listConnect:function(l,c){var m=this;return m.own(d(m.containerNode,d.selector(function(c,d,h){return c.parentNode==h},l),function(d){m[c](d,this)}))},selectFirstNode:function(){for(var d=this.containerNode.firstChild;d&&"none"==d.style.display;)d=d.nextSibling;this._setSelectedAttr(d,!0)},selectLastNode:function(){for(var d=this.containerNode.lastChild;d&&"none"==d.style.display;)d=d.previousSibling;this._setSelectedAttr(d,
!0)},selectNextNode:function(){var d=this.selected;if(d){for(d=d.nextSibling;d&&"none"==d.style.display;)d=d.nextSibling;d?this._setSelectedAttr(d,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var d=this.selected;if(d){for(d=d.previousSibling;d&&"none"==d.style.display;)d=d.previousSibling;d?this._setSelectedAttr(d,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(d,c){if(this.selected!=d){var l=this.selected;if(l)this.onDeselect(l);
d&&(c&&m.scrollIntoView(d),this.onSelect(d));this._set("selected",d)}else if(d)this.onSelect(d)}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(r,d,m,l,c){return r([d,m],{baseClass:"jimu-loading-shelter jimu-agol-loading",declaredClass:"jimu.dijit.LoadingShelter",templateString:l,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=
window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&c.setStyle(this.domNode,"display","none");c.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||c.setStyle(this.loadingNode,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(d){this.domNode&&this.hidden&&("string"===typeof d&&(this.textNode.innerHTML=d),c.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&
!this.hidden&&(c.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/dijit/FeatureActionPopupMenu":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin jimu/FeatureActionManager ./FeatureActionPopupMenuItem".split(" "),function(r,d,m,l,c,t,q,p,h,n){var k=null,a=r([q,p],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);this.hide();this.menuItems=[];this.own(c(this.domNode,"click",m.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||d.isDescendant(a,this.menuNode)||this.hide()})));this.own(c(this.closeBtn,"click",m.hitch(this,this.hide)))},setActions:function(a){this.clearActions();l.forEach(a,m.hitch(this,this._addMenuItem))},appendAction:function(a){this._addMenuItem(a)},clearActions:function(){this.menuItems=[];d.empty(this.menuContent)},_addMenuItem:function(a){a=
new n({action:a});d.place(a.domNode,this.menuContent);a.startup();this.menuItems.push(a);this.own(c(a,"click",m.hitch(this,this.hide)))},markAsSelected:function(a){l.forEach(this.menuItems,function(c){c.action.label===a.label?c.setSelected(!0):c.setSelected(!1)})},prepareActions:function(a,c){return h.getInstance().getSupportedActions(a).then(m.hitch(this,function(b){!1===c&&(b=l.filter(b,function(a){return 0!==a.name.indexOf("Export")&&"SaveToMyContent"!==a.name}));l.forEach(b,function(b){b.data=
a},this);this.setActions(b)}))},hide:function(){d.setStyle(this.domNode,"display","none")},show:function(a,c){if(0===this.menuItems.length)d.setStyle(this.domNode,"display","none");else{"string"===typeof c&&""!==c?(this.labelNode.innerHTML=c,d.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",d.setStyle(this.titleNode,"display","none"));c=a.y+a.h;var b;a=window.isRTL?a.x:a.x+a.w;d.setStyle(this.domNode,"display","");d.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});
b=t.getMarginSize(this.menuNode);d.setStyle(this.menuNode,{left:(window.isRTL?a+b.w>window.innerWidth?window.innerWidth-b.w:0>a?0:a:0>a-b.w?0:a>window.innerWidth?window.innerWidth-b.w:a-b.w)+"px",top:(b.h>window.innerHeight?0:c+b.h>window.innerHeight?window.innerHeight-b.h:c+b.h+5<window.innerHeight?c+5:c)+"px"})}}});a.getInstance=function(){null===k&&(k=new a,d.place(k.domNode,document.body),k.startup());k.setActions([]);return k};return a})},"jimu/dijit/FeatureActionPopupMenuItem":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/event dojo/on dojo/mouse dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),
function(r,d,m,l,c,t,q,p,h){return r([p,h,q],{baseClass:"popup-menu-item",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"icon jimu-float-leading" data-dojo-attach-point\x3d"iconContainer"\x3e\x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"label" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3c/div\x3e',action:null,postCreate:function(){this.inherited(arguments);this.action&&(this.labelNode.innerHTML=this.action.label,this.labelNode.title=
this.action.label,this.action.iconClass?("no-icon"===this.action.iconClass&&d.addClass(this.iconContainer,"no-icon"),d.addClass(this.iconNode,this.action.iconClass)):d.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")"),this.own(c(this.domNode,t.enter,m.hitch(this,this._useHoverIcon))),this.own(c(this.domNode,t.leave,m.hitch(this,this._useNormalIcon))));this.own(c(this.domNode,"click",m.hitch(this,this._clickHandler)))},setSelected:function(c){c?d.addClass(this.domNode,
"selected"):d.removeClass(this.domNode,"selected")},_useNormalIcon:function(){this.action.iconClass?d.removeClass(this.iconNode,"highlight"):d.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")")},_useHoverIcon:function(){this.action.iconClass?d.addClass(this.iconNode,"highlight"):d.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("hover")+")")},_clickHandler:function(c){l.stop(c);if(this.action){var d;this.action.data.features&&0<this.action.data.features.length&&
(d=this.action.data.features[0].getLayer());this.action.onExecute(this.action.data,d)}this.emit("click")}})})},"jimu/RelatedRecordsPopupProjector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/has dojo/query dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin esri/undoManager esri/OperationBase esri/tasks/RelationshipQuery esri/dijit/Popup esri/dijit/PopupMobile esri/graphicsUtils esri/dijit/PopupTemplate jimu/utils jimu/ConfigManager jimu/dijit/DropdownMenu jimu/LayerInfos/LayerInfos".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z){var A=r([h,n],{baseClass:"related-records-popup-projector",templateString:"\x3cdiv\x3e\x3cdiv class\x3d'operation-box' data-dojo-attach-point\x3d'operationBox' style\x3d'display: none'\x3e\x3cdiv class\x3d'previos-btn feature-action' data-dojo-attach-point\x3d'previouBtn'data-dojo-attach-event\x3d'click:_onPreviouBtnClick'\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-title' data-dojo-attach-point\x3d'operationTitle'\x3eabc\x3c/div\x3e\x3cdiv class\x3d'add-new-btn' data-dojo-attach-point\x3d'addNewBtn'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'content-box' data-dojo-attach-point\x3d'contentBox'\x3e\x3c/div\x3e\x3c/div\x3e",
popup:null,popupManager:null,undoManager:null,originalFeature:null,originalJimuLayerInfo:null,_temporaryData:null,postCreate:function(){this.undoManager=new k;this.layerInfosObj=z.getInstanceSync();var a=d.getObject("_wabProperties.referToFeatureLayerId",!1,this.originalFeature)||this.originalFeature.getLayer().id;this.originalJimuLayerInfo=this.layerInfosObj.getLayerInfoById(a);this._temporaryData={eventHandles:[],dijits:[]};window.isRTL?l.addClass(this.previouBtn,"icon-arrow-forward"):l.addClass(this.previouBtn,
"icon-arrow-back");a=this._createOperation({feature:this.originalFeature,oriJimuLayerInfo:this.originalJimuLayerInfo});this.showRelatedTables(a);this.popupUIController="esri.dijit.Popup"===this.popup.declaredClass?new A.PopupUIController(this):new A.PopupMobileUIController(this);this.popupUIController.addDomNode(this.domNode)},destroy:function(){this._clearPage();this.undoManager.destroy();this.popupUIController.destroy();this.inherited(arguments)},_getRelatedTableInfoArray:function(a){a=a.data.oriJimuLayerInfo;
var b=new p;a.getRelatedTableInfoArray().then(d.hitch(this,function(a){b.resolve(a)}));return b},_getOriRelationshipByDestLayer:function(a){var b=null;m.some(a.oriJimuLayerInfo.layerObject.relationships,function(c){if(c.relatedTableId===a.destJimuLayerInfo.layerObject.layerId)return b=c,!0},this);return b},_getRelatedRecordsByRelatedQuery:function(a){var b=new p,c=new g,e=this._getOriRelationshipByDestLayer(a);c.outFields=["*"];c.returnGeometry=!0;c.outSpatialReference=this.popupManager.mapManager.map.spatialReference;
c.relationshipId=e.id;var f=a.feature.attributes[a.oriJimuLayerInfo.layerObject.objectIdField];c.objectIds=[f];c.definitionExpression=a.destJimuLayerInfo.getFilter();a.oriJimuLayerInfo.layerObject.queryRelatedFeatures(c,d.hitch(this,function(a){(a=a[f]&&a[f].features)?b.resolve(a):b.resolve([])}),d.hitch(this,function(){b.resolve([])}));return b},_ignoreCaseToGetFieldObject:function(a,b){var c=null;b&&a&&a.fields&&m.some(a.fields,function(a){if(a.name.toLowerCase()===b.toLowerCase())return c=a,!0});
return c},getLocaleDateTime:function(a){return v.localizeDate(new Date(a),{fullYear:!0,formatLength:"medium"})},_getDisplayTitleOfRelatedRecord:function(a,b,c){var e=a.getInfoTemplate();return(a="popupTitle"===c&&e?"function"===typeof e.title?e.title(b):e.title:this._getDisplayTitleFromPopup(a,b,c))?a:""},_getDisplayTitleFromPopup:function(a,b,c){(a=this._getPopupTemplateWithOnlyDisplayField(a,c))?(b.setInfoTemplate(a),c=this.popupUIController.getDisplayTitle(b),b.setInfoTemplate(null)):c=b.attributes[c];
return c},_getPopupTemplateWithOnlyDisplayField:function(a,b){a=a._getCustomPopupInfo(a.layerObject,[b]);return new u(a)},_canShowRelatedData:function(a){var b=!0;(a=a.getPopupInfo())&&a.relatedRecordsInfo&&(b=!1!==a.relatedRecordsInfo.showRelatedRecords);return b},setPopupContent:function(a){this._clearPage();a.data.destJimuLayerInfo?a.data.relatedFeature||this.showRelatedRecords(a):this.showFeature(a);this.undoManager.peekUndo()?this.popupUIController.changeRefDomNode():this.popupUIController.revertRefDomNode()},
showFeature:function(a){var b=a.data,c=b.oriJimuLayerInfo.layerObject,e=d.getObject("_wabProperties.originalLayerName",!1,c)||b.oriJimuLayerInfo.title,c=d.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,c),f=this._getDisplayTitleOfRelatedRecord(b.oriJimuLayerInfo,b.feature,c);"popupTitle"!==c&&(f=e+": "+f);this._setOperationTitle(f);d.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",null,b.oriJimuLayerInfo.layerObject);b.oriJimuLayerInfo.loadInfoTemplate().then(d.hitch(this,
function(c){b.oriJimuLayerInfo.layerObject.infoTemplate||a.data.feature.setInfoTemplate(c);this.popupUIController.setFeature(a.data.feature);b.oriJimuLayerInfo.layerObject.infoTemplate||a.data.feature.setInfoTemplate(null)}));this.showRelatedTables(a);this.popupManager.initPopupMenu([a.data.feature]);this.popupUIController.updateZoomToBtn([a.data.feature])},showRelatedRecords:function(a){var b=a.data,e=d.getObject("_wabProperties.originalLayerName",!1,b.destJimuLayerInfo.layerObject)||b.destJimuLayerInfo.title;
this._setOperationTitle(e);this._clearPage();d.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",b,b.destJimuLayerInfo.layerObject);d.setObject("_wabProperties.popupInfo.originalFeature",this.originalFeature,b.destJimuLayerInfo.layerObject);d.setObject("_wabProperties.popupInfo.layerForActionWithEmptyFeatures",b.destJimuLayerInfo.layerObject,this.popup);this._getRelatedRecordsByRelatedQuery(b).then(d.hitch(this,function(e){0<e.length?this._setTitle(window.jimuNls.popup.relatedRecords):
this._setTitle(window.jimuNls.popup.noRelatedRecotds,"font-normal");var f=this._showFieldSelector(b.destJimuLayerInfo);m.forEach(e,function(e,g){e._layer=b.destJimuLayerInfo.layerObject;var h=this._getDisplayTitleOfRelatedRecord(b.destJimuLayerInfo,e,f);g=l.create("div",{"class":"item record-item "+(0===g%2?"oddLine":"evenLine"),innerHTML:h},this.contentBox);g.relatedRecord=e;g=c(g,"click",d.hitch(this,function(){this._addOperation(a);var c=this._createOperation({feature:e,oriJimuLayerInfo:b.destJimuLayerInfo});
this.setPopupContent(c)}));this._temporaryData.eventHandles.push(g)},this);this.popupManager.initPopupMenu(e);this.popupUIController.updateZoomToBtn(e)}));this.popupUIController.setContent(this.domNode)},showRelatedTables:function(a){this._canShowRelatedData(a.data.oriJimuLayerInfo)&&this._getRelatedTableInfoArray(a).then(d.hitch(this,function(b){0<b.length&&this._setTitle(window.jimuNls.popup.relatedTables);m.forEach(b,function(b,e){e=l.create("div",{"class":"item table-item "+(0===e%2?"oddLine":
"evenLine"),innerHTML:b.title},this.contentBox);e=c(e,"click",d.hitch(this,function(){b.getLayerObject().then(d.hitch(this,function(){this._addOperation(a);var c=this._createOperation({feature:a.data.feature,oriJimuLayerInfo:a.data.oriJimuLayerInfo,destJimuLayerInfo:b});this.setPopupContent(c)}))}));this._temporaryData.eventHandles.push(e)},this)}))},_createOperation:function(a){return new A.Operation({feature:a.feature||null,oriJimuLayerInfo:a.oriJimuLayerInfo||null,destJimuLayerInfo:a.destJimuLayerInfo||
null,relatedFeature:a.relatedFeature||null},this)},_addOperation:function(a){this.undoManager.add(a)},_onPreviouBtnClick:function(){this.undoManager.undo()},_clearPage:function(){l.empty(this.contentBox);m.forEach(this._temporaryData.eventHandles,function(a){a&&a.remove&&a.remove()},this);this._temporaryData.eventHandles=[];m.forEach(this._temporaryData.dijits,function(a){a&&a.destroy&&a.destroy()},this);this._temporaryData.dijits=[]},_setTitle:function(a,b){a&&l.create("div",{"class":"title-box "+
(b?b:""),innerHTML:a},this.contentBox)},_setOperationTitle:function(a){l.setAttr(this.operationTitle,"innerHTML",a);l.setAttr(this.operationTitle,"title",a)},_showFieldSelector:function(a){var b="objecid",e=q(".title-box",this.contentBox)[0],f=a.layerObject,g=[];if(!e||!a)return b;var h=a.getPopupInfo();h&&h.title&&g.push({label:window.jimuNls.popup.saveAsPopupTitle,value:"popupTitle"});var k=[];h&&h.fieldInfos?m.forEach(h.fieldInfos,function(a){var b={};a.visible&&(b.name=a.fieldName,b.alias=a.label,
k.push(b))}):k=f.fields;m.forEach(k,function(a){"globalid"!==a.name.toLowerCase()&&"shape"!==a.name.toLowerCase()&&g.push({label:a.alias||a.name,value:a.name})});e=(new D({items:g})).placeAt(e);e.domNode.title=window.jimuNls.popup.chooseFieldTip;var n=d.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,f),u=this._ignoreCaseToGetFieldObject(a.layerObject,a.layerObject.displayField||a.layerObject.objectIdField),l=x.getInstance().getAppConfig();n?b=n:"2.3"===l.configWabVersion&&
u&&u.name?b=u.name:h&&h.title?b="popupTitle":u&&u.name?b=u.name:0<g.length&&(b=g[0].value);b&&(e.setHighlightValue(b),d.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",b,f));this._temporaryData.dijits.push(e);a=c(e,"click-item",d.hitch(this,function(a,b){q(".item.record-item",this.contentBox).forEach(d.hitch(this,function(c){d.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",b,f);var e=this._getDisplayTitleOfRelatedRecord(a,c.relatedRecord,b);c.innerHTML=e}))},
a));this._temporaryData.eventHandles.push(a);return b}});A.Operation=r([a],{constructor:function(a,b){this.data=a;this.relatedRecordsPopupProjector=b},performUndo:function(){this.relatedRecordsPopupProjector.setPopupContent(this)}});A.PopupUIController=r([],{constructor:function(a){this.rrPopupProjector=a;this.popup=a.popup;this.initTempPopup();this._initTempPopupForDisplayTitle();this._initZoomToBtn();this._setScrollable()},initTempPopup:function(){this._tempPopup=new f({},l.create("div"))},_initTempPopupForDisplayTitle:function(){this._tempPopupForDisplayTitle=
new f({},l.create("div"));this._tempPopupForDisplayTitle.show()},destroy:function(){this._tempPopup.destroy();this._tempPopupForDisplayTitle.destroy();this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove();this._zoomToBtnANode&&l.destroy(this._zoomToBtnANode);this.toucemoveScrollHandle&&this.toucemoveScrollHandle.remove&&this.toucemoveScrollHandle.remove()},addDomNode:function(a){setTimeout(d.hitch(this,function(){l.place(a,this._getRefDomNode(),"after")}),
1)},setFeature:function(a){this._tempPopup.setFeatures([a]);if(a=q(".esriViewPopup",this._tempPopup.domNode)[0])this.setContent(a),l.place(this.rrPopupProjector.domNode,a,"after"),this._unsetScrollable()},setContent:function(a){var b=q(".related-records-popup-projector").parent()[0];b&&b.removeChild(this.rrPopupProjector.domNode);this.popup.setContent(a);this._unsetScrollable()},_setScrollable:function(){var a=q(".contentPane",this.popup.domNode)[0];t("esri-touch")&&a&&(this.toucemoveScrollHandle=
c(a,"touchmove",d.hitch(this,function(b){b.preventDefault();q(".esriViewPopup",this.popup.domNode)[0]&&(b=a.firstChild,b instanceof Text&&(b=a.childNodes[1]),this.rrPopupProjector.domNode&&l.setStyle(this.rrPopupProjector.contentBox,{"-webkit-transition-property":"-webkit-transform","-webkit-transform":"translate("+b._currentX+"px, "+b._currentY+"px)"}))})))},_unsetScrollable:function(){l.setStyle(this.rrPopupProjector.contentBox,{"-webkit-transition-property":"none","-webkit-transform":"none"});
l.setStyle(this.rrPopupProjector.domNode,{"-webkit-transition-property":"none","-webkit-transform":"none"})},getDisplayTitle:function(a){this._tempPopupForDisplayTitle.setFeatures([a]);return(a=q("td.attrValue",this._tempPopupForDisplayTitle.domNode)[0])&&a.innerHTML},_getRefDomNode:function(){return this._getViewPopupDomNode()},_getViewPopupDomNode:function(){return q(".esriViewPopup",this.popup.domNode)[0]},_setPopupTitleInBody:function(){this.rrPopupProjector.undoManager.peekUndo()?this._tempPopup.set("titleInBody",
!1):this._tempPopup.set("titleInBody",!0)},_initZoomToBtn:function(){var a=q(".actionList",this.popup.domNode)[0];this._oldZoomToBtnANdoe=q(".action",a)[0];this._zoomToBtnANode=l.create("a",{"class":"action",style:"display: none",href:"javascript:void(0)"},a);this._zoomToBtn=l.create("span",{innerHTML:window.jimuNls.common.zoomTo},this._zoomToBtnANode);this._showOldZoomToBtn()},_hideZoomToBtn:function(){this._zoomToBtnANode&&l.setStyle(this._zoomToBtnANode,"display","none")},_showZoomToBtn:function(){this._zoomToBtnANode&&
l.setStyle(this._zoomToBtnANode,"display","inline-block")},_hideOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&l.setStyle(this._oldZoomToBtnANdoe,"display","none")},_showOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&l.setStyle(this._oldZoomToBtnANdoe,"display","inline-block")},updateZoomToBtn:function(a){this._hideOldZoomToBtn();!a||1>a.length||!a[0].geometry?this._hideZoomToBtn():(this._showZoomToBtn(),this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove(),
this._zoomToBtnClickHandle=c(this._zoomToBtn,"click",d.hitch(this,function(){var b=null;try{b=e.graphicsExtent(a)}catch(C){console.error(C)}b&&(this.rrPopupProjector.popupManager.mapManager.map.setExtent(b),this.popup.hide())})))},changeRefDomNode:function(){l.setStyle(this.rrPopupProjector.operationBox,"display","block");l.addClass(this.rrPopupProjector.domNode,"second-page-mode");var a=this._getViewPopupDomNode();a&&l.addClass(a,"second-page-mode")},revertRefDomNode:function(){l.setStyle(this.rrPopupProjector.operationBox,
"display","none");l.removeClass(this.rrPopupProjector.domNode,"second-page-mode");this._hideZoomToBtn();this._showOldZoomToBtn()}});A.PopupMobileUIController=r([A.PopupUIController],{initTempPopup:function(){this._tempPopup=new b({},l.create("div"))},setFeature:function(a){this._tempPopup.setFeatures([a]);a=q(".esriMobileInfoView.esriMobilePopupInfoView",this._tempPopup.domNode)[0];if(a=q(".esriViewPopup",a)[0])this.setContent(a),l.place(this.rrPopupProjector.domNode,a,"after")},updateZoomToBtn:function(){},
_initZoomToBtn:function(){},_getRefDomNode:function(){return q(".esriMobilePopupInfoView .esriMobileInfoViewItem")[1]},_getViewPopupDomNode:function(){var a=q(".esriMobileInfoView.esriMobilePopupInfoView")[0];return q(".esriViewPopup",a)[0]}});return A})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented dojo/has!extend-esri?./OperationBase".split(" "),function(r,d,m,l,c,t){r=r([t],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,
canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(c){c=c||{};c.maxOperations&&(this.maxOperations=c.maxOperations);this._historyStack=[]},add:function(c){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,0,c);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},
undo:function(){if(0===this.position)return null;var c=this.peekUndo();this.position--;c?(c=c.performUndo(),this.onUndo(),this._checkAvailability(),l(c).then(d.hitch(this,this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var c=this.peekRedo();this.position++;c?(c=c.performRedo(),this.onRedo(),this._checkAvailability(),l(c).then(d.hitch(this,this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=
this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},
peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},get:function(c){return this._historyStack[c]},remove:function(c){0<this._historyStack.length&&(this._historyStack.splice(c,1),0<this.position&&c<this.position&&this.position--,this._checkAvailability())},destroy:function(){this._historyStack=null}});m("extend-esri")&&(c.UndoManager=
r);return r})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(r,d,m){r=r(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(d){d=d||{};d.label&&(this.label=d.label)},performUndo:function(){console.log("performUndo has not been implemented")},performRedo:function(){console.log("performRedo has not been implemented")}});d("extend-esri")&&(m.OperationBase=r);return r})},"jimu/dijit/DropdownMenu":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/query dojo/Evented".split(" "),
function(r,d,m,l,c,t,q,p,h){return r([d,m,h],{baseClass:"jimu-dijit-dropdownmenu",declaredClass:"jimu.dijit.DropdownMenu",templateString:"\x3cdiv\x3e\x3c/div\x3e",itemHeight:24,iconSize:16,offsetY:5,shelter:null,paddingOffsetY:8,dropdownMenuItemClass:"dropdown-menu-item",items:null,highlightValue:"",highlightSelectedItemAfterClick:!0,menuLeadingIcon:!0,maxDisplayItems:10,postCreate:function(){this.inherited(arguments);this.items||(this.items=[]);this.shelter=t.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-shelter"\x3e\x3c/div\x3e');
this.itemsContainer=t.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-items-container"\x3e\x3c/div\x3e');0>=this.maxDisplayItems&&(this.maxDisplayItems=20);this.itemsContainer.style.maxHeight=this.itemHeight*this.maxDisplayItems+2*this.paddingOffsetY+"px";c.forEach(this.items,l.hitch(this,function(c){var d=t.toDom('\x3cdiv class\x3d"'+this.dropdownMenuItemClass+' jimu-ellipsis"\x3e'+c.label+"\x3c/div\x3e");d.itemInfo=c;d.title=c.label;t.place(d,this.itemsContainer)}));this.own(q(this.domNode,"click",
l.hitch(this,this._onIconClick)));this.own(q(this.shelter,"click",l.hitch(this,this._onShelterClick)));this.own(q(this.itemsContainer,"click",l.hitch(this,this._onItemsContainerClick)));this.highlightValue&&this.setHighlightValue(this.highlightValue)},_onIconClick:function(c){c.stopPropagation();this.isShowing()?this.hideMenu():(c=t.position(c.target||c.srcElement),this.showMenu(c))},_onShelterClick:function(){this.hideMenu()},_onItemsContainerClick:function(c){c.stopPropagation();c=c.target||c.srcElement;
t.hasClass(c,this.dropdownMenuItemClass)&&(c=c.itemInfo.value,this.highlightSelectedItemAfterClick&&this.setHighlightValue(c),this.emit("click-item",c));this.hideMenu()},clearHighlightValue:function(){p("."+this.dropdownMenuItemClass,this.itemsContainer).removeClass("selected")},setHighlightValue:function(c){this.clearHighlightValue();p("."+this.dropdownMenuItemClass,this.itemsContainer).some(l.hitch(this,function(d){return d.itemInfo.value===c?(t.addClass(d,"selected"),!0):!1}))},getHighlightValue:function(){var c=
p("."+this.dropdownMenuItemClass+".selected",this.itemsContainer)[0];return c?c.itemInfo.value:null},isShowing:function(){return t.hasClass(this.domNode,"showing")},showMenu:function(c){this.itemsContainer.style.top=c.y+this.iconSize+this.offsetY+"px";this.menuLeadingIcon===window.isRTL?(this.itemsContainer.style.left=c.x+"px",this.itemsContainer.style.right="auto"):(this.itemsContainer.style.right=window.innerWidth-(c.x+this.iconSize)+"px",this.itemsContainer.style.left="auto");t.place(this.shelter,
document.body);t.place(this.itemsContainer,document.body);t.addClass(this.domNode,"showing")},hideMenu:function(){this.itemsContainer.parentNode&&this.itemsContainer.parentNode.removeChild(this.itemsContainer);this.shelter.parentNode&&this.shelter.parentNode.removeChild(this.shelter);t.removeClass(this.domNode,"showing")},destroy:function(){this.hideMenu();t.destroy(this.itemsContainer);t.destroy(this.shelter);this.inherited(arguments)}})})},"jimu/FilterManager":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/topic","esri/lang","./LayerInfos/LayerInfos"],function(r,d,m,l,c){var t=null,q=r(null,{_filters:null,layerInfos:null,constructor:function(){this._filters={};window.isBuilder?(m.subscribe("app/mapLoaded",d.hitch(this,this._onMapLoaded)),m.subscribe("app/mapChanged",d.hitch(this,this._onMapChanged))):(m.subscribe("mapLoaded",d.hitch(this,this._onMapLoaded)),m.subscribe("mapChanged",d.hitch(this,this._onMapChanged)));m.subscribe("widgetDestroyed",d.hitch(this,this._onWidgetDestroyed))},
getWidgetFilter:function(c,h){return d.getObject(c+".filterExprs."+h,!1,this._filters)},applyWidgetFilter:function(c,d,n,k,a){this._setFilterExp(c,d,n,k,a);d=this.layerInfos.getLayerInfoById(c)||this.layerInfos.getTableInfoById(c);c=this._getFilterExp(c);null!==c&&d&&d.setFilter(c)},_onMapLoaded:function(){this.layerInfos=c.getInstanceSync();this._traversalFilter()},_onMapChanged:function(){this.layerInfos=c.getInstanceSync();this._traversalFilter()},_onWidgetDestroyed:function(c){for(var d in this._filters)if(this._filters[d]){var n=
this._filters[d];if(n){var k=n.filterExprs,n=n.mapFilterControls;k&&delete k[c];n&&delete n[c]}}},_traversalFilter:function(){this.layerInfos.traversalAll(d.hitch(this,function(c){this._filters[c.id]||(this._filters[c.id]={definitionExpression:c.getFilter(),filterExprs:{},mapFilterControls:{}})}))},_getPriorityOfMapFilter:function(c){c=d.getObject(c+".mapFilterControls",!1,this._filters);var h=0,n;for(n in c){var k=c[n];k.priority>h&&(h=k.priority)}return h},_getMapFilterControl:function(c){c=d.getObject(c+
".mapFilterControls",!1,this._filters);var h=0,n=null,k;for(k in c){var a=c[k];a.priority>h&&(h=a.priority,n=a)}return n},_setFilterExp:function(c,h,n,k,a){var g=c+".filterExprs."+h,f=c+".mapFilterControls."+h;n?(d.setObject(g,n,this._filters),l.isDefined(k)&&(c=this._getPriorityOfMapFilter(c),d.setObject(f,{enable:k,useAND:a,priority:c+1},this._filters))):(d.getObject(g,!1,this._filters)&&delete this._filters[c].filterExprs[h],d.getObject(f,!1,this._filters)&&delete this._filters[c].mapFilterControls[h])},
_getFilterExp:function(c){if(!this._filters[c])return null;var d=[],n=this._filters[c].definitionExpression,k=this._filters[c].filterExprs;c=this._getMapFilterControl(c);for(var a in k){var g=k[a];g&&d.push("("+g+")")}d=d.join(" AND ");return n&&c&&c.enable||n&&null===c?d?c&&!1===c.useAND?"("+n+") OR "+d:"("+n+") AND "+d:n:d}});q.getInstance=function(){if(null===t)t=new q,window._filterManager=t;else return t};return q})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/topic"],function(r,d,m){var l=null,c;c=r(null,{constructor:function(c){m.subscribe("publishData",d.hitch(this,this.onDataPublished));m.subscribe("fetchData",d.hitch(this,this.onFetchData));m.subscribe("clearAllData",d.hitch(this,this.onClearAllData));m.subscribe("removeData",d.hitch(this,this.onRemoveData));m.subscribe("clearDataHistory",d.hitch(this,this.onClearDataHistory));this.widgetManager=c},_dataStore:{},onDataPublished:function(c,d,l,h){"undefined"===typeof h&&(h=!1);this._dataStore[d]?
(this._dataStore[d].current=l,h&&(this._dataStore[d].history?this._dataStore[d].history.push(l):this._dataStore[d].history=[l])):(this._dataStore[d]={current:l},h&&(this._dataStore[d].history=[l]))},onFetchData:function(c){var d;if(c)"framework"===c?this._dataStore[c]?m.publish("dataFetched","framework","framework",this._dataStore[c].current,this._dataStore[c].history):m.publish("noData","framework","framework"):(d=this.widgetManager.getWidgetById(c))?this._dataStore[c]?m.publish("dataFetched",d.name,
c,this._dataStore[c].current,this._dataStore[c].history):m.publish("noData",d.name,c):m.publish("noData",void 0,c);else{for(var l in this._dataStore)(d=this.widgetManager.getWidgetById(l))&&m.publish("dataFetched",d.name,l,this._dataStore[l].current,this._dataStore[l].history);d||m.publish("noData",void 0,void 0)}},onClearAllData:function(){this._dataStore={};m.publish("allDataCleared")},onRemoveData:function(c){delete this._dataStore[c];m.publish("dataRemoved",c)},onClearDataHistory:function(c){this._dataStore[c]&&
(this._dataStore[c].history=[]);m.publish("dataHistoryCleared",c)}});c.getInstance=function(d){null===l&&(l=new c(d));return l};return c})},"jimu/SelectionManager":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/topic esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/graphic esri/Color esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol".split(" "),function(r,d,m,l,c,t,q,p,h,
n,k,a,g){var f=null,b=r(null,{constructor:function(){window.isBuilder?(c.subscribe("app/mapLoaded",m.hitch(this,this._onMapLoaded)),c.subscribe("app/mapChanged",m.hitch(this,this._onMapChanged))):(c.subscribe("mapLoaded",m.hitch(this,this._onMapLoaded)),c.subscribe("mapChanged",m.hitch(this,this._onMapChanged)))},_displayLayers:{},setSelectionSymbol:function(b){var c=b.geometryType,e=new k(k.STYLE_CIRCLE,16,null,n.fromArray([0,255,255])),f=new a(a.STYLE_SOLID,n.fromArray([0,255,255]),2),d=new g(g.STYLE_SOLID,
f,n.fromArray([0,255,255,.3]));"esriGeometryPoint"===c?b.setSelectionSymbol(e):"esriGeometryPolyline"===c?b.setSelectionSymbol(f):"esriGeometryPolygon"===c&&b.setSelectionSymbol(d)},updateSelectionByFeatures:function(a,b,c){0<b.length&&(b=l.map(b,m.hitch(this,function(b){var c=null,c=0<=a.graphics.indexOf(b)?new h(b.toJson()):b;c.wabIsTemp=!0;return c})));a.getSelectionSymbol()||this.setSelectionSymbol(a);var e=new d;a._selectHandler({features:b},c,null,null,e);this._isLayerNeedDisplayLayer(a)&&(this._displayLayers[a.id]||
(this._displayLayers[a.id]=this._createDisplayLayer(a)),this._updateDisplayLayer(a));return e},getDisplayLayer:function(a){return this._displayLayers[a]},setSelection:function(a,b){return this.updateSelectionByFeatures(a,b,t.SELECTION_NEW)},addFeaturesToSelection:function(a,b){return this.updateSelectionByFeatures(a,b,t.SELECTION_ADD)},removeFeaturesFromSelection:function(a,b){return this.updateSelectionByFeatures(a,b,t.SELECTION_SUBTRACT)},clearSelection:function(a){var b=new d;this.clearDisplayLayer(a);
a.clearSelection();b.resolve();return b},clearDisplayLayer:function(a){(a=this._displayLayers[a.id])&&a.clear()},getClientFeaturesByGeometry:function(a,b,c){return l.filter(a.graphics,m.hitch(this,function(a){return c?p.contains(b,a.geometry):p.intersects(b,a.geometry)}))},getUnionGeometryBySelectedFeatures:function(a){var b=null;a=a.getSelectedFeatures();0<a.length&&(b=l.map(a,m.hitch(this,function(a){return a.geometry})),b=p.union(b));return b},_createDisplayLayer:function(a){var b=new q;b.id="displayLayer_of_"+
a.id;this.map.addLayer(b);return b},_updateDisplayLayer:function(a){var b=a.getSelectedFeatures(),c=this._displayLayers[a.id];this.clearDisplayLayer(a);var e=a.getSelectionSymbol();l.forEach(b,m.hitch(this,function(a){a.setSymbol(null);a=new h(a.toJson());a.setSymbol(e);c.add(a)}))},_isLayerNeedDisplayLayer:function(a){return!a.getMap()},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a}});b.getInstance=function(){f||(f=new b,window._selectionManager=f);return f};return b})},
"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(r,d,m,l,c,t,q,p,h){return r([t,q],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,
constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(c.subscribe("publishData",d.hitch(this,this._onReceiveData)));this.own(c.subscribe("dataFetched",d.hitch(this,this._onReceiveData)));this.own(c.subscribe("noData",d.hitch(this,this._onNoData)));this.own(c.subscribe("dataSourceDataUpdated",d.hitch(this,this.onDataSourceDataUpdate)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},
onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(c){},onSignOut:function(){},onPositionChange:function(c){this.setPosition(c)},setPosition:function(c,d){this.position=c;var a=p.getPositionStyle(this.position);a.position="absolute";d||(d="map"===c.relativeTo?this.map.id:window.jimuConfig.layoutId);l.place(this.domNode,d);l.setStyle(this.domNode,a);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return l.getMarginBox(this.domNode)},
setMap:function(c){this.map=c},setState:function(c){this.state=c},setWindowState:function(c){this.windowState=c},resize:function(){},onConfigChanged:function(c){},onAppConfigChanged:function(c,d,a){},onAction:function(c,d){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return h.getInstance().getPanelById(this.id+"_panel");var c=h.getInstance().getPanelById(this.gid+"_panel");return c?c:h.getInstance().getPanelById(this.id+"_panel")},
publishData:function(d,h){"undefined"===typeof h&&(h=!1);c.publish("publishData",this.name,this.id,d,h)},fetchData:function(d){d?c.publish("fetchData",d):0!==this.listenWidgetIds.length?m.forEach(this.listenWidgetIds,function(d){c.publish("fetchData",d)},this):c.publish("fetchData")},fetchDataByName:function(c){c=this.widgetManager.getWidgetsByName(c);m.forEach(c,function(c){this.fetchData(c.id)},this)},openWidgetById:function(c){return this.widgetManager.triggerWidgetOpen(c)},_onReceiveData:function(c,
d,a,g){if(d!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(d)))this.onReceiveData(c,d,a,g)},onReceiveData:function(c,d,a,g){},updateDataSourceData:function(d,h){c.publish("updateDataSourceData","widget~"+this.id+"~"+d,h)},onDataSourceDataUpdate:function(c,d){},_onNoData:function(c,d){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(d)))this.onNoData(c,d)},onNoData:function(c,d){}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g){var f,b=null;f=r(null,{constructor:function(){this.panels=[];this.widgetManager=g.getInstance();p(window,"resize",d.hitch(this,this.onWindowResize));this.activePanel=null;h.subscribe("/dnd/move/start",d.hitch(this,this._onMoveStart));h.subscribe("widgetActived",d.hitch(this,this._onWidgetActived))},showPanel:function(b){var c=new t,e=this.getPanelById(b.id+"_panel");e?("closed"===e.state&&this.openPanel(e),c.resolve(e)):q({Panel:this._loadPanelClass(b.panel.uri),
nls:this._loadThemeI18N(b.panel.uri)}).then(d.hitch(this,function(e){var f=b.id+"_panel",g=this.getPanelById(f),h={label:b.label,config:b,uri:b.panel.uri,position:b.panel.position,map:this.map,widgetManager:this.widgetManager,panelManager:this,id:f,gid:b.gid,nls:e.nls};d.mixin(h,b.panel.options);try{g=new e.Panel(h),console.log("panel ["+f+"] created.")}catch(E){console.log("create panel error: "+E+", panelId: "+f);c.reject(E);return}g.setPosition(b.panel.position);a.setVerticalCenter(g.domNode);
this.openPanel(g);g.domNode.addEventListener("click",d.hitch(this,this._onPanelClick,g),{capture:!0});c.resolve(g)}));return c},setMap:function(a){this.map=a;p(this.map,"resize",d.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===
a&&this.closePanel(this.panels[b])},openPanel:function(a){var b=new t;if("string"===typeof a){if(a=this.getPanelById(a),!a)return b.reject(),b}else this.panels.some(function(b){return b.id===a.id})||this.panels.push(a);if(!a.started)try{a.started=!0,a.startup()}catch(v){console.error("fail to startup panel "+a.id+". "+v.stack)}if("opened"===a.state)return this._activePanel(a),b.resolve(a),b;a.setState("opened");return this.playOpenPanelAnimation(a).then(d.hitch(this,function(){l.setStyle(a.domNode,
"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new t;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(d.hitch(this,function(){this.activePanel&&this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&l.setStyle(a.domNode,"display","none")}))},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),
!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(u){console.log(console.error("fail to minimize panel "+a.id+". "+u.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(u){console.log(console.error("fail to maximize panel "+a.id+". "+u.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),
!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(u){console.log(console.error("fail to noralize panel "+a.id+". "+u.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===
a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);
try{a.destroy()}catch(u){console.log(console.error("fail to destroy panel "+a.id+". "+u.stack))}}},destroyAllPanels:function(){var a=m.map(this.panels,function(a){return a.id});m.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return n();var b=new t;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(l.setStyle(a.domNode,{opacity:0,display:""}),
c.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return n();var b=new t;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?c.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play():b.resolve());return b},getPositionOnMobile:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a))return{};var b=l.getMarginBox(window.jimuConfig.layoutId),c=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?(c=0,this.panels.filter(function(b){return"minimized"===b.windowState&&"closed"!==b.state&&b.id!==
a.id}).some(function(a){return 0===a._mobileBottom})&&(c=a.titleHeight),a._mobileBottom=c,b.h>b.w?{left:0,right:0,top:"auto",bottom:c,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:"auto",bottom:c,width:b.w/2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,
borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}):b.h>b.w?{left:0,right:0,top:c,bottom:0,width:"auto",height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,
borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},activatePanel:function(a){"opened"===a.state&&this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&l.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&
(this.activePanel.setState("opened"),l.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=this.widgetManager.activeWidget;b&&"active"===b.state&&b.getPanel()!==a&&(b.setState("opened"),!1===b.inPanel&&l.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==
this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&l.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){m.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},this)},_onWidgetActived:function(a){this.activePanel&&"active"===this.activePanel.state&&
a.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),l.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var b=new t;k([a],function(a){b.resolve(a)});return b},_loadThemeI18N:function(a){var b=new t;a.startWith("themes")?(a=a.split("/"),k(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){b.resolve(a)})):b.resolve({});
return b}});f.getInstance=function(){null===b&&(b=new f,window._panelManager=b);return b};return f})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(r,d,m,l){return r([l],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&
this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&d.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(c){this.loading=c;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(c){this.widget=c;this.loading&&this.loading.destroy();m.place(c.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(c){console.error("destroy widget error. widget: ["+
this.widget.uri+"], "+c.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(r,d,m,l,c,t,q,p,h){return r([c,t],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,
startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var c=this.getAllWidgetConfigs(),c=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];m.forEach(c,function(c){var a,g;!1!==c.visible&&(g=new q,a=this.createFrame(c),this.addChild(a),a.setLoading(g),this.widgetManager.loadWidget(c).then(d.hitch(this,function(c){a.setWidget(c);c.startup()})))},this)},getAllWidgetConfigs:function(){var c=[];return c=Array.isArray(this.config.widgets)?
this.config.widgets:[this.config]},getWidgetById:function(c){for(var d=this.getChildren(),a=0;a<d.length;a++)if(d[a].getWidget()&&d[a].getWidget().id===c)return d[a].getWidget()},getWidgets:function(){return this.getChildren().map(function(c){return c.getWidget()})},createFrame:function(c){return new p},setPosition:function(c,d){this.position=c;var a=h.getPositionStyle(this.position);a.position="absolute";d||(d="map"===c.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():
this.openAnimation&&(a.display="none");l.place(this.domNode,d);l.setStyle(this.domNode,a)},getPosition:function(){return this.position},setState:function(c){this.state=c},setWindowState:function(c){this.windowState=c},resize:function(){this.getChildren().forEach(function(c){c.resize()})},onPositionChange:function(c){this.setPosition(c)},onOpen:function(){m.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.openWidget(c.getWidget())},this)},onClose:function(){m.forEach(this.getChildren(),
function(c){c.getWidget()&&this.widgetManager.closeWidget(c.getWidget())},this)},onMaximize:function(){m.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.maximizeWidget(c.getWidget())},this)},onMinimize:function(){m.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.minimizeWidget(c.getWidget())},this)},onNormalize:function(){m.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.normalizeWidget(c.getWidget())},this)},onActive:function(){},
onDeActive:function(){},updateConfig:function(c){this._updateConfig(c)},reloadWidget:function(c){this.isWidgetInPanel(c)&&(this._updateConfig(c),this.getChildren().forEach(function(h){h.getWidget()&&h.getWidget().id===c.id&&(h.getWidget().destroy(),h.setLoading(new q),this.widgetManager.loadWidget(c).then(d.hitch(this,function(a){h.setWidget(a);a.startup();"closed"===this.state&&this.widgetManager.closeWidget(a)})))},this))},isWidgetInPanel:function(c){return m.some(this.getAllWidgetConfigs(),function(d){if(c.id===
d.id)return!0})?!0:!1},_updateConfig:function(c){if(Array.isArray(this.config.widgets)){for(var d=-1,a=0;a<this.config.widgets.length;a++)this.config.widgets[a].id===c.id&&(d=a);0<d&&(this.config.widgets[d]=c)}else this.config=c},destroy:function(){this.getChildren().forEach(function(c){try{c.domNode&&c.destroy()}catch(k){console.error("destroy widget frame error."+k.stack)}});this.inherited(arguments)}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on",
"dijit/_WidgetBase","dijit/_TemplatedMixin"],function(r,d,m,l,c){return r([l,c],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(m(window,"resize",d.hitch(this,this._onWindowResize)))},getConfig:function(){},getDataSources:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define("require dojo/_base/lang dojo/_base/html dojox/gfx esri/symbols/jsonUtils esri/symbols/PictureMarkerSymbol".split(" "),function(r,d,m,l,c,
t){return{cloneSymbol:function(d){if(!d)return null;var l=null;try{var h=d.toJson(),l=c.fromJson(h)}catch(n){console.error(n)}return l},getDefaultMarkerSymbol:function(){return c.fromJson({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return c.fromJson({tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return c.fromJson({tags:["opaque"],
title:"Blue",style:"esriSFSSolid",color:[79,129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return c.fromJson({color:[255,255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return c.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",
style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return c.fromJson({color:[255,255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},getGreyPinMarkerSymbol:function(){var c=r.toUrl("jimu/css/images/grey_pin.png"),c=new t(c,16,16);c.setOffset(0,8);return c},createSymbolNode:function(q,p){var h=32,n=32,k=m.create("div",{},document.body);m.setStyle(k,"display","inline-block");if(p)h=p.width,n=p.height;else if(h=80,
n=30,this.isSimpleMarkerSymbol(q))n=h=Math.min(q.size+12,125);else if(this.isPictureMarkerSymbol(q)){if(!q.url||"http://"===q.url||-1===q.url.indexOf("http://")&&-1===q.url.indexOf("https://")&&-1===q.url.indexOf("data:"))return;n=h=Math.min(Math.max(q.width,q.height),125)}else if(this.isSimpleLineSymbol(q)||this.isCartographicLineSymbol(q))h=190,n=20;var a=l.createSurface(k,h,n);if("vml"===l.renderer){var g=a.getEventSource();m.setStyle(g,"position","relative");m.setStyle(g.parentNode,"position",
"relative")}var g=null,g=p?c.getShapeDescriptors(q):this.isSimpleLineSymbol(q)||this.isCartographicLineSymbol(q)?this._getLineShapeDesc(q):c.getShapeDescriptors(q),f;try{f=a.createShape(g.defaultShape),g.fill&&f.setFill(g.fill),g.stroke&&f.setStroke(g.stroke)}catch(b){a.clear();a.destroy();return}q=a.getDimensions();q={dx:q.width/2,dy:q.height/2};a=f.getBoundingBox();p=a.width;a=a.height;if(p>h||a>n)h=((h<n?h:n)-5)/(p>a?p:a),d.mixin(q,{xx:h,yy:h});f.applyTransform(q);k&&m.addClass(k,"symbol");return k},
_getLineShapeDesc:function(c){var d=null;if(this.isSimpleLineSymbol(c)||this.isCartographicLineSymbol(c))d={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:c.getStroke()};return d},isSimpleMarkerSymbol:function(c){return c&&"esri.symbol.SimpleMarkerSymbol"===c.declaredClass},isPictureMarkerSymbol:function(c){return c&&"esri.symbol.PictureMarkerSymbol"===c.declaredClass},isSimpleLineSymbol:function(c){return c&&"esri.symbol.SimpleLineSymbol"===c.declaredClass},isCartographicLineSymbol:function(c){return c&&
"esri.symbol.CartographicLineSymbol"===c.declaredClass},isSimpleFillSymbol:function(c){return c&&"esri.symbol.SimpleFillSymbol"===c.declaredClass},isPictureFillSymbol:function(c){return c&&"esri.symbol.PictureFillSymbol"===c.declaredClass},isTextSymbol:function(c){return c&&"esri.symbol.TextSymbol"===c.declaredClass}}})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(r,d,m){return r(null,{constructor:function(){this.panelManager=
m.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(d){},getConfigById:function(d){for(var c=this.getAllConfigs(),l=0;l<c.length;l++)if(c[l].id===d)return c[l]},getAllConfigs:function(){var l=[],l=l.concat(this.getWidgetConfigs(),this.getGroupConfigs()),l=d.filter(l,function(c){return c.visible});return l.sort(function(c,d){return c.index-d.index})},getAllConfigsIncludeInvisible:function(){var d=
[],d=d.concat(this.getWidgetConfigs(),this.getGroupConfigs());return d.sort(function(c,d){return c.index-d.index})},isControlled:function(l){return d.some(this.getAllConfigsIncludeInvisible(),function(c){return c.id===l})},widgetIsControlled:function(l){return d.some(this.getAllConfigsIncludeInvisible(),function(c){return c.id===l?!0:d.some(c.widgets,function(c){return c.id===l})})},getGroupConfigs:function(){var l=[];if(!this.appConfig.widgetPool)return l;this.appConfig.widgetPool.groups&&d.forEach(this.appConfig.widgetPool.groups,
function(c){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(c.id)&&l.push(c):"all"===this.controlledGroups&&l.push(c))},this);return l},getWidgetConfigs:function(){var l=[];if(!this.appConfig.widgetPool)return l;this.appConfig.widgetPool.widgets&&d.forEach(this.appConfig.widgetPool.widgets,function(c){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(c.id)&&l.push(c):"all"===this.controlledWidgets&&l.push(c))},
this);return l}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),function(r,d,m,l,c,t,q,p){var h=null,n=null,k=!1;r=r(null,function(){});var a=require.toUrl("jimu"),g=t(a+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),f=t(a+"/SpatialReference/transform.json",{handleAs:"json"});r.loadResource=function(){var a=new l;if(h&&n)return a.resolve(),a;
c([g,f]).then(function(b){h=b[0];n=b[1];k=!0;a.resolve()},function(b){console.error(b);k=!1;a.reject(b)});return a};r.getAllCSUnits=function(){if(k){var a=[];m.forEach(h.wkids,d.hitch(this,function(b){b=this.getCSUnit(b);-1===m.indexOf(a,b)&&a.push(b)}));return a}};r.convertUnit=function(a,c,d){if(k)return p.convertUnit(a,c,d)};r.getUnitRate=function(a,c){if(k)return p.getUnitRate(a,c)};r.isProjectUnit=function(a){if(k)return p.isProjectUnit(a)};r.isGeographicUnit=function(a){if(k)return p.isGeographicUnit(a)};
r.getGeographicUnits=function(){if(k)return p.getGeographicUnits()};r.getProjectUnits=function(){if(k)return p.getProjectUnits()};r.getCSUnit=function(a){if(k){a=this.getCSStr(a);var b=0,c=0,b=a.lastIndexOf("UNIT"),c=a.indexOf(",",b);return a.slice(b+6,c-1)}};r.isSameSR=function(a,c){if(k)return a=this.indexOfWkid(a),c=this.indexOfWkid(c),h.labels[a]===h.labels[c]};r.isValidWkid=function(a){if(k)return-1<this.indexOfWkid(a)};r.getSRLabel=function(a){if(k&&this.isValidWkid(a))return a=this.indexOfWkid(a),
h.labels[a]};r.indexOfWkid=function(a){if(k)return m.indexOf(h.wkids,a)};r.isWebMercator=function(a){return q.prototype._isWebMercator?q.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new q(parseInt(a,10))).isWebMercator()};r.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};r.isValidTfWkid=function(a){if(k)return-1<this.indexOfTfWkid(a)};r.getTransformationLabel=function(a){if(k)return this.isValidTfWkid(a)?(a=this.indexOfTfWkid(a),n.labels[a]):""};r.indexOfTfWkid=
function(a){if(k)return m.indexOf(n.tfWkids,a)};r.isGeographicCS=function(a){if(k)return this.isValidWkid(a)?h.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};r.isProjectedCS=function(a){if(k)return this.isValidWkid(a)?h.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};r.getGeoCSByProj=function(a){if(k&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=m.indexOf(h.details,a),h.wkids[a]};r.getSpheroidStr=function(a){if(k){if(this.isGeographicCS(a))return h.details[this.indexOfWkid(a)];
if(this.isProjectedCS(a)){a=h.details[this.indexOfWkid(a)];var b=a.indexOf("GEOGCS"),c=a.indexOf("PROJECTION")-1;return a.slice(b,c)}return null}};r.getCSStr=function(a){if(k)return h.details[this.indexOfWkid(a)]};r.isSameSpheroid=function(a,c){if(k)return a=this.getSpheroidStr(a),c=this.getSpheroidStr(c),a&&c&&a===c?!0:!1};return r})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(r,d){var m="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
l="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),c={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,
YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};r=r(null,function(){});r.convertUnit=function(d,l,m){return c[d.toUpperCase()]/c[l.toUpperCase()]*m};r.getUnitRate=function(d,l){return c[d.toUpperCase()]/c[l.toUpperCase()]};r.isProjectUnit=function(c){return-1<d.indexOf(m,c.toUpperCase())};r.isGeographicUnit=function(c){return-1<
d.indexOf(l,c.toUpperCase())};r.getGeographicUnits=function(){return l};r.getProjectUnits=function(){return m};return r})},"jimu/dijit-all":function(){define([],1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),function(r,d,m,l,c,t,q,p){return r(d,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,constructor:function(){},postCreate:function(){q.create("div",
{"class":"jimu-radio-inner"},this.domNode);this.checked&&t.add(this.domNode,"jimu-radio-checked");this.own(c(this.domNode,"click",m.hitch(this,function(){this.checked||this.check()})))},check:function(c){void 0===c&&(c=!0);this.checked=!0;t.add(this.domNode,"jimu-radio-checked");c&&this._changeOthersState(!1);this.onStateChange()},uncheck:function(c){void 0===c&&(c=!0);this.checked=!1;t.remove(this.domNode,"jimu-radio-checked");c&&this._changeOthersState(!1);this.onStateChange()},_changeOthersState:function(c){null!==
this.group&&l.forEach(p.toArray(),function(d){d.id!==this.id&&d["class"]===this["class"]&&d.group===this.group&&(c?d.check(!1):d.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/Evented dojo/keys".split(" "),function(r,d,m,l,c,t,q,p){return r([d,q],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",checked:!1,status:!0,label:"",postCreate:function(){this.checkNode=
l.create("div",{"class":"checkbox jimu-float-leading jimu-icon jimu-icon-checkbox"},this.domNode);this.labelNode=l.create("div",{"class":"label jimu-float-leading",innerHTML:this.label||""},this.domNode);this.checked&&(l.addClass(this.checkNode,"checked"),l.addClass(this.checkNode,"jimu-icon-checked"));this.status||(l.addClass(this.domNode,"jimu-state-disabled"),l.addClass(this.checkNode,"jimu-state-disabled"));this.own(t(this.checkNode,"click",m.hitch(this,function(){this.status&&(this.checked?this.uncheck():
this.check())})));this.own(t(this.labelNode,"click",m.hitch(this,function(){this.checked&&this.status?this.uncheck():this.status&&this.check()})));this._udpateLabelClass();this._initSection508()},setLabel:function(c){this.label=c;this.labelNode.innerHTML=this.label;this.labelNode.title=this.label;this._udpateLabelClass()},_udpateLabelClass:function(){this.labelNode&&(this.labelNode.innerHTML?l.removeClass(this.labelNode,"not-visible"):l.addClass(this.labelNode,"not-visible"))},_initSection508:function(){"undefined"!==
typeof this.tabindex&&(l.setAttr(this.checkNode,"tabindex",this.tabindex),this.own(t(this.checkNode,"focus",m.hitch(this,function(){l.addClass(this.checkNode,"dijitCheckBoxFocused")}))),this.own(t(this.checkNode,"blur",m.hitch(this,function(){l.removeClass(this.checkNode,"dijitCheckBoxFocused")}))),this.own(t(this.checkNode,"keypress",m.hitch(this,function(c){c=c.charCode||c.keyCode;l.hasClass(this.checkNode,"dijitCheckBoxFocused")&&p.SPACE===c&&this.status&&(this.checked?this.uncheck():this.check())}))))},
setValue:function(c){this.status&&(!0===c?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(d){d=!!d;var h=this.status!==d;(this.status=d)?(c.remove(this.domNode,"jimu-state-disabled"),l.removeClass(this.checkNode,"jimu-state-disabled")):(c.add(this.domNode,"jimu-state-disabled"),l.addClass(this.checkNode,"jimu-state-disabled"));h&&this.emit("status-change",d)},getStatus:function(){return this.status},check:function(c){if(this.status&&(this.checked=!0,l.addClass(this.checkNode,
"checked jimu-icon-checked"),l.removeClass(this.checkNode,"checked jimu-icon-checkbox"),!c))this.onStateChange()},uncheck:function(c){if(this.status&&(this.checked=!1,l.removeClass(this.checkNode,"checked"),l.removeClass(this.checkNode,"jimu-icon-checked"),l.addClass(this.checkNode,"jimu-icon-checkbox"),!c))this.onStateChange()},onStateChange:function(){if(this.onChange&&m.isFunction(this.onChange))this.onChange(this.checked);this.emit("change",this.checked)},focus:function(){this.checkNode&&this.checkNode.focus&&
this.checkNode.focus()}})})},"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr dojo/Deferred dojox/gfx dojo/promise/all jimu/utils jimu/symbolUtils jimu/portalUrlUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font esri/arcgis/Portal esri/request jimu/dijit/ImageChooser jimu/dijit/ColorPicker jimu/dijit/_Transparency jimu/dijit/LoadingIndicator dijit/form/Select dijit/form/NumberSpinner".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z,A,E,y,C,F,B,G,H){return r([d,m,l,t],{templateString:c,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,_customPictureMarkerSymbol:null,symbol:null,type:null,DEFAULT_PORTAL_URL:"//arcgis.com/",_portalLoadTimeoutInMs:3E3,_isOnline:!0,_localTypes:"basic A-Z arrows business cartographic nationalParkService outdoorRecreation peoplePlaces safetyHealth shapes transportation damage disasters emergencyManagement generalInfrastructure localGovernment numbers pointsOfInterest stateGovernment FireFly".split(" "),
cropImage:!1,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser;this._setTemplateNls()},postCreate:function(){this.inherited(arguments);this._initImageChooser();this.own(n(document.body,"click",q.hitch(this,this._onBodyClicked)));(this._isIE8=8===k("ie"))&&p.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(a){this.reset();var b=
a&&a.declaredClass;b&&"string"===typeof b&&0<=b.indexOf("esri.symbol")&&(this.symbol=this._cloneSymbol(a),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(a){this.reset();
if("marker"===a||"line"===a||"fill"===a||"text"===a)this.type=a,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===this.type&&this._initTextSection()},getSymbol:function(){return this._getSymbol(!1)},getValidSymbol:function(){return this._getSymbol(!0)},_getSymbol:function(a){var b=null;"marker"===this.type?b=this._getPointSymbolBySetting(a):"line"===this.type?b=this._getLineSymbolBySetting(a):"fill"===this.type?
b=this._getFillSymbolBySetting(a):"text"===this.type&&(b=this._getTextSymbolBySetting(a));a=null;b&&(a=this._cloneSymbol(b));return a},hideColorPicker:function(){for(var a="pointColor pointOutlineColor lineColor fillColor fillOutlineColor textColor".split(" "),b=0,c=a.length;b<c;b++){var e=a[b];this[e]&&this[e].hideTooltipDialog()}},_onBodyClicked:function(a){a=a.target||a.srcElement;this._tryHideDropDownOfSelectDijit(a,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(a,this.lineStylesSelect)},
_tryHideDropDownOfSelectDijit:function(a,b){var c=b.domNode,e=b.dropDown.domNode,c=a===c||p.isDescendant(a,c);a=a===e||p.isDescendant(a,e);if(!c&&!a)b.dropDown.onCancel()},_onChange:function(a){a=this._cloneSymbol(a);this.emit("change",a)},_hideAllSections:function(){a(".symbol-section",this.domNode).style("display","none")},_showSection:function(b){this._hideAllSections();a("."+b+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(a,b,c){return u.getAncestorDom(a,b,c)},
_getAbsoluteUrl:function(a){return window.location.protocol+"//"+window.location.host+require.toUrl(a)},_cloneSymbol:function(a){if(!a)return null;var b=a;try{var c=a.toJson(),b=D.fromJson(c)}catch(I){console.error(I)}return b},_createSymbolIconTable:function(b,c,e){var d=this.type+"-icon-table";b=p.toDom('\x3ctable class\x3d"'+("icon-table "+d+" "+(d+"-"+b))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');for(var d=a("tbody",b)[0],f=Math.ceil(c.length/8),g=0;g<f;g++)p.create("tr",{},d);var k=a("tr",
b);h.forEach(c,q.hitch(this,function(a,b){var c=q.clone(a),d=D.fromJson(a);b=p.create("td",{},k[Math.floor(b/8)]);p.addClass(b,"symbol-td-item");d=this._createSymbolNode(d);p.addClass(d,"symbol-div-item");var f=d.firstChild;p.addClass(f,"svg-node");if(this._isIE8&&"point"===e)if(window.isRTL){if("Cross"===a.name||"X"===a.name)p.setStyle(f,"right","-20px"),p.setStyle(d,"marginTop","20px")}else"Cross"!==a.name&&"X"!==a.name||p.setStyle(d,"marginTop","20px");d.symbol=c;p.place(d,b)}));return b},_updatePreview:function(a){var b=
this._cloneSymbol(this.symbol);p.empty(a);(b=v.createSymbolNode(b))||(b=p.create("div"));p.place(b,a)},_createSymbolNode:function(a){(a=v.createSymbolNode(a,{width:36,height:36}))||(a=p.create("div"));p.setStyle(a,{width:"36px",height:"36px"});return a},_getLineShapeDesc:function(a){var b=null;if(this.isSimpleLineSymbol(a)||this.isCartographicLineSymbol(a))b={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:a.getStroke()};return b},_initPointSection:function(){this._showSection("point");
this._pointEventsBinded||(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showBuildInPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new z({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(n(this.pointIconTables,
".symbol-div-item:click",q.hitch(this,this._onPointSymIconItemClick)));this.own(n(this.pointSymClassSelect,"change",q.hitch(this,this._onPointSymClassSelectChange)));this.own(n(this.pointSize,"change",q.hitch(this,this._onPointSymbolChange)));this.own(n(this.pointColor,"change",q.hitch(this,this._onPointSymbolChange)));this.own(n(this.pointAlpha,"change",q.hitch(this,this._onPointSymbolChange)));this.own(n(this.pointOutlineColor,"change",q.hitch(this,this._onPointSymbolChange)));this.own(n(this.pointOutlineWidth,
"change",q.hitch(this,this._onPointSymbolChange)))},_onPointSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(),this._onChange(this.symbol))},_initPointSettings:function(a){if(a){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(a)){if(this.pointSize.set("value",a.size),this.pointColor.setColor(a.color),this.pointAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a=a.outline)this.pointOutlineColor.setColor(a.color),this.pointOutlineWidth.set("value",parseFloat(a.width.toFixed(0)))}else this.isPictureMarkerSymbol(a)&&
this.pointSize.set("value",a.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(a){return a&&"esri.symbol.SimpleMarkerSymbol"===a.declaredClass},isPictureMarkerSymbol:function(a){return a&&"esri.symbol.PictureMarkerSymbol"===a.declaredClass},_isCustomImageOptionSelected:function(){return"custom"===this.pointSymClassSelect.get("value")},_onPointSymClassSelectChange:function(){if(this._isCustomImageOptionSelected())this._showCustomPictureMarkerSymSettings(),this._customPictureMarkerSymbol&&
(this.symbol=this._customPictureMarkerSymbol,this._onPointSymbolChange());else{this._showSimpleMarkerSymSettings();this._showSelectedPointSymIconTable();var a=this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+a]?(a=this.pointSymClassSelect.getOptions(a),this.pointSymClassSelect.domNode.title=a?a.label:""):this._requestPointSymJson(a)}},_hideAllPointSymIconTable:function(){a(".marker-icon-table",this.pointIconTables).style("display","none")},_showSelectedPointSymIconTable:function(){this._hideAllPointSymIconTable();
var b=this.pointSymClassSelect.get("value"),b=a(".marker-icon-table-"+b,this.pointIconTables);0<b.length&&b.style("display","table")},_getLocalSymbols:function(a){a=a||this.pointSymClassSelect.get("value");a=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+a+".json");return g(a,{handleAs:"json"})},_getPortalSymbolsByType:function(a){var b=new f;a?this._fetchSymbols(a).then(q.hitch(this,function(a){b.resolve(a)}),q.hitch(this,function(a){b.reject(a)})):b.reject(null);return b},_requestPointSymJson:function(a){this.pointSymClassSelect["def"+
a]||(this.loadingShelter.show(),!this._isOnline&&window.isXT?this._offLineGetSymbols(a):this._symbolTypes?this._handleGetPointSymbols(q.hitch(this,this._getPortalSymbolsByType),a):this._initPortal().then(q.hitch(this,this._fetchSymbolTypes)).then(q.hitch(this,function(b){this._clearOptions();this._createOptions(b);this._handleGetPointSymbols(q.hitch(this,this._getPortalSymbolsByType),a)}),q.hitch(this,function(b){window.isXT?this._offLineGetSymbols(a):(this.loadingShelter.hide(),console.error("Fetching symbols failed",
b))})))},_offLineGetSymbols:function(a){this._isOnline=!1;if(0===this.pointSymClassSelect.options.length){var b=[];h.forEach(this._localTypes,q.hitch(this,function(a,c){b.push({id:c,title:this.nls[a]||a})}));this._clearOptions();this._createOptions(b)}this._handleGetPointSymbols(q.hitch(this,this._getLocalSymbols),a)},_clearOptions:function(){this.pointSymClassSelect&&this.pointSymClassSelect.removeOption(this.pointSymClassSelect.options)},_createOptions:function(a){if(this.pointSymClassSelect){var b=
[],c="",e=!1;"[object Array]"===Object.prototype.toString.call(a)&&0<a.length&&h.forEach(a,q.hitch(this,function(a){c=a.title||a.name;e=c===this.nls.basic?!0:!1;c&&(a.id||0===a.id)&&b.push({label:c,value:a.id,selected:e})}));b.push({label:this.nls.customImage,value:"custom"});this.pointSymClassSelect.addOption(b)}},_initPortal:function(){var a=new f;if(this._portal)a.resolve();else{var b=x.getStandardPortalUrl(window.portalUrl),c=new B.Portal(b?b:this.DEFAULT_PORTAL_URL);if(c.loaded)return this._portal=
c,a.resolve(),a.promise;this.own(c.on("load",q.hitch(this,function(){this._portal=c;a.resolve()})));setTimeout(function(){a.reject()},this._portalLoadTimeoutInMs)}return a},_handleGetPointSymbols:function(a,b){if(this.pointSymClassSelect){var c=b||this.pointSymClassSelect.get("value");b="def"+c;a=a(c);this.pointSymClassSelect[b]=a;a.then(q.hitch(this,function(a){this.loadingShelter.hide();this._getPointSymbolsSucess(c,a)}),q.hitch(this,function(a){this.loadingShelter.hide();console.error("Fetching symbols failed",
a)}))}},_getPointSymbolsSucess:function(a,b){if(this.domNode){var c=this.pointSymClassSelect.getOptions(a);this.pointSymClassSelect.domNode.title=c?c.label:"";a=this._createSymbolIconTable(a,b,"point");p.place(a,this.pointIconTables);this._showSelectedPointSymIconTable()}},_fetchSymbols:function(a){var b=[],c=new f,b=this._symbolTypes.filter(function(b){return b.id===a});this._getSymbolListData(b).then(q.hitch(this,function(a){c.resolve(a)}),q.hitch(this,function(a){console.warn("fetch symbols failed",
a);c.reject(a)}));return c},_getSymbolListData:function(a){a=h.filter(a,function(a){return a.dataUrl});a=h.map(a,function(a){return G({url:a.dataUrl}).promise});return e(a).then(function(a){return a[0]})},_fetchSymbolTypes:function(){var a=new f;this._symbolTypes?a.resolve(this._symbolTypes):this._getSymbolListGroupId().then(q.hitch(this,this._getSymbolListItems)).then(q.hitch(this,function(b){this._symbolTypes=b;a.resolve(b)}),q.hitch(this,function(b){console.warn("fetch symbol types failed",b);
a.reject(b)}));return a},_getSymbolListGroupId:function(){var a=new f;this._portal||a.reject("no portal");this._portal.queryGroups({q:this._portal.symbolSetsGroupQuery}).then(function(b){a.resolve(b.results[0].id)},q.hitch(this,function(b){console.warn("get symbol list group id failed",b);a.reject(b)}));return a},_getSymbolListItems:function(a){var c=new f,e=this._portal;a="group:"+a+' AND type:"Symbol Set"';var d=[];this._portal||c.reject("no portal");a="vml"===b.renderer?a+' AND -typekeywords:"by value"':
a+' AND (typekeywords:"by value" AND typekeywords:"marker")';e.queryItems({q:a,num:20,sortField:"title"}).then(q.hitch(this,function(a){var b,e,f,g;h.forEach(a.results,function(a){b=a.typeKeywords.join(" ");-1<b.indexOf("marker")&&(e=a.title,f={name:e,id:a.id,title:a.title,keywords:b,dataUrl:a.itemDataUrl},(g=-1<b.indexOf("default"))?(f.defaultType=!0,d.unshift(f)):d.push(f))},this);0<d.length?c.resolve(d):c.reject()}),function(){c.reject()});return c},_onPointSymIconItemClick:function(b){if(b=this._getAncestor(b.target||
b.srcElement,function(a){return p.hasClass(a,"symbol-div-item")},5))if(a(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),p.addClass(b,"selected-symbol-div-item"),b=b.symbol){this.symbol=D.fromJson(b);b=p.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():this._showBuildInPictureMarkerSymSettings();this._onPointSymbolChange();var c=p.getStyle(this.pointColorTr,"display");b!==c&&this.emit("resize")}},
_showSimpleMarkerSymSettings:function(){p.addClass(this.pointCustomImageTr,"hidden");p.removeClass(this.pointIconTablesTr,"hidden");p.removeClass(this.pointColorTr,"hidden");p.removeClass(this.pointOpacityTr,"hidden");p.removeClass(this.pointOutlineColorTr,"hidden");p.removeClass(this.pointOulineWidthTr,"hidden")},_showBuildInPictureMarkerSymSettings:function(){p.addClass(this.pointCustomImageTr,"hidden");p.removeClass(this.pointIconTablesTr,"hidden");p.addClass(this.pointColorTr,"hidden");p.addClass(this.pointOpacityTr,
"hidden");p.addClass(this.pointOutlineColorTr,"hidden");p.addClass(this.pointOulineWidthTr,"hidden")},_showCustomPictureMarkerSymSettings:function(){p.removeClass(this.pointCustomImageTr,"hidden");p.addClass(this.pointIconTablesTr,"hidden");p.addClass(this.pointColorTr,"hidden");p.addClass(this.pointOpacityTr,"hidden");p.addClass(this.pointOutlineColorTr,"hidden");p.addClass(this.pointOulineWidthTr,"hidden")},_getPointSymbolBySetting:function(a){if(!this.symbol||a&&!this.pointSize.validate())return null;
var b=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){if(a&&!this.pointOutlineWidth.validate())return null;this.symbol.setSize(b);a=this.pointColor.getColor();b=this.pointAlpha.getAlpha();a.a=b;this.symbol.setColor(a);a=this.pointOutlineColor.getColor();var b=parseFloat(this.pointOutlineWidth.get("value")),c=new E;c.setStyle(E.STYLE_SOLID);c.setColor(a);c.setWidth(b);this.symbol.setOutline(c)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(b),
this.symbol.setHeight(b));this._updatePreview(this.pointSymPreview);return this.symbol},_initImageChooser:function(){this.imageChooser=new H({cropImage:this.cropImage,customZIndex:this.customZIndex,showSelfImg:!1,goldenWidth:16,goldenHeight:16,format:["image/gif","image/png","image/jpeg"],label:this.nls.chooseFile});p.addClass(this.imageChooser.domNode,"custom-image-chooser");this.own(n(this.imageChooser,"change",q.hitch(this,this._onImageChange)));this.imageChooser.placeAt(this.customImageTd,"first")},
_onImageChange:function(a,b){this.imageNameNode.innerHTML=b.fileName;a=a.replace(/^data:image\/.*;base64,/,"");b=parseFloat(this.pointSize.get("value"));this._customPictureMarkerSymbol=this.symbol=new A({type:"esriPMS",url:null,imageData:a,contentType:"image/png",color:null,width:b,height:b,angle:0,xoffset:0,yoffset:0});this._onPointSymbolChange()},_initLineSection:function(){this._showSection("line");this._lineEventBinded||(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));
this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(n(this.lineIconTables,".symbol-div-item:click",q.hitch(this,this._onLineSymIconItemClick)));this.own(n(this.lineColor,"change",q.hitch(this,this._onLineSymbolChange)));this.own(n(this.lineStylesSelect,"change",q.hitch(this,this._onLineSymbolChange)));this.own(n(this.lineAlpha,"change",q.hitch(this,this._onLineSymbolChange)));this.own(n(this.lineWidth,"change",q.hitch(this,this._onLineSymbolChange)))},
_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.lineColor.setColor(a.color),this.lineAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(a.width.toFixed(0))),this.lineStylesSelect.set("value",a.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(a){return a&&"esri.symbol.SimpleLineSymbol"===a.declaredClass},
isCartographicLineSymbol:function(a){return a&&"esri.symbol.CartographicLineSymbol"===a.declaredClass},_requestLineSymJson:function(a){var b=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+a+".json");g(b,{handleAs:"json"}).then(q.hitch(this,function(b){this.domNode&&(b=this._createSymbolIconTable(a,b,"line"),p.place(b,this.lineIconTables))}),q.hitch(this,function(a){console.error("get line symbol failed",a)}))},_onLineSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(a){return p.hasClass(a,
"symbol-div-item")},5))if(a(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),p.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=D.fromJson(b),this._initLineSettings(b),this._onLineSymbolChange()},_getLineSymbolBySetting:function(a){if(a&&!this.lineWidth.validate())return null;this.symbol=new E;a=this.lineColor.getColor();var b=this.lineStylesSelect.get("value");a.a=this.lineAlpha.getAlpha();var c=parseFloat(this.lineWidth.get("value"));this.symbol.setStyle(b);
this.symbol.setColor(a);this.symbol.setWidth(c);this._updatePreview(this.lineSymPreview);return this.symbol},_initFillSection:function(){this._showSection("fill");this._fillEventBinded||(this._fillEventBinded=!0,this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(n(this.fillIconTables,".symbol-div-item:click",q.hitch(this,this._onFillSymIconItemClick)));this.own(n(this.fillColor,"change",q.hitch(this,
this._onFillSymbolChange)));this.own(n(this.fillAlpha,"change",q.hitch(this,this._onFillSymbolChange)));this.own(n(this.fillOutlineColor,"change",q.hitch(this,this._onFillSymbolChange)));this.own(n(this.fillOutlineWidth,"change",q.hitch(this,this._onFillSymbolChange)))},_onFillSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getFillSymbolBySetting(),this._onChange(this.symbol))},_initFillSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(a.color),this.fillAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),
a.outline&&(this.fillOutlineColor.setColor(a.outline.color),this.fillOutlineWidth.set("value",parseInt(a.outline.width,10))),this._invokeSymbolChangeEvent=!0)},_isSimpleFillSymbol:function(a){return a&&"esri.symbol.SimpleFillSymbol"===a.declaredClass},_requestFillSymJson:function(a){var b=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+a+".json");g(b,{handleAs:"json"}).then(q.hitch(this,function(b){this.domNode&&(b=this._createSymbolIconTable(a,b,"fill"),p.place(b,this.fillIconTables))}),q.hitch(this,
function(a){console.error("get fill symbol failed",a)}))},_onFillSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(a){return p.hasClass(a,"symbol-div-item")},5))if(a(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),p.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=D.fromJson(b),this._initFillSettings(b),this._onFillSymbolChange()},_getFillSymbolBySetting:function(a){if(a&&!this.fillOutlineWidth.validate())return null;
this.symbol=new y;var b=this.fillColor.getColor();b.a=this.fillAlpha.getAlpha();a=this.fillOutlineColor.getColor();var c=parseInt(this.fillOutlineWidth.get("value"),10);this.symbol.setColor(b);this.symbol.setStyle(y.STYLE_SOLID);b=new E;b.setStyle(E.STYLE_SOLID);b.setColor(a);b.setWidth(c);this.symbol.setOutline(b);this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||(this._textEventBinded=!0,this._bindTextEvents());
this._initTextSettings();this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(n(this.inputText,"change",q.hitch(this,this._onTextSymbolChange)));this.own(n(this.textColor,"change",q.hitch(this,this._onTextSymbolChange)));this.own(n(this.textFontSize,"change",q.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(a){a&&(this._invokeSymbolChangeEvent=
!1,this.inputText.value=a.text,this.textColor.setColor(a.color),a=parseInt(a.font.size,10),this.textFontSize.set("value",a),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(a){return a&&"esri.symbol.TextSymbol"===a.declaredClass},_updateTextPreview:function(a){var b=this.textColor.getColor().toHex(),c=parseInt(this.textFontSize.get("value"),10)+"px";p.setStyle(this.textPreview,{color:b,fontSize:c,fontFamily:a});this.textPreview.innerHTML=this.inputText.value},_getTextSymbolBySetting:function(a){if(a&&
!this.textFontSize.validate())return null;this.symbol=new C;a=this.inputText.value;var b=this.textColor.getColor(),c=parseInt(this.textFontSize.get("value"),10),e=new F;e.setSize(c);this.symbol.setText(a);this.symbol.setColor(b);this.symbol.setFont(e);this._updateTextPreview(e.family);return this.symbol},_setTemplateNls:function(){"undefined"===typeof this.nls.damage&&(this.nls.damage="Damage");"undefined"===typeof this.nls.disasters&&(this.nls.disasters="Disasters");"undefined"===typeof this.nls.emergencyManagement&&
(this.nls.emergencyManagement="Emergency Management");"undefined"===typeof this.nls.generalInfrastructure&&(this.nls.generalInfrastructure="General Infrastructure");"undefined"===typeof this.nls.localGovernment&&(this.nls.localGovernment="Local Government");"undefined"===typeof this.nls.numbers&&(this.nls.numbers="Numbers");"undefined"===typeof this.nls.pointsOfInterest&&(this.nls.pointsOfInterest="Points of Interest");"undefined"===typeof this.nls.stateGovernment&&(this.nls.stateGovernment="State Government")}})})},
"esri/arcgis/Portal":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/_base/array dojo/_base/sniff require ../kernel ../lang ../request ../urlUtils ../Evented ../IdentityManager".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a){var g={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},f=function(a){function b(b){a[b]||(a[b]=function(){var e=arguments;return l.when(a,function(a){Array.prototype.unshift.call(e,a.results||a);return f(c[b].apply(c,
e))})})}if(!a)return a;a.then&&(a=d.delegate(a));a.total||(a.total=l.when(a,function(a){return h.isDefined(a.total)?a.total:a.length||0}));b("forEach");b("filter");b("map");b("some");b("every");return a},b={useSSL:function(a,c){var e=g&&g.self||{};if(e&&!e.isPortal)return-1!==a.indexOf("https:")||e.allSSL?c.replace("http:","https:"):c;var d=b.getLocation(c);return-1<e.portalHostname.toLowerCase().indexOf(d.hostname.toLowerCase())&&d.port&&"80"!==d.port&&"443"!==d.port?(c=d.pathname,c=0===c.indexOf("/")?
c:"/"+c,e.allSSL||-1<a.indexOf("https:")?"https://"+d.hostname+(e.httpsPort&&"443"!==e.httpsPort?":"+e.httpsPort:"")+c+d.search:"http://"+d.hostname+(e.httpPort&&"80"!==e.httpPort?":"+e.httpPort:"")+c+d.search):-1!==a.indexOf("https:")||e.allSSL?c.replace("http:","https:"):c},formatUrl:function(a){var c=g.currentToken;return-1!==a.indexOf("null")?null:b.useSSL(window.location.protocol,c?a+(-1!==a.indexOf("?")?"\x26":"?")+("token\x3d"+c):a)},getLocation:function(a){var b=document.createElement("a");
b.href=a;return{protocol:b.protocol,hostname:b.hostname,port:b.port,pathname:b.pathname,search:b.search,hash:b.hash,host:b.host}},resultsToTypedArray:function(a,b,e){e=e?e.listings||e.notifications||e.userInvitations||e.tags||e.items||e.groups||e.comments||e.provisions||e.results||e:[];return c.map(e,function(c){c=d.mixin(c,b||{});return a?new a(c):c})},clearFieldsFromObject:function(a,b){var c,e=a.length;if(d.isArray(a))for(c=0;c<e;c++)delete b[a[c]];else for(c in a)delete b[c];return b},requestToTypedArray:function(a,
c,e,g,h){return f(b.request(a,c,e).then(d.partial(b.resultsToTypedArray,g,h)))},request:function(a,c,e){var f;c&&c.portal&&delete c.portal;c&&c.form&&(f=c.form,delete c.form);c=d.mixin(d.mixin({},c||{}),g.requestParams);e=d.mixin(e||{},g.options);return n({url:b.useSSL(window.location.protocol,a.url||a),content:c,callbackParamName:"callback",timeout:e&&e.timeout||0,form:f},e)},formatQueryParams:function(a,b,c){a=d.mixin(d.mixin({},a),d.isString(b)?{q:b}:b||{});a.q=!c&&g.extraQuery?"("+a.q+")"+g.extraQuery:
a.q;return a}},e=r([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(a){d.mixin(this,a);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null}}),u=r([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(a){d.mixin(this,a);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null}}),v=r([],{declaredClass:"esri.arcgis.PortalItem",constructor:function(a){d.mixin(this,a);this.folderId=this.ownerFolder||
this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.hasOwnProperty("ownerFolder")?this.itemUrl.replace("/content/","/content/users/"+this.owner+(this.folderId?"/"+this.folderId:"")+"/"):null;this.itemDataUrl=b.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=b.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.displayName=this._getDisplayName();this.iconUrl=this._getIconUrl();this.isPremiumContent=this._getIsPremiumContent();this.created=
this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null},getTypeInfo:function(){var a=this.type;return{source:-1<c.indexOf(this.typeKeywords||[],"ArcGIS Server")||"Feature Collection"===a?a:null,displayName:this.displayName,iconUrl:this.iconUrl,isPremiumContent:this.isPremiumContent,premiumIconUrl:this._getPremiumIconUrl()}},addComment:function(a){var c=d.isString(a)?{comment:a}:a;return b.request(this.itemUrl+
"/addComment",c,{usePost:!0}).then(d.hitch(this,function(a){return new e(d.mixin(c,{id:a.commentId,item:this}))}))},updateComment:function(a){if(a&&a.url&&a.comment)return b.request(a.url+"/update",{comment:a.comment},{usePost:!0}).then(function(b){a.id=b.commentId;return a});throw Error();},getComments:function(){return b.requestToTypedArray(this.itemUrl+"/comments",null,null,e,{item:this})},deleteComment:function(a){if(a&&a.url)return b.request(a.url+"/delete",null,{usePost:!0});throw Error();},
addRating:function(a){var c=d.isObject(a)?a:{rating:parseFloat(a)};return b.request(this.itemUrl+"/addRating",c,{usePost:!0}).then(d.hitch(this,function(a){return new u(d.mixin(c,{id:a.ratingId,item:this}))}))},getRating:function(){return b.request(this.itemUrl+"/rating").then(d.hitch(this,function(a){return new u(d.mixin(a,{item:this}))}))},deleteRating:function(){return b.request(this.itemUrl+"/deleteRating",null,{usePost:!0})},_getDisplayName:function(){var a=this.type,b=this.typeKeywords||[],
e=a;"Feature Service"===a||"Feature Collection"===a?e=-1<c.indexOf(b,"Table")?"Table":-1<c.indexOf(b,"Route Layer")?"Route Layer":-1<c.indexOf(b,"Markup")?"Markup":"Feature Layer":"Image Service"===a?e=-1<c.indexOf(b,"Elevation 3D Layer")?"Elevation Layer":"Imagery Layer":"Scene Service"===a?e="Scene Layer":"Scene Package"===a?e="Scene Layer Package":"Stream Service"===a?e="Feature Layer":"Geoprocessing Service"===a&&this.portal&&this.portal.isPortal?e=-1<c.indexOf(b,"Web Tool")?"Tool":"Geoprocessing Service":
"Geocoding Service"===a?e="Locator":"Microsoft Powerpoint"===a?e="Microsoft PowerPoint":"GeoJson"===a?this.type=e="GeoJSON":"Globe Service"===a?e="Globe Layer":"Vector Tile Service"===a?e="Tile Layer":"netCDF"===a?e="NetCDF":"Map Service"===a?e=-1===c.indexOf(b,"Spatiotemporal")&&(-1<c.indexOf(b,"Hosted Service")||-1<c.indexOf(b,"Tiled"))?"Tile Layer":"Map Image Layer":a&&-1<a.toLowerCase().indexOf("add in")?e=a.replace(/(add in)/ig,"Add-In"):"datastore catalog service"===a&&(e="Big Data File Share");
return e},_getIconUrl:function(){var a=this.type&&this.type.toLowerCase()||"",b=this.typeKeywords||[],e=!1,d=!1,f=!1,g=!1,h=!1;0<a.indexOf("service")||"feature collection"===a||"kml"===a||"wms"===a||"wmts"===a||"wfs"===a?(e=-1<c.indexOf(b,"Hosted Service"),"feature service"===a||"feature collection"===a||"kml"===a||"wfs"===a?(g=-1<c.indexOf(b,"Table"),d=-1<c.indexOf(b,"Route Layer"),f=-1<c.indexOf(b,"Markup"),a=(h=-1!==c.indexOf(b,"Spatiotemporal"))&&g?"spatiotemporaltable":g?"table":d?"routelayer":
f?"markup":h?"spatiotemporal":e?"featureshosted":"features"):a="map service"===a||"wms"===a||"wmts"===a?e||-1<c.indexOf(b,"Tiled")||"wmts"===a?"maptiles":"mapimages":"scene service"===a?-1<c.indexOf(b,"Line")?"sceneweblayerline":-1<c.indexOf(b,"3DObject")?"sceneweblayermultipatch":-1<c.indexOf(b,"Point")?"sceneweblayerpoint":-1<c.indexOf(b,"IntegratedMesh")?"sceneweblayermesh":-1<c.indexOf(b,"PointCloud")?"sceneweblayerpointcloud":-1<c.indexOf(b,"Polygon")?"sceneweblayerpolygon":"sceneweblayer":"image service"===
a?-1<c.indexOf(b,"Elevation 3D Layer")?"elevationlayer":"imagery":"stream service"===a?"streamlayer":"vector tile service"===a?"vectortile":"datastore catalog service"===a?"datastorecollection":"geocoding service"===a?"geocodeservice":"geoprocessing service"===a?-1<c.indexOf(b,"Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":"layers"):a="web map"===a||"cityengine web scene"===a?"maps":"web scene"===a?-1<c.indexOf(b,"ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===
a||"mobile application"===a||"application"===a||"operation view"===a||"desktop application"===a?"apps":"map document"===a||"map package"===a||"published map"===a||"scene document"===a||"globe document"===a||"basemap package"===a||"mobile basemap package"===a||"mobile map package"===a||"project package"===a||"project template"===a||"pro map"===a||"layout"===a||"layer"===a&&-1<c.indexOf(b,"ArcGIS Pro")||"explorer map"===a&&c.indexOf(b,"Explorer Document")?"mapsgray":"service definition"===a||"csv"===
a||"shapefile"===a||"cad drawing"===a||"geojson"===a||"360 vr experience"===a||"netcdf"===a?"datafiles":"explorer add in"===a||"desktop add in"===a||"windows viewer add in"===a||"windows viewer configuration"===a?"appsgray":"arcgis pro add in"===a||"arcgis pro configuration"===a?"addindesktop":"rule package"===a||"file geodatabase"===a||"sqlite geodatabase"===a||"csv collection"===a||"kml collection"===a||"windows mobile package"===a||"map template"===a||"desktop application template"===a||"arcpad package"===
a||"code sample"===a||"form"===a||"document link"===a||"operations dashboard add in"===a||"rules package"===a||"image"===a||"workflow manager package"===a||"explorer map"===a&&-1<c.indexOf(b,"Explorer Mapping Application")||-1<c.indexOf(b,"Document")?"datafilesgray":"network analysis service"===a||"geoprocessing service"===a||"geodata service"===a||"geometry service"===a||"geoprocessing package"===a||"locator package"===a||"geoprocessing sample"===a||"workflow manager service"===a?"toolsgray":"layer"===
a||"layer package"===a||"explorer layer"===a?"layersgray":"scene package"===a?"scenepackage":"mobile scene package"===a?"mobilescenepackage":"tile package"===a?"tilepackage":"task file"===a?"taskfile":"report template"===a?"report-template":"statistical data collection"===a?"statisticaldatacollection":"insights workbook"===a?"workbook":"insights model"===a?"insightsmodel":"insights page"===a?"insightspage":"insights theme"===a?"insightstheme":"hub initiative"===a?"hubinitiative":"hub page"===a?"hubpage":
"hub site application"===a?"hubsite":"relational database connection"===a?"relationaldatabaseconnection":"big data file share"===a?"datastorecollection":"image collection"===a?"imagecollection":"desktop style"===a?"desktopstyle":"style"===a?"style":"dashboard"===a?"dashboard":"raster function template"===a?"rasterprocessingtemplate":"vector tile package"===a?"vectortilepackage":"ortho mapping project"===a?"orthomappingproject":"ortho mapping template"===a?"orthomappingtemplate":"solution"===a?"solutions":
"maps";return a?q.toUrl("../css/images/item_type_icons/"+a+"16.png"):null},_getIsPremiumContent:function(){var a=this.typeKeywords,b=!1;if(-1<c.indexOf(a,"Requires Subscription")||-1<c.indexOf(a,"Requires Credits"))b=!0;return b},_getPremiumIconUrl:function(){var a=this.typeKeywords,b;this.isPremiumContent&&(b=-1<c.indexOf(a,"Requires Credits")?"premiumcredits":"premiumitem");return b?q.toUrl("../css/images/item_type_icons/"+b+"16.png"):null},getThumbnailUrl:function(a){var b=this.thumbnailUrl;b&&
a&&(b+=(-1===b.indexOf("?")?"?":"\x26")+"w\x3d"+a);return b}}),x=r([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(a){d.mixin(this,a);this.id=this.itemId;this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+this.itemId;this.commentsUrl=this.url+"/comments";this.created=this.created?new Date(this.created):null;this.banner=this.banner?b.formatUrl(this.url+"/info/"+this.banner):"";this.thumbnail=this.thumbnail?b.formatUrl(this.url+"/info/"+
this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?b.formatUrl(this.url+"/info/"+this.largeThumbnail):"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=this.numComments||0;this.listingProperties=this.listingProperties||{priceDesc:"",creditsPerTransaction:0,licenseType:"free",trialSupported:!1,trialDuration:0,listingAccess:"private"};for(var e in this.listingProperties)this[e]&&(this.listingProperties[e]=this[e]);this.properties=this.properties||{systemRequirements:"",
termsAndConditions:"",version:"1.0"};this.screenshots=c.map(this.screenshots,d.hitch(this,function(a){return b.formatUrl(this.url+"/info/"+a)}));this.vendorName=this.vendor.name;this.vendor.thumbnail=this.vendor.thumbnail?this.userItemUrl?b.formatUrl(this.portal.portalUrl+"/portals/self/resources/"+this.vendor.thumbnail):b.formatUrl(this.url+"/vendorinfo/"+this.vendor.thumbnail):""},getComments:function(){return b.requestToTypedArray(this.commentsUrl,null,null,e,{item:this})},getVendor:function(){return this.vendor}}),
D=r([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(a){d.mixin(this,a);this.created=this.created?new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&-1!==this.endDate?new Date(this.endDate):null;this.listing=a.listing?new x(d.mixin(a.listing,{portal:this.portal})):null}}),z=r([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(a){d.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+
this.id;this.thumbnailUrl=b.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getMembers:function(){return b.request(this.url+"/users")},queryItems:function(a,c){a=b.formatQueryParams({},a,c);a.q="group:"+this.id+(a.q?" "+a.q:"");return this.portal.queryItems(a)},getThumbnailUrl:function(a){var b=this.thumbnailUrl;b&&a&&(b+=(-1===b.indexOf("?")?"?":"\x26")+"w\x3d"+a);return b}}),A=r([],{declaredClass:"esri.arcgis.PortalFolder",
constructor:function(a){d.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null},getItems:function(){return b.requestToTypedArray(this.url,null,null,v,{portal:this.portal,folderId:this.id})}}),E=r([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(a){d.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+
"content/users/"+this.username;this.thumbnailUrl=this.thumbnail?b.formatUrl(this.url+"/info/"+this.thumbnail):null;this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getGroups:function(){return f(b.request(this.url).then(d.hitch(this,function(a){return b.resultsToTypedArray(z,{portal:this.portal},a.groups)})))},getNotifications:function(){return b.requestToTypedArray(this.url+"/notifications",null,null,null,{portal:this.portal})},getGroupInvitations:function(){return b.requestToTypedArray(this.url+
"/invitations",null,null,null,{portal:this.portal})},getTags:function(){return b.requestToTypedArray(this.url+"/tags",null,null,null,{portal:this.portal})},getFolders:function(){return f(this.getContent(null,{num:1}).then(function(a){return a.folders}))},getItems:function(a){return f(this.getContent(a).then(function(a){return a.items}))},getItem:function(a){return b.request(this.portal.portalUrl+"content/items/"+a).then(d.hitch(this,function(a){return new v(d.mixin(a,{portal:this.portal}))}))},getContent:function(a,
c){var e=this.url.replace("community","content")+(a?"/"+a:"");return b.request(e,c).then(d.hitch(this,function(c){c.folders=b.resultsToTypedArray(A,{portal:this.portal},c.folders);c.items=b.resultsToTypedArray(v,{portal:this.portal,folderId:a},c.items);return c}))},getThumbnailUrl:function(a){var b=this.thumbnailUrl;b&&a&&(b+=(-1===b.indexOf("?")?"?":"\x26")+"w\x3d"+a);return b}});r={Portal:r([a],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},onError:function(){},constructor:function(a){a=
d.isObject(a)?a:{url:a};this.registerConnectEvents();g={options:{disableIdentityLookup:!0},requestParams:{f:"json"}};a.self?(g.self=a.self,d.mixin(this,{url:a.url||k.getProtocolForWebResource()+"//"+(a.self.urlKey?a.self.urlKey+"."+a.self.customBaseUrl:a.self.portalHostname)}),this.portalUrl=-1!==this.url.indexOf("/sharing")?this.url+"/":this.url+"/sharing/rest/",a=a.self.user?this.signIn():this.init(this.url)):(a.url&&d.mixin(this,{url:a.url}),a=this.init(this.url));a.then(d.hitch(this,function(){this.emit("ready",
this);this.onLoad(this)}))},init:function(a,c){a=(a||this.portalUrl).replace(/\/+$/,"");this.portalUrl=-1!==a.indexOf("/sharing")?a+"/":a+"/sharing/rest/";return this._getSelf(this.portalUrl).then(d.hitch(this,function(a){g.self=d.mixin({},a);(a=a.user)&&c&&(g.currentToken=c&&c.token,g.loggedInUser=new E(d.mixin(a,{portal:this,credential:c})));g.self.id&&!1===g.self.canSearchPublic&&(g.extraQuery=" AND orgid:"+g.self.id);d.mixin(this,g.self);this.thumbnailUrl=b.formatUrl(this.portalUrl+"portals/self/resources/"+
this.thumbnail);this.isOrganization=this.access&&this.access.length?!0:!1;this.created=this.created?new Date(this.created):null;this.modified=this.modified?new Date(this.modified):null;return this}),d.hitch(this,function(a){this.onError(a);throw a;}))},signIn:function(){var a=new l,b=d.hitch(this,function(){this._onSignIn().then(d.hitch(this,function(){a.resolve(g.loggedInUser)}),d.hitch(this,function(b){a.reject(b)}))});if(g&&g.self)g&&g.loggedInUser?setTimeout(function(){a.resolve(g.loggedInUser)},
0):b();else this.on("load",d.hitch(this,function(){b()}));return a},signOut:function(){g.loggedInUser.credential&&g.loggedInUser.credential.destroy();g.loggedInUser=null;g.options.disableIdentityLookup=!0;b.clearFieldsFromObject(g.self,this);g.self=null;return this.init(this.url)},getPortalUser:function(){return g.loggedInUser},addResource:function(a,c){return b.request(this.portalUrl+"portals/self/addResource",{key:a,text:c},{usePost:!0})},update:function(a){return b.request(this.portalUrl+"portals/self/update",
a,{usePost:!0})},queryGroups:function(a,c){return this._queryPortal(this.portalUrl+"community/groups",b.formatQueryParams({},a,c),z)},queryItems:function(a,c){return this._queryPortal(this.portalUrl+"search",b.formatQueryParams({},a,c),v)},queryListings:function(a){a=b.formatQueryParams({},a,!0);var c="";a.q&&-1<a.q.toLowerCase().indexOf("mylistings:true")?(a.q=a.q.toLowerCase().replace("mylistings:true",""),c="?mylistings\x3dtrue"):a.q||(a.q='""');return this._queryPortal(this.portalUrl+"content/listings"+
c,a,x)},queryCustomerList:function(a,c){a=b.formatQueryParams({},a,!0);return this._queryPortal(this.portalUrl+"portals/self/customersList",a)},getProvisions:function(){return this.getCustomers().then(d.hitch(this,function(a){return a.purchases}))},getInterests:function(){return this.getCustomers().then(d.hitch(this,function(a){return a.interests}))},getTrials:function(){return this.getCustomers().then(d.hitch(this,function(a){return a.trials}))},getCustomers:function(a){return b.request(this.portalUrl+
"portals/self/customers",{status:a||"all"})},getMyPurchases:function(){return this.getPurchases().then(function(a){return a.purchases})},getMyInterests:function(){return this.getPurchases().then(function(a){return a.interests})},getPurchases:function(){return b.request(this.portalUrl+"portals/self/purchases").then(d.hitch(this,function(a){a.interests=c.map(a.interests,function(a){return d.mixin(a.provision,{listing:a.listing})});a.purchases=c.map(a.purchases,function(a){return d.mixin(a.provision,
{listing:a.listing})});a.trials=c.map(a.trials,function(a){return d.mixin(a.provision,{listing:a.listing})});a.interests=b.resultsToTypedArray(D,{portal:this},a.interests);a.trials=b.resultsToTypedArray(D,{portal:this},a.trials);a.purchases=b.resultsToTypedArray(D,{portal:this},a.purchases);return a}))},queryUsers:function(a,c){return this._queryPortal(this.portalUrl+"community/users",b.formatQueryParams({sortField:"username"},a,c),E)},_onSignIn:function(){g.options.disableIdentityLookup=!1;g.self=
null;return p.id.getCredential(this.portalUrl).then(d.hitch(this,"init",this.url)).then(function(){return g.loggedInUser},d.hitch(this,function(a){g.options.disableIdentityLookup=!0;this.onError(a);throw a;}))},_getSelf:function(a){var c;a+="portals/self";g.self?(c=new l,setTimeout(function(){c.resolve(g.self)},0)):c=b.request(a,{culture:m.locale});return c},_queryPortal:function(a,c,e){var g=d.mixin({num:10,start:0,sortField:"title",sortOrder:"asc"},c),h=["start","query","num","nextStart"];a=b.request(a,
g).then(d.hitch(this,function(a){a.results=b.resultsToTypedArray(e,{portal:this},a);a.queryParams=d.mixin({},g);a.nextQueryParams=d.mixin(g,{start:a.nextStart});return b.clearFieldsFromObject(h,a)}));a=d.delegate(a);a.queryParams=d.mixin({},g);a.nextQueryParams=l.when(a,function(a){return a.nextQueryParams});return f(a)}}),PortalFolder:A,PortalGroup:z,PortalItem:v,PortalUser:E,PortalComment:e,PortalRating:u,PortalUtil:b,PortalResult:f,PortalListing:x};t("extend-esri")&&d.mixin(d.getObject("arcgis",
!0,p),r);return r})},"jimu/dijit/ImageChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/text!./templates/ImageChooser.html dojo/sniff esri/lang ../utils ./_CropImage jimu/dijit/Popup jimu/dijit/Message jimu/dijit/LoadingShelter".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b){var e=0;r=d([m,l,r],{templateString:p,declaredClass:"jimu.dijit.ImageChooser",cropImage:!0,displayImg:null,stretchImg:!0,defaultSelfSrc:null,
showSelfImg:!1,label:null,showTip:!0,goldenWidth:400,goldenHeight:400,maxSize:1024,format:null,customZIndex:null,imageData:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.imageChooser;this.nls.common=window.jimuNls.common;this.nls.readError=this.nls.readError||"Failed to read the file."},postCreate:function(){this._initial();k.file.supportHTML5()||h("safari")||!k.file.isEnabledFlash()||k.file.loadFileAPI().then(c.hitch(this,function(){t.setStyle(this.mask,"zIndex",
1)}))},setImageSize:function(a){this.goldenWidth=a.width;this.goldenHeight=a.height},disableChooseImage:function(){t.setStyle(this.fileForm,"display","none");this.label&&"string"===typeof this.label&&t.addClass(this.displayText,"disable-label");t.removeAttr(this.domNode,"title")},enableChooseImage:function(){t.setStyle(this.fileForm,"display","block");this.label&&"string"===typeof this.label&&t.removeClass(this.displayText,"disable-label");this._addTip()},setDefaultSelfSrc:function(a){this.defaultSelfSrc=
a;this.imageData=this.selfImg.src=a},getImageData:function(){return this.imageData},_initial:function(){this._initFileForm();this._processProperties();this._addTip()},_processProperties:function(){this.fileProperty={};this.label&&"string"===typeof this.label&&(this.displayText.innerHTML=this.label,t.setStyle(this.hintText,"display","block"));this.showSelfImg&&t.setStyle(this.hintImage,"display","block");!1===this.stretchImg?t.addClass(this.selfImg,"no-stretch-img"):t.removeClass(this.selfImg,"no-stretch-img");
this.defaultSelfSrc&&(this.imageData=this.selfImg.src=this.defaultSelfSrc);if(this.format){var a="image/*";"string"===typeof this.format&&/^image\/./.test(this.format)?a=this.format:"[object Array]"===Object.prototype.toString.call(this.format)&&0<this.format.length&&(a=this.format.join(","));t.setAttr(this.fileInput,"accept",a)}k.file.supportHTML5()||h("safari")||!k.file.isEnabledFlash()||t.setStyle(this.fileInput,{width:"100%",height:"100%",position:"absolute",left:0,top:0,opacity:0,zIndex:9})},
_newMessage:function(a){this.msgPopupOpen=!0;this.msgPopup=new f({customZIndex:this.customZIndex,message:a})},_porcessMaskClick:function(){t.setAttr(this.fileInput,"id","imageChooser_"+e);t.setAttr(this.mask,"for","imageChooser_"+e);e++;q.once(this.mask,"click",c.hitch(this,function(a){a.stopPropagation();if(h("safari")&&7>h("safari"))this._newMessage(this.nls.unsupportReaderAPI),a.preventDefault();else{if(!k.file.supportHTML5()){if(!k.file.isEnabledFlash()){var b=t.create("a",{href:"http://helpx.adobe.com/flash-player.html",
innerHTML:this.nls.enableFlash,target:"_blank"});this._newMessage(b);a.preventDefault();return}if(!k.file.supportFileAPI()){this._newMessage(this.nls.unsupportReaderAPI);a.preventDefault();return}}t.setStyle(this.fileInput,"display","none");setTimeout(c.hitch(this,function(){t.setStyle(this.fileInput,"display","block")}),200)}}))},_addTip:function(){if(this.showTip){var a=n.substitute({width:this.goldenWidth||40,height:this.goldenHeight||40},this.nls.toolTip);t.setAttr(this.domNode,"title",a)}else t.setAttr(this.domNode,
"title","")},_onFileInputChange:function(a){var b=a.target.files&&a.target.files[0]||a.files&&a.files[0];if(this.format&&-1===this.format.indexOf(b.type))this._newMessage(this.nls.invalidType),this._initFileForm();else{var e=1024*this.maxSize;k.file.readFile(a,"image/*",e,c.hitch(this,function(a,c,d){a?(c=this.nls[a.errCode],"exceed"===a.errCode&&(c=c.replace("1024",e/1024)),this._newMessage(c)):(this.fileProperty.fileName=c,this.cropImage&&"image/gif"!==b.type?this._cropImageByUser(d,b.type):this._readFileData(d));
this._initFileForm()}))}},_initFileForm:function(){this.mask&&t.destroy(this.mask);this.fileInput&&t.destroy(this.fileInput);this.fileForm&&t.destroy(this.fileForm);this.fileForm=t.create("form",{"data-dojo-attach-point":"fileForm"},this.domNode);this.mask=t.create("label",{"data-dojo-attach-point":"mask"},this.fileForm);this.fileInput=t.create("input",{type:"file","data-dojo-attach-point":"fileInput"},this.fileForm);this._porcessMaskClick();q.once(this.fileInput,"change",c.hitch(this,this._onFileInputChange))},
_readFileData:function(a){this.onImageChange(a,this.fileProperty);this.displayImg&&t.setAttr(this.displayImg,"src",a);this.showSelfImg&&(this.selfImg?t.setAttr(this.selfImg,"src",a):this.selfImg.src=a,(a=t.getMarginBox(this.hintImage))&&a.w&&a.h&&(t.style(this.selfImg,"maxWidth",a.w+"px"),t.style(this.selfImg,"maxHeight",a.h+"px")))},_cropImageByUser:function(e,d){var f=new a({imageSrc:e,type:d,nls:c.clone(this.nls),goldenWidth:this.goldenWidth,goldenHeight:this.goldenHeight}),h=new b({hidden:!0});
this.cropPopupOpen=!0;this.cropPopup=new g({titleLabel:this.nls.cropImage,content:f,customZIndex:this.customZIndex,width:500,height:480,buttons:[{label:this.nls.common.ok,onClick:c.hitch(this,function(){h.show();var a=f.getData();this._readFileData(a);this.cropPopup.close();f.destroy();h.hide()})}]});h.placeAt(this.cropPopup.domNode);f.startup();t.addClass(this.cropPopup.domNode,"image-chooser-crop-popup")},onImageChange:function(a){this.imageData=a;this.emit("imageChange",this.imageData,this.fileProperty);
this.emit("change",this.imageData,this.fileProperty)}});r.GIF="image/gif";r.JPEG="image/jpeg";r.PNG="image/png";return r})},"jimu/dijit/_CropImage":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on jimu/utils dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_CropImage.html dojo/NodeList-dom".split(" "),function(r,d,m,l,c,t,q,p){var h=window.Cropper;return r([t,q],{templateString:p,imageSrc:null,type:null,goldenWidth:4,goldenHeight:3,postCreate:function(){this.type||
(this.type="image/jpeg");this.setImageSrc(this.imageSrc);this.loadingImg.src=require.toUrl("jimu")+"/images/loading.gif";this.own(l(this.baseImage,"load",m.hitch(this,function(){d.setStyle(this.loadingImg,"display","none");this._initCropper()})))},_initCropper:function(){this.cropper&&this.cropper.destroy&&this.cropper.destroy();this.cropper=new h(this.baseImage,{aspectRatio:this.goldenWidth/this.goldenHeight,preview:".img-preview"})},setImageSrc:function(c){d.setAttr(this.baseImage,"src",c)},getData:function(){return this.cropper.getCroppedCanvas().toDataURL(this.type||
"image/jpeg")},destroy:function(){this.cropper&&this.cropper.destroy&&this.cropper.destroy();this.inherited(arguments)}})})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dijit/TooltipDialog dijit/popup jimu/dijit/ColorSelector jimu/utils".split(" "),function(r,d,m,l,c,t,q,p,h,n,k){return r([d,m],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",
_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof q||(this.color=new q(this.color)):this.color=new q("#ccc");c.setStyle(this.domNode,"backgroundColor",this.color.toHex());this.showLabel&&this._changeLabel(this.color);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){h.close(this.tooltipDialog);
this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(a){var d=this.tooltipDialog.domNode;return a===d||c.isDescendant(a,d)},hideTooltipDialog:function(){this._hideTooltipDialog()},_showTooltipDialog:function(){h.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=!0},_hideTooltipDialog:function(){this._isTooltipDialogOpened=!1;this.onClose();h.close(this.tooltipDialog)},_createTooltipDialog:function(){var a=
c.create("div");this.tooltipDialog=new p({content:a});c.addClass(this.tooltipDialog.domNode,"jimu-color-picker-dialog");var d=new n({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:l.hitch(this,function(a){this.ensureMode||(a=new q(a),this.setColor(a))})});d.placeAt(a);d.startup();if(this.ensureMode){var f=c.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-trailing",title:this.nls.cancel,innerHTML:this.nls.cancel},a);this.own(t(f,"click",
l.hitch(this,function(){this._hideTooltipDialog()})));"undefined"===typeof this.showOk&&(f=c.create("div",{"class":"jimu-btn jimu-float-trailing ok",title:this.nls.ok,innerHTML:this.nls.ok},a),this.own(t(f,"click",l.hitch(this,function(){var a=this.picker.get("value");this.setColor(new q(a));this._hideTooltipDialog()}))));a=c.create("div",{"class":"jimu-btn jimu-float-trailing",title:this.nls.apply,innerHTML:this.nls.apply},a);this.own(t(a,"click",l.hitch(this,function(){var a=this.picker.get("value");
this.setColor(new q(a))})))}this.own(t(this.domNode,"click",l.hitch(this,function(a){a.stopPropagation();a.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(t(document.body,"click",l.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=d},setColor:function(a,d){if(a instanceof q){var f=this.color,b="";f&&(b=f.toHex());f=a.toHex();this.color=a;c.setStyle(this.domNode,"backgroundColor",
f);if(b!==f&&(this.picker.set("value",f),!1!==d))this.onChange(new q(f))}},getColor:function(){return this.color},_changeLabel:function(a){c.empty(this.domNode);c.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:k.invertColor(a.toHex())}},this.domNode)},onChange:function(a){this.showLabel&&this._changeLabel(a)},onClose:function(){},getPopup:function(){return this.tooltipDialog||null},setLabel:function(a){c.empty(this.domNode);c.create("span",{innerHTML:a||"",className:"text-label"},
this.domNode)},isTooltipDialogOpened:function(){return this._isTooltipDialogOpened}})})},"jimu/dijit/ColorSelector":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dojox/widget/ColorPicker dijit/_base/focus dojo/fx dojo/_base/lang dojo/_base/html dojo/sniff".split(" "),function(r,d,m,l,c,t,q,p,h){return d([m,l,r],{baseClass:"jimu-color-selector",declaredClass:"jimu.dijit.ColorSelector",_setPoint:function(d){d&&c.focus(d.target);if(!this._CURSOR_WIDTH||!this._CURSOR_HEIGHT){var k=
p.getMarginBox(this.cursorNode);k.w&&k.h&&(this._CURSOR_WIDTH=k.w/2,this._CURSOR_HEIGHT=k.h/2)}this._BORDER_WIDTH&&this._BORDER_HEIGHT||(k=p.getBorderExtents(d.target||d.srcElement),k.w&&k.h&&(this._BORDER_WIDTH=k.w,this._BORDER_HEIGHT=k.h));var a=k=0;h("ff")||h("ie")||h("MSIE")?(k=d.offsetX,a=d.offsetY):d.offsetX&&d.offsetY&&(k=d.offsetX+this._BORDER_WIDTH,a=d.offsetY+this._BORDER_HEIGHT);d=a-this._CURSOR_HEIGHT;k-=this._CURSOR_WIDTH;this.animatePoint?t.slideTo({node:this.cursorNode,duration:this.slideDuration,
top:d,left:k,onEnd:q.hitch(this,function(){this._updateColor(!0);c.focus(this.cursorNode)})}).play():(p.style(this.cursorNode,{left:k+"px",top:d+"px"}),this._updateColor(!0))},_setHuePoint:function(d){d=d.offsetY-this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?t.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:d,left:0,onEnd:q.hitch(this,function(){this._updateColor(!0);c.focus(this.hueCursorNode)})}).play():(p.style(this.hueCursorNode,"top",d+"px"),this._updateColor(!0))}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z,A,E){r.experimental("dojox.widget.ColorPicker");return d("dojox.widget.ColorPicker",u,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:E,postMixInProperties:function(){k.contains(p.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=b.getUniqueId(this.id);m.mixin(this,D.getLocalization("dojox.widget","ColorPicker"));m.mixin(this,D.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>q("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new f.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new f.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(t.subscribe("/dnd/move/stop",m.hitch(this,"_clearTimer"))),this._subs.push(t.subscribe("/dnd/move/start",
m.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:a.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,m.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:a.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,m.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:a.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,m.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:a.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,m.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:a.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,m.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:a.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,m.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(a,b){this._started&&this.setColor(a,b)},setColor:function(a,b){a=x.fromString(a);this._updatePickerLocations(a);this._updateColorInputs(a);this._updateValue(a,b)},_setTimer:function(a){if(a.node==this.cursorNode||a.node==this.hueCursorNode)e.focus(a.node),n.setSelectable(this.domNode,!1),this._timer=setInterval(m.hitch(this,"_updateColor"),45)},_clearTimer:function(a){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),n.setSelectable(this.domNode,!0))},_setHue:function(a){c.style(this.colorUnderlay,"backgroundColor",x.fromHsv(a,100,100).toHex())},_updateHueCursorNode:function(b,e,d){if(-1!==b){b=c.style(this.hueCursorNode,"top");e=this.PICKER_HUE_SELECTOR_H/2;b+=e;var f=!1;d.charOrCode==a.UP_ARROW?0<b&&(--b,f=!0):d.charOrCode==a.DOWN_ARROW&&b<this.PICKER_HUE_H&&(b+=1,f=!0);f&&c.style(this.hueCursorNode,"top",b-e+"px")}else this._updateColor(!0)},_updateCursorNode:function(b,
e,d){e=this.PICKER_SAT_SELECTOR_H/2;var f=this.PICKER_SAT_SELECTOR_W/2;if(-1!==b){b=c.style(this.cursorNode,"top");var g=c.style(this.cursorNode,"left");b+=e;var g=g+f,h=!1;d.charOrCode==a.UP_ARROW?0<b&&(--b,h=!0):d.charOrCode==a.DOWN_ARROW?b<this.PICKER_SAT_VAL_H&&(b+=1,h=!0):d.charOrCode==a.LEFT_ARROW?0<g&&(--g,h=!0):d.charOrCode==a.RIGHT_ARROW&&g<this.PICKER_SAT_VAL_W&&(g+=1,h=!0);h&&(g-=f,c.style(this.cursorNode,"top",b-e+"px"),c.style(this.cursorNode,"left",g+"px"))}else this._updateColor(!0)},
_updateColor:function(a){var b=this.PICKER_HUE_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_W/2,b=c.style(this.hueCursorNode,"top")+b,e=c.style(this.cursorNode,"top")+e,d=c.style(this.cursorNode,"left")+d,b=Math.round(360-b/this.PICKER_HUE_H*360),d=x.fromHsv(b,d/this.PICKER_SAT_VAL_W*100,100-e/this.PICKER_SAT_VAL_H*100);this._updateColorInputs(d);this._updateValue(d,a);b!=this._hue&&this._setHue(b)},_colorInputChange:function(a){var b,c=!1;switch(a.target){case this.hexCode:b=
x.fromString(a.target.value);c=!0;break;case this.Rval:case this.Gval:case this.Bval:b=x.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);c=!0;break;case this.Hval:case this.Sval:case this.Vval:b=x.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),c=!0}c&&(this._updatePickerLocations(b),this._updateColorInputs(b),this._updateValue(b,!0))},_updateValue:function(a,b){a=a.toHex();this.value=this.valueNode.value=a;if(b&&(!this._timer||this.liveUpdate))this.onChange(a)},_updatePickerLocations:function(a){var b=
this.PICKER_HUE_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_W/2;a=a.toHsv();b=Math.round(this.PICKER_HUE_H-a.h/360*this.PICKER_HUE_H)-b;d=Math.round(a.s/100*this.PICKER_SAT_VAL_W)-d;e=Math.round(this.PICKER_SAT_VAL_H-a.v/100*this.PICKER_SAT_VAL_H)-e;this.animatePoint?(g.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:b,left:0}).play(),g.slideTo({node:this.cursorNode,duration:this.slideDuration,top:e,left:d}).play()):(c.style(this.hueCursorNode,"top",b+"px"),
c.style(this.cursorNode,{left:d+"px",top:e+"px"}));a.h!=this._hue&&this._setHue(a.h)},_updateColorInputs:function(a){var b=a.toHex();this.showRgb&&(this.Rval.value=a.r,this.Gval.value=a.g,this.Bval.value=a.b);this.showHsv&&(a=a.toHsv(),this.Hval.value=Math.round(a.h),this.Sval.value=Math.round(a.s),this.Vval.value=Math.round(a.v));this.showHex&&(this.hexCode.value=b);this.previewNode.style.backgroundColor=b;this.webSafe&&(this.safePreviewNode.style.backgroundColor=b)},_setHuePoint:function(a){var b=
this.PICKER_HUE_SELECTOR_H/2;a=a.layerY||a.y-a.target.getBoundingClientRect().top;a-=b;this.animatePoint?g.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:a,left:0,onEnd:m.hitch(this,function(){this._updateColor(!0);e.focus(this.hueCursorNode)})}).play():(c.style(this.hueCursorNode,"top",a+"px"),this._updateColor(!0))},_setPoint:function(a){var b=this.PICKER_SAT_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_W/2,f=a.layerY||a.y-a.target.getBoundingClientRect().top,f=f-b,b=a.layerX||a.x-
a.target.getBoundingClientRect().left,b=b-d;a&&e.focus(a.target);this.animatePoint?g.slideTo({node:this.cursorNode,duration:this.slideDuration,top:f,left:b,onEnd:m.hitch(this,function(){this._updateColor(!0);e.focus(this.cursorNode)})}).play():(c.style(this.cursorNode,{left:b+"px",top:f+"px"}),this._updateColor(!0))},_handleKey:function(a){},focus:function(){this.focused||e.focus(this.focusNode)},_stopDrag:function(a){h.stop(a)},destroy:function(){this.inherited(arguments);l.forEach(this._subs,function(a){t.unsubscribe(a)});
delete this._subs}})})},"dojox/color":function(){define(["./color/_base"],function(r){return r})},"dojox/color/_base":function(){define(["../main","dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(r,d,m,l){r=d.getObject("color",!0,r);r.Color=m;r.blend=m.blendColors;r.fromRgb=m.fromRgb;r.fromHex=m.fromHex;r.fromArray=m.fromArray;r.fromString=m.fromString;r.greyscale=l.makeGrey;d.mixin(r,{fromCmy:function(c,l,q){d.isArray(c)?(l=c[1],q=c[2],c=c[0]):d.isObject(c)&&(l=c.m,q=c.y,c=c.c);return new m({r:Math.round(255*
(1-c/100)),g:Math.round(255*(1-l/100)),b:Math.round(255*(1-q/100))})},fromCmyk:function(c,l,q,p){d.isArray(c)?(l=c[1],q=c[2],p=c[3],c=c[0]):d.isObject(c)&&(l=c.m,q=c.y,p=c.b,c=c.c);p/=100;return new m({r:Math.round(255*(1-Math.min(1,c/100*(1-p)+p))),g:Math.round(255*(1-Math.min(1,l/100*(1-p)+p))),b:Math.round(255*(1-Math.min(1,q/100*(1-p)+p)))})},fromHsl:function(c,l,q){d.isArray(c)?(l=c[1],q=c[2],c=c[0]):d.isObject(c)&&(l=c.s,q=c.l,c=c.h);l/=100;for(q/=100;0>c;)c+=360;for(;360<=c;)c-=360;var p,h;
120>c?(p=(120-c)/60,h=c/60,c=0):240>c?(p=0,h=(240-c)/60,c=(c-120)/60):(p=(c-240)/60,h=0,c=(360-c)/60);p=2*l*Math.min(p,1)+(1-l);h=2*l*Math.min(h,1)+(1-l);c=2*l*Math.min(c,1)+(1-l);.5>q?(p*=q,h*=q,c*=q):(p=(1-q)*p+2*q-1,h=(1-q)*h+2*q-1,c=(1-q)*c+2*q-1);return new m({r:Math.round(255*p),g:Math.round(255*h),b:Math.round(255*c)})}});r.fromHsv=function(c,l,q){d.isArray(c)?(l=c[1],q=c[2],c=c[0]):d.isObject(c)&&(l=c.s,q=c.v,c=c.h);360==c&&(c=0);l/=100;q/=100;var p,h,n;if(0==l)h=n=p=q;else{var k=c/60;c=Math.floor(k);
var a=k-c,k=q*(1-l),g=q*(1-l*a);l=q*(1-l*(1-a));switch(c){case 0:p=q;h=l;n=k;break;case 1:p=g;h=q;n=k;break;case 2:p=k;h=q;n=l;break;case 3:p=k;h=g;n=q;break;case 4:p=l;h=k;n=q;break;case 5:p=q,h=k,n=g}}return new m({r:Math.round(255*p),g:Math.round(255*h),b:Math.round(255*n)})};d.extend(m,{toCmy:function(){return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*(1-this.g/255)),y:Math.round(100*(1-this.b/255))}},toCmyk:function(){var c,d=this.r/255,l=this.g/255,m=this.b/255;c=Math.min(1-d,1-l,1-
m);return{c:Math.round((1-d-c)/(1-c)*100),m:Math.round((1-l-c)/(1-c)*100),y:Math.round((1-m-c)/(1-c)*100),b:Math.round(100*c)}},toHsl:function(){var c=this.r/255,d=this.g/255,l=this.b/255,m=Math.min(c,l,d),h=Math.max(c,d,l),n=h-m,k=0,a=0,m=(m+h)/2;0<m&&1>m&&(a=n/(.5>m?2*m:2-2*m));0<n&&(h==c&&h!=d&&(k+=(d-l)/n),h==d&&h!=l&&(k+=2+(l-c)/n),h==l&&h!=c&&(k+=4+(c-d)/n),k*=60);return{h:k,s:Math.round(100*a),l:Math.round(100*m)}},toHsv:function(){var c=this.r/255,d=this.g/255,l=this.b/255,m=Math.max(c,d,
l),h=m-Math.min(c,l,d),n=null,k=0==m?0:h/m;0==k?n=0:(n=c==m?60*(d-l)/h:d==m?120+60*(l-c)/h:240+60*(c-d)/h,0>n&&(n+=360));return{h:n,s:Math.round(100*k),v:Math.round(100*m)}}});return r})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(r,d,m,l){var c={};d.setObject("dojo.colors",c);var t=function(c,d,l){0>l&&++l;1<l&&--l;var h=6*l;return 1>h?c+(d-c)*h:1>2*l?d:2>3*l?c+(d-c)*(2/3-l)*6:c};r.colorFromRgb=m.fromRgb=function(c,d){var h=c.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);
if(h){c=h[2].split(/\s*,\s*/);var k=c.length,h=h[1];if("rgb"==h&&3==k||"rgba"==h&&4==k)return h=c[0],"%"==h.charAt(h.length-1)?(h=l.map(c,function(a){return 2.56*parseFloat(a)}),4==k&&(h[3]=c[3]),m.fromArray(h,d)):m.fromArray(c,d);if("hsl"==h&&3==k||"hsla"==h&&4==k){var h=(parseFloat(c[0])%360+360)%360/360,a=parseFloat(c[1])/100,g=parseFloat(c[2])/100,a=.5>=g?g*(a+1):g+a-g*a,g=2*g-a,h=[256*t(g,a,h+1/3),256*t(g,a,h),256*t(g,a,h-1/3),1];4==k&&(h[3]=c[3]);return m.fromArray(h,d)}}return null};var q=
function(c,d,l){c=Number(c);return isNaN(c)?l:c<d?d:c>l?l:c};m.prototype.sanitize=function(){this.r=Math.round(q(this.r,0,255));this.g=Math.round(q(this.g,0,255));this.b=Math.round(q(this.b,0,255));this.a=q(this.a,0,1);return this};c.makeGrey=m.makeGrey=function(c,d){return m.fromArray([c,c,c,d])};d.mixin(m.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,
226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,
150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],
hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,
136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],
navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,
87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return m})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dojo/_base/config dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g){return r([m,l,c,t],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:q,nls:null,_nls0:"0%",_nls50:"50%",_nls100:"100%",alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency;var a=d.locale||"",a=a.toLowerCase();"ar"===a?(this._nls0="\u066a0",this._nls50="\u066a50",this._nls100="\u066a100"):"tr"===a&&(this._nls0="%0",this._nls50="%50",this._nls100="%100")},postCreate:function(){this.inherited(arguments);"number"===
typeof this.alpha&&this.setAlpha(this.alpha)},setAlpha:function(a){this.opacitySlider.set("value",Math.round(100-100*a))},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var a=this.getAlpha();this.emit("change",a)}})})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z){var A=d("dijit.form._SliderMover",k,{onMouseMove:function(a){var b=this.widget,e=b._abspos;e||(e=b._abspos=c.position(b.sliderBarContainer,!0),b._setPixelValue_=p.hitch(b,"_setPixelValue"),b._isReversed_=b._isReversed());a=a[b._mousePixelCoord]-e[b._startingPixelCoord];b._setPixelValue_(b._isReversed_?e[b._pixelCount]-a:a,e[b._pixelCount],!1)},destroy:function(a){k.prototype.destroy.apply(this,arguments);var b=this.widget;b._abspos=null;b._setValueAttr(b.value,
!0)}});m=d("dijit.form.HorizontalSlider",[x,D],{templateString:z,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:b.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(a){this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey)){switch(a.keyCode){case q.HOME:this._setValueAttr(this.minimum,!1);break;case q.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?q.RIGHT_ARROW:q.LEFT_ARROW:case !1===this._descending?q.DOWN_ARROW:q.UP_ARROW:case !1===this._descending?q.PAGE_DOWN:q.PAGE_UP:this.increment(a);
break;case this._descending||this.isLeftToRight()?q.LEFT_ARROW:q.RIGHT_ARROW:case !1===this._descending?q.UP_ARROW:q.DOWN_ARROW:case !1===this._descending?q.PAGE_UP:q.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){this.disabled||this.readOnly||(h("ie")||e.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&
this.clickSelect){e.focus(this.sliderHandle);a.stopPropagation();a.preventDefault();var b=c.position(this.sliderBarContainer,!0),d=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-d:d,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var e=this.discreteValues;if(1>=e||Infinity==e)e=b;e--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(a/
(b/e))/e+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(a,b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var c=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,e=!1===this._descending?this.remainingBar:this.progressBar,d=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&
e.style[this._progressPixelSize]){var f=this,g={},h=parseFloat(e.style[this._progressPixelSize]),k=this.slideDuration*(c-h/100);0!=k&&(0>k&&(k=0-k),g[this._progressPixelSize]={start:h,end:100*c,units:"%"},this._inProgressAnim=l.animateProperty({node:e,duration:k,onAnimate:function(a){d.style[f._progressPixelSize]=100-parseFloat(a[f._progressPixelSize])+"%"},onEnd:function(){delete f._inProgressAnim},properties:g}),this._inProgressAnim.play())}else e.style[this._progressPixelSize]=100*c+"%",d.style[this._progressPixelSize]=
100*(1-c)+"%"},_bumpValue:function(a,b){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var e=t.getComputedStyle(this.sliderBarContainer),d=c.getContentBox(this.sliderBarContainer,e),e=this.discreteValues;if(1>=e||Infinity==e)e=d[this._pixelCount];e--;a=Math.round((this.value-this.minimum)*e/(this.maximum-this.minimum))+a;0>a&&(a=0);a>e&&(a=e);a=a*(this.maximum-this.minimum)/e+this.minimum;this._setValueAttr(a,b)}},_onClkBumper:function(a){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==q.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==q.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},
startup:function(){this._started||(r.forEach(this.getChildren(),function(a){this[a.container]!=this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var b=a('label[for\x3d"'+this.id+'"]');b.length&&(b[0].id||(b[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",b[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(u.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),u.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(f(this.domNode,
g.wheel,p.hitch(this,"_mouseWheeled")));var a=d(A,{widget:this});this._movable=new n(this.sliderHandle,{mover:a});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});m._Mover=A;return m})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(r,d,m,l,c,t){r=r("dijit.form.HorizontalRuleLabels",
t,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(c){return c},_genHTML:function(c,d){d=
this.labels[d];return this._positionPrefix+this._calcPosition(c)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(d)+this._labelPrefix+d+this._suffix},_genDirectionHTML:function(c){return""},getLabels:function(){var c=this.labels;!c.length&&this.srcNodeRef&&(c=l("\x3e li",this.srcNodeRef).map(function(c){return String(c.innerHTML)}));if(!c.length&&1<this.count)for(var c=[],d=this.minimum,h=(this.maximum-d)/(this.count-1),n=0;n<this.count;n++)c.push(n<this.numericMargin||n>=this.count-this.numericMargin?
"":m.format(d,this.constraints)),d+=h;return c},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();this.count=this.labels.length}});d("dojo-bidi")&&r.extend({_setTextDirAttr:function(d){this.textDir!=d&&(this._set("textDir",d),l(".dijitRuleLabelContainer",this.domNode).forEach(c.hitch(this,function(c){c.style.direction=this.getTextDir(c.innerText||c.textContent||"")})))},_genDirectionHTML:function(c){return this.textDir?"direction:"+this.getTextDir(c)+";":""}});
return r})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(r,d,m){return r("dijit.form.HorizontalRule",[d,m],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(d){return this._positionPrefix+d+this._positionSuffix+
this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var d;if(1==this.count)d=this._genHTML(50,0);else{var c,m=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){d=this._genHTML(0,0);for(c=1;c<this.count-1;c++)d+=this._genHTML(m*c,c);d+=this._genHTML(100,this.count-1)}else{d=this._genHTML(100,0);for(c=1;c<this.count-1;c++)d+=this._genHTML(100-m*c,c);d+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=d}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare",
"dojo/keys","./_Spinner","./NumberTextBox"],function(r,d,m,l){return r("dijit.form.NumberSpinner",[m,l.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(c,d){var l=this.constraints,m=isNaN(c),h=!isNaN(l.max),n=!isNaN(l.min);m&&0!=d&&(c=0<d?n?l.min:h?l.max:0:h?this.constraints.max:n?l.min:0);d=c+d;if(m||isNaN(d))return c;h&&d>l.max&&(d=l.max);n&&d<l.min&&(d=l.min);return d},_onKeyDown:function(c){if(!(this.disabled||this.readOnly||c.keyCode!=d.HOME&&c.keyCode!=d.END||
c.ctrlKey||c.altKey||c.metaKey||"undefined"==typeof this.get("value"))){var l=this.constraints[c.keyCode==d.HOME?"min":"max"];"number"==typeof l&&this._setValueAttr(l,!1);c.stopPropagation();c.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),function(r,d,m,l,c,t,q,p,h,n){return r("dijit.form._Spinner",p,{defaultTimeout:500,
minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:h,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(c){return c},_arrowPressed:function(c,a,d){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),a*d),!1),n.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(c,a,g){var f=
this.smallDelta;a==this.textbox&&(a=g.keyCode,f=a==d.PAGE_UP||a==d.PAGE_DOWN?this.largeDelta:this.smallDelta,a=a==d.UP_ARROW||a==d.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==c?this._arrowReleased(a):this._arrowPressed(a,a==this.upArrowNode?1:-1,f)},_wheelTimer:null,_mouseWheeled:function(c){if(this.focused){c.stopPropagation();c.preventDefault();var a=c.wheelDelta/120;Math.floor(a)!=a&&(a=0<c.wheelDelta?1:-1);c=c.detail?-1*c.detail:a;if(0!==c){var d=this[0<c?"upArrowNode":"downArrowNode"];this._arrowPressed(d,
c,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(d)},50)}}},_setConstraintsAttr:function(c){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(c,
a){this.focusNode.setAttribute("aria-valuenow",c);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(t(this.domNode,c.wheel,m.hitch(this,"_mouseWheeled")),q.addListener(this.upArrowNode,this.textbox,{keyCode:d.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),q.addListener(this.downArrowNode,this.textbox,{keyCode:d.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,
"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),q.addListener(this.upArrowNode,this.textbox,{keyCode:d.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),q.addListener(this.downArrowNode,this.textbox,{keyCode:d.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare",
"dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(r,d,m){return r("dijit.form.RangeBoundTextBox",m,{rangeMessage:"",rangeCheck:function(d,c){return("min"in c?0<=this.compare(d,c.min):!0)&&("max"in c?0>=this.compare(d,c.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var d=this.get("value");if(null==d)return!1;var c=!1;"min"in this.constraints&&(c=this.constraints.min,c=0>this.compare(d,"number"==typeof c&&
0<=c&&0!=d?0:c));!c&&"max"in this.constraints&&(c=this.constraints.max,c=0<this.compare(d,"number"!=typeof c||0<c?c:0));return c},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(d){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(d))},getErrorMessage:function(d){var c=this.get("value");return null==c||""===c||"number"==typeof c&&isNaN(c)||this.isInRange(d)?this.inherited(arguments):this.rangeMessage},
postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=d.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(r,d,m,l,c,t){var q=function(c){c=c||{};var d=m.getLocalization("dojo.cldr","number",m.normalizeLocale(c.locale)),h=c.pattern?c.pattern:d[(c.type||"decimal")+
"Format"];c="number"==typeof c.places?c.places:"string"===typeof c.places&&0<c.places.length?c.places.replace(/.*,/,""):-1!=h.indexOf(".")?h.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:d.decimal,places:c}},p=r("dijit.form.NumberTextBoxMixin",null,{pattern:function(c){return"("+(this.focused&&this.editOptions?this._regExpGenerator(d.delegate(c,this.editOptions))+"|":"")+this._regExpGenerator(c)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:c.format,_regExpGenerator:c.regexp,
_decimalInfo:q(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(c){var d="number"==typeof c.places?c.places:0;d&&d++;"number"!=typeof c.max&&(c.max=9*Math.pow(10,15-d));"number"!=typeof c.min&&(c.min=-9*Math.pow(10,15-d));this.inherited(arguments,[c]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=q(c)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var c=this.get("value");
"number"!=typeof c||isNaN(c)||(c=this.format(c,this.constraints),void 0!==c&&(this.textbox.value=c));this.inherited(arguments)}},format:function(c,l){var h=String(c);if("number"!=typeof c)return h;if(isNaN(c))return"";if(!("rangeCheck"in this&&this.rangeCheck(c,l))&&!1!==l.exponent&&/\de[-+]?\d/i.test(h))return h;this.editOptions&&this.focused&&(l=d.mixin({},l,this.editOptions));return this._formatter(c,l)},_parser:c.parse,parse:function(c,l){var h=d.mixin({},l,this.editOptions&&this.focused?this.editOptions:
{});if(this.focused&&null!=h.places){var a=h.places,a="number"===typeof a?a:Number(a.split(",").pop());h.places="0,"+a}h=this._parser(c,h);this.editOptions&&this.focused&&isNaN(h)&&(h=this._parser(c,l));return h},_getDisplayedValueAttr:function(){var c=this.inherited(arguments);return isNaN(c)?this.textbox.value:c},filter:function(d){if(null==d||"string"==typeof d&&""==d)return NaN;"number"!=typeof d||isNaN(d)||0==d||(d=c.round(d,this._decimalInfo.places));return this.inherited(arguments,[d])},serialize:function(c,
d){return"number"!=typeof c||isNaN(c)?"":this.inherited(arguments)},_setBlurValue:function(){var c=d.hitch(d.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(c,!0)},_setValueAttr:function(c,d,k){if(void 0!==c&&void 0===k)if(k=String(c),"number"==typeof c)if(isNaN(c))k="";else{if("rangeCheck"in this&&this.rangeCheck(c,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(k))k=void 0}else c?c=void 0:(k="",c=NaN);this.inherited(arguments,[c,d,k])},_getValueAttr:function(){var h=
this.inherited(arguments);if(isNaN(h)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+c._realNumberRegexp(d.delegate(this.constraints))+"$")).test(this.textbox.value))return h=Number(this.textbox.value),isNaN(h)?void 0:h}else return h},isValid:function(c){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var d=this.get("value");return!isNaN(d)&&this.rangeCheck(d,this.constraints)?!1!==this.constraints.exponent&&
/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var c="number"==typeof this.constraints.min,d="number"==typeof this.constraints.max,k=this.get("value");if(isNaN(k)||!c&&!d)return this.inherited(arguments);var a=k|0,g=0>k,f=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),b=(this.maxLength||20)-this.textbox.value.length,e=f?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",a=f?a+"."+e:a+"",b=l.rep("9",b),f=k;g?f=Number(a+
b):k=Number(a+b);return!(c&&k<this.constraints.min||d&&f>this.constraints.max)}});r=r("dijit.form.NumberTextBox",[t,p],{baseClass:"dijitTextBox dijitNumberTextBox"});r.Mixin=p;return r})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),function(r,d,m,l,c,t,q,p){return r([p],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,
declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=d.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=d.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=d.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},this.domNode);d.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(l(this,"Change",m.hitch(this,"_onServiceUrlChange")))},
setProcessFunction:function(c,d){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof c&&(this._fetchHandle=t.after(this,"onFetch",c),this.own(this._fetchHandle));"function"===typeof d&&(this._fetchErrHandle=t.after(this,"onFetchError",d),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),
this._fetchErrHandle=null)},onFetch:function(c){return c},onFetchError:function(c){},getStatus:function(){return this._status},_onServiceUrlChange:function(d){var h=new c;h.then(m.hitch(this,function(){this._valid()}),m.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();d?q({url:m.trim(d||""),handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(m.hitch(this,function(c){this.onFetch({url:this.getValue(),data:c})?h.resolve("success"):h.reject("error")}),
m.hitch(this,function(c){h.reject(c)})):h.reject("error")},_validating:function(){this._status="validating";d.removeClass(this.domNode,"jimu-serviceurl-input-invalid");d.removeClass(this.domNode,"jimu-serviceurl-input-valid");d.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";d.removeClass(this.domNode,"jimu-serviceurl-input-invalid");d.removeClass(this.domNode,"jimu-serviceurl-input-validating");d.addClass(this.domNode,"jimu-serviceurl-input-valid")},
_inValid:function(){this._status="invalid";d.removeClass(this.domNode,"jimu-serviceurl-input-validating");d.removeClass(this.domNode,"jimu-serviceurl-input-valid");d.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dijit/registry jimu/utils jimu/dijit/CheckBox dijit/form/Select".split(" "),function(r,d,m,
l,c,t,q,p,h,n,k,a,g){return r([d,m,l],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"headTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" data-dojo-attach-point\x3d"tableInHeadSection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"headColgroup"\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"  data-dojo-attach-point\x3d"thead"\x3e\x3c/thead\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"bodyTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0"data-dojo-attach-point\x3d"tableInBodySection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"bodyColgroup"\x3e\x3c/colgroup\x3e\x3ctbody class\x3d"simple-table-tbody" data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",_classVerticalScroll:"vertical-scroll",autoHeight:!0,selectable:!1,fields:null,singleClickEdit:!1,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);
this._initSelf()},startup:function(){this.inherited(arguments);this.updateUI()},_initSelf:function(){this.own(k.bindClickAndDblclickEvents(this.tableInBodySection,c.hitch(this,function(a){if(a=k.getAncestorDom(a.target||a.srcElement,function(a){return t.hasClass(a,"simple-table-row")&&t.hasClass(a,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),c.hitch(this,function(a){if(a=k.getAncestorDom(a.target||a.srcElement,function(a){return t.hasClass(a,"simple-table-row")&&t.hasClass(a,
"not-empty")},this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var d=Math.random().toString();this._name="jimu_table_"+d.slice(2,d.length);if(this.fields&&0<this.fields.length){var b=t.create("tr",{},this.thead);q.forEach(this.fields,c.hitch(this,function(e){var d="auto";"actions"===e.type&&(e.name="actions");e.hidden?d=1:void 0!==e.width&&null!==e.width?d=e.width:"actions"!==e.type||e.name||(e.width=this._calculateActionsWidth(e)+20,d=e.width);t.create("col",{width:d},this.headColgroup);
t.create("col",{width:d},this.bodyColgroup);d=t.create("th",{innerHTML:e.title,title:e.title},b);if("checkbox"===e.type){d.innerHTML="";var f=new a({label:e.title}),g=h(".checkbox",f.domNode)[0];g&&(g.style.marginTop="10px");this.own(p(f.domNode,"click",c.hitch(this,function(){f.getValue()?this._checkAllTdCheckBoxes(e.name):this._uncheckAllTdCheckBoxes(e.name)})));f.placeAt(d)}t.addClass(d,"simple-table-field");e.hidden&&t.addClass(d,"hidden-column");e["class"]&&t.addClass(d,e["class"]);t.addClass(d,
e.name)}))}else this.fields=null},_getThCheckBox:function(a){var b=null;a=h(".simple-table-field."+a+" .jimu-checkbox",this.thead)[0];return b=n.byNode(a)},_getAllEnabledTdCheckBoxes:function(a){a=h(".simple-table-cell."+a+" .jimu-checkbox",this.tbody);a=q.map(a,function(a){return n.byNode(a)});return a=q.filter(a,function(a){return a.getStatus()})},_checkAllTdCheckBoxes:function(a){a=this._getAllEnabledTdCheckBoxes(a);q.forEach(a,function(a){a.getValue()||a.setValue(!0)})},_uncheckAllTdCheckBoxes:function(a){a=
this._getAllEnabledTdCheckBoxes(a);q.forEach(a,function(a){a.getValue()&&a.setValue(!1)})},_delaySyncThCheckBoxStatusWithAllTdCheckBoxes:function(a){setTimeout(c.hitch(this,function(){this._syncThCheckBoxStatusWithAllTdCheckBoxes(a)}),100)},_syncThCheckBoxStatusWithAllTdCheckBoxes:function(a){var b=this._getAllEnabledTdCheckBoxes(a),b=q.filter(b,c.hitch(this,function(a){return a.getStatus()}));0!==b.length&&(a=this._getThCheckBox(a),q.every(b,function(a){return a.getValue()})?a.getValue()||a.setValue(!0):
a.getValue()&&a.setValue(!1))},clear:function(){var a=this._getNotEmptyRows(),b=q.map(a,c.hitch(this,function(a){return this.getRowData(a)}));t.empty(this.tbody);q.forEach(a,c.hitch(this,function(a,c){this._onDeleteRow(a,b[c])}));this.updateUI();this._rowIndex=0;this._onClearRows(a)},addRows:function(a){var b=[];this.fields&&a&&0<a.length&&q.forEach(a,c.hitch(this,function(a){b.push(this.addRow(a,-1,!0))}));this.updateUI();return b},addRow:function(a,b,e){this._rowIndex++;var d={success:!1,tr:null,
errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof a)return d;var f=q.filter(this.fields,c.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),f=q.filter(f,c.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,a[b.name]).length}));if(0<f.length)return d.errorCode=this.REPEATING_ERROR,d.errorMessage="repeating data",d.repeatFields=f,d;var g=t.create("tr",{"class":"simple-table-row not-empty"},this.tbody);t.setAttr(g,"rowId","row"+this._rowIndex);
q.forEach(this.fields,c.hitch(this,function(b){var c=a[b.name],e=b.type,d=null;"actions"===e?d=this._createActionsTd(g,b):("text"===e?d=this._createTextTd(g,b,c):"radio"===e?d=this._createRadioTd(g,b,c):"checkbox"===e?d=this._createCheckboxTd(g,b,c):"empty"===e?d=this._createEmptyTd(g,b):"extension"===e?d=this._createExtensionTd(g,b,c):"dropdown"===e&&(d=this._createDropdownTd(g,b,c)),b.hidden&&t.addClass(d,"hidden-column"))}));e||(this.updateUI(),e=this.getRows(),"number"===typeof b&&0<=b&&b<e.length&&
t.place(g,e[b],"before"));d.success=!0;d.tr=g;d.errorMessage=null;this._onAddRow(g);return d},deleteRow:function(a){if(a){var b=this.getRowData(a);t.destroy(a);this.updateUI();this._onDeleteRow(a,b)}},selectRow:function(a){this.selectable&&(h(".simple-table-row",this.tbody).removeClass("jimu-state-active"),t.addClass(a,"jimu-state-active"),this._onSelectRow(a))},updateUI:function(){this._updateRowClassName();this._updateHeight();t.removeClass(this.domNode,this._classVerticalScroll);0<this.bodyDiv.clientHeight&&
this.bodyDiv.clientHeight<this.bodyDiv.scrollHeight&&t.addClass(this.domNode,this._classVerticalScroll);q.forEach(this.fields,c.hitch(this,function(a){"checkbox"===a.type&&this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(a.name)}))},_updateHeadTableWidth:function(){if(this.domNode){var a=t.getContentBox(this.tableInBodySection).w,b="100%";"number"===typeof a&&0<a&&(b=a+"px");t.setStyle(this.tableInHeadSection,"width",b)}},_updateHeight:function(){var a=this.getRows();this.autoHeight&&t.setStyle(this.domNode,
"height",this._headHeight+this._rowHeight*(0<a.length?a.length:1)+1+"px");a&&0<a.length&&this.bodyTableDiv&&(a=t.getMarginSize(a[0]))&&a.h&&t.setStyle(this.bodyTableDiv,"backgroundSize","1px "+a.h+"px")},_updateRowClassName:function(){var a=h("."+this._classFirstSimpleTableRow,this.tbody)[0];a&&(a=h("."+this._classRowUpDiv,a)[0])&&t.removeClass(a,this._classJimuStateDisabled);(a=h("."+this._classLastSimpleTableRow,this.tbody)[0])&&(a=h("."+this._classRowDownDiv,a)[0])&&t.removeClass(a,this._classJimuStateDisabled);
a=h("."+this._classSimpleTableRow,this.tbody);a.removeClass("odd");a.removeClass("even");a.removeClass(this._classFirstSimpleTableRow);a.removeClass(this._classLastSimpleTableRow);q.forEach(a,c.hitch(this,function(a,b){0===b%2?t.addClass(a,"odd"):t.addClass(a,"even")}));if(0<a.length){var b=a[0];t.addClass(b,this._classFirstSimpleTableRow);(b=h("."+this._classRowUpDiv,b)[0])&&t.addClass(b,this._classJimuStateDisabled);a=a[a.length-1];t.addClass(a,this._classLastSimpleTableRow);(a=h("."+this._classRowDownDiv,
a)[0])&&t.addClass(a,this._classJimuStateDisabled)}},_createTextTd:function(a,b,c){var e=null;return e=b.editable?this._createEditableTextTd(a,b,c):this._createNormalTextTd(a,b,c)},_createNormalTextTd:function(a,b,c){var e=t.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');t.addClass(e,b.name);var d=h("div",e)[0];d.innerHTML=c||"";d.title=c||"";b["class"]&&t.addClass(e,b["class"]);t.place(e,a);return e},_createEditableTextTd:function(a,
b,e){var d=t.toDom('\x3ctd class\x3d"editable-text-td '+b.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');t.addClass(d,"simple-table-cell");t.place(d,a);b["class"]&&t.addClass(d,b["class"]);var f=h("div",d)[0],g=h("input",d)[0];f.innerHTML=e||"";""!==f.innerHTML&&(f.title=f.innerText||f.innerHTML);g.value=f.innerHTML;this.own(p(f,this.singleClickEdit?"click":"dblclick",c.hitch(this,function(a){this.singleClickEdit||
a.stopPropagation();g.value=f.innerText||f.innerHTML;t.setStyle(f,"display","none");t.setStyle(g,"display","inline");g.focus();g.select&&g.select()})));this.own(p(g,"blur",c.hitch(this,function(){g.value=c.trim(g.value);var e=f.innerText||f.innerHTML,d=g.value;""!==d?b.unique?0<this.getRowDataArrayByFieldValue(b.name,d,a).length?g.value=e:f.innerHTML=d:f.innerHTML=d:g.value=e;t.setStyle(g,"display","none");t.setStyle(f,"display","block")})));return d},_createRadioTd:function(a,b,c){var e=t.toDom('\x3ctd class\x3d"radio-td '+
b.name+'"\x3e\x3cinput class\x3d"jimu-radio-btn" type\x3d"radio" /\x3e\x3c/td\x3e');t.addClass(e,"simple-table-cell");t.place(e,a);b["class"]&&t.addClass(e,b["class"]);a=h("input",e)[0];a.name=b.radio&&"row"===b.radio?this._name+this._rowIndex:this._name+b.name;a.checked=!0===c;return e},_createCheckboxTd:function(d,b,e){var f=t.toDom('\x3ctd class\x3d"checkbox-td '+b.name+'"\x3e\x3c/td\x3e');t.addClass(f,"simple-table-cell");t.place(f,d);b["class"]&&t.addClass(f,b["class"]);var g=new a({onChange:c.hitch(this,
function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(b.name);"function"===typeof b.onChange&&setTimeout(c.hitch(this,function(){b.onChange(d,g)}),200)})});this.own(p(g,"status-change",c.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(b.name)})));this._setValueForCheckBox(g,e);g.placeAt(f);return f},_createActionsTd:function(a,b){var e=t.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');t.addClass(e,
"simple-table-cell");var d=h(".action-item-parent",e)[0];t.place(e,a);b["class"]&&t.addClass(e,b["class"]);q.forEach(b.actions,c.hitch(this,function(b){"up"===b?(b=t.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},d),b.title=this.nls.moveUp,this.own(p(b,"click",c.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowUp(a)){b=h(".simple-table-row",this.tbody);var c=q.indexOf(b,a);0<c&&(b=b[c-1])&&(t.place(a,b,"before"),this.updateUI(),this.emit("row-up",
a))}})))):"down"===b?(b=t.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},d),b.title=this.nls.moveDown,this.own(p(b,"click",c.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowDown(a)){b=h(".simple-table-row",this.tbody);var c=q.indexOf(b,a);c<b.length-1&&(b=b[c+1])&&(t.place(a,b,"after"),this.updateUI(),this.emit("row-down",a))}})))):"edit"===b?(b=t.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},
d),b.title=this.nls.edit,this.own(p(b,"click",c.hitch(this,function(b){b.stopPropagation();this.onBeforeRowEdit(a)&&this._onActionsEdit(a)})))):"delete"===b&&(b=t.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},d),b.title=this.nls.deleteRow,this.own(p(b,"click",c.hitch(this,function(b){b.stopPropagation();this.onBeforeRowDelete(a)&&this.deleteRow(a)}))))}));b=this._calculateActionsWidth(b)+"px";t.setStyle(d,"width",b);return e},_calculateActionsWidth:function(a){return 20*
q.map(a.actions,function(a){return"up"===a||"down"===a||"edit"===a||"delete"===a}).length},_createEmptyTd:function(a,b){a=t.create("td",{"class":b.name},a);t.addClass(a,"simple-table-cell");t.addClass(a,"empty-text-td");b["class"]&&t.addClass(a,b["class"]);return a},_createExtensionTd:function(a,b,c){a=t.create("td",{"class":b.name},a);t.addClass(a,"simple-table-cell");t.addClass(a,"extension-td");b["class"]&&t.addClass(a,b["class"]);b.create&&"function"===typeof b.create&&b.create(a);b.setValue&&
"function"===typeof b.setValue&&b.setValue(a,c);return a},_createDropdownTd:function(a,b,c){a=t.create("td",{"class":b.name},a);t.addClass(a,"simple-table-cell");t.addClass(a,"dropdown-td");b["class"]&&t.addClass(a,b["class"]);(new g({options:c})).placeAt(a);return a},editRow:function(a,b){var e={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof b||!t.isDescendant(a,this.tbody))return e;var d=c.mixin([],this.fields),d=q.filter(d,c.hitch(this,
function(a){return"text"===a.type&&!0===a.unique})),d=q.filter(d,c.hitch(this,function(c){return 0<this.getRowDataArrayByFieldValue(c.name,b[c.name],a).length}));if(0<d.length)return e.errorCode=this.REPEATING_ERROR,e.errorMessage="repeating data",e.repeatFields=d,e;var f=h(".simple-table-cell",a);q.forEach(this.fields,c.hitch(this,function(a,c){if(b.hasOwnProperty(a.name)){c=f[c];var e=b[a.name],d=a.type;"text"===d?a.editable?this._editEditableText(c,a,e):this._editNormalText(c,a,e):"radio"===d?
this._editRadio(c,a,e):"checkbox"===d?this._editCheckbox(c,a,e):"extension"===d?this._editExtension(c,a,e):"dropdown"===d&&this._editDropdown(c,a,e)}}));e.success=!0;e.tr=a;e.errorMessage=null;this._onEditRow(a);return e},_editNormalText:function(a,b,c){a=h("div",a)[0];a.innerHTML=c||"";a.title=a.innerHTML},_editEditableText:function(a,b,c){b=h("div",a)[0];b.innerHTML=c||"";h("input",a)[0].value=b.innerHTML},_editRadio:function(a,b,c){h("input",a)[0].checked=!0===c},_editCheckbox:function(a,b,c){a=
h(".jimu-checkbox",a)[0];a=n.byNode(a);this._setValueForCheckBox(a,c)},_setValueForCheckBox:function(a,b){null===b?a.setStatus(!1):(a.setStatus(!0),b!==a.getValue()&&a.setValue(b))},_editExtension:function(a,b,c){b.setValue&&"function"===typeof b.setValue&&b.setValue(a,c)},_editDropdown:function(a,b,c){a=h(".dijitSelect",a)[0];n.byNode(a).set("value",c)},_getAllRows:function(){return h(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var a=this._getAllRows();return q.filter(a,c.hitch(this,
function(a){return!t.hasClass(a,"empty")}))},_getEmptyRows:function(){var a=this._getAllRows();return q.filter(a,c.hitch(this,function(a){return t.hasClass(a,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var a=null,b=h(".simple-table-row",this.tbody),b=q.filter(b,c.hitch(this,function(a){return!t.hasClass(a,"empty")&&t.hasClass(a,"jimu-state-active")}));0<b.length&&(a=b[0]);return a},getSelectedRowData:function(){var a=null,b=this.getSelectedRow();b&&(a=
this._getRowDataByTr(b));return a},getData:function(a){var b=this._getNotEmptyRows();a&&(b=q.filter(b,c.hitch(this,function(b){return b!==a})));return q.map(b,c.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(a){return this._getRowDataByTr(a)},_getRowDataByTr:function(a){var b=null;if(a)b={};else return null;q.forEach(this.fields,c.hitch(this,function(c){var e=c.type;if("actions"!==e){var d=c.name;b[d]=null;var f=h(".simple-table-cell."+d,a)[0];f&&("text"===e?(c=h("div",
f)[0],b[d]=c.innerText||c.innerHTML):"radio"===e?(c=h("input",f)[0],b[d]=c.checked):"checkbox"===e?(c=h(".jimu-checkbox",f)[0],c=n.byNode(c),c.getStatus()?b[d]=c.getValue():b[d]=null):"extension"===e?c.getValue&&"function"===typeof c.getValue&&(b[d]=c.getValue(f,c)):"dropdown"===e&&(c=h(".dijitSelect",f)[0],c=n.byNode(c),b[d]=c.get("value")))}}));return b},getRowDataArrayByFieldValue:function(a,b,e){var d=[];if(!this.fields||!q.some(this.fields,c.hitch(this,function(b){return b.name===a})))return[];
e=this.getData(e);return d=q.filter(e,c.hitch(this,function(c){return c[a]==b}))},moveToTop:function(a){a&&a.parentNode===this.tbody&&t.place(a,this.tbody,"first")},_onClickRow:function(a){this.emit("row-click",a)},_onDblClickRow:function(a){this.emit("row-dblclick",a)},_onSelectRow:function(a){this.emit("row-select",a)},_onAddRow:function(a){this.emit("row-add",a)},_onEditRow:function(a){this.emit("row-edit",a)},_onDeleteRow:function(a,b){this.emit("row-delete",a,b)},_onEnterRow:function(a){this.emit("row-enter",
a)},_onClearRows:function(a){this.emit("rows-clear",a)},_onActionsEdit:function(a){this.emit("actions-edit",a)},onBeforeRowUp:function(a){return!0},onBeforeRowDown:function(a){return!0},onBeforeRowEdit:function(a){return!0},onBeforeRowDelete:function(a){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(r,d,m,l,c,t,q,p,
h,n){return r([q,p,t],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new h(null,this.containerNode);var c=1/this.tabs.length*100;this.isNested&&l.addClass(this.domNode,
"nested");m.forEach(this.tabs,function(a){this._createTab(a,c)},this)}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);n.setVerticalCenter(this.domNode)},_createTab:function(h,a){a=l.create("div",{innerHTML:h.title,"class":"tab jimu-vcenter-text",style:{width:this.isNested?"auto":a+"%"},label:h.title},this.controlNode);this.viewStack.viewType=h.content.domNode?"dijit":"dom";h.content.label=h.title;this.viewStack.addView(h.content);
this.own(c(a,"click",d.hitch(this,this.onSelect,h.title)));a.label=h.title;this.controlNodes.push(a)},onSelect:function(c){this.selectTab(c)},selectTab:function(c){this._selectControl(c);this.viewStack.switchView(c);this.emit("tabChanged",c)},_selectControl:function(c){m.forEach(this.controlNodes,function(a){l.removeClass(a,"jimu-state-selected");a.label===c&&l.addClass(a,"jimu-state-selected")})}})})},"jimu/dijit/ViewStack":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html",
"dojo/_base/array","dijit/_WidgetBase"],function(r,d,m,l,c){return r(c,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);this.views||(this.views=[]);l.forEach(this.views,d.hitch(this,function(c){1===c.nodeType?(m.place(c,this.domNode),m.addClass(c,"view"),m.setStyle(c,"display","none")):c.domNode&&(m.place(c.domNode,this.domNode),m.addClass(c.domNode,"view"),m.setStyle(c.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);
0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var c="",d=this.getSelectedView();d&&(c=d.label);return c},getViewByLabel:function(c){for(var d=0;d<this.views.length;d++)if(c===this.views[d].label)return this.views[d];return null},addView:function(c){this.views.push(c);1===c.nodeType?(m.place(c,this.domNode),m.addClass(c,"view")):c.domNode&&(m.place(c.domNode,this.domNode),m.addClass(c.domNode,"view"))},removeView:function(c){var d=
this.views.length;this.views=l.filter(this.views,function(d){return c!==d});d!==this.views.length&&(1===c.nodeType?m.destroy(c):c.domNode&&c.destroyRecursive())},switchView:function(c){var l,p;l="number"===typeof c?this.views[c]:"string"===typeof c?this.getViewByLabel(c):c;this.views.forEach(d.hitch(this,function(c){if(c)if(1===c.nodeType?p=c:c.domNode&&(p=c.domNode),c===l){if(m.setStyle(p,"display","block"),c.domNode)if(!c._started)c.startup(),c._started=!0;else if("function"===typeof c.onShown)c.onShown()}else if(m.setStyle(p,
"display","none"),c.domNode&&"function"===typeof c.onHidden)c.onHidden()}));this._currentView=l;this.onViewSwitch(l)},onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack".split(" "),function(r,d,m,l,c,t,q,p,h,n,k){return r([p,h,t],{templateString:n,baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",
_currentIndex:-1,selected:"",tabs:null,average:!0,postCreate:function(){this.inherited(arguments);this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(a){var c=q("td",this.tabTr);m.forEach(c,d.hitch(this,function(c,b){l.removeClass(c,"jimu-state-active");c.label===a&&(l.addClass(c,"jimu-state-active"),this._currentIndex=b)}));this.controlNode.removeChild(this.controlTable);l.place(this.controlTable,this.controlNode);
this.viewStack.switchView(a);this.emit("tabChanged",a)},addTab:function(a){if(!this.average){var c=q("td:last-child",this.tabTr);0<c.length&&l.destroy(c[0])}0<m.filter(this.tabs,function(c){return c.title===a.title}).length?console.error("tab title conflict: "+a.title):(this.tabs.push(a),this._createTab(a),this.average||(c=l.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e'),l.place(c,this.tabTr)))},
removeTab:function(a){var c=-1;if(m.some(this.tabs,function(b,e){if(b.title===a)return c=e,!0})){var d=this.tabs.splice(c,1)[0],b=q("td",this.tabTr),e;m.some(b,function(b){if(b.label===a)return e=b,!0})&&l.destroy(e);this.viewStack.removeView(d.content)}},showShelter:function(){l.setStyle(this.shelter,"display","block")},hideShelter:function(){l.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},
_initSelf:function(){this.viewStack=new k(null,this.containerNode);m.forEach(this.tabs,function(a){this._createTab(a)},this);if(this.average)this.controlTable.style.tableLayout="fixed",l.addClass(this.domNode,"average");else{var a=l.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');l.place(a,this.tabTr)}},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(a){var g=l.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');
g.label=a.title||"";g.title=a.title;l.place(g,this.tabTr);var f=q(".tab-item-div",g)[0];f.innerHTML=g.label;f.label=g.label;a.content.label=g.label;this.viewStack.addView(a.content);this.own(c(g,"click",d.hitch(this,this._onSelect,a.title)))},_onSelect:function(a){this.selectTab(a)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(r,d,m,l){return r([l],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",
constructor:function(){this.items=[];this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(d.hitch(this,function(c){this._placeItem(c)}));this.resize()},_placeItem:function(c){c.domNode?m.place(c.domNode,this.domNode):m.place(c,this.domNode)},addItem:function(c){this.items.push(c);this._placeItem(c);this.resize()},addItems:function(c){this.items=this.items.concat(c);this.items.forEach(d.hitch(this,function(c){this._placeItem(c)}));this.resize()},removeItem:function(c){var d;
for(d=0;d<this.items.length;d++)if(this.items[d].label===c){this.items[d].domNode?this.items[d].destroy():m.destroy(this.items[d]);this.items.splice(d,1);this.resize();break}},empty:function(){var c;for(c=0;c<this.items.length;c++)this.items[c].domNode?this.items[c].destroy():m.destroy(this.items[c]);this.items=[]},resize:function(){var c,l,q;c=m.getMarginBox(this.domNode);l=this.getItemSize(c);q=Math.floor((c.w+this.hmargin)/(l.width+this.hmargin));this.items.forEach(d.hitch(this,function(c,d){this.setItemPosition(c,
d,l,q)}))},getItemSize:function(c){var d={},l;if("fixWidth"===this.strategy)d.width=this.itemSize.width,d.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(l=0;l<this.itemSize.length;l++){if(c.w<=this.itemSize[l].screenWidth){d.width=this.itemSize[l].width;d.height=this.itemSize[l].height;break}}else"fixCols"===this.strategy&&(d.width=(c.w-this.hmargin*(this.maxCols-1))/this.maxCols,d.height="number"===typeof this.itemSize.height?this.itemSize.height:d.width*parseFloat(this.itemSize.height.substring(0,
this.itemSize.height.length-1))/100);return d},setItemPosition:function(c,d,l,p){d++;var h=d%p;d=Math.ceil(d/p);0===h&&(h=p);p={position:"absolute",top:(this.vmargin+l.height)*(d-1)+"px"};p[window.isRTL?"right":"left"]=(this.hmargin+l.width)*(h-1)+"px";0<=l.width&&(p.width=l.width+"px");0<=l.height&&(p.height=l.height+"px");m.setStyle(c.domNode?c.domNode:c,p)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer esri/toolbars/draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e){var u={};return r([d,m,l,k],{templateString:c,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,_isDisabled:!1,_shiftKey:!1,_ctrlKey:!1,_metaKey:!1,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);
var a={};this.drawLayerId&&(a.id=this.drawLayerId);this.drawLayer=new g(a);this._initDefaultSymbols();this._initTypes();a=n(".draw-item",this.domNode);this.own(a.on("click",t.hitch(this,this._onItemClick)));this.own(h(this.btnClear,"click",t.hitch(this,this._onClickClear)));this.own(h(document.body,"keydown",t.hitch(this,function(a){this._shiftKey=!!a.shiftKey;this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.own(h(document.body,"keyup",t.hitch(this,function(a){this._shiftKey=!!a.shiftKey;
this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.map&&this.setMap(this.map);q.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none");this.enable();u[this.id]=this},enable:function(){this._isDisabled=!1;q.addClass(this.domNode,"enabled");q.removeClass(this.domNode,"disabled")},disable:function(){this._isDisabled=!0;q.addClass(this.domNode,"disabled");q.removeClass(this.domNode,"enabled");this.deactivate()},hideLayer:function(){this.drawLayer&&this.drawLayer.hide()},showLayer:function(){this.drawLayer&&
this.drawLayer.show()},isEnabled:function(){return!this._isDisabled},isActive:function(){var a=n(".draw-item.jimu-state-active",this.domNode);return a&&0<a.length},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.deactivate();this.drawLayer&&this.map&&this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;delete u[this.id];this.inherited(arguments)},
setMap:function(a){a&&(this.map=a,this.map.addLayer(this.drawLayer),this.drawToolBar=new f(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(h(this.drawToolBar,"draw-end",t.hitch(this,this._onDrawEnd))))},setPointSymbol:function(a){this.pointSymbol=a;this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(a){this.polylineSymbol=a;this.drawToolBar.setLineSymbol(a)},
setPolygonSymbol:function(a){this.polygonSymbol=a;this.drawToolBar.setFillSymbol(a)},setTextSymbol:function(a){this.textSymbol=a},reset:function(){this.deactivate();this.clear()},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();n(".draw-item",this.domNode).removeClass("jimu-state-active");this.drawToolBar&&(this.drawToolBar.deactivate(),this.emit("draw-deactivate"))},activate:function(a){var b=null,c=n(".draw-item",this.domNode);"TEXT"===a?(a=
"POINT",b=this.textIcon):(c=c.filter(function(b){return b.getAttribute("data-geotype")===a}),0<c.length&&(b=c[0]));b&&this._activate(b)},onIconSelected:function(a,b,c){this.emit("icon-selected",a,b,c)},onDrawEnd:function(a,b,c,e,d,f){this.emit("draw-end",a,b,c,e,d,f)},onClear:function(){this.emit("clear")},addGraphic:function(a){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(a)},removeGraphic:function(a){this.drawLayer.remove(a)},getFirstGraphic:function(){var a=null;this.drawLayer&&
0<this.drawLayer.graphics.length&&(a=this.drawLayer.graphics[0]);return a},show:function(){q.removeClass(this.domNode,"hidden")},hide:function(){q.addClass(this.domNode,"hidden")},getDrawItemIcons:function(){return n(".draw-item",this.domNode)},_onClickClear:function(){this._isDisabled||(this.clear(),this.emit("user-clear"))},_initDefaultSymbols:function(){var a={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},c={style:"esriSLSSolid",
color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},e={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=b.fromJson(a));this.polylineSymbol||(this.polylineSymbol=b.fromJson(c));this.polygonSymbol||(this.polygonSymbol=b.fromJson(e))},_initTypes:function(){this.geoTypes&&0<this.geoTypes.length?this.types=null:(this.geoTypes=[],this.types&&0<this.types.length||(this.types=
["point","polyline","polygon"]),0<=this.types.indexOf("point")&&(this.geoTypes=this.geoTypes.concat(["POINT"])),0<=this.types.indexOf("polyline")&&(this.geoTypes=this.geoTypes.concat(["LINE","POLYLINE","FREEHAND_POLYLINE"])),0<=this.types.indexOf("polygon")&&(this.geoTypes=this.geoTypes.concat("TRIANGLE EXTENT CIRCLE ELLIPSE POLYGON FREEHAND_POLYGON".split(" "))),0<=this.types.indexOf("text")&&(this.geoTypes=this.geoTypes.concat(["TEXT"])));var a=n(".draw-item",this.domNode);a.style("display","none");
p.forEach(a,t.hitch(this,function(a){var b=a.getAttribute("data-geotype"),b=0<=p.indexOf(this.geoTypes,b);q.setStyle(a,"display",b?"block":"none")}))},_onItemClick:function(a){this._isDisabled||(a=a.target||a.srcElement,q.hasClass(a,"draw-item")&&(q.hasClass(a,"jimu-state-active")?this.deactivate():this._activate(a)))},_activate:function(a){this._deactiveAllDrawBoxes();n(".draw-item",this.domNode).removeClass("jimu-state-active");q.addClass(a,"jimu-state-active");var b=a.getAttribute("data-geotype"),
c=a.getAttribute("data-commontype"),e=f[b];"TEXT"===b&&(e=f.POINT);this.disableWebMapPopup();this.drawToolBar.activate(e);this.emit("draw-activate",e);this.onIconSelected(a,b,c)},_onDrawEnd:function(b){var c=n(".draw-item.jimu-state-active",this.domNode)[0],d=c.getAttribute("data-geotype"),c=c.getAttribute("data-commontype"),f=null,f="extent"===b.geometry.type?e.fromExtent(b.geometry):b.geometry;f.geoType=d;f.commonType=c;b=f.type;var g=null,g="point"===b||"multipoint"===b?q.hasClass(this.textIcon,
"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===b||"polyline"===b?this.polylineSymbol:this.polygonSymbol,f=new a(f,g,null,null);this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(f);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(f,d,c,this._shiftKey,this._ctrlKey,this._metaKey)},_deactiveAllDrawBoxes:function(){var a;p.forEach(Object.keys(u),t.hitch(this,function(b){(a=u[b])&&a.drawToolBar&&b!==this.id&&a.deactivate()}))}})})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z,A,E,y,C,F){var B=r(b,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(a,b){this.markerSymbol=new e(e.STYLE_SOLID,10,new u(u.STYLE_SOLID,new c([255,0,0]),2),new c([0,0,0,.25]));this.lineSymbol=new u(u.STYLE_SOLID,new c([255,0,0]),2);this.fillSymbol=new v(v.STYLE_SOLID,new u(u.STYLE_SOLID,new c([255,0,0]),2),new c([0,0,0,.25]));this._points=[];this._mouse=!q("esri-touch")&&!q("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=d.mixin(d.mixin({},this._defaultOptions),b||{});if(p("ios")||p("android"))this._options.showTooltips=!1;this._onKeyDownHandler=d.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=d.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=d.hitch(this,this._onMouseUpHandler);this._onClickHandler=d.hitch(this,this._onClickHandler);this._onMouseMoveHandler=d.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=d.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=d.hitch(this,this._onDblClickHandler);this._updateTooltip=d.hitch(this,this._updateTooltip);this._hideTooltip=d.hitch(this,this._hideTooltip);this._redrawGraphic=d.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(a){this.respectDrawingVertexOrder=a},setMarkerSymbol:function(a){this.markerSymbol=a},setLineSymbol:function(a){this.lineSymbol=a},
setFillSymbol:function(a){this.fillSymbol=a},activate:function(a,b){this._geometryType&&this.deactivate();var c=this.map,e=l.connect,f=B;this._options=d.mixin(d.mixin({},this._options),b||{});c.navigationManager.setImmediateClick(!1);switch(a){case f.ARROW:case f.LEFT_ARROW:case f.RIGHT_ARROW:case f.UP_ARROW:case f.DOWN_ARROW:case f.TRIANGLE:case f.CIRCLE:case f.ELLIPSE:case f.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=e(c,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=e(c,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=e(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=e(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler2_connect=e(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=e(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler2_connect=e(c,"onMouseDragEnd",this._onMouseUpHandler));q("esri-touch")&&!q("esri-pointer")&&
(this._onMouseDownHandler2_connect=e(c,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=e(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=e(c,"onSwipeEnd",this._onMouseUpHandler));break;case f.POINT:this._onClickHandler_connect=e(c,"onClick",this._onClickHandler);break;case f.LINE:case f.EXTENT:case f.FREEHAND_POLYLINE:case f.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=e(c,"onMouseDown",this._onMouseDownHandler),
this._onMouseDragHandler_connect=e(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=e(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=e(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=e(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=e(c,"onMouseDragEnd",this._onMouseUpHandler));q("esri-touch")&&!q("esri-pointer")&&(this._onMouseDownHandler2_connect=e(c,"onSwipeStart",this._onMouseDownHandler),
this._onMouseDragHandler2_connect=e(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=e(c,"onSwipeEnd",this._onMouseUpHandler));break;case f.POLYLINE:case f.POLYGON:case f.MULTI_POINT:c.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=e(c,"onClick",this._onClickHandler);this._onDblClickHandler_connect=e(c,"onDblClick",this._onDblClickHandler);this._dblClickZoom=c.isDoubleClickZoom;c.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+
a);return}this._onKeyDown_connect=e(c,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=e(c,"onExtentChange",this._redrawGraphic);this._geometryType=a;this._toggleTooltip(!0);c.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(c.snappingManager._startSelectionLayerQuery(),c.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var a=this.map;this._clear();var b=l.disconnect;b(this._onMouseMoveHandler_connect);
b(this._onMouseDownHandler_connect);b(this._onMouseDragHandler_connect);b(this._onMouseUpHandler_connect);b(this._onMouseDownHandler2_connect);b(this._onMouseDragHandler2_connect);b(this._onMouseUpHandler2_connect);b(this._onClickHandler_connect);b(this._onDblClickHandler_connect);b(this._onKeyDown_connect);b(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=
this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;a.snappingManager&&(a.snappingManager._stopSelectionLayerQuery(),a.snappingManager._killOffSnapping());switch(this._geometryType){case B.CIRCLE:case B.ELLIPSE:case B.TRIANGLE:case B.ARROW:case B.LEFT_ARROW:case B.RIGHT_ARROW:case B.UP_ARROW:case B.DOWN_ARROW:case B.RECTANGLE:case B.LINE:case B.EXTENT:case B.FREEHAND_POLYLINE:case B.FREEHAND_POLYGON:this._activateMapTools(!0,
!1,!1,!0);break;case B.POLYLINE:case B.POLYGON:case B.MULTI_POINT:this._dblClickZoom&&a.enableDoubleClickZoom()}b=this._geometryType;this._geometryType=null;a.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(b)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._tGraphic&&this.map.graphics.remove(this._tGraphic,!0);this._graphic=this._tGraphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},
finishDrawing:function(){var a,b=this._points,c=this.map.spatialReference,e=B,b=b.slice(0,b.length);switch(this._geometryType){case e.POLYLINE:if(!this._graphic||2>b.length)return;a=new A(c);a.addPath([].concat(b));break;case e.POLYGON:if(!this._graphic||3>b.length)return;a=new E(c);b=[].concat(b,[b[0].offset(0,0)]);E.prototype.isClockwise(b)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),b.reverse());
a.addRing(b);break;case e.MULTI_POINT:a=new y(c),m.forEach(b,function(b){a.addPoint(b)})}l.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(a)},_drawEnd:function(a){if(a){var b=this.map.spatialReference,c;this.onDrawEnd(a);b&&(b.isWebMercator()?c=z.webMercatorToGeographic(a,!0):4326===b.wkid&&(c=D.fromJson(a.toJson())));this.onDrawComplete({geometry:a,geographicGeometry:c})}},_normalizeRect:function(a,b,c){var e=a.x;a=a.y;var d=b.x;b=b.y;return{x:Math.min(e,
d),y:Math.max(a,b),width:Math.abs(e-d),height:Math.abs(a-b),spatialReference:c}},_onMouseDownHandler:function(a){this._dragged=!1;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=b||a.mapPoint,e=B;b=this.map;var d=b.spatialReference;this._points.push(c.offset(0,0));switch(this._geometryType){case e.LINE:this._graphic=b.graphics.add(new x(new A({paths:[[[c.x,c.y],[c.x,c.y]]],spatialReference:d}),this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);
break;case e.FREEHAND_POLYLINE:this._oldPoint=a.screenPoint;c=new A(d);c.addPath(this._points);this._graphic=b.graphics.add(new x(c,this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);break;case e.CIRCLE:case e.ELLIPSE:case e.TRIANGLE:case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.RECTANGLE:case e.FREEHAND_POLYGON:this._oldPoint=a.screenPoint,c=new E(d),c.addRing(this._points),this._graphic=b.graphics.add(new x(c,this.fillSymbol),
!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)}q("esri-touch")&&a.preventDefault();if(1===this._points.length)this.onDrawStart()},_onMouseMoveHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[this._points.length-1];a=b||a.mapPoint;b=this._tGraphic;var e=b.geometry;switch(this._geometryType){case B.POLYLINE:case B.POLYGON:e.setPoint(0,0,{x:c.x,y:c.y}),e.setPoint(0,1,{x:a.x,y:a.y}),b.setGeometry(e)}},_onMouseDragHandler:function(a){if(this._graphic||
this._points.length)if(q("esri-touch")&&!this._points.length)a.preventDefault();else{this._dragged=!0;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0],e=b||a.mapPoint,f=this.map,g=f.spatialReference;b=this._graphic;var h=B,k=f.toScreen(c),l=f.toScreen(e),n=[],n=l.x-k.x,l=l.y-k.y,m=Math.sqrt(n*n+l*l);switch(this._geometryType){case h.CIRCLE:this._hideTooltip();b.geometry=E.createCircle({center:k,r:m,numberOfPoints:60,map:f});b.setGeometry(b.geometry);
break;case h.ELLIPSE:this._hideTooltip();b.geometry=E.createEllipse({center:k,longAxis:n,shortAxis:l,numberOfPoints:60,map:f});b.setGeometry(b.geometry);break;case h.TRIANGLE:this._hideTooltip();n=[[0,-m],[.8660254037844386*m,.5*m],[-.8660254037844386*m,.5*m],[0,-m]];b.geometry=this._toPolygon(n,k.x,k.y);b.setGeometry(b.geometry);break;case h.ARROW:this._hideTooltip();c=l/m;f=n/m;e=.25*f*m;g=.25*m/(l/n);m*=.25*c;n=[[n,l],[n-e*(1+24/g),l+24*f-m],[n-e*(1+12/g),l+12*f-m],[-12*c,12*f],[12*c,-12*f],[n-
e*(1-12/g),l-12*f-m],[n-e*(1-24/g),l-24*f-m],[n,l]];b.geometry=this._toPolygon(n,k.x,k.y);b.setGeometry(b.geometry);break;case h.LEFT_ARROW:this._hideTooltip();n=0>=n?[[n,0],[.75*n,l],[.75*n,.5*l],[0,.5*l],[0,-.5*l],[.75*n,-.5*l],[.75*n,-l],[n,0]]:[[0,0],[.25*n,l],[.25*n,.5*l],[n,.5*l],[n,-.5*l],[.25*n,-.5*l],[.25*n,-l],[0,0]];b.geometry=this._toPolygon(n,k.x,k.y);b.setGeometry(b.geometry);break;case h.RIGHT_ARROW:this._hideTooltip();n=0<=n?[[n,0],[.75*n,l],[.75*n,.5*l],[0,.5*l],[0,-.5*l],[.75*n,
-.5*l],[.75*n,-l],[n,0]]:[[0,0],[.25*n,l],[.25*n,.5*l],[n,.5*l],[n,-.5*l],[.25*n,-.5*l],[.25*n,-l],[0,0]];b.geometry=this._toPolygon(n,k.x,k.y);b.setGeometry(b.geometry);break;case h.UP_ARROW:this._hideTooltip();n=0>=l?[[0,l],[-n,.75*l],[-.5*n,.75*l],[-.5*n,0],[.5*n,0],[.5*n,.75*l],[n,.75*l],[0,l]]:[[0,0],[-n,.25*l],[-.5*n,.25*l],[-.5*n,l],[.5*n,l],[.5*n,.25*l],[n,.25*l],[0,0]];b.geometry=this._toPolygon(n,k.x,k.y);b.setGeometry(b.geometry);break;case h.DOWN_ARROW:this._hideTooltip();n=0<=l?[[0,l],
[-n,.75*l],[-.5*n,.75*l],[-.5*n,0],[.5*n,0],[.5*n,.75*l],[n,.75*l],[0,l]]:[[0,0],[-n,.25*l],[-.5*n,.25*l],[-.5*n,l],[.5*n,l],[.5*n,.25*l],[n,.25*l],[0,0]];b.geometry=this._toPolygon(n,k.x,k.y);b.setGeometry(b.geometry);break;case h.RECTANGLE:this._hideTooltip();n=[[0,0],[n,0],[n,l],[0,l],[0,0]];b.geometry=this._toPolygon(n,k.x,k.y);b.setGeometry(b.geometry);break;case h.LINE:b.setGeometry(d.mixin(b.geometry,{paths:[[[c.x,c.y],[e.x,e.y]]]}));break;case h.EXTENT:b&&f.graphics.remove(b,!0);b=new C(this._normalizeRect(c,
e,g));b._originOnly=!0;this._graphic=f.graphics.add(new x(b,this.fillSymbol),!0);f.snappingManager&&f.snappingManager._setGraphic(this._graphic);break;case h.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){q("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([e.offset(0,0)],0);b.setGeometry(b.geometry);break;case h.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){q("esri-touch")&&a.preventDefault();
return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([e.offset(0,0)],0);b.setGeometry(b.geometry)}q("esri-touch")&&a.preventDefault()}},_canDrawFreehandPoint:function(a){if(!this._oldPoint)return!1;var b=this._oldPoint.x-a.screenPoint.x,c=this._oldPoint.y-a.screenPoint.y,e=this._options.tolerance;if((0>b?-1*b:b)<e&&(0>c?-1*c:c)<e)return!1;b=new Date;if(b-this._startTime<this._options.drawTime)return!1;this._startTime=b;this._oldPoint=a.screenPoint;return!0},_onMouseUpHandler:function(a){if(this._dragged&&
this._graphic){0===this._points.length&&this._points.push(a.mapPoint.offset(0,0));var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0];b=b||a.mapPoint;var e=this.map.spatialReference,d=B,f;switch(this._geometryType){case d.CIRCLE:case d.ELLIPSE:case d.TRIANGLE:case d.ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.UP_ARROW:case d.DOWN_ARROW:case d.RECTANGLE:f=this._graphic.geometry;break;case d.LINE:f=new A({paths:[[[c.x,c.y],[b.x,b.y]]],spatialReference:e});
break;case d.EXTENT:f=(new C(this._normalizeRect(c,b,e))).getExtent();break;case d.FREEHAND_POLYLINE:f=new A(e);f.addPath([].concat(this._points,[b.offset(0,0)]));break;case d.FREEHAND_POLYGON:f=new E(e),c=[].concat(this._points,[b.offset(0,0),this._points[0].offset(0,0)]),E.prototype.isClockwise(c)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),c.reverse()),f.addRing(c)}q("esri-touch")&&a.preventDefault();
this._clear();this._drawEnd(f)}else this._clear()},_onClickHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);a=b||a.mapPoint;b=this.map;var c=b.toScreen(a),e=B;this._points.push(a.offset(0,0));switch(this._geometryType){case e.POINT:this.onDrawStart();this._drawEnd(a.offset(0,0));this._setTooltipMessage(0);break;case e.POLYLINE:1===this._points.length?(c=new A(b.spatialReference),c.addPath(this._points),this._graphic=b.graphics.add(new x(c,this.lineSymbol),
!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=l.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new x(new A({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.lineSymbol),!0),this.onDrawStart()):(this._graphic.geometry._insertPoints([a.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,
1,a.offset(0,0)),b.setGeometry(c));break;case e.POLYGON:1===this._points.length?(c=new E(b.spatialReference),c.addRing(this._points),this._graphic=b.graphics.add(new x(c,this.fillSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=l.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new x(new A({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.fillSymbol),!0),this.onDrawStart()):(this._graphic.geometry._insertPoints([a.offset(0,
0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,1,a.offset(0,0)),b.setGeometry(c));break;case e.MULTI_POINT:a=this._points;1===a.length?(c=new y(b.spatialReference),c.addPoint(a[a.length-1]),this._graphic=b.graphics.add(new x(c,this.markerSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(a[a.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));
break;case e.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case e.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],c.x,c.y);break;case e.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case e.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],c.x,c.y);break;case e.DOWN_ARROW:this._addShape([[0,
0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],c.x,c.y);break;case e.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],c.x,c.y);break;case e.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],c.x-48,c.y+48);break;case e.CIRCLE:this._clear();this.onDrawStart();this._drawEnd(E.createCircle({center:c,r:48,numberOfPoints:60,map:b}));break;case e.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(E.createEllipse({center:c,longAxis:48,
shortAxis:24,numberOfPoints:60,map:b}))}this._setTooltipMessage(this._points.length)},_addShape:function(a,b,c){this._setTooltipMessage(0);this._clear();this.onDrawStart();this._drawEnd(this._toPolygon(a,b,c))},_toPolygon:function(a,b,c){var e=this.map,d=new E(e.spatialReference);d.addRing(m.map(a,function(a){return e.toMap({x:a[0]+b,y:a[1]+c})}));return d},_onDblClickHandler:function(a){var b,c=this._points,e=this.map.spatialReference,d=B;q("esri-touch")&&c.push(a.mapPoint);var f=c[c.length-1],g=
c[c.length-2],c=f&&g&&f.x===g.x&&f.y===g.y?c.slice(0,c.length-1):c.slice(0,c.length);switch(this._geometryType){case d.POLYLINE:if(!this._graphic||2>c.length){l.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new A(e);b.addPath([].concat(c));break;case d.POLYGON:if(!this._graphic||2>c.length){l.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new E(e);a=[].concat(c,[c[0].offset(0,0)]);E.prototype.isClockwise(a)||
this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),a.reverse());b.addRing(a);break;case d.MULTI_POINT:b=new y(e),m.forEach(c,function(a){b.addPoint(a)})}l.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(b)},_onKeyDownHandler:function(a){a.keyCode===h.ESCAPE&&(l.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},
_toggleTooltip:function(b){this._options.showTooltips&&(b?this._tooltip||(this._tooltip=n.create("div",{"class":"esriMapTooltip"},this.map.container),a.isBodyLtr()||k.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=l.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=l.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=
l.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(l.disconnect(this._onTooltipMouseEnterHandler_connect),l.disconnect(this._onTooltipMouseLeaveHandler_connect),l.disconnect(this._onTooltipMouseMoveHandler_connect),n.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var a=this._tooltip;a&&(a.style.display="none")},_setTooltipMessage:function(a){var b=this._tooltip;if(b){var c="";switch(this._geometryType){case B.POINT:c=F.toolbars.draw.addPoint;break;case B.ARROW:case B.LEFT_ARROW:case B.RIGHT_ARROW:case B.UP_ARROW:case B.DOWN_ARROW:case B.TRIANGLE:case B.RECTANGLE:case B.CIRCLE:case B.ELLIPSE:c=
F.toolbars.draw.addShape;break;case B.LINE:case B.EXTENT:case B.FREEHAND_POLYLINE:case B.FREEHAND_POLYGON:c=F.toolbars.draw.freehand;break;case B.POLYLINE:case B.POLYGON:c=F.toolbars.draw.start;1===a?c=F.toolbars.draw.resume:2<=a&&(c=F.toolbars.draw.complete);break;case B.MULTI_POINT:c=F.toolbars.draw.addMultipoint,1<=a&&(c=F.toolbars.draw.finish)}b.innerHTML=c}},_updateTooltip:function(a){var b=this._tooltip;if(b){var c;a.clientX||a.pageY?(c=a.clientX,a=a.clientY):(c=a.clientX+t.body().scrollLeft-
t.body().clientLeft,a=a.clientY+t.body().scrollTop-t.body().clientTop);b.style.display="none";k.set(b,{left:c+this._options.tooltipOffset+"px",top:a+"px"});b.style.display=""}},_redrawGraphic:function(a,b,c,e){if(c||this.map.wrapAround180)(a=this._graphic)&&a.setGeometry(a.geometry),(a=this._tGraphic)&&a.setGeometry(a.geometry)},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});d.mixin(B,{POINT:"point",MULTI_POINT:"multipoint",
LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});q("extend-esri")&&d.setObject("toolbars.Draw",B,g);return B})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],
function(r,d,m,l,c){r=r([c],{declaredClass:"esri.toolbars._Toolbar",constructor:function(c){this.map=c},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(c,d,l,h){var n=this.map;c&&(this._mapNavState={isDoubleClickZoom:n.isDoubleClickZoom,isClickRecenter:n.isClickRecenter,isPan:n.isPan,isRubberBandZoom:n.isRubberBandZoom,
isKeyboardNavigation:n.isKeyboardNavigation,isScrollWheelZoom:n.isScrollWheelZoom},n.disableDoubleClickZoom(),n.disableClickRecenter(),n.disablePan(),n.disableRubberBandZoom(),n.disableKeyboardNavigation());d&&n.hideZoomSlider();l&&n.hidePanArrows();h&&n.graphics.disableMouseEvents()},_activateMapTools:function(c,d,l,h){var n=this.map,k=this._mapNavState;c&&k&&(k.isDoubleClickZoom&&n.enableDoubleClickZoom(),k.isClickRecenter&&n.enableClickRecenter(),k.isPan&&n.enablePan(),k.isRubberBandZoom&&n.enableRubberBandZoom(),
k.isKeyboardNavigation&&n.enableKeyboardNavigation(),k.isScrollWheelZoom&&n.enableScrollWheelZoom());d&&n.showZoomSlider();l&&n.showPanArrows();h&&n.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var c=this.map;this._scrollWheelState={isScrollWheelZoom:c.isScrollWheelZoom,isScrollWheelPan:c.isScrollWheelPan};c.disableScrollWheelZoom();c.disableScrollWheelPan()},_activateScrollWheel:function(){var c=this.map,d=this._scrollWheelState;d&&(d.isScrollWheelZoom&&c.enableScrollWheelZoom(),
d.isScrollWheelPan&&c.enableScrollWheelPan())}});m("extend-esri")&&d.setObject("toolbars._Toolbar",r,l);return r})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(r,d,m,l){return r([m],{declaredClass:"jimu.dijit.URLInput",required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?
this.nls.invalidUrl:"Invalid Url"},postCreate:function(){this.inherited(arguments);d.addClass(this.domNode,"jimu-url-input")},validator:function(c){if(!1===this.required&&""===c)return!0;if(isFinite(c))return!1;var d="^"+l.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),d=new RegExp(d,"g");d.lastIndex=0;d=d.test(c);return this.rest?(c=/\/rest\/services/gi.test(c),d&&c):d}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(r,d,m){var l=
r.getObject("validate.regexp",!0,m);return l=m.validate.regexp={ipAddress:function(c){c="object"==typeof c?c:{};"boolean"!=typeof c.allowDottedDecimal&&(c.allowDottedDecimal=!0);"boolean"!=typeof c.allowDottedHex&&(c.allowDottedHex=!0);"boolean"!=typeof c.allowDottedOctal&&(c.allowDottedOctal=!0);"boolean"!=typeof c.allowDecimal&&(c.allowDecimal=!0);"boolean"!=typeof c.allowHex&&(c.allowHex=!0);"boolean"!=typeof c.allowIPv6&&(c.allowIPv6=!0);"boolean"!=typeof c.allowHybrid&&(c.allowHybrid=!0);var d=
[];c.allowDottedDecimal&&d.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");c.allowDottedHex&&d.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");c.allowDottedOctal&&d.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");c.allowDecimal&&d.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");c.allowHex&&
d.push("0[xX]0*[\\da-fA-F]{1,8}");c.allowIPv6&&d.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");c.allowHybrid&&d.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");c="";0<d.length&&(c="("+d.join("|")+")");return c},host:function(c){c="object"==typeof c?c:{};"boolean"!=typeof c.allowIP&&(c.allowIP=!0);"boolean"!=typeof c.allowLocal&&(c.allowLocal=!1);"boolean"!=typeof c.allowPort&&(c.allowPort=!0);"boolean"!=typeof c.allowNamed&&
(c.allowNamed=!1);var d=c.allowPort?"(\\:\\d+)?":"",m="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.?)";c.allowIP&&(m+="|"+l.ipAddress(c));c.allowLocal&&(m+="|localhost");c.allowNamed&&(m+="|^[^-][a-zA-Z0-9_-]*");return"("+m+")"+d},url:function(c){c="object"==typeof c?c:{};"scheme"in c||(c.scheme=[!0,!1]);return d.buildGroupRE(c.scheme,function(c){return c?"(https?|ftps?)\\://":""})+l.host(c)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},
emailAddress:function(c){c="object"==typeof c?c:{};"boolean"!=typeof c.allowCruft&&(c.allowCruft=!1);c.allowPort=!1;var d="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+l.host(c);c.allowCruft&&(d="\x3c?(mailto\\:)?"+d+"\x3e?");return d},emailAddressList:function(c){c="object"==typeof c?c:{};"string"!=typeof c.listSeparator&&(c.listSeparator="\\s;,");var d=l.emailAddress(c);return"("+d+"\\s*["+c.listSeparator+"]\\s*)*"+d+"\\s*["+c.listSeparator+"]?\\s*"},numberFormat:function(c){c=
"object"==typeof c?c:{};"undefined"==typeof c.format&&(c.format="###-###-####");return d.buildGroupRE(c.format,function(c){return d.escapeString(c,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(c){c="object"==typeof c?c:{};"boolean"!=typeof c.allowTerritories&&(c.allowTerritories=!0);"boolean"!=typeof c.allowMilitary&&(c.allowMilitary=!0);
var d="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";c.allowTerritories&&(d+="|AS|FM|GU|MH|MP|PW|PR|VI");c.allowMilitary&&(d+="|AA|AE|AP");return"("+d+")"}}}})},"jimu/dijit/ColorPalette":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dojo/query jimu/dijit/ColorChooser jimu/dijit/CustomColorPicker jimu/dijit/ColorRecords dijit/popup jimu/utils dijit/a11yclick".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e){return d([m,c,l,r],{templateString:"\x3cdiv\x3e\x3c/div\x3e",baseClass:"jimu-color-palette",declaredClass:"jimu.dijit.ColorPalette",_TRANSPARENT_STR:"rgba(0, 0, 0, 0)",value:"",_defaultAppearance:{showTransparent:!0,showColorPalette:!0,showCoustom:!0,showColorPickerOK:!1,showColorPickerApply:!0,showCoustomRecord:!0,closeDialogWhenChange:!1},recordUID:"",postMixInProperties:function(){this.nls=window.jimuNls.colorPalette},postCreate:function(){this.inherited(arguments);
this.value=this.value?new h(this.value):new h("#fff");this._createContent()},initUI:function(){this._toggleCustomColorPicker("init",!1)},_createContent:function(){this.appearance=t.mixin(this._defaultAppearance,this.appearance);var a=q.create("div",{"class":"jimu-colorpalette"},this.domNode);this.initPanel=q.create("div",{"class":"init-panel"},a);this.customPanel=q.create("div",{"class":"custom-panel hide"},a);this.appearance.showTransparent&&this._createSpecialColors(this.initPanel);this.appearance.showColorPalette&&
this._createColorChooser(this.initPanel);this.appearance.showCoustom&&this._createCustomColorPicker(this.initPanel);this.appearance.showCoustom&&this.appearance.showCoustomRecord&&this._createCoustomRecord(this.initPanel)},setColor:function(a){this._isColorEqual(a)||(this.value=new h(a),this._setSpatialColor(this.value),"undefined"!==typeof this.value.a&&0===this.value.a?(this.colorChooser.setColor(new h("transparent"),!1),this.picker.setColor(new h("#fff"),!1)):(this.colorChooser.setColor(this.value.toHex(),
!1),this.picker.setColor(this.value,!1)),this.colorRecords&&this.colorRecords.selecteColor(this.value))},getColor:function(){return this.value},changeColor:function(a){if("undefined"!==typeof this.value.a&&0===this.value.a)this.onChange(this.value);else this.onChange(this.value.toHex());this.emit("change",this.value);!0===this.appearance.closeDialogWhenChange&&!1!==a&&this._closeDialog()},refreshRecords:function(){this.colorRecords&&this.colorRecords.refresh()},destroy:function(){f.close(this.tooltipDialog);
this.picker.destroy();this.inherited(arguments)},_createSpecialColors:function(a){a=q.create("div",{"class":"special-color"},a);this.transparentBtn=q.create("div",{"class":"transparent btn",innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"transparent icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"transparent text jimu-float-leading"\x3e'+this.nls.transparent+"\x3c/div\x3e\x3c/div\x3e"},a);this.own(p(this.transparentBtn,e,t.hitch(this,this._onTransparentClick)))},_onTransparentClick:function(){this.setColor(new h("transparent"));
this.changeColor()},_setSpatialColor:function(a){if(this.transparentBtn){var b=n(".btn-wapper",this.transparentBtn)[0];q.removeClass(b,"selected");a&&a.toString&&a.toString()===this._TRANSPARENT_STR&&q.addClass(b,"selected")}},_createColorChooser:function(a){this.colorChooser=new k({});this.colorChooser.placeAt(a);this.own(p(this.colorChooser,"change",t.hitch(this,function(a){a=new h(a);this.setColor(a);this.changeColor()})))},_createCustomColorPicker:function(){this.coustomtBtn=q.create("div",{"class":"coustom btn",
innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"custom icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"custom text jimu-float-leading"\x3e'+this.nls.custom+"\x3c/div\x3e\x3c/div\x3e"},this.initPanel);this.own(p(this.coustomtBtn,"click",t.hitch(this,function(){this._toggleCustomColorPicker("custom")})));this.picker=new a({showOk:this.appearance.showColorPickerOK,showApply:this.appearance.showColorPickerApply,value:this.value.toHex()});this.picker.placeAt(this.customPanel);this.picker.setColor(this.value);
this.own(p(this.picker,"ok",t.hitch(this,function(a){this.setColor(new h(a));this.changeColor();this._addAColorRecord(a);this._toggleCustomColorPicker("init");this._closeDialog()})));this.own(p(this.picker,"apply",t.hitch(this,function(a){this.setColor(new h(a));this.changeColor(!1);this._addAColorRecord(a)})));this.own(p(this.picker,"cancel",t.hitch(this,function(){this._toggleCustomColorPicker("init");this._closeDialog()})))},_toggleCustomColorPicker:function(a,b){"custom"===a?(q.removeClass(this.customPanel,
"hide"),q.addClass(this.initPanel,"hide")):(q.addClass(this.customPanel,"hide"),q.removeClass(this.initPanel,"hide"));"undefined"!==typeof b&&!1===b||this.emit("change-style")},_createCoustomRecord:function(a){this.colorRecords=new g({recordsLength:10,uid:this.recordUID||""});this.colorRecords.placeAt(a);this.own(p(this.colorRecords,"choose",t.hitch(this,function(a){this.setColor(new h(a));this.changeColor()})))},_addAColorRecord:function(a){this.colorRecords&&this.colorRecords.push&&this.colorRecords.push(a)},
_isColorEqual:function(a){return this.value.toString()===(new h(a)).toString()?!0:!1},_changeLabel:function(a){q.empty(this.domNode);q.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:b.invertColor(a.toHex())}},this.domNode)},onOpen:function(){this.openDialog()},openDialog:function(){this.initUI()},_closeDialog:function(){this.emit("close")},onClose:function(){this._closeDialog()}})})},"jimu/dijit/ColorChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/i18n dojo/_base/Color dijit/a11yclick dojo/i18n!dojo/nls/colors".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a){return d([m,l,c,r],{templateString:'\x3cdiv\x3e\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\x3ctable class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e',baseClass:"jimu-color-chooser",declaredClass:"jimu.dijit.ColorChooser",uid:"",colorsArray:["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),
"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),
"rgb(0,0,1) darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],postCreate:function(){this.inherited(arguments);this.colorTitleNls=n.getLocalization("dojo","colors");this._createColorsBlocks()},_createColorsBlocks:function(){this._row=this.colorsArray.length;this._col=this.colorsArray[0].length;for(var c=0;c<this._row;c++)for(var d=q.create("tr",{role:"row"},this.gridNode),b=0;b<this._col;b++){var e=this.colorsArray[c][b],h=k.named[e],l="";h?l=e:"rgb(0,0,1)"===
e&&(l="black",h="rgb(0,0,1)");e=this.colorTitleNls[l];h=(new k(h)).toString();this["record"+b]=q.create("td",{"class":"dijitPaletteCell","data-title":h,role:"gridcell"},d);var n=q.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+b]);q.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),alt:e,title:e,"data-title":l,width:"16px",height:"16px",style:"background-color: "+h},n)}this.own(p(this.gridNode,a,t.hitch(this,this.onColorClick)))},onColorClick:function(a){for(var c=
a.target;"TD"!==c.tagName;){if(!c.parentNode||c===this.gridNode)return;c=c.parentNode}c=q.getAttr(c,"data-title");c=(new k(c)).toString();this.setColor(c);a.stopPropagation();a.preventDefault()},_onChange:function(a){this.emit("change",a)},setColor:function(a,c){a=new k(a);for(var b=null,e=h("td",this.domNode),d=0,f=e.length;d<f;d++)q.removeClass(e[d],"dijitPaletteCellSelected");d=0;for(f=e.length;d<f;d++)if(a.toString()===q.getAttr(e[d],"data-title")){b=e[d];break}b&&q.addClass(b,"dijitPaletteCellSelected");
(b&&"undefined"===typeof c||!0===c)&&this._onChange(a)}})})},"jimu/dijit/CustomColorPicker":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color jimu/dijit/ColorSelector".split(" "),function(r,d,m,l,c,t,q,p,h){return d([m,l,r],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,
ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof p||(this.color=new p(this.color)):this.color=new p("#ccc");t.setStyle(this.domNode,"backgroundColor",this.color.toHex());this._createDialog(this.domNode)},destroy:function(){this.picker.destroy();this.inherited(arguments)},_handlerOk:function(c){c&&c.stopPropagation&&c.preventDefault&&(c.stopPropagation(),c.preventDefault());this.emit("ok",
this.color)},_handlerApply:function(c){c&&c.stopPropagation&&c.preventDefault&&(c.stopPropagation(),c.preventDefault());this.emit("apply",this.color)},_handlerCancel:function(c){c&&c.stopPropagation&&c.preventDefault&&(c.stopPropagation(),c.preventDefault());this.emit("cancel")},_createDialog:function(){var d=t.create("div",{"class":"dojox-color-picker-container"},this.domNode),k=new h({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:c.hitch(this,function(a){a=
new p(a);this.setColor(a)})});k.placeAt(d);k.startup();d=t.create("div",{"class":"btns-container jimu-float-trailing"},d);if(!0===this.showOk){var a=t.create("div",{"class":"jimu-btn jimu-float-leading ok",title:this.nls.ok,innerHTML:this.nls.ok},d);this.own(q(a,"click",c.hitch(this,function(a){var c=this.picker.get("value");this.setColor(new p(c));this._handlerOk(a)})))}!0===this.showApply&&(a=t.create("div",{"class":"jimu-btn jimu-float-leading apply",title:this.nls.apply,innerHTML:this.nls.apply},
d),this.own(q(a,"click",c.hitch(this,function(a){var c=this.picker.get("value");this.setColor(new p(c));this._handlerApply(a)}))));d=t.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-leading",title:this.nls.cancel,innerHTML:this.nls.cancel},d);this.own(q(d,"click",c.hitch(this,function(a){this._handlerCancel(a)})));this.picker=k},setColor:function(c){if(c instanceof p){var d=this.color,a="";d&&(a=d.toHex());d=c.toHex();this.color=c;a!==d&&this.picker.set("value",d)}},getColor:function(){return this.color},
onClose:function(){}})})},"jimu/dijit/ColorRecords":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/_base/Color dojo/cookie dojo/text!./templates/ColorRecords.html dijit/a11yclick".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a,g){return d([m,l,c,r],{templateString:a,baseClass:"jimu-color-records",declaredClass:"jimu.dijit.ColorRecords",uid:"",recordsLength:10,colorList:null,
postCreate:function(){this.inherited(arguments);this.colorList=[];this._createCoustomRecord();""===this.uid&&(this.uid="wab_colorRecords");this.refresh()},push:function(a){this.colorList.unshift(a);this.colorList.length>this.recordsLength&&this.colorList.pop();this._setColors()},selecteColor:function(a){a=new n(a);for(var b=null,c=h("td",this.domNode),d=0,f=c.length;d<f;d++)q.removeClass(c[d],"dijitPaletteCellSelected");d=0;for(f=c.length;d<f;d++)if(a.toString()===q.getAttr(c[d],"title")){b=c[d];
break}b&&(q.addClass(b,"dijitPaletteCellSelected"),this.onChoose(a))},refresh:function(){this._getCookie(this.uid);this._setColors()},_setColors:function(){for(var a=0;a<this.recordsLength;a++){var b=this["record"+a];if(b&&this.colorList[a]&&this.colorList[a].toString){var c=this.colorList[a].toString();q.setAttr(b,"title",c);b=this._findImg(b);q.setStyle(b,"background-color",c);q.setAttr(b,"alt",c);q.setAttr(b,"title",c)}}this._setCookie(this.uid)},_createCoustomRecord:function(){for(var a=0;a<this.recordsLength;a++){this["record"+
a]=q.create("td",{"class":"dijitPaletteCell",tabindex:a,title:"",role:"gridcell"},this.container);var b=q.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+a]);q.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),style:"background-color: #ffffff"},b)}this.own(p(this.gridNode,g,t.hitch(this,this.onRecordClick)))},onRecordClick:function(a){for(var b=a.target;"TD"!==b.tagName;){if(!b.parentNode||b===this.gridNode)return;b=b.parentNode}b=q.getAttr(b,
"title");b=(new n(b)).toString();this.onChoose(b);a.stopPropagation();a.preventDefault()},onChoose:function(a){this.emit("choose",a)},_findImg:function(a){var b=null;return a.nodeName&&"IMG"===a.nodeName.toUpperCase()?a:b=h(".dijitColorPaletteSwatch",a)[0]},_setCookie:function(a){for(var b=[],c=0,d=this.recordsLength;c<d;c++){var f=this.colorList[c];f&&f.toString&&(b[c]=f.toString())}this._cleanCookie(a);try{var g=JSON.stringify(b);k(a,g,{expires:1E3,path:"/"})}catch(D){console.error("ColorRecords: cookieList JSON.stringify error."+
D.stack)}},_getCookie:function(a){a=k(a);if("undefined"!==typeof a)try{var b=JSON.parse(a);if(b&&"undefined"!==typeof b.length){a=0;for(var c=this.recordsLength;a<c;a++){var d=b[a];d&&d.toString&&(this.colorList[a]=new n(d.toString()))}}}catch(v){console.error("ColorRecords: cookieList JSON.parse error."+v.stack)}},_cleanCookie:function(a){k(a,null,{expires:-1})}})})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),
function(r,d,m,l,c,t,q,p,h){return r([q,t],{baseClass:"jimu-panel jimu-on-screen-widget-panel jimu-main-background",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(c){c.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(c){c.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(m.removeClass(this.foldableNode,"fold-up"),m.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(m.removeClass(this.foldableNode,"fold-down"),m.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(c){this.panelManager.closePanel(this);c.stopPropagation();"touchstart"===c.type&&c.preventDefault()},_normalizePositionObj:function(c){var h=
this._getLayoutBox();c.left=isFinite(c.left)?c.left:h.w-c.right;c.top=isFinite(c.top)?c.top:h.h-c.bottom;delete c.right;delete c.bottom;this.position=d.mixin(d.clone(this.position),c)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new h({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(h,k){this.disableMoveable();var a=m.getMarginBox(jimuConfig.layoutId);a.l=a.l-h+k;a.w+=2*(h-k);this.moveable=new c.boxConstrainedMoveable(this.domNode,{box:a,handle:this.titleNode,within:!0});this.own(l(this.moveable,
"Moving",d.hitch(this,this.onMoving)));this.own(l(this.moveable,"MoveStop",d.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);window.appInfo.isRunInMobile&&this._setMobilePosition();this.inherited(arguments)},_switchToMobileUI:function(){m.removeClass(this.titleNode,"title-normal");m.addClass(this.titleNode,
"title-full");m.setStyle(this.foldableNode,"display","block");m.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(m.removeClass(this.foldableNode,"fold-up"),m.addClass(this.foldableNode,"fold-down")):(m.removeClass(this.foldableNode,"fold-down"),m.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){m.removeClass(this.titleNode,"title-full");m.addClass(this.titleNode,"title-normal");m.setStyle(this.foldableNode,"display","none");m.setStyle(this.maxNode,"display",
"none")},resize:function(c){var h=this._getPositionInfo(),a={left:h.position.left,top:h.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};c&&(c.t=this.domNode.offsetTop,a.left=isFinite(c.l)?c.l:a.left,a.top=isFinite(c.t)?c.t:a.top,a.width=isFinite(c.w)?c.w:a.width,a.height=isFinite(c.h)?c.h:a.height,this._normalizePositionObj(d.clone(a)),this.makePositionInfoBox(),a.width=this._positionInfoBox.w,a.height=this._positionInfoBox.h);h.position=a;this._onResponsible(h);this.inherited(arguments)},
_onResponsible:function(c){c.isRunInMobile?(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(c.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(c){this._normalizePositionObj(c);this.makePositionInfoBox();c=this._getPositionInfo();this._onResponsible(c)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var c=
jimuConfig.layoutId,c="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return m.getMarginBox(c)},_getPositionInfo:function(){var c={isRunInMobile:!1,position:{left:0,top:5}},d=this._getLayoutBox(),a=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return c.isRunInMobile=!0,c;window.isRTL?(c.position.left=d.w-a,c.position.left+this._positionInfoBox.w>d.w&&(c.position.left-=this._positionInfoBox.w,0>c.position.left&&(c.position.left=d.w-this._positionInfoBox.w))):(c.position.left=
a,c.position.left+this._positionInfoBox.w>d.w&&(c.position.left=d.w>this._positionInfoBox.w?d.w-this._positionInfoBox.w:0));a=this._positionInfoBox.t;d=d.h-a;a>=d?a>=this._positionInfoBox.h&&(c.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):d>=this._positionInfoBox.h&&(c.position.top=this._positionInfoBox.t+40+3);return c},_setMobilePosition:function(){window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==m.byId(jimuConfig.layoutId)&&m.place(this.domNode,jimuConfig.layoutId);
var c=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(c.zIndex=this.position.zIndex);var h=p.getPositionStyle(c);d.mixin(h,c.borderRadiusStyle);m.setStyle(this.domNode,h)},_setDesktopPosition:function(c){!window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==m.byId(jimuConfig.mapId)&&m.place(this.domNode,jimuConfig.mapId);m.setStyle(this.domNode,{left:c.left+"px",right:"auto",top:c.top+"px",width:(c.width||this.position.width||this._originalBox.w)+"px",height:(c.height||
this.position.height||this._originalBox.h)+"px"})},onMoving:function(c){m.setStyle(c.node,"opacity",.9)},onMoveStop:function(c){m.setStyle(c.node,"opacity",1);c=m.getMarginBox(c.node);this._normalizePositionObj(d.clone({left:c.l,top:c.t,width:c.w,height:c.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u){r.experimental("dojox.layout.ResizeHandle");var v=g("dojox.layout._ResizeHelper",e,{show:function(){a.set(this.domNode,"display","")},hide:function(){a.set(this.domNode,"display","none")},resize:function(a){k.setMarginBox(this.domNode,a)}});return g("dojox.layout.ResizeHandle",[e,u],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,f.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=b.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new v({id:"dojoxGlobalResizeHelper"})).placeAt(q.body()),
n.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=d.partial(n.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(e){if(!this._isSizing&&
(m.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=b.byId(this.targetId))?this.targetWidget.domNode:h.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var d=k.position(this.targetDomNode,!0);this._resizeHelper.resize({l:d.x,t:d.y,w:d.w,h:d.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:d.x,t:d.y})}this._isSizing=!0;this.startPoint={x:e.clientX,y:e.clientY};
var d=a.getComputedStyle(this.targetDomNode),g="border-model"===k.boxModel?{w:0,h:0}:k.getPadBorderExtents(this.targetDomNode,d),l=k.getMarginExtents(this.targetDomNode,d);this.startSize={w:a.get(this.targetDomNode,"width",d),h:a.get(this.targetDomNode,"height",d),pbw:g.w,pbh:g.h,mw:l.w,mh:l.h};this.isLeftToRight()||"absolute"!=a.get(this.targetDomNode,"position")||(d=k.position(this.targetDomNode,!0),this.startPosition={l:d.x,t:d.y});this._pconnects=[m.connect(q.doc,f.move,this,"_updateSizing"),
m.connect(q.doc,f.release,this,"_endSizing")];c.stop(e)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,c){try{if(!a.clientX||!a.clientY)return!1}catch(y){return!1}this._activeResizeLastEvent=a;var e=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),d=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
e:0);d=this._checkConstraints(a,this.startSize.h-(this._resizeY?d:0));(c=c||this.startPosition)&&this._resizeX&&(d.l=c.l+e,d.w!=a&&(d.l+=a-d.w),d.t=c.t);switch(b){case "margin":d.w+=this.startSize.mw,d.h+=this.startSize.mh;case "border":d.w+=this.startSize.pbw,d.h+=this.startSize.pbh}return d},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,
e=this.startSize.h,d=c*b-e*a;0>d?a=b*c/e:0<d&&(b=a*e/c)}return{w:a,h:b}},_changeSizing:function(b){var c=this.targetWidget&&d.isFunction(this.targetWidget.resize),e=this._getNewCoords(b,c&&"margin");if(!1!==e&&(c?this.targetWidget.resize(e):this.animateSizing?p[this.animateMethod]([t.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:e.w}},duration:this.animateDuration}),t.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:e.h}},
duration:this.animateDuration})]).play():a.set(this.targetDomNode,{width:e.w+"px",height:e.h+"px"}),this.intermediateChanges))this.onResize(b)},_endSizing:function(a){l.forEach(this._pconnects,m.disconnect);var b=d.partial(m.publish,this.endTopic,[this]);this.activeResize?b():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(b,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo".split(" "),
function(r,d,m,l,c,t){return r(t,{constructor:function(c,d,h,l){this.noLegend=l},_initVisible:function(){var c=!1,d=this.originOperLayer.mapService;this.originOperLayer.mapService&&d.layerInfo._subLayerVisible[d.subId]&&(c=!0);this._visible=c},_setTopLayerVisible:function(c){var d;if(this.originOperLayer.mapService&&(d=this.originOperLayer.mapService,0<this.originOperLayer.subLayers.length)){d.layerInfo._subLayerVisible[d.subId]=c?!0:!1;this._visible=c;var h={};this.traversal(function(c){0===c.getSubLayers().length&&
(h[c.originOperLayer.mapService.subId]=c.isVisbleOrInvisilbe())});d.layerInfo._setSubLayerVisible(h)}},setLayerVisiblefromTopLayer:function(){},_visibleChanged:function(c){},_sevVisible:function(c){this.visible=c},obtainNewSubLayers:function(){var c=[];d.forEach(this.originOperLayer.subLayers,function(d){d.parentLayerInfo=this;d=this._layerInfoFactory.create(d);c.push(d);d.init()},this);return c},getOpacity:function(){},setOpacity:function(c){},getLayerObject:function(){var d=new l;this.layerObject.empty?
c({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(m.hitch(this,function(c){var h=this.layerObject.url;this.layerObject=c;this.layerObject.url=h;this.layerObject.id=this.id;d.resolve(this.layerObject)}),function(c){d.reject(c)}):d.resolve(this.layerObject);return d},getLayerType:function(){var c=new l;c.resolve("GroupLayer");return c},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},
getScaleRange:function(){var c=this.originOperLayer.mapService;return(c=c.layerInfo._getJsapiLayerInfoById(c.subId))&&0<=c.minScale&&0<=c.maxScale?{minScale:c.minScale,maxScale:c.maxScale}:{minScale:0,maxScale:0}}})})},"jimu/dijit/Filter":function(){define("dojo/on dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/Filter.html jimu/filterUtils jimu/utils jimu/LayerInfos/LayerInfos jimu/dijit/_filter/ValueProviderFactory dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/aspect dojo/Deferred esri/request ./_SingleFilter ./_FilterSet ./LoadingIndicator".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D){return m([l,c,t,p,d],{templateString:q,baseClass:"jimu-filter",declaredClass:"jimu.dijit.Filter",nls:null,autoSwitchMode:!0,_validOptions:!1,_layerDefinition:null,_popupFieldsInfo:[],_def:null,valueProviderFactory:null,featureLayerId:null,layerInfosObj:null,mode:"desktop",noFilterTip:"",enableAskForValues:!1,mobileBreakWidth:600,runtime:!1,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.nls.add=window.jimuNls.common.add;this.nls.apply=
window.jimuNls.common.apply;this.layerInfosObj=n.getInstanceSync();this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._setDesktopMode();this.noFilterTip&&"string"===typeof this.noFilterTip&&(this.noFilterTipSection.innerHTML=this.noFilterTip)},startup:function(){this.inherited(arguments);this.autoUpdateMode()},resize:function(){this.autoUpdateMode()},autoUpdateMode:function(){this.autoSwitchMode&&(this._clearMode(),this.domNode.clientWidth>=this.mobileBreakWidth?this._setDesktopMode():
this._setMobileMode())},setMode:function(a){"desktop"===a?this._setDesktopMode():"mobile"===a&&this._setMobileMode()},_setMode:function(a){this.mode=a;this._setModeClass(this.mode)},_setModeClass:function(a){f.removeClass(this.domNode,"desktop-mode");f.removeClass(this.domNode,"mobile-mode");f.addClass(this.desktopAddSection,"hidden");f.addClass(this.mobileAddSection,"hidden");a&&f.addClass(this.domNode,a+"-mode")},_clearMode:function(){this._setModeClass("")},_setDesktopMode:function(){this._setMode("desktop");
f.removeClass(this.desktopAddSection,"hidden")},_setMobileMode:function(){this._setMode("mobile");f.removeClass(this.mobileAddSection,"hidden")},reset:function(){this.isBuilding()||(this.removeAllFilters(),this.url=null,this.isHosted=!1,this._layerDefinition=null,this._popupFieldsInfo=[],this.valueProviderFactory=this.partsObj=this.expr=this.featureLayerId=null)},isBuilding:function(){return this._def&&!this._def.isFulfilled()},build:function(a){var b=new u;this.isBuilding()?b.reject("Filter is already building."):
(this._def=null,this.reset(),this.url=a.url,this.isHosted=h.isHostedService(this.url),this._layerDefinition=a.layerDefinition,this.featureLayerId=a.featureLayerId,a.partsObj?(this.partsObj=this._updatePartsObj(a.partsObj),this._def=this._init("partsObj")):(this.expr=a.expr||"1\x3d1",this._def=this._init("expr")),b=this._def);return b},buildByExpr:function(a,b,c){console.warn("Filter#buildByExpr() method is deprecated, please use Filter#build() instead.");return this.build({url:a,expr:b,layerDefinition:c,
featureLayerId:this.featureLayerId})},buildByFilterObj:function(a,b,c){console.warn("Filter#buildByFilterObj() method is deprecated, please use Filter#build() instead.");return this.build({url:a,partsObj:b,layerDefinition:c,featureLayerId:this.featureLayerId})},_updatePartsObj:function(a){b.forEach(a,g.hitch(this,function(a){a.parts?b.forEach(a.parts,g.hitch(this,function(a){a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade=
"none")})):a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")}));return a},removeAllFilters:function(){this._destroyAllFilters()},_getLayerDefinitionRaw:function(a,b){var c=new u;b?c.resolve(b):(this.loading.show(),v({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(g.hitch(this,function(a){this.domNode?(this.loading.hide(),c.resolve(a)):c.reject()}),g.hitch(this,function(a){console.error(a);
c.reject();this.domNode&&this.loading.hide()})));return c},_validateLayerDefinition:function(a){return this._isObject(a)},_init:function(a){var c=new u;if(!this._isString(this.url))return c.reject(),c;var e=g.hitch(this,function(){setTimeout(g.hitch(this,function(){this.emit("change");c.resolve()}),1500)}),d=g.hitch(this,function(){f.addClass(this.errorSection,"hidden");this.removeAllFilters();var d;this.featureLayerId&&(this._tryOverrideFieldAliases(this.featureLayerId,this._layerDefinition),d=this.layerInfosObj.getLayerOrTableInfoById(this.featureLayerId).getPopupInfo());
var l=this._layerDefinition.fields;l&&0<l.length?(this._popupFieldsInfo=d?h.completePopupFieldFromLayerField(l,d.fieldInfos):l,(l=b.filter(l,g.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)})))&&0<l.length?(this._validOptions=!0,f.removeClass(this.btnAddSetDesktop,"jimu-state-disabled"),f.removeClass(this.btnAddExpDesktop,"jimu-state-disabled"),f.removeClass(this.btnAddSetMobile,"jimu-state-disabled"),f.removeClass(this.btnAddExpMobile,"jimu-state-disabled"),this.createFieldsStore(),
this.valueProviderFactory=new k({url:this.url,layerDefinition:this._layerDefinition,featureLayerId:this.featureLayerId}),"expr"===a?this._isString(this.expr)?("1\x3d1"===this.expr.replace(/\s/gi,"")&&this.removeAllFilters(),this._parseExpr(this.expr)?e():c.reject()):c.reject():"partsObj"===a?this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),e()):c.reject():this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),e()):this._isString(this.expr)?this._parseExpr(this.expr)?
e():c.reject():(this.removeAllFilters(),e())):(this._showErrorOptions(this.nls.error.noFilterFields),c.reject())):(d&&(this._popupFieldsInfo=d.fieldInfos),c.reject())});this._validateLayerDefinition(this._layerDefinition)?d():(this.loading.show(),v({url:this.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(g.hitch(this,function(a){this.domNode?(this.loading.hide(),this._layerDefinition=a,d()):c.reject()}),g.hitch(this,function(a){console.error(a);c.reject();this.domNode&&
this.loading.hide()})));return c},_tryOverrideFieldAliases:function(a,c){if(a=this.layerInfosObj.getLayerOrTableInfoById(a))if(a=a.getPopupInfo())if(a=a.fieldInfos,c=c.fields,a&&0<a.length&&c&&0<c.length){var e={};b.forEach(a,g.hitch(this,function(a){a.fieldName&&(e[a.fieldName]=a)}));b.forEach(c,g.hitch(this,function(a){var b=e[a.name];b&&b.label&&(a.alias=b.label)}))}},toJson:function(){var a={logicalOperator:this.allAnySelect.value,parts:[]},c=this._getAllSingleFiltersAndFilterSets();if(0===c.length)return a.expr=
"1\x3d1",a;b.forEach(c,g.hitch(this,function(b){b=b.toJson();a.parts.push(b)}));return b.every(a.parts,g.hitch(this,function(a){return!!a}))&&0<a.parts.length?(a.expr=this.getExprByFilterObj(a),a):null},createFieldsStore:function(){if(this._layerDefinition.fields&&0!==this._layerDefinition.fields.length){var a=g.clone(this._layerDefinition).fields;0===this.setFieldsStoreByFieldInfos(a)&&this._showErrorOptions(this.nls.error.noFilterFields)}else this._showErrorOptions(this.nls.error.noFilterFields)},
_parsePartsObj:function(a){this._validatePartsObj(a)&&(this.removeAllFilters(),this._buildEditUIByPartsObj(a))},_parseExpr:function(a){this._destroyAllFilters();var b=null;if(!this._validateLayerDefinition(this._layerDefinition))return b;if(!a||"string"!==typeof a)return this._showErrorOptions(this.nls.error.invalidSQL),b;if("1\x3d1"===this.expr.replace(/\s/gi,""))return b={expr:"1\x3d1",parts:[],logicalOperator:"AND"};try{b=this.getFilterObjByExpr(a)}catch(E){b=null,console.error(E)}b?this._buildEditUIByPartsObj(b):
this._showErrorOptions(this.nls.error.cantParseSQL);return b},_buildEditUIByPartsObj:function(a){a&&(this._destroyAllFilters(),b.forEach(a.parts,g.hitch(this,function(a){a.parts?this._addFilterSet(a):a.fieldObj&&a.operator&&a.valueObj&&this._addSingleFilter(a)})),this.allAnySelect.value=a.logicalOperator,this._setFilterMsgUI(a.parts.length))},_addSingleFilter:function(a){a={url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,
numberFieldTypes:this._numberFieldTypes,part:a,OPERATORS:g.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,runtime:this.runtime};a=new x(a);a.placeAt(this.allExpsBox);a.startup();this.own(e.after(a,"_destroySelf",g.hitch(this,function(){this._checkFilterNumbers();this.emit("change")})));this.own(r(a,"change",g.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return a},_addFilterSet:function(a){a=
{url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,partsObj:a,OPERATORS:g.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,runtime:this.runtime};a=new D(a);a.placeAt(this.allExpsBox);a.startup();this.own(e.after(a,"_destroySelf",g.hitch(this,function(){this._checkFilterNumbers();
this.emit("change")})));this.own(r(a,"change",g.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return a},_destroyAllFilters:function(){for(var a=this._getAllSingleFiltersAndFilterSets();0<a.length;)a[0].destroy(),a.splice(0,1);this._checkFilterNumbers()},_getAllSingleFiltersAndFilterSetsDoms:function(){var a=[];this.allExpsBox.childNodes&&0<this.allExpsBox.childNodes.length&&b.forEach(this.allExpsBox.childNodes,g.hitch(this,function(b){(f.hasClass(b,"jimu-single-filter")||
f.hasClass(b,"jimu-filter-set"))&&a.push(b)}));return a},_getAllSingleFiltersAndFilterSets:function(){var c=this._getAllSingleFiltersAndFilterSetsDoms();return b.map(c,g.hitch(this,function(b){return a.byNode(b)}))},_setFilterMsgUI:function(a){2>a?(this.allAnySelect.value="AND",f.setStyle(this.allAnySelect,"display","none"),f.setStyle(this.oneOrZeroMsg,"display","block")):(f.setStyle(this.oneOrZeroMsg,"display","none"),f.setStyle(this.allAnySelect,"display","block"))},_checkFilterNumbers:function(){var a=
this._getAllSingleFiltersAndFilterSetsDoms();this._setFilterMsgUI(a.length);0<a.length?f.addClass(this.noFilterTipSection,"hidden"):f.removeClass(this.noFilterTipSection,"hidden");this.emit("filter-number-change")},_showErrorOptions:function(a){console.error(a);f.addClass(this.errorSection,"hidden");this.errorTip.innerHTML=a;this.loading.hide()},_onBtnApplyClicked:function(){this.emit("apply")},_onBtnAddSetClick:function(){this._layerDefinition&&this._validOptions&&(this._addFilterSet(),this.emit("change"))},
_onBtnAddExpClick:function(){this._layerDefinition&&this._validOptions&&(this._addSingleFilter(),this.emit("change"))}})})},"jimu/dijit/_filter/ValueProviderFactory":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare ./BlankValueProvider ./SimpleValueProvider ./TwoNumbersValueProvider ./TwoDatesValueProvider ./ListValueProvider ./AdvancedListValueProvider ./PredefinedValueProvider ./NumberListValueProvider ./DateIsInValueProvider jimu/utils jimu/LayerInfos/LayerInfos".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f){var b={stringOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorStartsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorEndsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,
supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorContains:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorDoesNotContain:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsAnyOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},stringOperatorIsNoneOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},
stringOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},stringOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsAtLeast:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},
field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsLessThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsAtMost:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsGreaterThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},
unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsAnyOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNoneOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNotBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},
dateOperatorIsOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsNotOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsNotIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsOnOrBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},dateOperatorIsOnOrAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"}},
dateOperatorInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorNotInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsNotBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},dateOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}}},
e=m([],{nls:null,layerInfo:null,popupInfo:null,url:null,layerDefinition:null,featureLayerId:null,constructor:function(a){r.mixin(this,a);this.nls=window.jimuNls.filterBuilder;a=f.getInstanceSync();this.featureLayerId&&(this.layerInfo=a.getLayerOrTableInfoById(this.featureLayerId))&&(this.popupInfo=this.layerInfo.getPopupInfo())},getSupportedValueTypes:function(a,c){var e=[];if(c=b[c])c.value&&e.push("value"),c.field&&0<this._getSameShortTypeFieldNames(a).length&&e.push("field"),c.unique&&this.url&&
(this._isStreamServer(this.url)||e.push("unique")),c.multiple&&this.url&&(this._isStreamServer(this.url)||e.push("multiple")),c.uniquePredefined&&this.url&&(this._isStreamServer(this.url)||e.push("uniquePredefined")),c.multiplePredefined&&this.url&&(this._isStreamServer(this.url)||e.push("multiplePredefined"));return e},_isStreamServer:function(a){a=(a||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(a)},_getSameShortTypeFieldNames:function(a){var b=[],c=this._getFieldInfo(this.layerDefinition,
a),f=e.getShortTypeByEsriType(c.type);d.forEach(this.layerDefinition.fields,r.hitch(this,function(c){c.name!==a&&e.getShortTypeByEsriType(c.type)===f&&b.push(c.name)}));return b},getValueProvider:function(e,f){var m=null,u=r.clone(b[e.operator]);if(u){var v=e.valueObj.type,A=e.fieldObj.name,E=this._getFieldInfo(this.layerDefinition,A),y=u[v],C=y.normalProviderType,F=null,B=g.getCodedValueListForCodedValueOrSubTypes(this.layerDefinition,A);"field"===v?(A=this._getSameShortTypeFieldNames(A),0<A.length&&
(F=d.map(A,r.hitch(this,function(a){return{value:a,label:a}})))):B&&0<B.length&&y.codedValueProviderType&&(C=y.codedValueProviderType);e={nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:e,fieldInfo:E,codedValues:B,staticValues:F,layerInfo:this.layerInfo,popupInfo:this.popupInfo,operatorInfo:u,filterCodedValueIfPossible:!!y.filterCodedValueIfPossible,runtime:f};if("BLANK_VALUE_PROVIDER"===C)m=new l(e);else if("SIMPLE_VALUE_PROVIDER"===C)m=new c(e);else if("TWO_NUMBERS_VALUE_PROVIDER"===
C)m=new t(e);else if("TWO_DATES_VALUE_PROVIDER"===C)m=new q(e);else if("LIST_VALUE_PROVIDER"===C)e.showNullValues=!1,"value"===v||"field"===v?m=new p(e):(e.providerType=C,e.selectUI="dropdown",m=new h(e));else if("NUMBER_LIST_VALUE_PROVIDER"===C)m=new k(e);else if("DATE_IS_IN_VALUE_PROVIDER"===C)m=new a(e);else if("ADVANCED_LIST_VALUE_PROVIDER"===C)e.providerType=C,e.selectUI="dropdown",m=new h(e);else if("UNIQUE_PREDEFINED_VALUE_PROVIDER"===C||"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===C)e.providerType=
C,e.selectUI=e.partObj.valueObj?e.partObj.valueObj.selectUI:null,m=f?new h(e):new n(e)}return m},_getFieldInfo:function(a,b){a=a.fields;for(var c=0;c<a.length;c++){var e=a[c];if(b===e.name)return e}return null}});e.getOperatorInfo=function(a){return r.clone(b[a])};e.getOperatorsByShortType=function(a,b){var c=[];"string"===a?c="stringOperatorIs stringOperatorIsNot stringOperatorStartsWith stringOperatorEndsWith stringOperatorContains stringOperatorDoesNotContain stringOperatorIsAnyOf stringOperatorIsNoneOf stringOperatorIsBlank stringOperatorIsNotBlank".split(" "):
"number"===a?c="numberOperatorIs numberOperatorIsNot numberOperatorIsAtLeast numberOperatorIsAtMost numberOperatorIsLessThan numberOperatorIsGreaterThan numberOperatorIsAnyOf numberOperatorIsNoneOf numberOperatorIsBetween numberOperatorIsNotBetween numberOperatorIsBlank numberOperatorIsNotBlank".split(" "):"date"===a&&(c="dateOperatorIsOn dateOperatorIsNotOn dateOperatorIsIn dateOperatorIsNotIn dateOperatorIsBefore dateOperatorIsAfter dateOperatorIsOnOrBefore dateOperatorIsOnOrAfter dateOperatorIsBetween dateOperatorIsNotBetween dateOperatorIsBlank dateOperatorIsNotBlank".split(" "),
b&&c.splice(8,0,"dateOperatorInTheLast","dateOperatorNotInTheLast"));return c};e.getShortTypeByEsriType=function(a){var b=null;"esriFieldTypeString"===a?b="string":"esriFieldTypeDate"===a?b="date":0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a)&&(b="number");return b};return e})},"jimu/dijit/_filter/BlankValueProvider":function(){define(["dojo/_base/html","dojo/_base/declare","./ValueProvider"],function(r,d,m){return d([m],
{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments);r.addClass(this.domNode,"jimu-filter-blank-value-provider")},getDijits:function(){return[]},getStatus:function(){return 1},setValueObject:function(){},getValueObject:function(){return{isValid:!0,type:this.partObj.valueObj.type,value:null}},isBlankValueProvider:function(){return!0}})})},"jimu/dijit/_filter/ValueProvider":function(){define("dojo/on dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils esri/lang".split(" "),
function(r,d,m,l,c,t,q,p,h,n){return t([q,p,d],{baseClass:"jimu-filter-value-provider",fieldName:null,shortType:null,_enabled:!1,cascade:"none",filterCodedValue:!1,fieldPopupInfo:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,partObj:null,runtime:!0,staticValues:null,codedValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,postMixInProperties:function(){this.inherited(arguments);this.shortType=this.partObj.fieldObj.shortType;this.fieldName=this.partObj.fieldObj.name;
this.cascade=this.partObj.interactiveObj&&this.partObj.interactiveObj.cascade;this.runtime&&this.codedValues&&this.filterCodedValueIfPossible&&h.isCodedValuesSupportFilter(this.layerDefinition,this.codedValues.length)?this.filterCodedValue=!0:this.filterCodedValue=!1;this.popupInfo&&this.popupInfo.fieldInfos&&0<this.popupInfo.fieldInfos.length&&c.some(this.popupInfo.fieldInfos,m.hitch(this,function(c){return c.fieldName===this.fieldName?(this.fieldPopupInfo=c,!0):!1}))},getDijits:function(){return[]},
bindChangeEvents:function(){var d=this.getDijits();c.forEach(d,m.hitch(this,function(a){a.declaredClass&&0===a.declaredClass.indexOf("dijit.")&&l.addClass(a.domNode,a.declaredClass.replace(/\./g,"-"));this.own(r(a,"change",m.hitch(this,this._onChanged)));this.own(r(a,"enter",m.hitch(this,this._onEnter)))}))},_onChanged:function(){this._onEnterTriggered||this.emit("change")},_onEnterTriggered:!1,_onEnter:function(){this._onEnterTriggered=!0;this.emit("change");this.emit("enter");setTimeout(m.hitch(this,
function(){this._onEnterTriggered=!1}),100)},tryLocaleNumber:function(c){var a=h.localizeNumber(c);if(null===a||void 0===a)a=c;return a},getPartObject:function(){var c=this.getValueObject();if(!c)return null;var a=m.clone(this.partObj);a.valueObj=c;return a},setValueObject:function(){},getValueObject:function(){},tryGetValueObject:function(){return this.getValueObject()},setRequired:function(){},getStatus:function(){var d=1,a=this.getDijits();0<a.length&&(d=c.map(a,m.hitch(this,function(a){return"function"===
typeof a.getStatus?a.getStatus():this.getStatusForDijit(a)})),d=Math.min.apply(d,d));return d},getStatusForDijit:function(c){return c.validate()?c.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},isBlankValueProvider:function(){return!1},getFilterExpr:function(){var c="1\x3d1",c=this.getLayerFilterExpr();if("all"===this.cascade||"previous"===this.cascade)var a=
this.getCascadeFilterExpr(),c="("+c+") AND ("+a+")";return c},getLayerFilterExpr:function(){var c="1\x3d1";this.layerInfo&&(c=this.layerInfo.getFilter());c||(c="1\x3d1");return c},_getWebMapFilterExpr:function(){var c="";this.layerInfo&&(c=this.layerInfo.getFilterOfWebmap());c||(c="1\x3d1");return c},getDropdownFilterExpr:function(){var c="1\x3d1",c=this._getWebMapFilterExpr();if("all"===this.cascade||"previous"===this.cascade)var a=this.getCascadeFilterExpr(),c="("+c+") AND ("+a+")";return c},getCascadeFilterExpr:function(){return"1\x3d1"},
getDropdownFilterPartsObj:function(){var c={parts:[]};if("all"===this.cascade||"previous"===this.cascade)c=this.getCascadeFilterPartsObj();return c},getCascadeFilterPartsObj:function(){return{}},getCodedValueListByPartsObj:function(c,a,d,f){var b=h.getFieldInfoByFieldName(c.fields,a),e=c.typeIdField,g=null;d=d.parts;for(var k in d){var l=d[k];if(l.fieldObj.name===e){e=l.valueObj.value;g=h._getCodedValueBySubTypeId(c,a,e,b);break}}var n;g||(g=f?f:h._getAllCodedValue(c,b));g&&0<g.length&&(n=g[0].value);
return{selectedValue:n,valueLabels:g}},isDefined:function(c){return n.isDefined(c)},disable:function(){this._enabled=!1},enable:function(){this._enabled=!0},isEnabled:function(){return this._enabled},destroy:function(){this.inherited(arguments)}})})},"jimu/dijit/_filter/SimpleValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/on ./ValueProvider dijit/form/ValidationTextBox dijit/form/NumberTextBox ./DateValueSelector".split(" "),function(r,d,m,l,c,t,q){return d([l],{templateString:"\x3cdiv\x3e\x3c/div\x3e",
_dijit:null,postCreate:function(){this.inherited(arguments);r.addClass(this.domNode,"jimu-filter-simple-value-provider");"string"===this.shortType?(this._dijit=new c({required:!1,trim:!0,intermediateChanges:!1}),this._dijit.startup(),this._dijit.on("keydown",function(c){13===(c.keyCode||c.which)&&(this._dijit.textbox.blur(),this._dijit.emit("enter"))}.bind(this))):"number"===this.shortType?(this._dijit=new t({required:!1,intermediateChanges:!1,constraints:{pattern:"#####0.##########"}}),this._dijit.startup(),
this._dijit.on("keydown",function(c){13===(c.keyCode||c.which)&&(this._dijit.textbox.blur(),this._dijit.emit("enter"))}.bind(this))):this._dijit=new q({popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo});r.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(this.domNode)},getDijits:function(){return[this._dijit]},setValueObject:function(c){this.isDefined(c.value)&&("date"===this.shortType?this._dijit.setValueObject(c):this._dijit.set("value",c.value))},getValueObject:function(){if(this.isValidValue())if("date"===
this.shortType){var c=this._dijit.getValueObject();if(c&&c.value)return c.isValid=!0,c.type=this.partObj.valueObj.type,c}else return c=this._dijit.get("value"),"number"===this.shortType&&(c=parseFloat(c)),{isValid:!0,type:this.partObj.valueObj.type,value:c};return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:null}:null},setRequired:function(c){this._dijit.set("required",c)}})})},"jimu/dijit/_filter/DateValueSelector":function(){define("dojo/aspect dojo/Evented dojo/on dojo/_base/html dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./DateValueSelector.html jimu/filterUtils jimu/utils dijit/form/Select dijit/form/DateTextBox".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g){return q([p,h,n,d],{templateString:k,virtualDates:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);l.addClass(this.domNode,"jimu-date-value-selector");this.virtualDates&&0<this.virtualDates.length||(this.virtualDates=[a.VIRTUAL_DATE_TODAY,a.VIRTUAL_DATE_YESTERDAY,a.VIRTUAL_DATE_TOMORROW]);this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});this.dateTypeSelect.addOption({value:"custom",
label:this.nls.custom});t.map(this.virtualDates,c.hitch(this,function(c){var b={value:c,label:c};switch(c){case a.VIRTUAL_DATE_TODAY:b.label=this.nls.today;break;case a.VIRTUAL_DATE_YESTERDAY:b.label=this.nls.yesterday;break;case a.VIRTUAL_DATE_TOMORROW:b.label=this.nls.tomorrow}this.dateTypeSelect.addOption(b)}));this._showDateTypeSelect();this.own(m(l.byId("main-page"),"click",c.hitch(this,function(){this.dateTextBox&&this.dateTextBox.closeDropDown()})));this.own(r.before(this.dateTypeSelect,"openDropDown",
c.hitch(this,function(){"custom"===this.dateTypeSelect.getValue()&&this.dateTextBox.getValue()&&(this.dateTypeSelect.textDirNode.innerText=this._formatDate(this.dateTextBox.getValue()))})));this.own(r.after(this.dateTypeSelect,"closeDropDown",c.hitch(this,function(){"custom"===this.dateTypeSelect.getValue()&&this.dateTextBox.getValue()&&(this.dateTypeSelect.textDirNode.innerText=this._formatDate(this.dateTextBox.getValue()))})));this.own(r.after(this.dateTypeSelect.dropDown,"onItemClick",c.hitch(this,
function(a,b){a&&"custom"===a.option.value&&this._showDateTextBox()}),!0));this.popupInfo&&this.popupInfo.fieldInfos&&(this.fieldInfo=this.popupInfo.fieldInfos.filter(c.hitch(this,function(a){return a.fieldName===this._fieldInfo.name}))[0])},getDijits:function(){return[]},setValueObject:function(a){a.virtualDate&&"custom"!==a.virtualDate?this.dateTypeSelect.set("value",a.virtualDate,!1):(this.dateTypeSelect.set("value","custom",!1),a.value&&(this.dateTextBox.set("value",new Date(a.value),!1),this.dateTypeSelect.textDirNode.innerText=
this._formatDate(new Date(a.value))))},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var c={value:null,virtualDate:""},b=this.dateTypeSelect.get("value"),e=null;"custom"===b?(e=this.dateTextBox.get("value"),c.value=e?e.toDateString():null,c.virtualDate=""):(e=a.getRealDateByVirtualDate(b),c.virtualDate=b,e?c.value=e.toDateString():c=null);return c},setRequired:function(a){this.dateTextBox.set("required",
a)},getStatus:function(){return"custom"===this.dateTypeSelect.get("value")?this._getStatusForDijit(this.dateTextBox):""===this.dateTypeSelect.get("value")?0:1},_getStatusForDijit:function(a){return a.validate()?a.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},_showDateTypeSelect:function(){this.dateTextBox.closeDropDown()},_showDateTextBox:function(){this.dateTextBox.openDropDown();
this.dateTextBoxClickBinded=!0},_onDateTypeSelectChanged:function(){"custom"===this.dateTypeSelect.get("value")&&this._showDateTextBox();this.emit("change")},_onDateTextBoxChanged:function(a){this.dateTypeSelect.textDirNode.innerText=this._formatDate(a);this.emit("change")},_formatDate:function(a){return this.fieldInfo?g.localizeDateByFieldInfo(a,this.fieldInfo):a.toDateString()}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(r,d,
m){return r("dijit.form.DateTextBox",m,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:d,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),function(r,d,m,l,c,t,q,p,h,n,
k,a,g,f,b,e,u){var v=l("dijit.Calendar",[g,f,b],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(a){p.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_createMonthWidget:function(){return new v._MonthDropDownButton({id:this.id+"_mddb",tabIndex:-1,onMonthSelect:n.hitch(this,
"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(k(this.domNode,"keydown",n.hitch(this,"_onKeyDown")),k(this.dateRowsNode,"mouseover",n.hitch(this,"_onDayMouseOver")),k(this.dateRowsNode,"mouseout",n.hitch(this,"_onDayMouseOut")),k(this.dateRowsNode,"mousedown",n.hitch(this,"_onDayMouseDown")),k(this.dateRowsNode,"mouseup",n.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(a){var b=new this.dateClassObj(this.currentFocus);
b.setDate(1);b.setMonth(a);a=this.dateModule.getDaysInMonth(b);var c=this.currentFocus.getDate();b.setDate(Math.min(c,a));this._setCurrentFocusAttr(b)},_onDayMouseOver:function(a){(a=t.contains(a.target,"dijitCalendarDateLabel")?a.target.parentNode:a.target)&&(a.dijitDateValue&&!t.contains(a,"dijitCalendarDisabledDate")||a==this.previousYearLabelNode||a==this.nextYearLabelNode)&&(t.add(a,"dijitCalendarHoveredDate"),this._currentNode=a)},_onDayMouseOut:function(a){!this._currentNode||a.relatedTarget&&
a.relatedTarget.parentNode==this._currentNode||(a="dijitCalendarHoveredDate",t.contains(this._currentNode,"dijitCalendarActiveDate")&&(a+=" dijitCalendarActiveDate"),t.remove(this._currentNode,a),this._currentNode=null)},_onDayMouseDown:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&!t.contains(a,"dijitCalendarDisabledDate")&&(t.add(a,"dijitCalendarActiveDate"),this._currentNode=a)},_onDayMouseUp:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&t.remove(a,"dijitCalendarActiveDate")},
handleKey:function(a){var b=-1,c,e=this.currentFocus;switch(a.keyCode){case h.RIGHT_ARROW:b=1;case h.LEFT_ARROW:c="day";this.isLeftToRight()||(b*=-1);break;case h.DOWN_ARROW:b=1;case h.UP_ARROW:c="week";break;case h.PAGE_DOWN:b=1;case h.PAGE_UP:c=a.ctrlKey||a.altKey?"year":"month";break;case h.END:e=this.dateModule.add(e,"month",1),c="day";case h.HOME:e=new this.dateClassObj(e);e.setDate(1);break;default:return!0}c&&(e=this.dateModule.add(e,c,b));this._setCurrentFocusAttr(e);return!1},_onKeyDown:function(a){this.handleKey(a)||
(a.stopPropagation(),a.preventDefault())},onValueSelected:function(){},onChange:function(a){this.onValueSelected(a)},getClassForDate:function(){}});v._MonthDropDownButton=l("dijit.Calendar._MonthDropDownButton",u,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new v._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(b){var c=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,b);this.dropDown.set("months",
c);this.containerNode.innerHTML=(6==a("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+c[b.getMonth()]+"\x3c/div\x3e"}});v._MonthDropDown=l("dijit.Calendar._MonthDropDown",[f,e,b],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(a){this.domNode.innerHTML=
"";r.forEach(a,function(a,b){q.create("div",{className:"dijitCalendarMonthLabel",month:b,innerHTML:a},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(a){this.onChange(c.get(a.target,"month"))},onChange:function(){}});return v})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e){var u=d("dijit.CalendarLite",[f,b],{templateString:e,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(a){return a&&!isNaN(a)&&"object"==typeof a&&a.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var a=this._get("value");if(a&&!isNaN(a)){var b=
new this.dateClassObj(a);b.setHours(0,0,0,0);b.getDate()<a.getDate()&&(b=this.dateModule.add(b,"hour",1));return b}return null},_setValueAttr:function(a,b){"string"==typeof a&&(a=t.fromISOString(a));a=this._patchDate(a);if(this._isValidDate(a)&&!this.isDisabledDate(a,this.lang)){if(this._set("value",a),this.set("currentFocus",a),this._markSelectedDates([a]),this._created&&(b||"undefined"==typeof b))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(a){if(a||
0===a)a=new this.dateClassObj(a),a.setHours(1,0,0,0);return a},_setText:function(a,b){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(a.ownerDocument.createTextNode(b))},_populateGrid:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);var a=this._patchDate(a),b=a.getDay(),e=this.dateModule.getDaysInMonth(a),d=this.dateModule.getDaysInMonth(this.dateModule.add(a,"month",-1)),f=new this.dateClassObj,g=0<=this.dayOffset?this.dayOffset:m.getFirstDayOfWeek(this.lang);g>
b&&(g-=7);if(!this.summary){var k=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.gridNode.setAttribute("summary",k[a.getMonth()])}this._date2cell={};r.forEach(this.dateCells,function(k,l){var n=l+g,m=new this.dateClassObj(a),u="dijitCalendar",p=0;n<b?(n=d-b+n+1,p=-1,u+="Previous"):n>=b+e?(n=n-b-e+1,p=1,u+="Next"):(n=n-b+1,u+="Current");p&&(m=this.dateModule.add(m,"month",p));m.setDate(n);this.dateModule.compare(m,f,"date")||(u="dijitCalendarCurrentDate "+u);this.isDisabledDate(m,
this.lang)?(u="dijitCalendarDisabledDate "+u,k.setAttribute("aria-disabled","true")):(u="dijitCalendarEnabledDate "+u,k.removeAttribute("aria-disabled"),k.setAttribute("aria-selected","false"));(p=this.getClassForDate(m,this.lang))&&(u=p+" "+u);k.className=u+"Month dijitCalendarDateTemplate";u=m.valueOf();this._date2cell[u]=k;k.dijitDateValue=u;u=m.getDateLocalized?m.getDateLocalized(this.lang):m.getDate();this._setText(this.dateLabels[l],u);h.set(k,"aria-label",c.format(m,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);this.monthWidget.set("month",a);var b=a.getFullYear()-1,c=new this.dateClassObj;r.forEach(["previous","current","next"],function(a){c.setFullYear(b++);this._setText(this[a+"YearLabelNode"],this.dateLocaleModule.format(c,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(a){this.dateModule=a.datePackage?n.getObject(a.datePackage,
!1):l;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=a.datePackage?n.getObject(a.datePackage+".locale",!1):c},_createMonthWidget:function(){return u._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var a=this.dowTemplateString,b=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),c=0<=this.dayOffset?this.dayOffset:m.getFirstDayOfWeek(this.lang);this.dayCellsHtml=g.substitute([a,
a,a,a,a,a,a].join(""),{d:""},function(){return b[c++%7]});a=g.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[a,a,a,a,a,a].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);q.setSelectable(this.domNode,!1);a=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",a,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var a=n.hitch(this,function(a,
b,c){this[a].dojoClick=!0;return k(this[a],"click",n.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,b,c))}))});this.own(a("incrementMonth","month",1),a("decrementMonth","month",-1),a("nextYearLabelNode","year",1),a("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(b,c){var e=this.currentFocus,d=this._getNodeByDate(e);b=this._patchDate(b);this._set("currentFocus",b);this._date2cell&&0==this.dateModule.difference(e,b,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));b=this._getNodeByDate(b);b.setAttribute("tabIndex",this.tabIndex);(this.focused||c)&&b.focus();d&&d!=b&&(a("webkit")?d.setAttribute("tabIndex","-1"):d.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(a){a.stopPropagation();a.preventDefault();for(a=a.target;a&&!a.dijitDateValue&&0!==a.dijitDateValue;a=a.parentNode);a&&!p.contains(a,"dijitCalendarDisabledDate")&&this.set("value",
a.dijitDateValue)},_getNodeByDate:function(a){return(a=this._patchDate(a))&&this._date2cell?this._date2cell[a.valueOf()]:null},_markSelectedDates:function(a){function b(a,b){p.toggle(b,"dijitCalendarSelectedDate",a);b.setAttribute("aria-selected",a?"true":"false")}r.forEach(this._selectedCells||[],n.partial(b,!1));this._selectedCells=r.filter(r.map(a,this._getNodeByDate,this),function(a){return a});r.forEach(this._selectedCells,n.partial(b,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
u._MonthWidget=d("dijit.CalendarLite._MonthWidget",f,{_setMonthAttr:function(b){var c=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,b),e=6==a("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+r.map(c,function(a){return"\x3cdiv\x3e"+a+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=e+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+c[b.getMonth()]+"\x3c/div\x3e"}});return u})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(r,d,m,l,c,t,q,p){new Date("X");return l("dijit.form._DateTimeTextBox",[t,q],{templateString:p,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:d.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(c,d){var h=this._isInvalidDate(c),a=this._isInvalidDate(d);if(h||a)return h&&a?0:h?-1:1;c=this.format(c,this._unboundedConstraints);d=this.format(d,this._unboundedConstraints);
h=this.parse(c,this._unboundedConstraints);a=this.parse(d,this._unboundedConstraints);return c==d?0:r.compare(h,a,this._selector)},autoWidth:!0,format:function(c,d){return c?this.dateLocaleModule.format(c,d):""},parse:function(c,d){return this.dateLocaleModule.parse(c,d)||(this._isEmpty(c)?null:void 0)},serialize:function(c,d){c.toGregorian&&(c=c.toGregorian());return m.toISOString(c,d)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(h){h=
h||{};this.dateModule=h.datePackage?c.getObject(h.datePackage,!1):r;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=h.datePackage?c.getObject(h.datePackage+".locale",!1):d;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(d){d.selector=this._selector;d.fullYear=!0;var h=m.fromISOString;"string"==typeof d.min&&(d.min=h(d.min),this.dateClassObj instanceof Date||(d.min=new this.dateClassObj(d.min)));"string"==typeof d.max&&(d.max=h(d.max),this.dateClassObj instanceof Date||(d.max=new this.dateClassObj(d.max)));this.inherited(arguments);this._unboundedConstraints=c.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(c){return!c||
isNaN(c)||"object"!=typeof c||c.toString()==this._invalidDate},_setValueAttr:function(c,d,k){void 0!==c&&("string"==typeof c&&(c=m.fromISOString(c)),this._isInvalidDate(c)&&(c=null),c instanceof Date&&!(this.dateClassObj instanceof Date)&&(c=new this.dateClassObj(c)));this.inherited(arguments,[c,d,k]);this.value instanceof Date&&(this.filterString="");!1!==d&&this.dropDown&&this.dropDown.set("value",c,!1)},_set:function(c,d){if("value"==c){d instanceof Date&&!(this.dateClassObj instanceof Date)&&
(d=new this.dateClassObj(d));var h=this._get("value");if(h instanceof this.dateClassObj&&0==this.compare(d,h))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(c){this._isInvalidDate(c)&&(c=new this.dateClassObj);this._set("dropDownDefaultValue",c)},openDropDown:function(d){this.dropDown&&this.dropDown.destroy();var h=c.isString(this.popupClass)?c.getObject(this.popupClass,!1):this.popupClass,k=this,a=this.get("value");this.dropDown=new h({onChange:function(a){k.set("value",
a,!0)},id:this.id+"_popup",dir:k.dir,lang:k.lang,value:a,textDir:k.textDir,currentFocus:this._isInvalidDate(a)?this.dropDownDefaultValue:a,constraints:k.constraints,filterString:k.filterString,datePackage:k.datePackage,isDisabledDate:function(a){return!k.rangeCheck(a,k.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(c,d){this._setValueAttr(this.parse(c,this.constraints),d,c)}})})},"jimu/dijit/_filter/TwoNumbersValueProvider":function(){define("dojo/_base/html dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./TwoNumbersValueProvider.html dijit/form/NumberTextBox".split(" "),
function(r,d,m,l,c,t){return d([m,l,c],{templateString:t,postCreate:function(){this.inherited(arguments);r.addClass(this.domNode,"jimu-two-numbers-filter-value-provider")},_onRangeNumberBlur:function(){if(this._dijit1.validate()&&this._dijit2.validate()){var c=parseFloat(this._dijit1.get("value")),d=parseFloat(this._dijit2.get("value"));c>d&&(this._dijit1.set("value",d),this._dijit2.set("value",c))}},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(c){this.isDefined(c.value1)&&
this._dijit1.set("value",c.value1);this.isDefined(c.value2)&&this._dijit2.set("value",c.value2)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))}:null},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var c={isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))};
isNaN(c.value1)&&(c.value1=null);isNaN(c.value2)&&(c.value2=null);return c}return null},setRequired:function(c){this._dijit1.set("required",c);this._dijit2.set("required",c)}})})},"jimu/dijit/_filter/TwoDatesValueProvider":function(){define("dojo/Evented dojo/_base/html dojo/_base/declare ./ValueProvider dijit/_WidgetsInTemplateMixin ./DateValueSelector dojo/text!./TwoDatesValueProvider.html".split(" "),function(r,d,m,l,c,t,q){return m([l,c,r],{templateString:q,postCreate:function(){this.inherited(arguments);
d.addClass(this.domNode,"jimu-two-dates-filter-value-provider");this._dijit1=new t({popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo,style:{width:"100%"}},this._dijitDiv1);this._dijit2=new t({popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo,style:{width:"100%"}},this._dijitDiv2)},_initDateSelectors:function(){},_onDateValueSelectorChanged:function(){this.emit("change")},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(c){this._setValueObject(this._dijit1,c,"value1",
"virtualDate1");this._setValueObject(this._dijit2,c,"value2","virtualDate2")},_setValueObject:function(c,d,l,k){if(this.isDefined(d[l])){var a={value:null,virtualDate:""};a.value=d[l];a.virtualDate=d[k];c.setValueObject(a)}},getValueObject:function(){if(this.isValidValue()){var c=this._dijit1.getValueObject(),d=this._dijit2.getValueObject();if(c.value&&d.value)return{isValid:!0,type:this.partObj.valueObj.type,value1:c.value,value2:d.value,virtualDate1:c.virtualDate,virtualDate2:d.virtualDate}}return null},
tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:null,value2:null,virtualDate1:null,virtualDate2:null}:null},getStatus:function(){return 1===this._dijit1.getStatus()&&1===this._dijit2.getStatus()?1:-1===this._dijit1.getStatus()||-1===this._dijit2.getStatus()?-1:0},setRequired:function(c){this._dijit1.set("required",c);this._dijit2.set("required",c)}})})},"jimu/dijit/_filter/ListValueProvider":function(){define("dojo/aspect dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./ListValueProvider.html dojo/store/Memory jimu/utils dijit/form/FilteringSelect".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g){return q([p,h,n],{templateString:k,codedValues:null,staticValues:null,showNullValues:!1,layerDataChanged:!1,ifDropDown:!1,postCreate:function(){this.inherited(arguments);l.addClass(this.domNode,"jimu-filter-list-value-provider");this._uniqueValueCache={};this.noDataTips='\x3cdiv class\x3d"error-tip-section" style\x3d"display: block;"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text"\x3e'+this.nls.noFilterValueTip+
"\x3c/span\x3e\x3c/div\x3e";var c=new a({idProperty:"id",data:[]});this.valuesSelect.set("store",c);this.isNumberField=g.isNumberField(this.fieldInfo.type);!this.staticValues&&"function"===typeof this.valuesSelect._onDropDownMouseDown&&(!this.codedValues||this.codedValues&&this.filterCodedValue)&&(this.own(r.before(this.valuesSelect,"_onDropDownMouseDown",m.hitch(this,this._onBeforeDropDownMouseDown))),this.own(t(document.body,"click",m.hitch(this,this._onBodyClick))),this.layerInfo&&this.layerInfo.getLayerObject().then(m.hitch(this,
function(a){a.on("edits-complete",m.hitch(this,function(){this.layerDataChanged=!0}))})))},_onFilteringSelectInput:function(){this.emit("change")},_getCodedValueLabelsBySubTypeId:function(){var a=this.getDropdownFilterPartsObj();return this.getCodedValueListByPartsObj(this.layerDefinition,this.fieldName,a,this.codedValues)},_onBeforeDropDownMouseDown:function(){this.ifDropDown=!0;this._tryUpdatingUniqueValues(void 0,!0);return arguments},_onBodyClick:function(a){a=a.target||a.srcElement;a===this.domNode||
l.isDescendant(a,this.domNode)||this.msgDiv&&l.setStyle(this.msgDiv,"display","none")},getDijits:function(){return[this.valuesSelect]},isValidValue:function(){return 0<this.getStatus()},getStatus:function(){var a=this.valuesSelect.get("item");if(a&&void 0!==a.value){if(this.isNumberField&&!g.isValidNumber(a.value)){var b=parseFloat(a.value);return g.isValidNumber(b)?(a.value=b,this._getStatusForDijit(this.valuesSelect)):-1}return this._getStatusForDijit(this.valuesSelect)}return 0},_getStatusForDijit:function(a){return a.validate()?
a.get("DisplayedValue")?1:0:-1},setValueObject:function(a){return this.staticValues?this._setValueForStaticValues(a.value,this.staticValues):this.codedValues?this.filterCodedValue?this._tryUpdatingUniqueValues(a.value,!1):this._setValueForStaticValues(a.value,this.codedValues):this._tryUpdatingUniqueValues(a.value,!1)},getValueObject:function(){if(this.isValidValue()){var a=this.valuesSelect.get("item").value;return{isValid:!0,type:this.partObj.valueObj.type,value:a}}return null},tryGetValueObject:function(){return this.isValidValue()?
this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:"string"===this.shortType?"":null}:null},setRequired:function(a){this.valuesSelect.set("required",a)},_setValueForStaticValues:function(a,b){var e=null,d=-1,e=null;b&&(e=c.map(b,m.hitch(this,function(b,c){b={id:c,value:b.value,label:b.label};b.value+""===a+""&&(d=c);return b})),this.valuesSelect.store.setData(e),0<=d&&(e=this.valuesSelect.store.get(d))&&this.valuesSelect.set("item",e),this._checkIfNoData())},
_uniqueValueLoadingDef:null,_uniqueValueLoadingExpr:"",_uniqueValueCache:null,_tryUpdatingUniqueValues:function(a,b){var c=new d;if(this.valuesSelect._opened)this._checkIfNoData(),c.resolve();else{var f=this.getDropdownFilterExpr();f!==this._uniqueValueLoadingExpr||this.layerDataChanged?(this.valuesSelect.readOnly=!0,this._uniqueValueLoadingDef&&(this._uniqueValueLoadingDef.reject(),this._uniqueValueLoadingDef=null),this._uniqueValueLoadingExpr=f,this._uniqueValueLoadingDef=this._getUniqueValues(f),
this._uniqueValueLoadingDef.then(m.hitch(this,function(e){this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._setValueForUniqueValues(a,e),this._hideLoadingIcon(),b&&this.valuesSelect.toggleDropDown(),this._checkIfNoData(),c.resolve())}),m.hitch(this,function(a){console.error(a);this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._hideLoadingIcon(),this._checkIfNoData(),c.reject(a))}))):(this._checkIfNoData(),c.resolve())}return c},_setValueForUniqueValues:function(a,
b){b.sort(function(a,b){return a.value<b.value?-1:a.value===b.value?0:1});this.showNullValues||(b=c.filter(b,m.hitch(this,function(a){return"\x3cNull\x3e"!==a.value&&null!==a.value})));if(void 0===a){var e=this.getValueObject();e&&(a=e.value)}var d=-1,e=null;b=c.map(b,m.hitch(this,function(b,c){var e={id:c,value:b.value,label:b.label};b.value+""===a+""&&(d=c);return e}));this.valuesSelect.store.setData(b);0<=d&&(e=this.valuesSelect.store.get(d));this.valuesSelect.set("item",e)},_checkIfNoData:function(){this.runtime&&
this.ifDropDown&&(this.ifDropDown=!1,0===this.valuesSelect.store.data.length&&(this.msgDiv?l.setStyle(this.msgDiv,"display","block"):(this.msgDiv=document.createElement("div"),l.addClass(this.msgDiv,"jimu-filter-list-value-provider-tip-container"),this.msgDiv.innerHTML=this.noDataTips,this.valuesSelect.domNode.parentNode.appendChild(this.msgDiv))))},_showLoadingIcon:function(){l.addClass(this.valuesSelect.domNode,"loading")},_hideLoadingIcon:function(){l.removeClass(this.valuesSelect.domNode,"loading")},
_getUniqueValues:function(a){var b=new d;this._uniqueValueCache[a]&&!this.layerDataChanged?b.resolve(this._uniqueValueCache[a]):(this._showLoadingIcon(),g.getUniqueValues(this.url,this.fieldName,a,this.layerDefinition,this.fieldPopupInfo).then(m.hitch(this,function(c){this.domNode&&(this._uniqueValueCache[a]=c,b.resolve(c),this._hideLoadingIcon())}),m.hitch(this,function(a){this.domNode&&(b.reject(a),this._hideLoadingIcon())})));this.layerDataChanged=!1;return b}})})},"jimu/dijit/_filter/AdvancedListValueProvider":function(){define("dojo/Deferred dojo/_base/lang dojo/Evented dojo/_base/html dojo/_base/array dojo/_base/declare dojo/query ./ValueProvider ./AdvancedListValueSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdvancedListValueProvider.html jimu/utils jimu/dijit/_filter/pageControlForQuery jimu/dijit/Popup".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b){return t([p,n,k,m],{templateString:a,codedValues:null,staticValues:null,showNullValues:!1,cbxPopup:null,pageSize:1E3,pageIndex:1,emptyStr:"",postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.noDataTips='\x3cdiv class\x3d"error-tip-section" style\x3d"display: block;"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text"\x3e'+
this.nls.noFilterValueTip+"\x3c/span\x3e\x3c/div\x3e";l.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");"ADVANCED_LIST_VALUE_PROVIDER"===this.providerType?(this.controlType="multipleDynamic",this.checkedNumDiv.style.display="block"):"LIST_VALUE_PROVIDER"===this.providerType?(this.controlType="uniqueDynamic",this.checkedNameDiv.style.display="block"):(this.runtime&&"dropdown"===this.selectUI&&("UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?this.checkedNameDiv.style.display=
"block":this.checkedNumDiv.style.display="block"),this.controlType="MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"multiplePredefined":"uniquePredefined");this.selectType="MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"multiple":"UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"unique":"LIST_VALUE_PROVIDER"===this.providerType?"unique":"multiple";this.disPlayLabel="value";!this.runtime||"multiplePredefined"!==this.controlType&&"uniquePredefined"!==this.controlType||(this.disPlayLabel=
"alias");!this.runtime||"multipleDynamic"!==this.controlType&&"uniqueDynamic"!==this.controlType||(this.isLoadDataAdvanced=!0);this.isNumberField=g.isNumberField(this.fieldInfo.type);this.pageControlForQuery||(this.pageControlForQuery=new f({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,fieldPopupInfo:this.fieldPopupInfo,isNumberField:this.isNumberField}),this.pageControlForQuery.on("query_getNewExpr",d.hitch(this,
this._resetPageControlNewExpr)));this.listSelect||(this.listSelectDataList=this.partObj&&this.partObj.valueObj&&this.partObj.valueObj.value?this.partObj.valueObj.value:[],this.listSelect=new h({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectUI:this.selectUI,controlType:this.controlType,selectType:this.selectType,dataList:this.listSelectDataList,selectedDataList:[],isNumberField:this.isNumberField}),d.isArray(this.listSelectDataList)?this.getCheckedList(this.listSelectDataList):
(this.listSelect.checkedList=[this.listSelectDataList],this.listSelect._updateCheckedLabelListFromCheckedList()),this.listSelect.on("advancedListValueSelect_itemChecked",d.hitch(this,this._createTarget)),this.listSelect.on("advancedListValueSelect_itemUnChecked",d.hitch(this,this._destoryTarget)),this.listSelect.on("advancedListValueSelect_addNextPage",d.hitch(this,this._addNextPage)),this.listSelect.on("advancedListValueSelect_searchKey",d.hitch(this,this._searchKey)),this.listSelect.on("advancedListValueSelect_searchKeyLocal",
d.hitch(this,this._searchKeyLocal)),this.staticValues||"function"!==typeof this._checkedBtnEvent||(!this.codedValues||this.codedValues&&this.filterCodedValue)&&this.layerInfo&&this.layerInfo.getLayerObject().then(d.hitch(this,function(a){a.on("edits-complete",d.hitch(this,function(){this.layerDataChanged=!0}))})));"dropdown"===this.selectUI?(l.setStyle(this.checkedBtn,"display","block"),this._multipleSelectProviderEventHandler=d.hitch(this,this._multipleSelectProviderEvent),document.addEventListener("click",
this._multipleSelectProviderEventHandler,{capture:!0})):this.listSelect.placeAt(this.listContent)},filterExpr:null,_resetPageControlNewExpr:function(){var a=this.getDropdownFilterExpr();return this.filterExpr!==a?(this.pageControlForQuery.reset(),this.filterExpr=this.pageControlForQuery.cascadeFilterExprs=a,!0):!1},_multipleSelectProviderEvent:function(a){a=a.target||a.srcElement;if(this.cbxPopup&&this.cbxPopup.domNode){if(l.isDescendant(a,this.cbxPopup.domNode)||l.isDescendant(a,this.checkedBtn))return;
"block"===l.getStyle(this.cbxPopup.domNode,"display")&&(this._resetListSelectState(this),this.cbxPopup.hide())}else!l.isDescendant(a,this.checkedBtn)&&this.isPopupLoading&&(this.isLoadDataAdvanced=!0);this.msgDiv&&l.setStyle(this.msgDiv,"display","none")},_checkedBtnEvent:function(){this._showPopup()},_onBeforeDropDownMouseDown:function(){this._tryUpdatingUniqueValues(void 0,!0);return arguments},_isRestSelectList:!1,_resetListSelectState:function(a){"block"===l.getStyle(a.listSelect.searchKeyInput,
"display")&&("multipleDynamic"===this.controlType&&this.listSelect.showAllList(),a.listSelect.listContainer.scrollTop=0,a.listSelect.queryState=!0,a.listSelect.valueInput.set("value",""),this._isRestSelectList=!0)},_createTarget:function(a){this._checkedChanged(1,a);this.cbxPopup&&("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType)&&this.cbxPopup.domNode&&(this._resetListSelectState(this),this.cbxPopup.close())},_destoryTarget:function(a){this._checkedChanged(-1,a)},_checkedChanged:function(a,
b){if("multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType&&this.runtime&&"dropdown"===this.selectUI)b&&(a=parseInt(this.checkedNum.innerText,10)+a,this.checkedNum.innerText=0<a?a:0);else if("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType&&this.runtime&&"dropdown"===this.selectUI)"uniqueDynamic"===this.controlType&&(b===this.emptyStr?l.addClass(this.checkedNameDiv,"checkedEmptyNameDiv"):l.removeClass(this.checkedNameDiv,"checkedEmptyNameDiv")),a=
b?b:this._getCheckedNameDivText(),this._setCheckedNameDivText(a);this.listSelect.set("displayedValue","12345678");this.emit("change")},_clearCheckedTxt:function(){this.runtime&&"dropdown"===this.selectUI&&("multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType?this.checkedNum.textContent?this.checkedNum.textContent=0:this.checkedNum.innerText=0:"uniqueDynamic"!==this.controlType&&"uniquePredefined"!==this.controlType||this._setCheckedNameDivText(""),this.valueList=[],this.listSelect.checkedList=
[],this.listSelect.checkedLabelList=[],this.listSelect.valueInput.set("value",""),"multipleDynamic"===this.controlType&&this.listSelect.showAllList());this.listSelect.set("displayedValue","12345678");this.emit("change")},_layerDataChangedCallback:function(){this.layerDataChanged&&(this.pageControlForQuery.reset(),this.listSelect.ifFristPage=!0,this.layerDataChanged=!1)},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this._layerDataChangedCallback(),this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage).then(d.hitch(this,
function(a){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;this.listSelect.ifFristPage&&this._checkIfNoData(a)||(this.listSelect.setCBXData(a,!0,this.listSelect.ifFristPage),this._hideLoadingIcon())}),d.hitch(this,function(a){console.log(a);this.listSelect.queryState=!1;this._hideLoadingIcon()})))},_searchKey:function(a){this.listSelect&&(this._showLoadingIcon(),this._layerDataChangedCallback(),this.pageControlForQuery._searchKey(a).then(d.hitch(this,function(a){this.listSelect.setCBXContentBySearch(a);
this._resetPopupStyles(!a.length);this._hideLoadingIcon()}),d.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},_searchKeyLocal:function(a,b){if(this.listSelect){"uniqueDynamic"===this.controlType&&this._isRestSelectList&&(this.listSelect.keyQueryMode=!1,this._isRestSelectList=this.listSelect.cacheQueryMode=!1);this._showLoadingIcon();var c=this.pageControlForQuery._searchKeyLocal(a);""===a&&0===c.length?(this.layerDataChanged=!0,this._layerDataChangedCallback(),this._addNextPage()):
this.listSelect.setCBXContentBySearch(c,b);this._resetPopupStyles(!0);this._hideLoadingIcon()}},queryByPage:function(){var a=this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);a.then(d.hitch(this,function(b){a.resolve(b)}),d.hitch(this,function(b){console.log(b);a.reject(b)}))},getCheckedList:function(a){this.listSelect.checkedList=[];this.listSelect.checkedLabelList=[];c.forEach(a,d.hitch(this,function(a){var b;d.isObject(a)?a.isChecked&&(b=a.value):b=a;if(b||0===b)b=this.isNumberField?
parseFloat(b):b,this.listSelect.checkedList.push(b)}))},getCheckedStrsList:function(a){var b=[];c.forEach(a,d.hitch(this,function(a){var c;d.isObject(a)?a.isChecked&&(c=a[this.disPlayLabel]):c=a;(c||0===c)&&b.push(c)}));return b},showContent:function(a){var b=new r;this.getCheckedList(this.valueList);this.listSelect.codedValues=!1;this.listSelect.disPlayLabel="value";var c;if("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType)return this.runtime&&(this.listSelect.disPlayLabel=
"alias"),(c=this._checkIfNoData(this.valueList))||this.listSelect.setCBXData(this.valueList,!0,a),this._hideLoadingIcon(),b.resolve(c),b;if(this.staticValues)return c=this._setValueForStaticValues(this.staticValues),b.resolve(c),b;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return c=this._setValueForStaticValues(this.codedValues),b.resolve(c),b;this._showLoadingIcon();if("multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType)this._layerDataChangedCallback(),
this.pageControlForQuery.queryByPage(a).then(d.hitch(this,function(e){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;e=this._handleCodedValue(e);(c=this._checkIfNoData(e))||this.listSelect.setCBXData(e,!0,a);this._hideLoadingIcon();b.resolve(c)}),d.hitch(this,function(a){console.log(a);this._hideLoadingIcon();b.reject(a)}));return b},_handleCodedValue:function(a){this.listSelect.disPlayLabel="label";if(!this.codedValues)return this.listSelect._updateCheckedLabelListFromCheckedList(),
a;this.pageControlForQuery._codedvalueCache=a;"uniqueDynamic"===this.controlType&&this._setCheckedName(this.listSelect.checkedList?this.listSelect.checkedList[0]:"",a);this.listSelect._updateCheckedLabelList(this.codedValues);return a},_showDropdown:function(a){var b=l.position(a.target),e;e=this.isInFilterSet?this.domNode.parentNode.parentNode.parentNode:this.domNode.parentNode;var d=l.position(e);if("none"!==l.getStyle(this.listContentPopup,"display"))l.setStyle(this.listContentPopup,"display",
"none");else{c.forEach(q(".value-type-popup",e),function(a){l.setStyle(a,"display","none")},this);l.place(this.listContentPopup,e);var f;f=l.hasClass(q(".desktop-add-section",e.parentNode)[0],"hidden")?-5:30;f=b.y-d.y-e.parentNode.scrollTop+f;f+170>e.parentNode.scrollHeight&&(f=e.parentNode.scrollHeight-170-40);window.isRTL?b=b.x-d.x+20:(b=b.x-d.x-100-90,b+150>e.clientWidth&&(b=e.clientWidth-150));l.setStyle(this.listContentPopup,{display:"block",left:b+"px",top:f+"px"});a.stopPropagation()}},_calculatePopup:function(){var a=
l.position(this.domNode.parentNode),b=l.position(document.body).h,c=a.y+30;b-c<this._cbxHeight&&(c=a.y-this._cbxHeight);return{left:a.x,top:c}},_cbxWidth:210,_cbxHeight:362,popupIsNoData:!1,isPopupLoading:!1,isLoadDataAdvanced:!1,_showPopup:function(){if(!this.isPopupLoading)if(this.cbxPopup&&this.cbxPopup.domNode&&"block"===l.getStyle(this.cbxPopup.domNode,"display"))this._resetListSelectState(this),this.cbxPopup.hide();else{var a=this._resetPageControlNewExpr();a&&this.cbxPopup&&(this.cbxPopup.close(),
this._clearCheckedTxt());var c=this._calculatePopup();this._cbxWidth=l.getStyle(this.checkedBtn,"width");if(!a&&this.cbxPopup&&this.cbxPopup.domNode&&!this.layerDataChanged)this.popupIsNoData?this._checkIfNoData([]):(this.cbxPopup.show(),this._resetPopupStyles(),this.listSelect.valueInput&&this.listSelect.valueInput.focus(),this.listSelect.queryState=!1);else{this.isPopupLoading=!0;this.isLoadDataAdvanced||this._showDataQueryingIcon();var f=this.showContent(!0);f.then(d.hitch(this,function(a){this.isPopupLoading=
!1;this._hideDataQueryingIcon();this.popupIsNoData=a;a||(this.cbxPopup=new b({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:c.left,top:c.top},hiddenAfterInit:this.isLoadDataAdvanced,onClose:d.hitch(this,function(){this.cbxPopup.hide();return!1}),buttons:[]}),this.cbxPopup.setDomNodeStyls({"border-radius":0,border:"1px solid #999"}),this.cbxPopup.on("popupHasInitedSuccessfully",
d.hitch(this,function(a){this._resetPopupStyles(!1,!0);a||this.listSelect.valueInput&&this.listSelect.valueInput.focus()})));this.isLoadDataAdvanced&&(this.isLoadDataAdvanced=!1)}),d.hitch(this,function(a){this.isPopupLoading=!1;console.log(a);f.reject(a)}))}}},_itemContainerH:300,_resetPopupStyles:function(a,b){var c=this._itemContainerH,e=l.getStyle(this.listSelect.listContent,"height");0===e&&this.cbxPopup&&this.cbxPopup.domNode&&"none"===l.getStyle(this.cbxPopup.domNode,"display")&&(e=this.popupInitHeight);
b&&(this.popupInitHeight=e);!a||this.listSelect.codedValues||this.pageControlForQuery._isUniqueValueCacheFinish||(e+=25);this.pageControlForQuery._isUniqueValueCacheFinish&&"block"===l.getStyle(this.listSelect.noDataTips,"display")&&(e+=30);c=e<c?e:c;l.setStyle(this.listSelect.listContainer,"height",c+"px");l.setStyle(this.listSelect.selectedContainer,"height",c+30+"px");"multipleDynamic"===this.controlType?c=c+30+30:"uniqueDynamic"===this.controlType&&(c+=30);this._cbxHeight=c+10;a=this._calculatePopup();
this._cbxWidth=l.getStyle(this.checkedBtn,"width");this.cbxPopup.setCustomPosition(a.left,a.top,this._cbxWidth,this._cbxHeight);this._resetItemWidth()},_resetItemWidth:function(){var a=this._cbxWidth-20;"uniqueDynamic"===this.controlType||this.runtime&&"uniquePredefined"===this.controlType&&"dropdown"===this.selectUI||!this.runtime&&("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType)||(a=!this.runtime||"dropdown"===this.selectUI||"uniquePredefined"!==this.controlType&&
"multiplePredefined"!==this.controlType?a-30:a-15);window.isRTL&&(a-=3);this.listSelect._itemLabelW=a;q(".item .label",this.listSelect.listContent).style({"max-width":a+"px"})},_setValueForStaticValues:function(a){this.listSelect.codedValues=!0;this.listSelect._updateCheckedLabelList(this.codedValues);if(a){this.pageControlForQuery._codedvalueCache=a;var b=this._checkIfNoData(a);b||(this.listSelect.disPlayLabel="label",this.listSelect.setCBXData(a,!0,!0));return b}return!1},_checkIfNoData:function(a){if(this.runtime&&
"dropdown"===this.selectUI){if(a&&0<a.length)return!1;this.msgDiv?l.setStyle(this.msgDiv,"display","block"):(this.msgDiv=document.createElement("div"),l.addClass(this.msgDiv,"jimu-filter-list-value-provider-tip-container"),this.msgDiv.innerHTML=this.noDataTips,this.checkedBtn.parentNode.appendChild(this.msgDiv));return!0}return!1},getDijits:function(){return[this.listSelect]},_setCheckedName:function(a,b){var c=a;if(b=b?b:this.codedValues){for(var e=!1,d=0;d<b.length;d++){var f=b[d];if(f.value===
a){c=f.label;e=!0;break}}e||(c=this.emptyStr,this.valueList=[],this.listSelect&&(this.listSelect.checkedList=[],this.listSelect.checkedLabelList=[]))}else void 0===a?(c=this.emptyStr,l.addClass(this.checkedNameDiv,"checkedEmptyNameDiv")):l.removeClass(this.checkedNameDiv,"checkedEmptyNameDiv");this._setCheckedNameDivText(c)},setValueObject:function(a){a.value=a.value||0===a.value?a.value:[];this.valueList=a.value;this.enableEmpty=a.enableEmpty;this.listSelect.enableEmpty=a.enableEmpty;if("multipleDynamic"===
this.controlType)this.checkedNum.innerText=this.valueList.length,this.isLoadDataAdvanced&&this._checkedBtnEvent();else if("uniqueDynamic"===this.controlType)a=this.valueList,d.isArray(a)&&0===a.length&&(a=void 0),this._setCheckedName(a),this.valueList=[this.valueList],this.isLoadDataAdvanced&&this._checkedBtnEvent();else{this.emptyStr=a.emptyLabel?a.emptyLabel:this.emptyStr;this.listSelect.emptyStr=this.emptyStr;if(this.runtime&&"dropdown"===this.selectUI){var b=[];"value"===this.disPlayLabel?(this.getCheckedList(this.valueList),
b=this.listSelect.checkedList):b=this.getCheckedStrsList(this.valueList);"uniquePredefined"===this.controlType?0<this.listSelect.checkedList.length?this._setCheckedNameDivText(b[0]):this._setCheckedNameDivText(a.enableEmpty?this.emptyStr:""):this.checkedNum.innerText=b.length}this.showContent(!0);setTimeout(d.hitch(this,function(){this._cbxWidth=l.getStyle(this.listSelect.listContent,"width");this._resetItemWidth()}),50)}},_getCheckedNameDivText:function(){return this.checkedNameDiv.textContent||
this.checkedNameDiv.innerText||""},_setCheckedNameDivText:function(a){this.isNumberField&&"number"===typeof a&&(a=g._getValues(this.layerDefinition,this.fieldPopupInfo,this.fieldName,[a])[0].label);this.checkedNameDiv.textContent?this.checkedNameDiv.textContent=a:this.checkedNameDiv.innerText=a},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var a=null,a="multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType?[]:"string"===
this.shortType?"":null;return{isValid:!0,type:this.partObj.valueObj.type,value:a}}return null},getValueObject:function(){if(this.isValidValue()){var a;a="multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType?this.listSelect.getListCheckedValues():this.listSelect.getListValues();"uniqueDynamic"===this.controlType&&(a=d.isArray(a)?a[0]:a);!this.runtime&&this.cbxPopup&&this.cbxPopup.domNode&&(this.cbxPopup.onClose=d.hitch(this,function(){return!0}),this.cbxPopup.close());return{isValid:!0,
type:this.partObj.valueObj.type,value:a}}return null},setRequired:function(a){this.listSelect.set("required",a)},_showDataQueryingIcon:function(){this._validatingNode||(this._validatingNode=l.create("div",{"class":"jimu-circle-loading"},this.checkedBtn));l.setStyle(this._validatingNode,"display","block")},_hideDataQueryingIcon:function(){this._validatingNode&&l.setStyle(this._validatingNode,"display","none")},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&l.addClass(this.listSelect.listContainer,
"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&l.removeClass(this.listSelect.listContainer,"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&document.removeEventListener("click",this._multipleSelectProviderEventHandler,{capture:!0});this.inherited(arguments)},destroyProvider:function(){this.listSelect&&this.listSelect.destroy();this.listSelect=null}})})},"jimu/dijit/_filter/AdvancedListValueSelect":function(){define("dojo/_base/lang dojo/Evented dojo/_base/html dojo/_base/declare dijit/_WidgetBase dojo/on dojo/query dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdvancedListValueSelect.html jimu/utils".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k){return l([c,p,h,d],{templateString:n,selectType:null,dataList:[],checkedList:[],checkedLabelList:[],_itemLabelW:215,ifFristPage:!0,queryState:!0,isCacheFinish:!1,keyQueryMode:!1,cacheQueryMode:!1,emptyStr:"",postMixInProperties:function(){this.inherited(arguments);this.jimuCommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.noDataNls=window.apiNls.widgets.FeatureTable.noData},postCreate:function(){this.inherited(arguments);this.inputType="unique"===
this.selectType?"radio":"checkbox";if("multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType)m.addClass(this.listContainer,"items-setting-dropdown-content"),this.searchKeyInput.style.display="block";"uniqueDynamic"===this.controlType&&m.addClass(this.listContainer,"items_content_no_selected_toggle");this.runtime?(m.addClass(this.listContainer,"items-widget-content"),"dropdown"!==this.selectUI&&(m.addClass(this.listContainer,"items-widget-expaned-content"),m.addClass(this.listContent,
"jimu-multiple-items-expanded-list"))):(m.addClass(this.listContainer,"items-setting-popup-content"),this.searchKeyInput.style.display="block");this.runtime||"predefined"!==this.controlType||(m.addClass(this.listContainer,"items-setting-dropdown-content"),m.addClass(this.listContainer,"items_content_no_selected_toggle"),this.searchKeyInput.style.display="block");this._addCBXClickEvent();("dropdown"===this.selectUI||"predefined"===this.controlType&&!this.runtime)&&this._addCBXHoverEvent();this.disPlayLabel=
"value";!this.runtime||"multiplePredefined"!==this.controlType&&"uniquePredefined"!==this.controlType||(this.disPlayLabel="alias");"multipleDynamic"===this.controlType&&(this.selectedToggleDiv.style.display="block",this.selectedToggle=q(".showAllIcon",this.selectedToggleDiv)[0],this.own(t(this.selectedToggleDiv,"click",r.hitch(this,"_toggleFilter"))),this._addSelectedContainerEvent())},_toggleFilter:function(a){var c=a.target;m.hasClass(c,"clearAllSelectedIcon")?this._clearAllSelected():m.hasClass(c,
"iconHover")||m.hasClass(c,"selectedToggleDiv")||(m.hasClass(c,"showAllIcon")?this.selectedContainer.style.display="none":(this._initSelectedContainerItems(),this.selectedContainer.style.display="block"),m.removeClass(this.selectedToggle,"iconHover"),this.selectedToggle=c,m.addClass(this.selectedToggle,"iconHover"),a.stopPropagation())},showAllList:function(){m.hasClass(this.selectedToggle,"showSelectedIcon")&&m.hasClass(this.selectedToggle,"iconHover")&&(m.removeClass(this.selectedToggle,"iconHover"),
this.selectedToggle=q(".showAllIcon",this.selectedToggleDiv)[0],m.addClass(this.selectedToggle,"iconHover"),m.setStyle(this.selectedContainer,"display","none"))},_clearAllSelected:function(){var a;a=m.hasClass(this.selectedToggle,"showAllIcon")?this.listContainer:this.selectedListContent;a=q(".item .checkInput.checked",a);for(var c=0;c<a.length;c++)a[c].click()},_initSelectedContainerItems:function(){for(var a=this.selectedListContent.innerHTML="",c=this.runtime?" labelRuntime":"",d=0;d<this.checkedList.length;d++)var b=
this.checkedList[d],a=a+('\x3cdiv class\x3d"item"\x3e\x3cdiv class\x3d"checkInput '+this.inputType+' checked" '+(this.isNumberField?"data\x3d"+b:"data\x3d'"+b+"'")+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label jimu-ellipsis-Blanks'+c+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+("value"===this.disPlayLabel?b:this.checkedLabelList[d])+"\x3c/div\x3e\x3c/div\x3e");this.selectedListContent.innerHTML=a},_addSelectedContainerEvent:function(){this.own(t(this.selectedListContent,"click",r.hitch(this,function(a){var c=
a.target,d;if(m.hasClass(c,"item"))d=c.firstElementChild,c=c.firstElementChild.nextSibling;else if(m.hasClass(c,"checkInput"))d=c,c=c.nextSibling;else if(m.hasClass(c,"label"))d=c.previousSibling;else{a.stopPropagation();return}var b=c=this._getNodeText(c);if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)b=decodeURIComponent(m.getAttr(d,"data"));if(m.hasClass(d,"checked")){if("radio"===this.inputType)return;m.removeClass(d,"checked");this._updateCheckedList("remove",b,c);this.checkCBXItems();
this.emit("advancedListValueSelect_itemUnChecked",c)}else"radio"===this.inputType&&this.currentItem&&(!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),m.removeClass(this.currentItem,"checked")),m.addClass(d,"checked"),this._updateCheckedList("add",b,c),this.checkCBXItems(),this.emit("advancedListValueSelect_itemChecked",c);a.stopPropagation()})))},_getNodeText:function(a){return a.textContent||a.innerText||""},_updateCheckedList:function(a,c,d){c!==this.emptyStr&&(c=this.isNumberField?
parseFloat(c):c);if("remove"===a)for(var b in this.checkedList){if(this.checkedList[b]===c||this.isNumberField&&isNaN(this.checkedList[b])&&isNaN(c)){this.checkedList.splice(b,1);this.checkedLabelList.splice(b,1);break}}else"radio"===this.inputType?(this.checkedList=[c],this.checkedLabelList=[d]):(this.checkedList.push(c),this.checkedLabelList.push(d))},_updateCheckedLabelList:function(a){this.checkedLabelList=[];for(var c=0;c<this.checkedList.length;c++)for(var d=0;d<a.length;d++)this.checkedList[c]===
a[d].value&&this.checkedLabelList.push(a[d].label)},_updateCheckedLabelListFromCheckedList:function(){for(var a=0;a<this.checkedList.length;a++)this.checkedLabelList.push(this.checkedList[a]+"")},_createTarget:function(a){a=this._getNodeText(a.target).split(": ")[1];this.emit("advancedListValueSelect_itemChecked",a)},_deleteCBXItem:function(){},_getCheckInputItems:function(){return q(".item .checkInput",this.listContent)},getListCheckedValuesOrigin:function(){for(var a=[],c=this._getCheckInputItems(),
d=0;d<c.length;d++){var b=c[d],e=this._getNodeText(b.nextSibling);m.hasClass(b,"checked")&&a.push(e)}return a},getListCheckedValues:function(){for(var a=[],c=r.clone(this.checkedList),d=0;d<c.length;d++){var b=c[d],b=this.isNumberField?parseFloat(b):b;a.push(b)}return a},getListValues:function(){var a=[],c=this._getCheckInputItems();if(0===c.length)return this.dataList;for(var d=0;d<c.length;d++){var b=c[d],e=this._getNodeText(b.nextSibling);if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)e=
decodeURIComponent(m.getAttr(b,"data"));e=this.isNumberField?parseFloat(e):e;e={value:e,isChecked:!1};m.hasClass(b,"checked")&&(e.isChecked=!0);a.push(e)}return a},getIfValueExist:function(a){for(var c=this._getCheckInputItems(),d=0;d<c.length;d++){var b=this._getNodeText(c[d].nextSibling);if(a===b)return!0}return!1},getCurrentItem:function(){for(var a=this._getCheckInputItems(),c=0;c<a.length;c++){var d=a[c];if(m.hasClass(d,"checked"))return d}return null},checkCBXItems:function(a){a=a?"":this.valueInput.get("value");
this.valueInput.set("value",a);a=q(".item .label",this.listContent);for(var c=0;c<a.length;c++){var d=a[c],b="value"===this.disPlayLabel?this._getNodeText(d):decodeURIComponent(m.getAttr(d.previousSibling,"data")),b=this.isNumberField?parseFloat(b):b;0<=this.checkedList.indexOf(b)||this.isNumberField&&0<=this.checkedList.indexOf(parseFloat(b))?m.addClass(d.previousSibling,"checked"):m.removeClass(d.previousSibling,"checked")}},reset:function(){this.listContent.innerHTML=""},setCBXData:function(a,
c,d,b){b||(this.queryState=!1);a=a?a:[];if(this.listContent){m.setStyle(this.noDataTips,"display","none");var e=0,f="radio"===this.inputType?" labelBig":"",g=this.runtime?" labelRuntime":"";b=this.listContent.innerHTML;if(d){b=this.listContent.innerHTML="";if("uniquePredefined"===this.controlType&&this.enableEmpty||"uniqueDynamic"===this.controlType&&!this.keyQueryMode)d=b="",this.checkedList[0]===this.emptyStr&&(b=" checked",d=" active",e=1),0===this.checkedList.length&&(b=" checked",this.currentItem=
!0,e=1),b='\x3cdiv class\x3d"item emptyItem'+d+'"\x3e\x3cdiv class\x3d"checkInput '+this.inputType+b+'" '+("data\x3d'"+this.emptyStr+"'")+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label'+f+" jimu-ellipsis-Blanks"+g+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+this.emptyStr+"\x3c/div\x3e\x3c/div\x3e";this.listContainer.scrollTop=0}if(0===a.length)return a=this.listContent.innerHTML.replace(/(^\s*)|(\s*$)/g,""),""!==a||this.cacheQueryMode&&!this.isCacheFinish||m.setStyle(this.noDataTips,"display","block"),
""===a&&(this.listContent.innerHTML=b),this.listContent;d="";for(var h=0;h<a.length;h++){var k=a[h],l="";if(c)if(this.runtime&&("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType))k.isChecked&&(l=" checked",this.currentItem=!0,e++);else if(0<=this.checkedList.indexOf(k.value)||this.isNumberField&&0<=this.checkedList.indexOf(parseFloat(k.value)))l=" checked",this.currentItem=!0,e++;var n='data\x3d"'+(this.isNumberField?k.value:encodeURIComponent(k.value))+'"';d+='\x3cdiv class\x3d"item"\x3e\x3cdiv class\x3d"checkInput '+
this.inputType+l+'" '+n+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label'+f+" jimu-ellipsis-Blanks"+g+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+k[this.disPlayLabel]+"\x3c/div\x3e\x3c/div\x3e"}a=this.checkedList.length-e;if(this.runtime&&0<a)for(c=0;c<a;c++)this.emit("advancedListValueSelect_itemUnChecked","");this.listContent.innerHTML=b+d;return this.listContent}},setCBXContentBySearch:function(a,c){0===a.length?this.setCBXData([],!1,!0,c):this.setCBXData(a,!0,!0,c)},_onSearchKeyChange:function(){var a=
this.valueInput.get("value");this.searchName=a;this.listContainer.scrollTop=0;this.reset();this.cacheQueryMode=this.keyQueryMode=this.ifFristPage=!0;this.emit("advancedListValueSelect_searchKeyLocal",a);this.codedValues||(this.isCacheFinish||m.setStyle(this.loadMoreDataBtn,"display","block"),0===a.length&&(this.queryState=this.cacheQueryMode=this.keyQueryMode=!1,m.setStyle(this.loadMoreDataBtn,"display","none")))},_loadMoreDataFromServer:function(){this.keyQueryMode=this.ifFristPage=!0;this.cacheQueryMode=
!1;this.queryState=!0;m.setStyle(this.loadMoreDataBtn,"display","none");var a=this.valueInput.get("value");this.searchName=a;this.listContainer.scrollTop=0;"multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType?this.emit("advancedListValueSelect_searchKey",a):this.runtime||this.emit("advancedListValueSelect_searchKey",a)},currentHoverItem:null,_addCBXHoverEvent:function(){this.own(t(this.listContent,"mouseover",r.hitch(this,function(a){a=a.target||a.srcElement;a=m.hasClass(a,"item")?
a:k.getAncestorDom(a,function(a){return m.hasClass(a,"item")},3);this.currentHoverItem&&m.removeClass(this.currentHoverItem,"active");m.addClass(a,"active");this.currentHoverItem=a})));this.own(t(this.listContent,"mouseout",r.hitch(this,function(){this.currentHoverItem&&m.removeClass(this.currentHoverItem,"active");this.currentHoverItem=null})))},_addCBXClickEvent:function(){this.own(t(this.valueInput,"change",r.hitch(this,function(){this._onSearchKeyChange()})));this.own(t(this.loadMoreDataBtn,"click",
r.hitch(this,function(){this._loadMoreDataFromServer()})));this.own(t(this.listContainer,"scroll",r.hitch(this,this.dropDownScroll)));this.own(t(this.searchKeyInput,"click",r.hitch(this,function(a){a.stopPropagation()})));this.own(t(this.listContainer,"click",r.hitch(this,function(a){var c=a.target,d;if(m.hasClass(c,"item"))d=c.firstElementChild,c=c.firstElementChild.nextSibling;else if(m.hasClass(c,"checkInput"))d=c,c=c.nextSibling;else if(m.hasClass(c,"label"))d=c.previousSibling;else{a.stopPropagation();
return}this._setCBXChecked(d,this._getNodeText(c));a.stopPropagation()})))},scrollDiff:100,dropDownScroll:function(a){this.runtime&&("uniquePredefined"===this.controlType||"multiplePredefined"===this.controlType)||this.cacheQueryMode||this.codedValues||(this.queryState?this.listContainer.scrollTop=this.containerScrollTop:(a=a.target,a.scrollHeight-a.clientHeight-a.scrollTop<=this.scrollDiff&&!this.queryState&&(this.containerScrollTop=this.listContainer.scrollTop,this.queryState=!0,this.ifFristPage=
!1,this.emit("advancedListValueSelect_addNextPage"))))},_setCBXChecked:function(a,c){var d=c;if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)d=decodeURIComponent(m.getAttr(a,"data"));m.hasClass(a,"checked")?"radio"===this.inputType?this.runtime||"predefined"!==this.controlType?this.emit("advancedListValueSelect_itemChecked",c):this.emit("advancedListValueSelect_itemCheckedForPredefined",d,c):(m.removeClass(a,"checked"),this._updateCheckedList("remove",d,c),this.emit("advancedListValueSelect_itemUnChecked",
c)):("radio"===this.inputType&&this.currentItem&&(!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),this.currentItem&&m.removeClass(this.currentItem,"checked")),m.addClass(a,"checked"),this.currentItem=a,this._updateCheckedList("add",d,c),this.runtime||"predefined"!==this.controlType?this.emit("advancedListValueSelect_itemChecked",c):this.emit("advancedListValueSelect_itemCheckedForPredefined",d,c))},initDoms:function(a,c){this.setCBXData(a,c)},getData:function(){},refreshData:function(){this.checkCBXItems()},
validate:function(){var a=this.checkedList.length?"12345678":null;1===this.checkedList.length&&this.checkedList[0]===this.emptyStr&&(a=null);if(this.isNumberField)for(var c=0;c<this.checkedList.length;c++){var d=this.checkedList[c];if(d!==this.emptyStr&&isNaN(d)){a=null;break}}this.set("DisplayedValue",a);return!0},setRequired:function(a){this.mutiValuesSelect.set("required",a)},destroy:function(){m.destroy(this.domNode);this.inherited(arguments)}})})},"jimu/dijit/_filter/pageControlForQuery":function(){define("dojo/Deferred esri/tasks/query dojo/_base/array dojo/_base/lang dojo/_base/declare jimu/Query jimu/LayerStructure dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./pageControlForQuery.html jimu/utils".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a){return c([p,h,n],{templateString:k,layerUrl:null,fieldInfo:null,fieldPopupInfo:null,spatialReference:null,layerDefinition:null,isNumberField:!1,showNullValues:!1,_isUniqueValueCacheFinish:!1,_uniqueValueCache:{},_uniqueValueCacheForOtherTypes:{},_codedvalueCache:[],cascadeFilterExprs:"1\x3d1",numbericFieldLength:{esriFieldTypeOID:32,esriFieldTypeSmallInteger:16,esriFieldTypeInteger:32,esriFieldTypeSingle:128,esriFieldTypeDouble:1024},pageIndex:1,pageSize:1E3,postCreate:function(){this.inherited(arguments);
this.spatialReference=q.getInstance().map.spatialReference;this.reset();this.queryType=t.getQueryType(this.layerDefinition);this.isNumberField&&(this.fieldLength=this.numbericFieldLength[this.fieldInfo.type])},reset:function(){this.pageIndex=1;this._isUniqueValueCacheFinish=!1;this._uniqueValueCache={};this._uniqueValueCacheForOtherTypes={};this._codedvalueCache=[]},isKeyQueryLoader:!1,_searchKey:function(a){var c=new r,b=new d,e="",e=this.isNumberField?"CAST("+this.fieldInfo.name+" AS CHAR("+this.fieldLength+
")) LIKE '%"+a+"%'":this.fieldInfo.name+" LIKE '%"+a+"%'";b.where="(("+this.cascadeFilterExprs+") AND ("+e+"))";b.geometry=null;b.outSpatialReference=this.spatialReference;b.outFields=[this.fieldInfo.name];b.returnDistinctValues=!0;b.returnGeometry=!1;b.orderByFields=b.outFields;this.layerLoaderForKey=new t({url:this.layerUrl,query:b,pageSize:this.pageSize});this.isKeyQueryLoader=!0;this._uniqueValueCacheForOtherTypes={};this.queryByPage(!0).then(l.hitch(this,function(a){c.resolve(a)}),l.hitch(this,
function(a){c.reject("reject:"+a)}));return c},_searchKeyLocal:function(a){a=a.toUpperCase();this.isKeyQueryLoader=!1;var c=[],b=this._codedvalueCache,e;if(0<b.length)for(var d=0;d<b.length;d++)e=b[d],e.label&&0<=e.label.toString().toUpperCase().indexOf(a)&&c.push(e);else for(d in b=this._uniqueValueCache,b)for(var g=b[d],h=0;h<g.length;h++){e=g[h];var k=e.label;k&&0<=k.toString().toUpperCase().indexOf(a)&&c.push(e)}return c},queryByPage:function(a){var c=new r;this.layerLoader&&this.layerLoader.query.where!==
this.cascadeFilterExprs&&(this.layerLoader=null,this.isKeyQueryLoader=!1,this.reset());if(!this.layerLoader){var b=new d;b.where=this.cascadeFilterExprs;b.geometry=null;b.outSpatialReference=this.spatialReference;b.outFields=[this.fieldInfo.name];b.returnDistinctValues=!0;b.returnGeometry=!1;b.orderByFields=b.outFields;this.layerLoader=new t({url:this.layerUrl,query:b,pageSize:this.pageSize})}a&&(this.pageIndex=1);a=[];if(this.isKeyQueryLoader){if(this._uniqueValueCacheForOtherTypes[this.pageIndex])return a=
this._resolveValueLabelsFromCache(this._uniqueValueCacheForOtherTypes),c.resolve(a),c;a=this.layerLoaderForKey}else{if(this._uniqueValueCache[this.pageIndex])return a=this._resolveValueLabelsFromCache(this._uniqueValueCache),c.resolve(a),c;a=this.layerLoader}1===this.queryType?a.queryByPage(this.pageIndex).then(l.hitch(this,function(a){if(a){var b=a.features||[];a=b.length;this.showNullValues||(b=this._getNotNullValues(b));b=this._getValueLabelsFromFeatures(b);this.isKeyQueryLoader?(this._uniqueValueCacheForOtherTypes[this.pageIndex-
1]=b,a<this.pageSize&&(this._uniqueValueCacheForOtherTypes[this.pageIndex]=[])):(this._uniqueValueCache[this.pageIndex-1]=b,a<this.pageSize&&(this._uniqueValueCache[this.pageIndex]=[],this._isUniqueValueCacheFinish=!0));0===b.length&&this.pageIndex--;c.resolve(b)}else c.reject("Can't get features from current layer")}),l.hitch(this,function(a){c.reject(a)})):a.getAllFeatures().then(l.hitch(this,function(a){if(a){var b=a.features||[];this.showNullValues||(b=this._getNotNullValues(b));a=0<b.length?
!0:!1;b=this._getDistinctValues(b);b=this._getValueLabelsFromFeatures(b);b=this.isKeyQueryLoader?this._getAndStoreValueLabelsForOtherTypes(b,this._uniqueValueCacheForOtherTypes):this._getAndStoreValueLabelsForOtherTypes(b,this._uniqueValueCache);this._isUniqueValueCacheFinish=!0;c.resolve(a?b:[])}else c.reject("Can't get features from current layer")}),l.hitch(this,function(a){c.reject(a)}));this.pageIndex++;return c},_resolveValueLabelsFromCache:function(a){a=a[this.pageIndex];0!==a.length&&this.pageIndex++;
return a},_getAndStoreValueLabelsForOtherTypes:function(a,c){for(var b=0;b<a.length;b+=this.pageSize)c[parseInt(b/this.pageSize,10)+1]=a.slice(b,b+this.pageSize);for(var e in c)a=parseInt(e,10)+1,c[a]||(c[a]=[]);return c[1]},_getDistinctValues:function(a){var c={},b=[],e;for(e in a){var d=a[e],g=d.attributes[this.fieldInfo.name];c[g]||(c[g]=!0,b.push(d))}return b},_getNotNullValues:function(a){return a=m.filter(a,l.hitch(this,function(a){a=a.attributes[this.fieldInfo.name];return"\x3cNull\x3e"!==
a&&null!==a}))},_getValueLabelsFromFeatures:function(c){var d=this.fieldInfo.name;c=m.map(c,function(a){return a.attributes[d]});return a._getValues(this.layerDefinition,this.fieldPopupInfo,d,c)}})})},"jimu/LayerStructure":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/on dojo/Evented ./LayerInfos/LayerInfos".split(" "),function(r,d,m,l,c,t){var q=r([c],{declaredClass:"jimu.LayerStructure",map:null,_layerInfos:null,_eventHandles:null,constructor:function(c){this._layerInfos=
c;this.map=this._layerInfos.map;this._eventHandles=[];this._bindEvents()},getLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArray())},getTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArray())},getBasemapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getBasemapLayerInfoArray())},getWebmapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArrayOfWebmap())},
getWebmapTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArrayOfWebmap())},addTable:function(c){var d=null;if(c=this._layerInfos.addTable(c))d=c._adaptor;return d},removeTable:function(c){(c=this.getNodeById(c))&&this._layerInfos.removeTable(c._layerInfo)},_traversal:function(c,d){for(var h=0;h<d.length;h++)if(d[h].traversal(c))return!0;return!1},traversal:function(c){return this._traversal(c,this.getLayerNodes().concat(this.getBasemapLayerNodes().concat(this.getTableNodes())))},
traversalWithNodes:function(c,d){return this._traversal(c,d)},getNodeById:function(c){var d=null;this.traversal(function(h){if(h.id===c)return d=h,!0});return d},getBasemapLayerObjects:function(){return this._layerInfos.getBasemapLayers()},restoreState:function(c){this._layerInfos.restoreState(c)},destroy:function(){d.forEach(this._eventHandles,function(c){c.remove()});this.inherited(arguments)},_getNodesArrayFromInfosArray:function(c){var h=[];d.forEach(c,function(c){h.push(c._adaptor)},this);return h},
_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(h){console.warn(h)}},_bindEvents:function(){var c;c=l(this._layerInfos,"layerInfosChanged",m.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(c);c=l(this._layerInfos,"basemapLayerInfosChanged",m.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(c);c=l(this._layerInfos,"tableInfosChanged",m.hitch(this,this._onTableNdoesStructureChanged));this._eventHandles.push(c);c=l(this._layerInfos,"layerInfosReorder",
m.hitch(this,this._onLayerReordered));this._eventHandles.push(c);c=l(this._layerInfos,"layerInfosIsShowInMapChanged",m.hitch(this,this._onVisibilityChanged));this._eventHandles.push(c);c=l(this._layerInfos,"layerInfosIsVisibleChanged",m.hitch(this,this._onToggleChanged));this._eventHandles.push(c);c=l(this._layerInfos,"layerInfosFilterChanged",m.hitch(this,this._onFilterChanged));this._eventHandles.push(c);c=l(this._layerInfos,"layerInfosRendererChanged",m.hitch(this,this._onRendererChanged));this._eventHandles.push(c);
c=l(this._layerInfos,"layerInfosOpacityChanged",m.hitch(this,this._onOpacityChanged));this._eventHandles.push(c);c=l(this._layerInfos,"layerInfosTimeExtentChanged",m.hitch(this,this._onTimeExtentChanged));this._eventHandles.push(c)},_onLayerNodesStructureChanged:function(c,d,k){this._emitEvent(q.EVENT_STRUCTURE_CHANGE,{type:d,layerNodes:[k._adaptor],rootLayerNodes:[c._adaptor]})},_onTableNdoesStructureChanged:function(c,d){c=this._getNodesArrayFromInfosArray(c);this._emitEvent(q.EVENT_STRUCTURE_CHANGE,
{type:d,layerNodes:c,rootLayerNodes:c})},_onLayerReordered:function(c,d){c=[c._adaptor];this._emitEvent(q.EVENT_STRUCTURE_CHANGE,{type:d,layerNodes:c,rootLayerNodes:c})},_onVisibilityChanged:function(c){c={layerNodes:this._getNodesArrayFromInfosArray(c)};this._emitEvent(q.EVENT_VISIBILITY_CHANGE,c)},_onToggleChanged:function(c){c={layerNodes:this._getNodesArrayFromInfosArray(c)};this._emitEvent(q.EVENT_TOOGLE_CHANGE,c)},_onFilterChanged:function(c){c={layerNodes:this._getNodesArrayFromInfosArray(c)};
this._emitEvent(q.EVENT_FILTER_CHANGE,c)},_onRendererChanged:function(c){c={layerNodes:this._getNodesArrayFromInfosArray(c)};this._emitEvent(q.EVENT_RENDERER_CHANGE,c)},_onOpacityChanged:function(c){c={layerNodes:this._getNodesArrayFromInfosArray(c)};this._emitEvent(q.EVENT_OPACITY_CHANGE,c)},_onTimeExtentChanged:function(c){c={layerNodes:this._getNodesArrayFromInfosArray(c)};this._emitEvent(q.EVENT_TIME_EXTENT_CHANGE,c)}}),p=null;q.getInstance=function(){p&&p._layerInfos._objectId===t.getInstanceSync()._objectId||
(p&&p.destroy(),p=new q(t.getInstanceSync()));return p};q.createInstance=function(c){return new q(t.createInstance(c))};m.mixin(q,{STRUCTURE_CHANGE_ADD:t.ADDED,STRUCTURE_CHANGE_REMOVE:t.REMOVED,STRUCTURE_CHANGE_SUBNODE_ADD:t.SUBLAYER_ADDED,STRUCTURE_CHANGE_SUBNODE_REMOVE:t.SUBLAYER_REMOVED,STRUCTURE_CHANGE_NODE_UPDATE:t.UPDATED,STRUCTURE_CHANGE_REORDER:t.REORDERED,EVENT_STRUCTURE_CHANGE:"structure-change",EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",EVENT_FILTER_CHANGE:"filter-change",
EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change",EVENT_TIME_EXTENT_CHANGE:"time-extent-change"});return q})},"jimu/dijit/_filter/PredefinedValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/text!./PredefinedValueProvider.html dojo/_base/lang dojo/on jimu/dijit/Popup ./PredefinedValuePopup ./ValueProvider".split(" "),function(r,d,m,l,c,t,q,p){return d([p],{templateString:m,nls:null,url:"",layerDefinition:null,partObj:null,fieldInfo:null,codedValues:null,
staticValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,runtime:!1,providerType:null,valueProvider:null,postCreate:function(){this.inherited(arguments);this.jimuNls=window.jimuNls;r.addClass(this.domNode,"jimu-filter-indexBtn-value-provider");r.addClass(this.valueProviderPopupNode,"value-type-popup");r.setStyle(this.valueProviderPopupNode,"display","none");var c="";"UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?c=this.nls.predefinedUniqueTips:"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===
this.providerType&&(c=this.nls.predefinedMultipleTips);this.indexBtnTips.title=c;this.indexBtnTips.innerText=c+" ...";this._initProvider();this._bindEvent()},_initProvider:function(){var c={preDefinedTips:this.indexBtnTips,nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:this.partObj,fieldInfo:this.fieldInfo,codedValues:this.codedValues,staticValues:this.staticValues,layerInfo:this.layerInfo,popupInfo:this.popupInfo,operatorInfo:this.operatorInfo,filterCodedValueIfPossible:this.filterCodedValueIfPossible,
runtime:this.runtime,selectUI:this.selectUI,providerType:this.providerType};if("UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType||"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType)this.valueProvider=new q(c);this.valueProvider.on("predefinedValuePopup_setApplyBtnState",l.hitch(this,function(c){this.popup&&(c?this.popup.enableButton(0):this.popup.disableButton(0))}))},_bindEvent:function(){this.own(c(this.indexBtn,"click",l.hitch(this,function(){this.valueProvider&&this.destroyProvider();
this._initProvider();this.setValueObject(this.valueObjEnd,this.valueObjEnd.type);this.popup=new t({width:800,height:600,content:this.valueProvider,titleLabel:this.indexBtnTips.title,onClose:l.hitch(this,function(){this.getValueObject(!1);this._closeCBXPopup();this.destroyProvider()}),buttons:[{label:this.nls.apply,disable:!0,onClick:l.hitch(this,function(){this.getValueObject(!0)?this.popup.close():alert("please configurate some items")})},{label:this.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],
onClick:l.hitch(this,function(){this.popup.close()})}]});r.addClass(this.popup.domNode,"widget-at-filter-popup");setTimeout(l.hitch(this,function(){this.valueProvider._setApplyState(this.getValueObject(!0));this.valueProvider._setDisplayTypeStyle()}),100)})))},_closeCBXPopup:function(){this.valueProvider.cbxPopup&&this.valueProvider.cbxPopup.domNode&&(this.valueProvider.cbxPopup.onClose=l.hitch(this,function(){return!0}),this.valueProvider.cbxPopup.close())},_saveData:function(){this.valueProvider.saveData()},
reset:function(){},getDijits:function(){return[]},getStatus:function(){return 1},setValueObject:function(c){c&&(this.valueObjEnd=c);this.valueProvider.setValueObject(c,!0)},valueObj:null,getValueObject:function(c){if(c)return this.valueObjEnd=c=this.valueProvider.getValueObject(),c.value.length;delete this.valueObjEnd.valueList;return 0===this.valueObjEnd.value.length?0:this.valueObjEnd},destroyProvider:function(){this.valueProvider&&this.valueProvider.destroyProvider();this.valueProvider=null}})})},
"jimu/dijit/_filter/PredefinedValuePopup":function(){define("dojo/_base/lang dojo/Deferred dojo/_base/html dojo/_base/array dojo/_base/declare dojo/Evented dojo/query ./ValueProvider ./EditTable ./AdvancedListValueSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./PredefinedValuePopup.html dojo/store/Memory jimu/utils jimu/dijit/Popup jimu/dijit/_filter/pageControlForQuery dojox/form/CheckedMultiSelect".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v){return c([p,k,a,t],
{templateString:g,codedValues:null,staticValues:null,showNullValues:!1,cbxPopup:null,pageSize:1E3,pageIndex:1,selectUI:null,postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.selectUI=this.selectUI?this.selectUI:"dropdown";m.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");this.controlType="unique";
"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType&&(this.controlType="multiple");this.isNumberField=b.isNumberField(this.fieldInfo.type);this.editTable||(this.editTable=new h({tableType:this.controlType,dataList:[],codedValues:this.codedValues,emptyStr:this.emptyStr,customValue:this.Nls.addValuePlaceHolder,customLabel:this.Nls.addLabelPlaceHolder,isNumberField:this.isNumberField}),this.editTable.placeAt(this.tableContent),this.editTable.on("editTable_openListSelectByName",r.hitch(this,this._showListSelectByTable)),
this.editTable.on("editTable_itemChanged",r.hitch(this,this._editTableItemChanged)),this.editTable.on("editTable_getValLabelsArrayForNumber",r.hitch(this,this._getValLabelsArrayForNumber)));this.supportPaing=!0;this.pageControlForQuery||(this.pageControlForQuery=new u({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,fieldPopupInfo:this.fieldPopupInfo,isNumberField:this.isNumberField}));this.listSelect||(this.listSelect=
new n({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField}),this.listSelect.on("advancedListValueSelect_itemChecked",r.hitch(this,this._createTarget)),this.listSelect.on("advancedListValueSelect_itemUnChecked",r.hitch(this,this._destoryTarget)),this.listSelect.on("advancedListValueSelect_addNextPage",r.hitch(this,this._addNextPage)),this.listSelect.on("advancedListValueSelect_searchKey",
r.hitch(this,this._searchKey)),this.listSelect.on("advancedListValueSelect_searchKeyLocal",r.hitch(this,this._searchKeyLocal)),this.listSelect.on("advancedListValueSelect_itemCheckedForPredefined",r.hitch(this,this._createTargetForPredefined)));this.mutiValuesSelect||(this.mutiValuesSelect=new v({multiple:!0,required:!1,intermediateChanges:!0,style:{width:"100%"}}));this._multipleSelectProviderEventHandler=r.hitch(this,this._multipleSelectProviderEvent);document.addEventListener("click",this._multipleSelectProviderEventHandler);
var a=new f({idProperty:"id",data:[]});this.listSelect.set("store",a)},_multipleSelectProviderEvent:function(a){var b=a.target||a.srcElement,c=m.isDescendant(b,this.editTable.searchBtn);this.editTable&&this.cbxPopup&&this.cbxPopup.domNode?(c?"block"===m.getStyle(this.cbxPopup.domNode,"display")?m.setStyle(this.cbxPopup.domNode,"display","none"):m.setStyle(this.cbxPopup.domNode,"display","block"):m.isDescendant(b,this.cbxPopup.domNode)||this._createTargetForPredefined(),a.stopPropagation()):this._isInSelectPopup(b)||
this.runtime?a.stopPropagation():m.setStyle(this.valuesPopupNode,"display","none")},_initAdvancedListValueSelect:function(){this.pageControlForQuery.pageIndex=1;this.pageControlForQuery.isKeyQueryLoader=!1;this.listSelect=new n({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,isCacheFinish:this.pageControlForQuery._isUniqueValueCacheFinish,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField});this.listSelect.on("advancedListValueSelect_itemChecked",
r.hitch(this,this._createTarget));this.listSelect.on("advancedListValueSelect_itemUnChecked",r.hitch(this,this._destoryTarget));this.listSelect.on("advancedListValueSelect_addNextPage",r.hitch(this,this._addNextPage));this.listSelect.on("advancedListValueSelect_searchKey",r.hitch(this,this._searchKey));this.listSelect.on("advancedListValueSelect_searchKeyLocal",r.hitch(this,this._searchKeyLocal));this.listSelect.on("advancedListValueSelect_itemCheckedForPredefined",r.hitch(this,this._createTargetForPredefined))},
_isInSelectPopup:function(a){for(var b="dijitCheckBoxInput dojoxMultiSelectItemLabel dojoxMultiSelectItemBox dojoxMultiSelectItem dojoxCheckedMultiSelectWrapper dojoxCheckedMultiSelect value-type-popup popupOper pageItem".split(" "),c=!1,e=0;e<=b.length;e++)if(m.hasClass(a,b[e])){c=!0;break}return c},_createTarget:function(){this.editTable._createTarget("","","","",!0);this._editTableItemChanged()},_createTargetForPredefined:function(a,b){this.editTable._setNewLabel(a,b);this.cbxPopup.close();this._editTableItemChanged()},
_destoryTarget:function(a){this.editTable._destroyTarget(a);this._editTableItemChanged()},_editTableItemChanged:function(){if(!this.runtime){var a=this.getValueObject();this._setApplyState(a.value.length)}},_setApplyState:function(a){this.emit("predefinedValuePopup_setApplyBtnState",a)},_cbxWidth:245,_cbxHeight:340,isPopupLoading:!1,_showListSelectByTable:function(a){if(!this.isPopupLoading){this._initAdvancedListValueSelect();this.valueList=[a];this.getCheckedList(this.valueList);a=m.position(this.editTable.searchBtn);
var b=a.x-226,c=a.y+30;window.isRTL&&(b=a.x);this.cbxPopup=new e({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:b,top:c},buttons:[]});this.cbxPopup.setDomNodeStyls({"border-radius":0,border:"1px solid #999"});this.cbxPopup.on("popupHasInitedSuccessfully",r.hitch(this,function(){var a=m.position(this.editTable.searchBtn),b=a.x-226,c=a.y+30;window.isRTL&&(b=a.x);this.cbxPopup.setCustomPosition(b,
c)}));this.listSelect.valueInput&&this.listSelect.valueInput.focus();this._showLoadingIcon();this.isPopupLoading=!0;this._valueLabels().then(r.hitch(this,function(a){this.isPopupLoading=!1;this._hideLoadingIcon();if(!0!==a){var b=!1;this.valueList&&0!==this.valueList.length&&(b=!0);this.listSelect.setCBXData(a,b)}}))}},_valueLabels:function(){var a=new d;this.listSelect.codedValues=!1;this.listSelect.disPlayLabel="label";if(this.staticValues)return this._setValueForStaticValues(this.staticValues),
a.resolve(!0),a;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return this._setValueForStaticValues(this.codedValues),a.resolve(!0),a;this.pageControlForQuery.queryByPage(!0).then(r.hitch(this,function(b){a.resolve(b)}),r.hitch(this,function(b){console.log(b);this._hideLoadingIcon();a.reject(b)}));return a},_setValueForStaticValues:function(a){this.listSelect.codedValues=!0;a&&(this.pageControlForQuery._codedvalueCache=a,a=0<a.length?a:[],this.listSelect.setCBXData(a,
!0,!0))},_changeDisplayType:function(a){a=a.target||a.srcElement;a=m.hasClass(a,"option")?a:b.getAncestorDom(a,function(a){return m.hasClass(a,"option")},2);m.hasClass(a,"checked")||(m.addClass(a,"checked"),a=q("."+this.selectUI+"Option ",this.displayTypes)[0],m.removeClass(a,"checked"),this.selectUI="expanded"===this.selectUI?"dropdown":"expanded")},_setDisplayTypeStyle:function(){var a=q(".title",this.displayTypes)[0],b=q(".label",this.displayTypes),a=(m.getStyle(this.displayTypes,"width")-m.getStyle(a,
"width")-80)/2,c=m.getStyle(b[0],"width"),c=c<a?c:a,e=m.getStyle(b[1],"width"),e=e<a?e:a;m.setStyle(b[0],"width",c+"px");m.setStyle(b[1],"width",e+"px")},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage).then(r.hitch(this,function(a){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;this.listSelect.setCBXData(a,!0);this._hideLoadingIcon()}),r.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},
_searchKey:function(a){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery._searchKey(a).then(r.hitch(this,function(a){this.listSelect.setCBXContentBySearch(a);this._hideLoadingIcon()}),r.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},_searchKeyLocal:function(a){this.listSelect&&(this._showLoadingIcon(),a=this.pageControlForQuery._searchKeyLocal(a),this.listSelect.setCBXContentBySearch(a),this._hideLoadingIcon())},_handlerPageValues:function(){},getCheckedList:function(a){this.listSelect.checkedList=
[];this.isNumberField?l.forEach(a,r.hitch(this,function(a){this.listSelect.checkedList.push(parseFloat(a))})):this.listSelect.checkedList=a},_showPopup:function(){var a=this.getValueObject().valueList;this.valueList=null===a?void 0:a;this.getCheckedList(this.valueList);this.cbxPopup?(this.listSelect.checkCBXItems(!1),this.cbxPopup.show()):(this.cbxPopup=new e({width:355,height:596,content:this.listSelect.domNode,titleLabel:this.layerDefinition.name+"("+this.fieldName+")",isResize:!1,onClose:r.hitch(this,
function(){this.cbxPopup.hide();return!1}),buttons:[]}),this._showLoadingIcon(),this.pageControlForQuery.queryByPage().then(r.hitch(this,function(a){this._hideLoadingIcon();var b=!1;this.valueList&&0!==this.valueList.length&&(b=!0);this.listSelect.setCBXData(a,b)})))},getDijits:function(){return[this.mutiValuesSelect]},setValueObject:function(a){a.value=a.value?a.value:[];var b=q("."+(a.selectUI?a.selectUI:this.selectUI)+"Option ",this.displayTypes)[0];m.addClass(b,"checked");b=null;if(this.isNumberField){for(var b=
[],c=0;c<a.value.length;c++)b.push(a.value[c].value);b=this._getValLabelsArrayForNumber(!1,b)}this.editTable.emptyLabel=a.emptyLabel;this.editTable.enableEmpty=a.enableEmpty;this.editTable.setListValues(a.value,b)},_getValLabelsArrayForNumber:function(a,c){c=b._getValues(this.layerDefinition,this.fieldPopupInfo,this.fieldName,c);a&&(this.editTable.currentValLabel=c[0].label);return c},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,selectUI:this.selectUI,
type:this.partObj.valueObj.type,value:[],valueList:[]}:null},getValueObject:function(){if(this.isValidValue()){var a=this.editTable.getListValues(),b={isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:a.list,valueList:a.valueList};"unique"===this.controlType&&(b.emptyLabel=a.emptyLabel,b.enableEmpty=a.enableEmpty);return b}return null},setRequired:function(a){this.mutiValuesSelect.set("required",a)},queryByPage:function(){var a=this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);
a.then(r.hitch(this,function(b){a.resolve(b)}),r.hitch(this,function(b){console.log(b);a.reject(b)}))},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&m.addClass(this.listSelect.listContainer,"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&m.removeClass(this.listSelect.listContainer,"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&document.removeEventListener("click",this._multipleSelectProviderEventHandler);
this.inherited(arguments)},destroyProvider:function(){this.editTable&&this.editTable.destroy();this.listSelect&&this.listSelect.destroy();this.listSelect=null;this.destroy();m.destroy(this.domNode)}})})},"jimu/dijit/_filter/EditTable":function(){define("dojo/_base/lang dojo/_base/html dojo/Evented dojo/on dojo/dom-attr dojo/_base/declare dijit/_WidgetBase dojo/query dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./EditTable.html jimu/utils".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f){return t([q,k,a,m],{templateString:g,currentItem:null,dataList:[],codedValues:null,isNumberField:!0,tableType:"unique",postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);d.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");this.inputType="unique"===this.tableType?"radio":"checkbox"},_onListContentDblClicked:function(a){this.isSearch=
!1;var b=a.target||a.srcElement,g=f.getAncestorDom(b,function(a){return d.hasClass(a,"item")},3);if(g&&(d.hasClass(b,"name")||d.hasClass(b,"alias"))&&(!d.hasClass(g,"empty")||!d.hasClass(b,"name"))){this._dijit?(this.editState="active",this.updateInputDivPre=this.updateInputDiv,this._dijitPre=this._dijit):this.editState="negative";a=this._getNodeText(b);var k=decodeURIComponent(d.getAttr(b,"data")),g=d.hasClass(g,"custom");this.placeHolder=d.hasClass(b,"name")&&!this.codedValues?k:a;g?d.hasClass(b,
"alias")&&this.placeHolder!==this.customLabel?this.currentLabel=a:this.currentLabel=NaN:this.currentLabel=this.isNumberField&&d.hasClass(b,"name")&&!this.codedValues?parseFloat(this.placeHolder):this.placeHolder;c.set(b,"innerHTML","");a="";d.hasClass(b,"name")&&(a='\x3cdiv class\x3d"searchBtn"\x3e\x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8"\x3e\x3c/div\x3e\x3c/div\x3e');this.updateInputDiv=d.create("div",{"class":"updateInputDiv",innerHTML:'\x3cdiv class\x3d"inputDiv"\x3e\x3c/div\x3e'+a},
b);a=p(".inputDiv",this.updateInputDiv)[0];this.searchBtn=p(".searchBtn",this.updateInputDiv)[0];this.own(l(this.updateInputDiv,"dblclick",r.hitch(this,function(a){a.stopPropagation();a.preventDefault()})));k={required:!1,intermediateChanges:!1,value:this.currentLabel};this.codedValues&&d.hasClass(b,"name")&&(k.disabled=!0);this.isNumberField&&d.hasClass(b,"name")?(k.constraints={pattern:"#####0.##########"},this._dijit=new n(k)):(k.trim=!0,this._dijit=new h(k));this._dijit.startup();this._dijit.on("keydown",
function(a){13===(a.keyCode||a.which)&&this._dijit.emit("blur")}.bind(this));this._dijit.on("blur",r.hitch(this,function(){if(this._dijit){var a="Error"!==this._dijit.state?this._dijit.displayedValue:this.currentLabel;this.isNumberField&&d.hasClass(b,"name")&&"Error"===this._dijit.state&&this._dijit.setValue(parseFloat(a));var a=f.sanitizeHTML(a),c=this._dijit.get("value");""!==c&&c?d.hasClass(b,"name")&&(this.placeHolder===this.customValue||"NaN"===this.placeHolder&&""!==this._dijit.displayedValue)&&
(c=f.getAncestorDom(this._dijit.domNode,function(a){return d.hasClass(a,"item")},4),d.removeClass(c,"custom"),this.emit("editTable_itemChanged")):a=this.placeHolder;this.newLabel=a;setTimeout(r.hitch(this,function(){var a;if(this.isSearch||"active"===this.editState)"active"===this.editState&&(this.currentValLabel=""===this._dijitPre.displayedValue?this.customValue:this.isNumberField?this._getLocalNumber(this._dijitPre.value):this._dijitPre.value,b=this.updateInputDivPre.parentNode,!d.hasClass(b,"name")||
"NaN"===this.newLabel||this.newLabel===this.customValue||this._getNodeText(b.nextSibling)!==this.customLabel&&this._dijit.value!==this.customLabel||(d.isDescendant(this.updateInputDiv,b.nextSibling)?this._dijit.set("value",this.currentValLabel):(a=this.isNumberField?this.currentValLabel:this.newLabel,d.setAttr(b.nextSibling,"data",encodeURIComponent(a)),this._setNodeText(b.nextSibling,a))),a=d.hasClass(b,"name")?""===this._dijitPre.displayedValue?this.customValue:this._dijitPre.value:this.newLabel,
d.setAttr(b,"data",a),a=d.hasClass(b,"name")?this.currentValLabel:this.newLabel,this._setNodeText(b,a),this._dijitPre=this.updateInputDivPre=null,this.editState="negative");else{this.currentValLabel=""===this._dijit.displayedValue?this.customValue:this.isNumberField?this._getLocalNumber(this._dijit.value):this._dijit.value;var b=this.updateInputDiv.parentNode;d.hasClass(b,"name")&&"NaN"!==this.newLabel&&this.newLabel!==this.customValue&&this._getNodeText(b.nextSibling)===this.customLabel&&(a=this.isNumberField?
this.currentValLabel:this.newLabel,d.setAttr(b.nextSibling,"data",encodeURIComponent(a)),this._setNodeText(b.nextSibling,a));a=d.hasClass(b,"name")?""===this._dijit.displayedValue?this.customValue:this._dijit.value:this.newLabel;d.setAttr(b,"data",encodeURIComponent(a));a=d.hasClass(b,"name")?this.currentValLabel:this.newLabel;this._setNodeText(b,a);this._dijit=null;this.isSearch=!1}}),300);this.placeHolder=""}}));d.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(a);p("input",this._dijit.domNode)[1].focus();
this.searchBtn&&(this.own(l(this.searchBtn,"click",r.hitch(this,function(a){this.isSearch||(this.isSearch=!0,this.searchTarget=a.target||a.srcElement,this.emit("editTable_openListSelectByName",this.newLabel),a.stopPropagation(),a.preventDefault())}))),this.codedValues&&this.searchBtn.click())}},_getLocalNumber:function(a){"string"===typeof a&&(a=parseFloat(a));this.emit("editTable_getValLabelsArrayForNumber",!0,[a]);return this.currentValLabel},_setNewLabel:function(a,c){void 0===a&&void 0===c&&(""!==
this._dijit.displayedValue?this.codedValues?(c=this._dijit.displayedValue,a=this._getCodeFromCodevalueLabel(c)):(c=a=this._dijit.value,this.isNumberField&&this.newLabel!==this.customValue&&(c=this._getLocalNumber(a))):a=c=this.customValue);if(this.updateInputDiv&&this.updateInputDiv.parentNode){var b=this.updateInputDiv.parentNode;c!==this.customValue&&this._getNodeText(b.nextSibling)===this.customLabel&&(d.setAttr(b.nextSibling,"data",encodeURIComponent(c)),this._setNodeText(b.nextSibling,c));this.codedValues||
(a=a?a:decodeURIComponent(d.getAttr(b,"data")));d.setAttr(b,"data",encodeURIComponent(a));a=b.parentNode;c!==this.customValue&&d.removeClass(a,"custom");this._setNodeText(b,c)}this._dijit=this.updateInputDiv=null},_onListContentClicked:function(a){a=a.target||a.srcElement;var b=f.getAncestorDom(a,function(a){return d.hasClass(a,"item")},3);b&&(d.hasClass(a,"checkboxEmpty")?d.hasClass(a,"checked")?d.removeClass(a,"checked"):d.addClass(a,"checked"):d.hasClass(a,this.inputType)?("radio"===this.inputType&&
!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),d.hasClass(a,"checked")?"radio"!==this.inputType?d.removeClass(a,"checked"):d.hasClass(this.currentItem,"checked")||d.removeClass(a,"checked"):("radio"===this.inputType&&this.currentItem&&d.removeClass(this.currentItem,"checked"),d.addClass(a,"checked"),this.currentItem=a)):d.hasClass(a,"action")&&(d.hasClass(a,"up")?b.previousElementSibling&&d.place(b,b.previousElementSibling,"before"):d.hasClass(a,"down")?b.nextElementSibling&&d.place(b,
b.nextElementSibling,"after"):d.hasClass(a,"delete")&&(d.destroy(b),this.emit("editTable_itemChanged"))))},_getLabelFromCodevalue:function(a){for(var b=a,c=0;c<this.codedValues.length;c++){var d=this.codedValues[c];if(d.value===a){b=d.label;break}}return b},_getCodeFromCodevalueLabel:function(a){for(var b=a,c=0;c<this.codedValues.length;c++){var d=this.codedValues[c];if(d.label===a){b=d.value;break}}return b},_createEmptyTarget:function(a){for(var b=this.emptyStr,c=this.emptyLabel?this.emptyLabel:
b,f=" checked",g=0;g<a.length;g++)if(a[g].isChecked){f="";break}" checked"===f&&(this.currentItem=!0);var g='data\x3d"'+encodeURIComponent(b)+'"',h="",k=this.Nls.emptyValueTips;if(0===a.length||this.enableEmpty)h=" checked";return d.create("div",{"class":"item empty",innerHTML:'\x3cdiv class\x3d"label name jimu-ellipsis" style\x3d"cursor: default;"'+g+"\x3e"+b+'\x3c/div\x3e\x3cdiv class\x3d"label alias jimu-ellipsis-Blanks" data\x3d"'+c+'"\x3e'+c+'\x3c/div\x3e\x3cdiv class\x3d"label '+this.inputType+
f+' jimu-ellipsis"\x3e\x3c/div\x3e\x3cdiv class\x3d"label checkbox checkboxEmpty'+h+' jimu-ellipsis jimu-flipx" title\x3d"'+k+'"\x3e\x3c/div\x3e'},this.listContent)},_createTarget:function(a,c,f,g,h){var b="item";h&&(a=c=this.customValue,f=this.customLabel,b="item custom");a=a||0===a?a:"";c=c||"";f=f?f:a;g=g?g:"";h=a;(this.codedValues||this.isNumberField)&&a!==this.Nls.addValuePlaceHolder&&(h=this.codedValues?this._getLabelFromCodevalue(a):c);a=this.isNumberField?a:encodeURIComponent(a);return d.create("div",
{"class":b,innerHTML:'\x3cdiv class\x3d"label name jimu-ellipsis-Blanks" '+('data\x3d"'+a+'"')+"\x3e"+h+'\x3c/div\x3e\x3cdiv class\x3d"label alias jimu-ellipsis-Blanks" data\x3d"'+f+'"\x3e'+f+'\x3c/div\x3e\x3cdiv class\x3d"label '+this.inputType+g+' jimu-ellipsis"\x3e\x3c/div\x3e\x3cdiv class\x3d"actions jimu-float-trailing"\x3e\x3cdiv class\x3d"delete action jimu-float-trailing"\x3e\x3c/div\x3e\x3cdiv class\x3d"down action jimu-float-trailing"\x3e\x3c/div\x3e\x3cdiv class\x3d"up action jimu-float-trailing"\x3e\x3c/div\x3e\x3c/div\x3e'},
this.listContent)},_destroyTarget:function(a){for(var b=p(".item .name",this.listContent),f=0;f<b.length;f++){var g=b[f];if(c.get(this._dijit.domNode.parentNode,"innerHTML")===a){d.destroy(g.parentNode);break}}},getCurrentItem:function(){for(var a=p(".item .radio",this.listContent),c=0;c<a.length;c++){var f=a[c];if(d.hasClass(f,"checked"))return f}return null},_getEmptyLabel:function(){var a=p(".label.alias",this.listContent.firstChild)[0],c=this._getNodeText(a);a.children.length&&(c="Error"===this._dijit.state?
decodeURIComponent(d.getAttr(a,"data")):this._dijit.value);return c=f.sanitizeHTML(c)},_getEmptyStatus:function(){var a=p(".checkboxEmpty",this.listContent.firstChild)[0];return d.hasClass(a,"checked")?!0:!1},_getNodeText:function(a){return a.textContent||a.innerText||""},_setNodeText:function(a,c){a.innerHTML="\x26nbsp;";a.textContent?a.textContent=c:a.innerText=c},getListValues:function(){this.listItemsArray=[];this.listValuesArray=[];for(var a=p(".item .name",this.listContent),c="radio"===this.inputType?
1:0;c<a.length;c++){var g=a[c],h=f.getAncestorDom(g,function(a){return d.hasClass(a,"item")},3);if(!d.hasClass(h,"custom")){var h=this._getNodeText(g),k=decodeURIComponent(d.getAttr(g,"data"));if(this.isNumberField||this.codedValues)h=k;g.children.length&&(h="Error"===this._dijit.state?k:this._dijit.value,this.codedValues&&(h=this._getCodeFromCodevalueLabel(h),h=void 0!==h?h:k));h=this.isNumberField?parseFloat(h):f.sanitizeHTML(h);k=this._getNodeText(g.nextSibling);k===this.customLabel&&(k=h.toString(),
this.isNumberField&&(k=this._getLocalNumber(k)));g.nextSibling.children.length&&(k="Error"===this._dijit.state?decodeURIComponent(d.getAttr(g.nextSibling,"data")):this._dijit.value);k=f.sanitizeHTML(k);k={value:h,alias:k,isChecked:!1};this.listItemsArray.push(k);this.listValuesArray.push(h);d.hasClass(g.nextSibling.nextSibling,"checked")&&(k.isChecked=!0)}}a={list:this.listItemsArray,valueList:this.listValuesArray};"radio"===this.inputType&&(a.emptyLabel=this._getEmptyLabel(),a.enableEmpty=this._getEmptyStatus());
return a},setListValues:function(a,d){c.set(this.listContent,"innerHTML","");"radio"===this.inputType&&this._createEmptyTarget(a);for(var b=0;b<a.length;b++){var e=a[b],f="";e.isChecked&&(f=" checked",this.currentItem=!0);this._createTarget(e.value,d?d[b].label:e.value,e.alias,f)}},_initTable:function(){},getDijits:function(){return[this.mutiValuesSelect]},destroy:function(){this.inherited(arguments)}})})},"dojox/form/CheckedMultiSelect":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/event dojo/dom-geometry dojo/dom-class dojo/dom-construct dojo/i18n dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/registry dijit/Menu dijit/MenuItem dijit/Tooltip dijit/form/_FormSelectWidget dijit/form/ComboButton dojo/text!dojox/form/resources/_CheckedMultiSelectMenuItem.html dojo/text!dojox/form/resources/_CheckedMultiSelectItem.html dojo/text!dojox/form/resources/CheckedMultiSelect.html dojo/i18n!dojox/form/nls/CheckedMultiSelect dijit/form/CheckBox".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z){var A=r("dojox.form._CheckedMultiSelectItem",[h,n,k],{templateString:x,baseClass:"dojoxMultiSelectItem",option:null,parent:null,disabled:!1,readOnly:!1,postMixInProperties:function(){this._type=this.parent.multiple?{type:"checkbox",baseClass:"dijitCheckBox"}:{type:"radio",baseClass:"dijitRadio"};this.disabled||(this.disabled=this.option.disabled=this.option.disabled||!1);this.readOnly||(this.readOnly=this.option.readOnly=this.option.readOnly||!1);
this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.labelNode.innerHTML=this.option.label},_changeBox:function(){this.get("disabled")||this.get("readOnly")||(this.parent.multiple?this.option.selected=this.checkBox.get("value")&&!0:this.parent.set("value",this.option.value),this.parent._updateSelection(),this.parent.focus())},_onClick:function(a){this.get("disabled")||this.get("readOnly")?l.stop(a):this.checkBox._onClick(a)},_updateBox:function(){this.checkBox.set("value",
this.option.selected)},_setDisabledAttr:function(a){this.disabled=a||this.option.disabled;this.checkBox.set("disabled",this.disabled);t.toggle(this.domNode,"dojoxMultiSelectDisabled",this.disabled)},_setReadOnlyAttr:function(a){this.checkBox.set("readOnly",a);this.readOnly=a}}),E=r("dojox.form._CheckedMultiSelectMenu",g,{multiple:!1,buildRendering:function(){this.inherited(arguments);var a=this.menuTableNode=this.domNode,b=this.domNode=q.create("div",{style:{overflowX:"hidden",overflowY:"scroll"}});
a.parentNode&&a.parentNode.replaceChild(b,a);t.remove(a,"dijitMenuTable");b.className=a.className+" dojoxCheckedMultiSelectMenu";a.className="dijitReset dijitMenuTable";a.setAttribute("role","listbox");b.setAttribute("role","presentation");b.appendChild(a)},resize:function(a){a&&(c.setMarginBox(this.domNode,a),"w"in a&&(this.menuTableNode.style.width="100%"))},onClose:function(){this.inherited(arguments);this.menuTableNode&&(this.menuTableNode.style.width="")},onItemClick:function(a,b){"undefined"==
typeof this.isShowingNow&&this._markActive();this.focusChild(a);if(a.disabled||a.readOnly)return!1;if(!this.multiple)this.onExecute();a.onClick(b)}}),y=r("dojox.form._CheckedMultiSelectMenuItem",f,{templateString:v,option:null,parent:null,iconClass:"",postMixInProperties:function(){this.parent.multiple?(this._iconClass="dojoxCheckedMultiSelectMenuCheckBoxItemIcon",this._type={type:"checkbox"}):(this._iconClass="",this._type={type:"hidden"});this.disabled=this.option.disabled;this.checked=this.option.selected;
this.label=this.option.label;this.readOnly=this.option.readOnly;this.inherited(arguments)},onChange:function(a){},_updateBox:function(){t.toggle(this.domNode,"dojoxCheckedMultiSelectMenuItemChecked",!!this.option.selected);this.domNode.setAttribute("aria-checked",this.option.selected);this.inputNode.checked=this.option.selected;this.parent.multiple||t.toggle(this.domNode,"dijitSelectSelectedOption",!!this.option.selected)},_onClick:function(a){this.disabled||this.readOnly||(this.parent.multiple?(this.option.selected=
!this.option.selected,this.parent.onChange(),this.onChange(this.option.selected)):this.option.selected||(m.forEach(this.parent.getChildren(),function(a){a.option.selected=!1}),this.option.selected=!0,this.parent.onChange(),this.onChange(this.option.selected)));this.inherited(arguments)}});return r("dojox.form.CheckedMultiSelect",e,{templateString:D,baseClass:"dojoxCheckedMultiSelect",required:!1,invalidMessage:"$_unset_$",_message:"",dropDown:!1,labelText:"",tooltipPosition:[],postMixInProperties:function(){this.inherited(arguments);
this._nlsResources=p.getLocalization("dojox.form","CheckedMultiSelect",this.lang);"$_unset_$"==this.invalidMessage&&(this.invalidMessage=this._nlsResources.invalidMessage)},_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this.value=this.options[0<=a?a:0].value}this.dropDown&&(t.toggle(this.selectNode,"dojoxCheckedMultiSelectHidden"),this.dropDownMenu=new E({id:this.id+"_menu",style:"display: none;",multiple:this.multiple,
onChange:d.hitch(this,"_updateSelection")}))},startup:function(){this.dropDown&&(this.dropDownButton=new u({label:this.labelText,dropDown:this.dropDownMenu,baseClass:"dojoxCheckedMultiSelectButton",maxHeight:this.maxHeight},this.comboButtonNode));this.inherited(arguments)},_onMouseDown:function(a){a.preventDefault()},validator:function(){return this.required?m.some(this.getOptions(),function(a){return a.selected&&null!=a.value&&0!=a.value.toString().length}):!0},validate:function(a){b.hide(this.domNode);
(a=this.isValid(a))||this.displayMessage(this.invalidMessage);return a},isValid:function(a){return this.validator()},getErrorMessage:function(a){return this.invalidMessage},displayMessage:function(a){b.hide(this.domNode);a&&b.show(a,this.domNode,this.tooltipPosition)},onAfterAddOptionItem:function(a,b){},_addOptionItem:function(a){var b;this.dropDown?(b=new y({option:a,parent:this.dropDownMenu}),this.dropDownMenu.addChild(b)):(b=new A({option:a,parent:this,disabled:this.disabled,readOnly:this.readOnly}),
this.wrapperDiv.appendChild(b.domNode));this.onAfterAddOptionItem(b,a)},_refreshState:function(){this.validate(this.focused)},onChange:function(a){this._refreshState()},reset:function(){this.inherited(arguments);b.hide(this.domNode)},_updateSelection:function(){this.inherited(arguments);this._handleOnChange(this.value);m.forEach(this._getChildren(),function(a){a._updateBox()});q.empty(this.containerNode);var a=this;m.forEach(this.value,function(b){b=q.create("option",{value:b,label:b,selected:"selected"});
q.place(b,a.containerNode)});if(this.dropDown&&this.dropDownButton){var b=0,c="";m.forEach(this.options,function(a){a.selected&&(b++,c=a.label)});this.dropDownButton.set("label",this.multiple?d.replace(this._nlsResources.multiSelectLabelText,{num:b}):c)}},_getChildren:function(){return this.dropDown?this.dropDownMenu.getChildren():m.map(this.wrapperDiv.childNodes,function(b){return a.byNode(b)})},invertSelection:function(a){this.multiple&&(m.forEach(this.options,function(a){a.selected=!a.selected}),
this._updateSelection())},_setDisabledAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDownButton.set("disabled",a);m.forEach(this._getChildren(),function(b){b&&b.set&&b.set("disabled",a)})},_setReadOnlyAttr:function(a){this.inherited(arguments);"readOnly"in this.attributeMap&&this[this.attributeMap.readOnly].setAttribute("readonly",a);this.readOnly=a;m.forEach(this._getChildren(),function(b){b&&b.set&&b.set("readOnly",a)})},uninitialize:function(){b.hide(this.domNode);m.forEach(this._getChildren(),
function(a){a.destroyRecursive()});this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e){k("dijit-legacy-requires")&&e(0,function(){r(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return m("dijit.Menu",
b,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):d.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return g.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||
a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(b){b=l.byId(b,this.ownerDocument);var d;if("iframe"==b.tagName.toLowerCase()){var e=b;d=this._iframeContentWindow(e);d=a.body(d.document)}else d=b==a.body(this.ownerDocument)?this.ownerDocument.documentElement:b;var f={node:b,iframe:e};c.set(b,"_dijitMenu"+this.id,this._bindings.push(f));var g=h.hitch(this,function(a){var b=this.selector,c=b?function(a){return n.selector(b,
a)}:function(a){return a},d=this;return[n(a,c(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<d._lastKeyDown+500||d._scheduleOpen(this,e,{x:a.pageX,y:a.pageY},a.target)}),n(a,c("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==p.F10||d.leftClickToOpen&&a.keyCode==p.SPACE)a.stopPropagation(),a.preventDefault(),d._scheduleOpen(this,e,null,a.target),d._lastKeyDown=(new Date).getTime()})]});f.connects=d?g(d):[];e&&(f.onloadHandler=
h.hitch(this,function(){var b=this._iframeContentWindow(e),b=a.body(b.document);f.connects=g(b)}),e.addEventListener?e.addEventListener("load",f.onloadHandler,!1):e.attachEvent("onload",f.onloadHandler))},unBindDomNode:function(a){var b;try{b=l.byId(a,this.ownerDocument)}catch(A){return}a="_dijitMenu"+this.id;if(b&&c.has(b,a)){for(var d=c.get(b,a)-1,e=this._bindings[d],f;f=e.connects.pop();)f.remove();(f=e.iframe)&&(f.removeEventListener?f.removeEventListener("load",e.onloadHandler,!1):f.detachEvent("onload",
e.onloadHandler));c.remove(b,a);delete this._bindings[d]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(a){function b(){p.refocus&&u&&u.focus();f.close(p)}var c=a.target,d=a.iframe,e=a.coords,g=!e;this.currentTarget=a.delegatedTarget;if(e){if(d){a=t.position(d,!0);var c=this._iframeContentWindow(d),c=t.docScroll(c.document),h=q.getComputedStyle(d),
m=q.toPixelValue,n=(k("ie")&&k("quirks")?0:m(d,h.paddingLeft))+(k("ie")&&k("quirks")?m(d,h.borderLeftWidth):0),d=(k("ie")&&k("quirks")?0:m(d,h.paddingTop))+(k("ie")&&k("quirks")?m(d,h.borderTopWidth):0);e.x+=a.x+n-c.x;e.y+=a.y+d-c.y}}else e=t.position(c,!0),e.x+=10,e.y+=10;var p=this,d=this._focusManager.get("prevNode");a=this._focusManager.get("curNode");var u=!a||l.isDescendant(a,this.domNode)?d:a;f.open({popup:this,x:e.x,y:e.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});this.focus();
g||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);f.close(this)}},destroy:function(){d.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(r,d,m,l,c,t,q,p,h){l("dijit-legacy-requires")&&
t(0,function(){r(["dijit/form/RadioButton"])});return d("dijit.form.CheckBox",[q,p],{templateString:h,baseClass:"dijitCheckBox",_setValueAttr:function(c,d){"string"==typeof c&&(this.inherited(arguments),c=!0);this._created&&this.set("checked",c,d)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&
c("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&c("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(r,d){return r("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(m){this._set("readOnly",m);d.set(this.focusNode,"readOnly",
m)},_setLabelAttr:void 0,_getSubmitValue:function(d){return null==d||""===d?"on":d},_setValueAttr:function(m){m=this._getSubmitValue(m);this._set("value",m);d.set(this.focusNode,"value",m)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));d.set(this.focusNode,"value",this.value)},_onClick:function(d){return this.readOnly?(d.stopPropagation(),d.preventDefault(),!1):this.inherited(arguments)}})})},"jimu/dijit/_filter/NumberListValueProvider":function(){define("dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./NumberListValueProvider.html dijit/form/NumberTextBox dijit/form/Select".split(" "),
function(r,d,m,l,c,t,q,p){return l([c,t,q],{templateString:p,postCreate:function(){this.inherited(arguments);d.addClass(this.domNode,"jimu-number-list-filter-value-provider");this.rangeSelect.removeOption(this.rangeSelect.getOptions());m.forEach("dateOperatorMinutes dateOperatorHours dateOperatorDays dateOperatorWeeks dateOperatorMonths dateOperatorYears".split(" "),r.hitch(this,function(c){this.rangeSelect.addOption({value:c,label:this.nls[c]})}));this.rangeSelect.set("value","dateOperatorDays")},
getDijits:function(){return[this._dijit1,this.rangeSelect]},setValueObject:function(c){this.isDefined(c.value)&&this._dijit1.set("value",c.value);this.isDefined(c.range)&&this.rangeSelect.set("value",c.range)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()}:null},_getRangeByUI:function(){var c=this.rangeSelect.get("value");"none"===c&&(c=null);return c},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();
if(this.isEmptyValue()){var c={isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()};isNaN(c.value)&&(c.value=null);return c}return null},setRequired:function(c){this._dijit1.set("required",c);this.rangeSelect.set("required",c)}})})},"jimu/dijit/_filter/DateIsInValueProvider":function(){define("dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/text!./DateIsInValueProvider.html ./ValueProvider jimu/filterUtils dijit/form/Select dijit/form/DateTextBox".split(" "),
function(r,d,m,l,c,t,q,p){return l([q,c,r],{templateString:t,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},virtualDates:null,postCreate:function(){this.inherited(arguments);d.addClass(this.domNode,"jimu-date-is-in-value-provider");this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});return["thisWeek","thisMonth","thisQuarter","thisYear"].forEach(m.hitch(this,function(c){this.dateTypeSelect.addOption({value:c,label:this.nls[c]})}))},getDijits:function(){return[this.dateTypeSelect]},
_setValueObject:function(c,d,k,a){if(this.isDefined(d[k])){var g={value:null,virtualDate:""};g.value=d[k];g.virtualDate=d[a];c.setValueObject(g)}},setValueObject:function(c){this.dateTypeSelect.set("value",c.virtualDate)},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var c={isValid:!0,type:this.partObj.valueObj.type,value:null,virtualDate:this.dateTypeSelect.get("value")},d=this.dateTypeSelect.get("value"),
k=p.getRealDateByVirtualDate(d);c.virtualDate=d;k&&(c.value1=k[0].toDateString(),c.value2=k[1].toDateString());return c},setRequired:function(c){this.dateTypeSelect.set("required",c)},getStatus:function(){return this.dateTypeSelect.get("value")?1:0},_onDateTypeSelectChanged:function(){this.emit("change")}})})},"jimu/dijit/_SingleFilter":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilter.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/store/Memory jimu/utils jimu/dijit/_filter/ValueProviderFactory dijit/popup jimu/dijit/CheckBox dijit/form/Select dijit/form/FilteringSelect dijit/form/ValidationTextBox".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b){return d([m,l,c,r],{templateString:t,baseClass:"jimu-single-filter",declaredClass:"jimu.dijit._SingleFilter",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],supportFieldTypes:[],part:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,valueProvider:null,runtime:!1,postMixInProperties:function(){this.supportFieldTypes=[];this.supportFieldTypes.push(this.stringFieldType);this.supportFieldTypes.push(this.dateFieldType);
this.supportFieldTypes=this.supportFieldTypes.concat(this.numberFieldTypes);this.nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);this._initSelf();this.own(n(document,"click",q.hitch(this,function(a){a=a.target;p.isDescendant(a,this.valueTypePopupNode)&&!p.hasClass(a,"value-type-popup-icon")||this._closeEsriPopup()})));this.customDijit&&this.own(n(window,"resize",q.hitch(this,function(){this._closeEsriPopup()})))},toJson:function(){var a={fieldObj:"",operator:"",valueObj:"",
interactiveObj:"",caseSensitive:!1},b=this._getFieldObjByUI();if(!b)return null;a.fieldObj=b;b=this._getOperatorByUI();if(!b)return null;a.operator=b;a.caseSensitive=this.cbxCaseSensitive.getStatus()&&this.cbxCaseSensitive.getValue();var b=this._getValueTypeByUI(),c=this._isUseAskForValues();if(c){if(!this.promptTB.validate())return this._showValidationErrorTip(this.promptTB),null;a.interactiveObj={prompt:this.promptTB.get("value"),hint:this.hintTB.get("value"),cascade:"none"};if("unique"===b||"multiple"===
b)a.interactiveObj.cascade=this.cascadeSelect.get("value")}a.valueObj={isValid:!0,type:""};c=c?this.valueProvider.tryGetValueObject():this.valueProvider.getValueObject();if(!c)return null;c.type=b;a.valueObj=c;return a},_getFieldObjByUI:function(){var a=this._getSelectedFilteringItem(this.fieldsSelect);if(!a)return null;var b="";0!==this.popupFieldsInfo.length&&(b=g.getDateFieldFormatByFieldName(this.popupFieldsInfo,a.name));return{name:a.name,label:a.name,dateFormat:b,shortType:a.shortType,type:a.type}},
_getOperatorByUI:function(){var a=this.operatorsSelect.get("value");"none"===a&&(a=null);return a},showDelteIcon:function(){p.setStyle(this.btnDelete,"display","inline-block")},hideDeleteIcon:function(){p.setStyle(this.btnDelete,"display","none")},_showCaseSensitive:function(){p.setStyle(this.cbxCaseSensitive.domNode,"display","inline-block")},_hideCaseSensitive:function(){p.setStyle(this.cbxCaseSensitive.domNode,"display","none")},_showAndEnableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!0);
this._showCaseSensitive()},_hideAndDisableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!1);this._hideCaseSensitive()},_initSelf:function(){this.layerInfo=q.mixin({},this.layerInfo);this.isHosted&&(this.cbxCaseSensitive.setValue(!1),this.cbxCaseSensitive.setStatus(!1),this.cbxCaseSensitive.domNode.title=this.nls.notSupportCaseSensitiveTip);this.own(n(this.fieldsSelect,"MouseEnter",q.hitch(this,this._updateFieldsSelectTitle)));this.own(n(this.operatorsSelect,"MouseEnter",q.hitch(this,this._updateOperatorsSelectTitle)));
this.enableAskForValues?(p.setStyle(this.cbxAskValues.domNode,"display","inline-block"),p.setStyle(this.promptSection,"display","block"),this.own(n(this.cbxAskValues,"status-change",q.hitch(this,this._onCbxAskValuesStatusChanged))),this.cbxAskValues.onChange=q.hitch(this,this._onCbxAskValuesClicked)):(p.setStyle(this.cbxAskValues.domNode,"display","none"),p.setStyle(this.promptSection,"display","none"));var a=this.layerInfo.fields;a&&0<a.length&&(a=h.filter(a,q.hitch(this,function(a){return 0<=this.supportFieldTypes.indexOf(a.type)})),
0<a.length&&(this._initValueTypeUI(),this._enableAllValueTypeOptions(),this._initFieldsSelect(a),this.part?this._showPart(this.part):this._resetByFieldAndOperator(),setTimeout(q.hitch(this,function(){this._bindFieldsSelectChangeAndOperatorChangeEvents()}),10)))},_bindFieldsSelectChangeAndOperatorChangeEvents:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this._handle1=n(this.fieldsSelect,"change",q.hitch(this,this._onFieldsSelectChange));this._handle2=n(this.operatorsSelect,"change",
q.hitch(this,this._onOperatorsSelectChange))},_removeFieldsSelectChangeAndOperatorChangeEvents:function(){this._handle1&&this._handle1.remove();this._handle2&&this._handle2.remove();this._handle2=this._handle1=null},_isServiceSupportDistinctValues:function(a,b){return this._isStreamServer(a)?!1:10.1<=parseFloat(b.currentVersion)},_isStreamServer:function(a){a=(a||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(a)},_updateFieldsSelectTitle:function(){this.fieldsSelect.domNode.title="";var a=
this._getSelectedFilteringItem(this.fieldsSelect);a&&(this.fieldsSelect.domNode.title=a.displayName||a.alias||a.name)},_updateOperatorsSelectTitle:function(){this.operatorsSelect.domNode.title="";var a=this.operatorsSelect.get("value");a&&(a=this.operatorsSelect.getOptions(a),this.operatorsSelect.domNode.title=a.label)},_showValidationErrorTip:function(a){try{!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),a.focusNode.blur())}catch(u){console.error(u)}},_getSelectedFilteringItem:function(a){if(a.validate()){var b=
a.get("item");if(b)return b}this._showValidationErrorTip(a);return null},_getShortTypeByFieldType:function(a){return a===this.stringFieldType?"string":a===this.dateFieldType?"date":0<=this.numberFieldTypes.indexOf(a)?"number":null},_initFieldsSelect:function(b){b=h.map(b,q.hitch(this,function(a,b){var c=q.mixin({},a);c.id=b;c.shortType=this._getShortTypeByFieldType(a.type);c.alias||(c.alias=c.name);a="";"string"===c.shortType?a=this.nls.string:"number"===c.shortType?a=this.nls.number:"date"===c.shortType&&
(a=this.nls.date);c.displayName=c.alias+" ("+a+")";return c}));if(0<b.length){var c=new a({data:b});this.fieldsSelect.set("store",c);this.fieldsSelect.set("value",b[0].id)}this._updateOperatorsByFieldsSelect()},_showPart:function(a){if((this.part=a)&&this.part.fieldObj&&this.part.operator&&this.part.valueObj){this._removeFieldsSelectChangeAndOperatorChangeEvents();var b=this.part.fieldObj.name;a=this.part.operator;this.part.caseSensitive=!!this.part.caseSensitive;b=this.fieldsSelect.store.query({name:b});
0!==b.length&&(b=b[0])&&(this.fieldsSelect.set("value",b.id),this._updateOperatorsByFieldsSelect(),this.operatorsSelect.set("value",a),this._resetByFieldAndOperator(this.part),a=this.part.interactiveObj)&&(this.cbxAskValues.check(),this._updatePrompt(),this.promptTB.set("value",a.prompt||""),this.hintTB.set("value",a.hint||""),"unique"===this.part.valueObj.type||"multiple"===this.part.valueObj.type?this.cascadeSelect.set("value",a.cascade):this.cascadeSelect.set("value","none"))}},_onFieldsSelectChange:function(){this._updateOperatorsByFieldsSelect();
this._resetByFieldAndOperator()},_updateOperatorsByFieldsSelect:function(){this._updateFieldsSelectTitle();this.operatorsSelect.removeOption(this.operatorsSelect.getOptions());this.operatorsSelect.addOption({value:"none",label:this.nls.none});var a=this._getSelectedFilteringItem(this.fieldsSelect);a&&(this.operatorsSelect.shortType=a.shortType,a=f.getOperatorsByShortType(a.shortType,this.isHosted),this.operatorsSelect.removeOption(this.operatorsSelect.getOptions()),h.forEach(a,q.hitch(this,function(a){this.operatorsSelect.addOption({value:a,
label:this.nls[a]})})))},_onOperatorsSelectChange:function(){this._resetByFieldAndOperator()},_updateValueTypeClass:function(){p.removeClass(this.domNode,"value-type");p.removeClass(this.domNode,"field-type");p.removeClass(this.domNode,"unique-type");p.removeClass(this.domNode,"support-cascade");var a=this._getValueTypeByUI();"value"===a?(p.addClass(this.domNode,"value-type"),this.cascadeSelect.set("value","none")):"field"===a?(p.addClass(this.domNode,"field-type"),this.cascadeSelect.set("value",
"none")):(p.addClass(this.domNode,"unique-type"),this.cascadeSelect.set("value","previous"),a=!0,a=this._getSelectedFilteringItem(this.fieldsSelect),a=g.getCodedValuesOrTypesCount(a,this.layerInfo),(a=0<a?g.isCodedValuesSupportFilter(this.layerInfo,a):!0)?(this.cascadeSelect.set("value","previous"),p.addClass(this.domNode,"support-cascade")):this.cascadeSelect.set("value","none"))},_enableValueTypeSelectOption:function(a,b){a=k("li[data-type\x3d"+a+"]",this.valueTypePopupNode)[0];b?p.removeClass(a,
"disabled"):p.addClass(a,"disabled")},_setVisibleValueTypeSelectOption:function(a,b){a=k("li[data-type\x3d"+a+"]",this.valueTypePopupNode)[0];b?p.setStyle(a,"display","block"):p.setStyle(a,"display","none")},_calcValueTypePosition:function(a){var b,c;a=p.position(a.target);b=p.position(document.body).w;c=p.position(document.body).h;var d=p.getStyle(this.valueTypePopupNode,"width"),e=p.getStyle(this.valueTypePopupNode,"height");c=c-a.y-16-10>=e?a.y+16+10:a.y-e-10;b=b-a.x>=d?a.x:a.x+16-d;window.isRTL&&
(b=a.x+16>=d?a.x+16-d:a.x);return{left:b,top:c}},_onValueTypeSetClick:function(a){b.open({popup:this.customDijit,around:a.target});var c=this._calcValueTypePosition(a);b.open({x:c.left,y:c.top,popup:this.customDijit});a.stopPropagation()},_onValueTypeClick:function(a){var b=p.getAttr(a.currentTarget,"data-type");p.hasClass(a.currentTarget,"disabled")?a.stopPropagation():(k("li",this.valueTypePopupNode).forEach(function(a){p.removeClass(a,"selected")}),p.addClass(a.currentTarget,"selected"),this._resetByFieldAndOperator(null,
b),this._closeEsriPopup())},_enableValueTypeOption:function(a){this._enableValueTypeSelectOption("value",a)},_enableFieldTypeOption:function(a){this._enableValueTypeSelectOption("field",a)},_enableUniqueTypeOption:function(a){this._enableValueTypeSelectOption("unique",a)},_enableUniquePredefinedTypeOption:function(a){this.runtime?this._setVisibleValueTypeSelectOption("uniquePredefined",!1):this._enableValueTypeSelectOption("uniquePredefined",a)},_enableValuesTypeOption:function(a){this._enableValueTypeSelectOption("values",
a)},_enableMultipleTypeOption:function(a){this._enableValueTypeSelectOption("multiple",a)},_enableMultiplePredefinedTypeOption:function(a){this.runtime?this._setVisibleValueTypeSelectOption("multiplePredefined",!1):this._enableValueTypeSelectOption("multiplePredefined",a)},_enableAllValueTypeOptions:function(){this._enableValueTypeOption(!0);this._enableFieldTypeOption(!0);this._enableUniqueTypeOption(!0);this._enableUniquePredefinedTypeOption(!0);this._enableMultipleTypeOption(!0);this._enableMultiplePredefinedTypeOption(!0)},
_disableAllValueTypeOptions:function(){this._enableValueTypeOption(!1);this._enableFieldTypeOption(!1);this._enableUniqueTypeOption(!1);this._enableUniquePredefinedTypeOption(!1);this._enableMultipleTypeOption(!1);this._enableMultiplePredefinedTypeOption(!1)},_resetByFieldAndOperator:function(a,b){this._updateOperatorsSelectTitle();this.valueProvider&&this.valueProvider.destroy();this._hideCaseSensitive();this._disableAllValueTypeOptions();a||(a={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",
caseSensitive:!1},a.fieldObj=this._getFieldObjByUI(),a.operator=this._getOperatorByUI());var c=[],d=null;a.fieldObj&&a.operator&&(c=this.valueProviderFactory.getSupportedValueTypes(a.fieldObj.name,a.operator),a.valueObj?d=a.valueObj.type:(d=b&&0<=c.indexOf(b)?b:c[0],a.valueObj={type:d}),0<=c.indexOf("value")&&this._enableValueTypeOption(!0),0<=c.indexOf("field")&&this._enableFieldTypeOption(!0),0<=c.indexOf("unique")&&this._enableUniqueTypeOption(!0),0<=c.indexOf("values")&&this._enableValuesTypeOption(!0),
0<=c.indexOf("uniquePredefined")&&this._enableUniquePredefinedTypeOption(!0),0<=c.indexOf("multiple")&&this._enableMultipleTypeOption(!0),0<=c.indexOf("multiplePredefined")&&this._enableMultiplePredefinedTypeOption(!0),"value"===d?this._enableValueTypeOption(!0):"field"===d?this._enableFieldTypeOption(!0):"unique"===d?this._enableUniqueTypeOption(!0):"values"===d?this._enableValuesTypeOption(!0):"uniquePredefined"===d?this._enableUniquePredefinedTypeOption(!0):"multiple"===d?this._enableMultipleTypeOption(!0):
"multiplePredefined"===d&&this._enableMultiplePredefinedTypeOption(!0),this._updateValueTypeUI(d));0<c.length?(this.valueProvider=this.valueProviderFactory.getValueProvider(a,this.runtime),this.valueProvider.placeAt(this.valueProviderContainer),this.valueProvider.setValueObject(a.valueObj),this.own(n(this.valueProvider,"change",q.hitch(this,function(){this.emit("change")}))),this.valueProvider.bindChangeEvents(),this.valueProvider.isBlankValueProvider()?(p.addClass(this.valueProvider.domNode,"hidden"),
p.addClass(this.attributeValueContainer,"hidden")):p.removeClass(this.attributeValueContainer,"hidden"),(b=f.getOperatorInfo(a.operator))&&d&&(b[d]&&b[d].supportCaseSensitive&&this._showCaseSensitive(),a&&this.cbxCaseSensitive.setValue(a.caseSensitive))):p.addClass(this.attributeValueContainer,"hidden");this._updateWhenValueRadioChanged();this.emit("change")},_updateWhenValueRadioChanged:function(){this._updatePrompt(!1,!0);this._updateValueTypeClass()},_onCbxAskValuesClicked:function(){this._updateRequiredProperty();
this._updatePrompt(!0)},_onCbxAskValuesStatusChanged:function(){this._updateRequiredProperty()},_isUseAskForValues:function(){var a=this._getValueTypeByUI();return"uniquePredefined"===a||"multiplePredefined"===a?!0:this.cbxAskValues.status&&this.cbxAskValues.checked},_isValueRequired:function(){return!this._isUseAskForValues()},_updateRequiredProperty:function(){var a=this._isValueRequired();this.valueProvider.setRequired(a)},_getValueTypeByUI:function(){var a=k("li.selected",this.valueTypePopupNode)[0];
return a?p.getAttr(a,"data-type"):null},_closeEsriPopup:function(){this.customDijit&&b.close(this.customDijit)},_destroyEsriPopup:function(){this.customDijit&&(this.customDijit.destroy(),b.close(this.customDijit))},_initValueTypeUI:function(){if(!this.valueTypePopupNode){this.valueTypePopupNode=document.createElement("DIV");p.addClass(this.valueTypePopupNode,"value-type-popup");this.valueTypePopupNode.innerHTML='\x3cdiv class\x3d"value-type-popup-header"\x3e\x3cspan class\x3d"value-type-popup-title jimu-ellipsis" title\x3d"'+
this.nls.setInputType+'"\x3e'+this.nls.setInputType+'\x3c/span\x3e\x3cspan class\x3d"value-type-popup-icon jimu-icon jimu-icon-delete"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul\x3e\x3cli data-type\x3d"value" title\x3d"'+this.nls.value+'"\x3e\x3cspan\x3e'+this.nls.value+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli data-type\x3d"field" title\x3d"'+this.nls.field+'"\x3e\x3cspan\x3e'+this.nls.field+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli data-type\x3d"unique" title\x3d"'+this.nls.unique+
'"\x3e\x3cspan\x3e'+this.nls.unique+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli data-type\x3d"uniquePredefined" title\x3d"'+this.nls.uniquePredefined+'"\x3e\x3cspan\x3e'+this.nls.uniquePredefined+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli data-type\x3d"multiple" title\x3d"'+this.nls.multiple+'"\x3e\x3cspan\x3e'+this.nls.multiple+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli data-type\x3d"multiplePredefined" title\x3d"'+this.nls.multiplePredefined+'"\x3e\x3cspan\x3e'+
this.nls.multiplePredefined+"\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3c/ul\x3e";this.customDijit=new m({baseClass:"jimu-filter-valueType",domNode:this.valueTypePopupNode});var a=k(".value-type-popup-icon",this.valueTypePopupNode)[0];this.own(n(a,"click",q.hitch(this,function(a){this._closeEsriPopup();a.stopPropagation()})));a=k("li",this.valueTypePopupNode);this.own(n(a,"click",q.hitch(this,function(a){this._onValueTypeClick(a)})))}},_updateValueTypeUI:function(a){k("li",this.valueTypePopupNode).forEach(function(a){p.removeClass(a,
"selected")});if(a=k("li[data-type\x3d"+a+"]",this.valueTypePopupNode)[0])return p.addClass(a,"selected")},_updatePrompt:function(a,b){this.promptTB.set("value","");this.hintTB.set("value","");this.cbxAskValues.setStatus(!0);!a&&b&&this.cbxAskValues.uncheck(!0);p.setStyle(this.promptTable,"display","table");b=this.operatorsSelect.get("value");var c=this.nls[b],d=!1,e=this._getValueTypeByUI(),g=f.getOperatorInfo(b);g&&e&&(g=g[e])&&g.supportAskForValue&&(d=!0);d||(this.cbxAskValues.uncheck(!0),this.cbxAskValues.setStatus(!1));
g=this.cbxAskValues.getValue();(e=0<=["uniquePredefined","multiplePredefined"].indexOf(e)?!0:!1)?this.cbxAskValues.check(!0):a?g?this.cbxAskValues.check(!0):this.cbxAskValues.uncheck(!0):d?this.cbxAskValues.status||this.cbxAskValues.check(!0):this.cbxAskValues.uncheck(!0);this.cbxAskValues.status&&this.cbxAskValues.checked?(p.setStyle(this.promptTable,"display","table"),(a=this._getSelectedFilteringItem(this.fieldsSelect))&&"none"!==b&&this.promptTB.set("value",(a.alias||a.name)+" "+c)):p.setStyle(this.promptTable,
"display","none");e&&this.cbxAskValues.setStatus(!1)},_destroySelf:function(){this.destroy()},destroy:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this._destroyEsriPopup();this.inherited(arguments)}})})},"jimu/dijit/_FilterSet":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_FilterSet.html dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/aspect dojo/query ./_SingleFilter".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f){return d([m,l,c,r],{templateString:t,baseClass:"jimu-filter-set",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],partsObj:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,runtime:!1,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelf()},toJson:function(){var a=g(".jimu-single-filter",
this.allExpsBox),a=n.map(a,p.hitch(this,function(a){return q.byNode(a).toJson()}));return n.every(a,p.hitch(this,function(a){return!!a}))&&0<a.length?{logicalOperator:this.allAnySelect.value,parts:a}:null},showDelteIcon:function(){h.setStyle(this.btnDelete,"display","block")},hideDeleteIcon:function(){h.setStyle(this.btnDelete,"display","none")},_initSelf:function(){this.own(k(this.btnAdd,"click",p.hitch(this,function(){this._addSingleFilter();this.emit("change")})));if(this.partsObj){this.allAnySelect.value=
this.partsObj.logicalOperator;var a=this.partsObj.parts||[];0===a.length?(this._addSingleFilter(),this._addSingleFilter()):1===a.length?(this._addSingleFilter(a[0]),this._addSingleFilter()):n.forEach(a,p.hitch(this,function(a){this._addSingleFilter(a)}))}else this._addSingleFilter(),this._addSingleFilter()},_addSingleFilter:function(b){b=new f({url:this.url,layerInfo:this.layerInfo,popupFieldsInfo:this.popupFieldsInfo,stringFieldType:this.stringFieldType,dateFieldType:this.dateFieldType,numberFieldTypes:this.numberFieldTypes,
part:b,OPERATORS:this.OPERATORS,enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,isInFilterSet:!0,runtime:this.runtime});b.placeAt(this.allExpsBox);b.startup();this.own(a.after(b,"_destroySelf",p.hitch(this,this._checkFilterNumbers)));this.own(k(b,"change",p.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return b},_checkFilterNumbers:function(){var a=g(".jimu-single-filter",this.allExpsBox),c=2<a.length;n.forEach(a,
p.hitch(this,function(a){a=q.byNode(a);c?a.showDelteIcon():a.hideDeleteIcon()}))},_destroySelf:function(){this.destroy()}})})},"jimu/dijit/FilterParameters":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/promise/all dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/_base/array dojo/query dijit/registry jimu/filterUtils jimu/utils ./_SingleFilterParameter ./_filter/ValueProviderFactory".split(" "),function(r,d,
m,l,c,t,q,p,h,n,k,a,g,f,b,e,u){return c([t,q,p,d],{baseClass:"jimu-filter-parameters",templateString:'\x3cdiv\x3e\x3ctable style\x3d"width:100%;border-collapse:collapse;"\x3e\x3ctbody data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e',_filterUtils:null,_spObj:null,nls:null,partsObj:null,layerInfo:null,OPERATORS:null,url:null,featureLayerId:null,postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this._filterUtils=new f;this.OPERATORS=h.clone(this._filterUtils.OPERATORS);
this._spObj={}},destroy:function(){this.clear();this._filterUtils=null;this.inherited(arguments)},getFilterExpr:function(a){var b=this._getNewValidPartsObj(this.partsObj,!0),c=b?this._getFilterExprByPartsObj(b):null;return a&&a.ifDisplaySQL?void 0===b.displaySQL?c:b.displaySQL:c},getValueProviders:function(){for(var a=[],b=this._getAllInteractiveSinglePartArray(this.partsObj),c=0;c<b.length;c++){var d=b[c].spId;d&&(d=this._getSingleFilterParameterBySpId(d),a.push(d))}return a},_getNewValidPartsObj:function(a,
b){a=h.clone(a);for(var c={logicalOperator:a.logicalOperator,parts:[]},d=h.hitch(this,function(a){if(a.spId){var b=this._getSingleFilterParameterBySpId(a.spId),c=b.getValueObject();a.valueObj=c;if(!c||"uniquePredefined"!==c.type&&"multiplePredefined"!==c.type)return c&&"multipleDynamic"===c.type?0<c.value.length?1:-1:c&&"unique"===c.type?null===c.value||void 0===c.value||""===c.value?-1:1:b.getStatus();var b=[],d;for(d in c.value)c.value[d].isChecked&&b.push(c.value[d]);if(0<b.length)return a.valueObj.value=
b,1;a.valueObj.value="";return-1}return a.valueObj?1:-1}),e=h.hitch(this,function(a){var b=d(a);0<b&&c.parts.push(a);return b}),f=h.hitch(this,function(a){var b=[];a.parts=k.filter(a.parts,h.hitch(this,function(a){a=d(a);b.push(a);return 0<a}));1===a.parts.length?c.parts.push(a.parts[0]):2<=a.parts.length&&c.parts.push(a);return Math.min.apply(b,b)}),g=0;g<a.parts.length;g++){var l=a.parts[g];if(l.parts){if(0>f(l)&&b)return null}else if(0>e(l)&&b&&l.valueObj&&"uniquePredefined"!==l.valueObj.type&&
"multiplePredefined"!==l.valueObj.type&&"unique"!==l.valueObj.type)return null}return c},_getFilterExprByPartsObj:function(a){this._filterUtils.isHosted=b.isHostedService(this.url);return this._filterUtils.getExprByFilterObj(a)},_getSingleFilterParameterBySpId:function(a){return this._spObj[a]},_getCascadeFilterPartsObj:function(a){var b={logicalOperator:this.partsObj.logicalOperator,parts:[]},c=h.clone(this.partsObj),d,e,f;d="none";a.interactiveObj&&a.interactiveObj.cascade&&(d=a.interactiveObj.cascade);
if("previous"===d)for(d=0;d<c.parts.length;d++)e=c.parts[d],e.majorCascadeIndex<a.majorCascadeIndex?b.parts.push(e):e.parts&&e.majorCascadeIndex===a.majorCascadeIndex&&(f=h.clone(e),f.parts=k.filter(f.parts,h.hitch(this,function(b){return b.minorCascadeIndex<a.minorCascadeIndex})),b.parts.push(f));else if("all"===d)for(d=0;d<c.parts.length;d++)e=c.parts[d],e.majorCascadeIndex!==a.majorCascadeIndex?b.parts.push(e):e.majorCascadeIndex===a.majorCascadeIndex&&e.parts&&(f=h.clone(e),k.some(e.parts,h.hitch(this,
function(b){return b.spId===a.spId}))&&(f.parts=k.filter(f.parts,h.hitch(this,function(b){return b.minorCascadeIndex!==a.minorCascadeIndex})),b.parts.push(f)));return b=this._getNewValidPartsObj(b,!1)},_getCascadeFilterExpr:function(a){var b="1\x3d1";(a=this._getCascadeFilterPartsObj(a))&&(b=this._getFilterExprByPartsObj(a));b||(b="1\x3d1");return b},clear:function(){this.featureLayerId=this.url=null;var b=a(".jimu-widget-query-single-parameter",this.tbody);k.forEach(b,h.hitch(this,function(a){g.byNode(a).destroy()}));
n.empty(this.tbody);this.layerInfo=this.partsObj=null},build:function(b,c,d,f){var g=new m;this.clear();this.url=b;this.layerInfo=c;this.partsObj=h.clone(d);this.partsObj=this._updatePartsObj(this.partsObj);this.featureLayerId=f;this._setCascadeIndexForPartsObj(this.partsObj);b=this._getAllInteractiveSinglePartArray(this.partsObj);if(0<b.length){var p=new u({url:this.url,layerDefinition:c,featureLayerId:this.featureLayerId});b=k.map(b,h.hitch(this,function(b){var d=n.create("tr",{innerHTML:"\x3ctd\x3e\x3c/td\x3e"},
this.tbody),d=a("td",d)[0],f=this._getFieldInfo(b.fieldObj.name,this.layerInfo),f=new e({nls:this.nls,url:this.url,layerDefinition:c,fieldInfo:f,part:b,valueProviderFactory:p});this.own(r(f,"change",h.hitch(this,this._onSingleFilterParameterChanged)));this.own(r(f,"enter",h.hitch(this,this._catchSingleFilterParameterEnter)));f.placeAt(d);f.startup();b.spId=f.id;return this._spObj[f.id]=f}));k.forEach(b,h.hitch(this,function(a){a.valueProvider.getCascadeFilterExpr=h.hitch(this,this._getCascadeFilterExpr,
a.part);a.valueProvider.getCascadeFilterPartsObj=h.hitch(this,this._getCascadeFilterPartsObj,a.part)}));b=k.map(b,h.hitch(this,function(a){return a.init()}));l(b).then(h.hitch(this,function(){g.resolve()}),h.hitch(this,function(){g.reject()}))}else g.resolve();return g},_updatePartsObj:function(a){k.forEach(a,h.hitch(this,function(a){a.parts?k.forEach(a.parts,h.hitch(this,function(a){a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&
(a.interactiveObj.cascade="none")})):a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")}));return a},_setCascadeIndexForPartsObj:function(a){for(var b=0;b<a.parts.length;b++){var c=a.parts[b];c.majorCascadeIndex="AND"===a.logicalOperator?b:0;c.minorCascadeIndex=0;c.cascadeIndex=c.majorCascadeIndex;if(c.parts)for(var d=0;d<c.parts.length;d++){var e=c.parts[d];e.majorCascadeIndex=c.majorCascadeIndex;e.minorCascadeIndex=
"AND"===c.logicalOperator?d:0;e.cascadeIndex=parseFloat(e.majorCascadeIndex+"."+e.minorCascadeIndex)}}},_getFieldInfo:function(a,b){b=b.fields;for(var c=0;c<b.length;c++){var d=b[c];if(a===d.name)return d}return null},_getAllInteractiveSinglePartArray:function(a){for(var b=[],c=0;c<a.parts.length;c++){var d=a.parts[c];if(d.parts)for(var e=0;e<d.parts.length;e++){var f=d.parts[e];f.interactiveObj&&b.push(f)}else d.interactiveObj&&b.push(d)}return b},_catchSingleFilterParameterEnter:function(){this.emit("enter")},
_onSingleFilterParameterChanged:function(){this.emit("change",this.getFilterExpr(!1))}})})},"jimu/dijit/_SingleFilterParameter":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilterParameter.html dojo/_base/lang".split(" "),function(r,d,m,l,c,t,q,p,h){return l([c,t,q,d],{baseClass:"jimu-single-filter-parameter",templateString:p,valueProvider:null,nls:null,url:null,layerDefinition:null,
fieldInfo:null,part:null,valueProviderFactory:null,postCreate:function(){this.inherited(arguments);this.valueProvider=this.valueProviderFactory.getValueProvider(this.part,!0);this.valueProvider.placeAt(this.valueProviderTd);this.own(r(this.valueProvider,"change",h.hitch(this,this._onValueProviderChanged)));this.own(r(this.valueProvider,"enter",h.hitch(this,this._onValueProviderEnter)));this.valueProvider.bindChangeEvents()},getValueObject:function(){return this.valueProvider.getValueObject()},init:function(){return this.build(this.fieldInfo,
this.part)},build:function(c,d){var a=null;this.fieldInfo=c;this.part=d;if(c=d.interactiveObj)this.promptNode.innerHTML=c.prompt||"",this.hintNode.innerHTML=c.hint||"";(c=this.valueProvider.setValueObject(this.part.valueObj))&&"function"===typeof c.then?a=c:(a=new m,a.resolve());return a},disable:function(){this.valueProvider.disable()},enable:function(){this.valueProvider.enable()},isEnabled:function(){return this.valueProvider.isEnabled()},getStatus:function(){return this.valueProvider.getStatus()},
_showValidationErrorTip:function(c){!c.validate()&&c.domNode&&c.focusNode&&(c.focusNode.focus(),c.focusNode.blur())},_onValueProviderEnter:function(){this.emit("enter")},_onValueProviderChanged:function(){this.emit("change")}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(r,d,m,l,c,t,q,p,h){return t("dijit.layout._LayoutWidget",[d,m,l],{baseClass:"dijitLayoutContainer",
isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);q.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var d=this.getParent&&this.getParent();d&&d.isLayoutContainer||(this.resize(),this.own(c.on("resize",r.hitch(this,"resize"))))}},resize:function(c,d){var a=this.domNode;c&&p.setMarginBox(a,c);d=d||{};r.mixin(d,c||{});"h"in d&&"w"in d||(d=r.mixin(p.getMarginBox(a),d));c=h.getComputedStyle(a);var g=p.getMarginExtents(a,
c),f=p.getBorderExtents(a,c);d=this._borderBox={w:d.w-(g.w+f.w),h:d.h-(g.h+f.h)};g=p.getPadExtents(a,c);this._contentBox={l:h.toPixelValue(a,c.paddingLeft),t:h.toPixelValue(a,c.paddingTop),w:d.w-g.w,h:d.h-g.h};this.layout()},layout:function(){},_setupChild:function(c){q.add(c.domNode,this.baseClass+"-child "+(c.baseClass?this.baseClass+"-"+c.baseClass:""))},addChild:function(c,d){this.inherited(arguments);this._started&&this._setupChild(c)},removeChild:function(c){q.remove(c.domNode,this.baseClass+
"-child"+(c.baseClass?" "+this.baseClass+"-"+c.baseClass:""));this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(r,d,m){return r("dgrid.OnDemandGrid",[d,m],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(r,d,m,l,c,t,q){function p(c,a){a&&a.nodeType&&c.appendChild(a)}
function h(c,a,d,f){if(this.formatter){f=this.formatter;var b=this.grid.formatterScope;d.innerHTML="string"===typeof f&&b?b[f](a,c):this.formatter(a,c)}else null!=a&&d.appendChild(document.createTextNode(a))}var n=8>l("ie")&&!l("quirks");d=d("dgrid.Grid",t,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(c){return"object"!=typeof c?this.columns[c]:this.cell(c).column},listType:"grid",cell:function(c,a){if(c.column&&c.element)return c;c.target&&c.target.nodeType&&(c=c.target);
var d;if(c.nodeType){do{if(this._rowIdToObject[c.id])break;var f=c.columnId;if(f){a=f;d=c;break}c=c.parentNode}while(c&&c!=this.domNode)}if(!d&&"undefined"!=typeof a){var b=this.row(c);if(f=b&&b.element)for(var f=f.getElementsByTagName("td"),e=0;e<f.length;e++)if(f[e].columnId==a){d=f[e];break}}if(null!=c)return{row:b||this.row(c),column:a&&this.column(a),element:d}},createRowCells:function(d,a,g,f){var b=c("table.dgrid-row-table[role\x3dpresentation]"),e=9>l("ie")||l("quirks")?c(b,"tbody"):b,h,k,
m,p,r,t,E,y,C,F;g=g||this.subRows;k=0;for(m=g.length;k<m;k++)for(t=g[k],h=c(e,"tr"),t.className&&c(h,"."+t.className),p=0,r=t.length;p<r;p++){E=t[p];y=E.id;C=E.field?".field-"+q.escapeCssIdentifier(E.field,"-"):"";(F="function"===typeof E.className?E.className(f):E.className)&&(C+="."+F);C=c(d+(".dgrid-cell.dgrid-cell-padding"+(y?".dgrid-column-"+q.escapeCssIdentifier(y,"-"):"")+C.replace(/ +/g,"."))+"[role\x3d"+("th"===d?"columnheader":"gridcell")+"]");C.columnId=y;n?(y=c(C,"!dgrid-cell-padding div.dgrid-cell-padding"),
C.contents=y):y=C;if(F=E.colSpan)C.colSpan=F;if(F=E.rowSpan)C.rowSpan=F;a(y,E);h.appendChild(C)}return b},left:function(c,a){c.element||(c=this.cell(c));return this.cell(this._move(c,-(a||1),"dgrid-cell"))},right:function(c,a){c.element||(c=this.cell(c));return this.cell(this._move(c,a||1,"dgrid-cell"))},renderRow:function(d,a){var g=this.createRowCells("td",function(c,b){var e=d;b.get?e=b.get(d):"field"in b&&"_item"!=b.field&&(e=e[b.field]);b.renderCell?p(c,b.renderCell(d,e,c,a)):h.call(b,d,e,c,
a)},a&&a.subRows,d);return c("div[role\x3drow]\x3e",g)},renderHeader:function(){var d=this,a=this.headerNode,g=a.childNodes.length;for(a.setAttribute("role","row");g--;)c(a.childNodes[g],"!");g=this.createRowCells("th",function(a,b){var c=b.headerNode=a;n&&(a=a.parentNode);var d=b.field;d&&(a.field=d);b.renderHeaderCell?p(c,b.renderHeaderCell(c)):("label"in b||b.field)&&c.appendChild(document.createTextNode("label"in b?b.label:b.field));!1!==b.sortable&&d&&"_item"!=d&&(a.sortable=!0,a.className+=
" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[g.id=this.id+"-header"]=this.columns;a.appendChild(g);this._sortListener&&this._sortListener.remove();this._sortListener=m(g,"click,keydown",function(c){if("click"==c.type||32==c.keyCode||!l("opera")&&13==c.keyCode){var b=c.target,e,f,g;do if(b.sortable){g=[{attribute:e=b.field||b.columnId,descending:(f=d._sort[0])&&f.attribute==e&&!f.descending}];e={bubbles:!0,cancelable:!0,grid:d,parentType:c.type,sort:g};m.emit(c.target,
"dgrid-sort",e)&&(d._sortNode=b,d.set("sort",g));break}while((b=b.parentNode)&&b!=a)}})},resize:function(){var c=this.headerNode.firstChild,a=this.contentNode,d;this.inherited(arguments);if(!l("ie")||7<l("ie")&&!l("quirks"))a.style.width="",a&&c&&(d=c.offsetWidth)!=a.offsetWidth&&(a.style.width=d+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(c,a){this.inherited(arguments);this.updateSortArrow(this._sort)},
_findSortArrowParent:function(c){var a=this.columns,d;for(d in a){var f=a[d];if(f.field==c)return f.headerNode}},updateSortArrow:function(d,a){this._lastSortedArrow&&(c(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),c(this._lastSortedArrow,"!"),delete this._lastSortedArrow);a&&(this._sort=d);if(d[0]){a=d[0].attribute;d=d[0].descending;a=this._sortNode||this._findSortArrowParent(a);var g;delete this._sortNode;a&&(a=a.contents||a,g=this._lastSortedArrow=c("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),
g.innerHTML="\x26nbsp;",a.insertBefore(g,a.firstChild),c(a,d?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(c,a){return this.addCssRule("#"+q.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+q.escapeCssIdentifier(c,"-"),a)},_configColumns:function(c,a){var d=[],f=a instanceof Array;q.each(a,function(b,e){"string"==typeof b&&(a[e]=b={label:b});f||b.field||(b.field=e);e=b.id=b.id||(isNaN(e)?e:c+e);this._configColumn&&(this._configColumn(b,e,a,c),e=b.id);f&&(this.columns[e]=
b);b.grid=this;"function"===typeof b.init&&b.init();d.push(b)},this);return f?a:d},_destroyColumns:function(){var c=this.subRows,a=c&&c.length,d,f,b,e;this.cleanup();for(d=0;d<a;d++)for(f=0,e=c[d].length;f<e;f++)b=c[d][f],"function"===typeof b.destroy&&b.destroy()},configStructure:function(){var c=this.subRows,a=this._columns=this.columns;this.columns=!a||a instanceof Array?{}:a;if(c)for(a=0;a<c.length;a++)c[a]=this._configColumns(a+"-",c[a]);else this.subRows=[this._configColumns("",a)]},_getColumns:function(){return this._columns||
this.columns},_setColumns:function(c){this._destroyColumns();this.subRows=null;this.columns=c;this._updateColumns()},_setSubRows:function(c){this._destroyColumns();this.subRows=c;this._updateColumns()},setColumns:function(c){r.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",c)},setSubRows:function(c){r.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",c)},_updateColumns:function(){this.configStructure();this.renderHeader();
this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});d.appendIfNode=p;d.defaultRenderCell=h;return d})},"put-selector/put":function(){(function(r){var d,m=/[-+,> ]/;r([],d=function(l,c){function r(c){function a(){k&&e&&k!=e&&(e==c&&(d||(d=m.test(z)&&l.createDocumentFragment()))?d:e).insertBefore(k,b||null)}for(var d,f,b,e,k,t=arguments,x=t[0],D=0;D<t.length;D++){var z=t[D];if("object"==
typeof z){f=!1;if(z instanceof Array){k=l.createDocumentFragment();for(var A=0;A<z.length;A++)k.appendChild(r(z[A]));z=k}if(z.nodeType)k=z,a(),e=z,b=0;else for(A in z)k[A]=z[A]}else if(f)f=!1,k.appendChild(l.createTextNode(z));else{1>D&&(c=null);f=!0;if(x=z.replace(q,function(d,f,g,m,q,u){f&&(a(),"-"==f||"+"==f?(e=(b=k||e).parentNode,k=null,"+"==f&&(b=b.nextSibling)):("\x3c"==f?e=k=(k||e).parentNode:(","==f?e=c:k&&(e=k),k=null),b=0),k&&(e=k));if((d=!g&&m)||!k&&(g||q))"$"==d?(d=t[++D],e.appendChild(l.createTextNode(d))):
(d=d||r.defaultTag,(f=n&&t[D+1]&&t[D+1].name)&&(d="\x3c"+d+' name\x3d"'+f+'"\x3e'),k=h&&~(p=d.indexOf("|"))?l.createElementNS(h[d.slice(0,p)],d.slice(p+1)):l.createElement(d));if(g)if("$"==m&&(m=t[++D]),"#"==g)k.id=m;else if(f=(d=k.className)&&(" "+d+" ").replace(" "+m+" "," "),"."==g)k.className=d?(f+m).substring(1):m;else if("!"==z){var v;n?r("div",k,"\x3c").innerHTML="":(v=k.parentNode)&&v.removeChild(k)}else f=f.substring(1,f.length-1),f!=d&&(k.className=f);q&&("$"==u&&(u=t[++D]),"style"==q?k.style.cssText=
u:(g="!"==q.charAt(0)?(q=q.substring(1))&&"removeAttribute":"setAttribute",u=""===u?q:u,h&&~(p=q.indexOf("|"))?k[g+"NS"](h[q.slice(0,p)],q.slice(p+1),u):k[g](q,u)));return""}))throw new SyntaxError("Unexpected char "+x+" in "+z);a();e=x=k||e}}c&&d&&c.appendChild(d);return x}m=c||m;var q=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,p,h=!1;l=l||document;var n="object"==typeof l.createElement;r.addNamespace=function(c,a){l.createElementNS?(h||
(h={}))[c]=a:l.namespaces.add(c,a)};r.defaultTag="div";r.forDocument=d;return r})})(function(r,d,m){m=m||d;"function"===typeof define?define([],function(){return m()}):"undefined"==typeof window?require("./node-html")(module,m):put=m()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),function(r,d,m,l,c,t,q,p,h){function n(a,
b){h(document.body,a,".dgrid-scrollbar-measure");b=a["offset"+b]-a["client"+b];a.className="";document.body.removeChild(a);return b}function k(a){var b=a?"."+a.replace(v,"."):"";this._class&&(b="!"+this._class.replace(v,"!")+b);h(this.domNode,b);this._class=a}function a(){return this._class}function g(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function f(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)}p("mozilla",
"opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var b,e;c.add("dom-scrollbar-width",function(a,b,c){return n(c,"Width")});c.add("dom-scrollbar-height",function(a,b,c){return n(c,"Height")});c.add("dom-rtl-scrollbar-left",function(a,b,d){a=h("div");h(document.body,d,".dgrid-scrollbar-measure[dir\x3drtl]");h(d,a);b=!!c("ie")||!!c("trident")||a.offsetLeft>=c("dom-scrollbar-width");d.className="";document.body.removeChild(d);h(a,"!");d.removeAttribute("dir");return b});var u=0,v=/ +/g,
x=7>c("ie")&&!c("quirks")?function(){var a,b,c;this._started&&(a=document.documentElement,b=a.clientWidth,a=a.clientHeight,c=this._prevWinDims||[],c[0]!==b||c[1]!==a)&&(this.resize(),this._prevWinDims=[b,a])}:function(){this._started&&this.resize()};return d("dgrid.List",c("touch")?q:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(a,b){var c=
this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){b=this.domNode=b||h("div");var e;a?(this.params=a,d.safeMixin(this,a),e=a["class"]||a.className||b.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&
this.postMixInProperties();this.id=b.id=b.id||this.id||"dgrid_"+u++;null===this.useTouchScroll&&(this.useTouchScroll=!c("dom-scrollbar-width"));this.buildRendering();e&&k.call(this,e);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var a=this.domNode,b=this.addUiClasses,d=this,e,f,g,k;k=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className="";h(a,"[role\x3dgrid].dgrid.dgrid-"+
this.listType+(b?".ui-widget":""));e=this.headerNode=h(a,"div.dgrid-header.dgrid-header-row"+(b?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));(c("quirks")||8>c("ie"))&&h(a,"div.dgrid-spacer");f=this.bodyNode=h(a,"div.dgrid-scroller");c("ff")&&(f.tabIndex=-1);this.headerScrollNode=h(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(b?".ui-widget-header":""));g=this.footerNode=h("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));h(a,g);k&&(a.className+=
" dgrid-rtl"+(c("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));l(f,"scroll",function(b){d.showHeader&&(e.scrollLeft=b.scrollLeft||f.scrollLeft);b.stopPropagation();l.emit(a,"scroll",{scrollTarget:f})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=h(this.bodyNode,"div.dgrid-content"+(b?".ui-widget-content":""));this._listeners.push(this._resizeHandle=l(window,"resize",t.throttleDelayed(x,this)))},postCreate:c("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:
function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},resize:function(){var a=this.bodyNode,d=this.headerNode,f=this.footerNode,g=d.offsetHeight,h=this.showFooter?f.offsetHeight:0,k=c("quirks")||7>c("ie");this.headerScrollNode.style.height=a.style.marginTop=g+"px";a.style.marginBottom=h+"px";k&&(a.style.height="",a.style.height=Math.max(this.domNode.offsetHeight-g-h,0)+"px",h&&(f.style.bottom=
"1px",setTimeout(function(){f.style.bottom=""},0)));b||(b=c("dom-scrollbar-width"),e=c("dom-scrollbar-height"),c("ie")&&(b++,e++),t.addCssRule(".dgrid-scrollbar-width","width: "+b+"px"),t.addCssRule(".dgrid-scrollbar-height","height: "+e+"px"),17==b||k||(t.addCssRule(".dgrid-header-row","right: "+b+"px"),t.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+b+"px")));k&&(d.style.width=a.clientWidth+"px",setTimeout(function(){d.scrollLeft=a.scrollLeft},0))},addCssRule:function(a,b){a=t.addCssRule(a,
b);this.cleanAddedRules&&this._listeners.push(a);return a},on:function(a,b){a=l(this.domNode,a,b);c("dom-addeventlistener")||this._listeners.push(a);return a},cleanup:function(){var a=this.observers,b;for(b in this._rowIdToObject)if(this._rowIdToObject[b]!=this.columns){var c=document.getElementById(b);c&&this.removeRow(c,!0)}for(b=0;b<a.length;b++)(c=a[b])&&c.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();
delete this._listeners}this._started=!1;this.cleanup();h(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},newRow:function(a,b,c,d,e){if(b){var f=this.insertRow(a,b,c,d,e);h(f,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){h(f,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return f}},adjustRowIndices:function(a){var b=
a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&h(a,"."+(1==b%2?"dgrid-row-odd":"dgrid-row-even")+"!"+(0==b%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=b++);while((a=a.nextSibling)&&a.rowIndex!=b)}},renderArray:function(a,b,c){function d(){var b=arguments;if(-1<q)for(var d=0;d<b.length;d++){var f=b[d],g=n[f?0:n.length-1];if(g=g&&e(g)){var k=g[f?"previousSibling":"nextSibling"];k&&(k=h.row(k));k&&k.element!=g&&(f=f?"unshift":"push",a[f](k.data),
n[f](k.element),c.count++)}}}function e(a){return!m.isDescendant(a,h.domNode)&&document.getElementById(a.id)?h.row(a.id.slice(h.id.length+5)).element:a}function f(a){t=h.insertRow(a,u,null,k++,c);t.observerIndex=q;return t}function g(a){v=a.slice(0);(p=b?b.parentNode:h.contentNode)&&p.parentNode&&(p!==h.contentNode||a.length)?(p.insertBefore(u,b||null),(t=a[a.length-1])&&h.adjustRowIndices(t)):l[q]&&h.cleanEmptyObservers&&"undefined"!==typeof q&&(l[q].cancel(),l[q]=0,h._numObservers--);n=a;r&&(r.rows=
n)}c=c||{};var h=this,k=c.start||0,l=this.observers,n,p,q;b||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){h._numObservers++;var r=a.observe(function(f,g,k){var l,m,r;-1<g&&n[g]&&(l=n.splice(g,1)[0],l.parentNode==p&&((m=l.nextSibling)&&g!=k&&m.rowIndex--,h.removeRow(l)),c.count--,h._processScroll&&h._processScroll());if(-1<k){if(n.length)if(0===k)r=(r=n[k])&&e(r);else{if(r=n[k-1])r=e(r),r=(r.connected||r).nextSibling}else r=h._getFirstRowSibling&&h._getFirstRowSibling(p);l&&r&&l.id===
r.id&&(r=(r.connected||r).nextSibling);r&&!r.parentNode&&(r=document.getElementById(r.id));l=b&&b.parentNode||r&&r.parentNode||h.contentNode;if(l=h.newRow(f,l,r,c.start+k,c))if(l.observerIndex=q,n.splice(k,0,l),!m||k<g)m=(m=l.previousSibling)&&m.rowIndex+1!=l.rowIndex&&0!=l.rowIndex?m:l;c.count++}0===g?d(1,1):g===a.length-(-1===k?0:1)&&d(0,0);g!=k&&m&&h.adjustRowIndices(m);h._onNotification(n,f,g,k)},!0);q=l.push(r)-1}var u=document.createDocumentFragment(),t,v;if(a.map){if(n=a.map(f,console.error),
n.then)return a.then(function(b){a=b;return n.then(function(a){g(a);d(1,1,0,0);return v})})}else{n=[];for(var x=0,D=a.length;x<D;x++)n[x]=f(a[x])}g(n);d(1,1,0,0);return v},_onNotification:function(a,b,c,d){},renderHeader:function(){},_autoId:0,insertRow:function(a,b,c,d,e){var f=e.parentId,f=this.id+"-row-"+(f?f+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),g=document.getElementById(f),h=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g));
g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1==d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,c||null);h&&this.adjustRowIndices(h);g.rowIndex=d;return g},renderRow:function(a,b){return h("div",""+a)},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||h(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=
a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!=this.domNode)}else return"object"==typeof a?b=this.store.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){f=e;b+=0>b?
1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||e===this.headerNode)break;while(b);return f},up:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:c("touch")?function(a){return this.useTouchScroll?this.inherited(arguments):f.call(this,a)}:f,getScrollPosition:c("touch")?function(){return this.useTouchScroll?
this.inherited(arguments):g.call(this)}:g,get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:a,_setClass:k,_getClassName:a,_setClassName:k,_setSort:function(a,b){this._sort=
"string"!=typeof a?a:[{attribute:a,descending:b}];this.refresh();this._lastCollection&&(a.length&&("string"!=typeof a&&(b=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(c,d){c=c[a];d=d[a];void 0===c&&(c="");void 0===d&&(d="");return c==d?0:c>d==!b?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,b){r.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",a,b)},_getSort:function(){return this._sort},_setShowHeader:function(a){var b=
this.headerNode;this.showHeader=a;h(b,(a?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();a&&(b.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){r.deprecated("setShowHeader(...)",'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;h(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has","put-selector/put"],function(r,d){r.add("dom-contains",
function(c,d,k){return!!k.contains});var m=[],l,c,t,q=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,p={defaultDelay:15,throttle:function(c,d,k){var a=!1;k=k||p.defaultDelay;return function(){a||(a=!0,c.apply(d,arguments),setTimeout(function(){a=!1},k))}},throttleDelayed:function(c,d,k){var a=!1;k=k||p.defaultDelay;return function(){if(!a){a=!0;var g=arguments;setTimeout(function(){a=!1;c.apply(d,g)},k)}}},debounce:function(c,d,k){var a;k=k||p.defaultDelay;return function(){a&&(clearTimeout(a),a=null);var g=arguments;
a=setTimeout(function(){c.apply(d,g)},k)}},each:function(c,d,k){var a,g;if(c)if("number"===typeof c.length)for(a=0,g=c.length;a<g;a++)d.call(k,c[a],a,c);else for(a in c)d.call(k,c[a],a,c)},contains:function(c,d){return r("dom-contains")?c.contains(d):c.compareDocumentPosition(d)&8},addCssRule:function(h,n){l||(l=d(document.getElementsByTagName("head")[0],"style"),l=l.sheet||l.styleSheet,c=l.deleteRule?"deleteRule":"removeRule",t=l.cssRules?"cssRules":"rules");var k=m.length;m[k]=(l.cssRules||l.rules).length;
l.addRule?l.addRule(h,n):l.insertRule(h+"{"+n+"}",m[k]);return{get:function(a){return l[t][m[k]].style[a]},set:function(a,c){"undefined"!==typeof m[k]&&(l[t][m[k]].style[a]=c)},remove:function(){var a=m[k],d,f;if(void 0!==a)for(l[c](a),m[k]=void 0,d=k+1,f=m.length;d<f;d++)m[d]>a&&m[d]--}}},escapeCssIdentifier:function(c,d){return"string"===typeof c?c.replace(q,d||"\\$1"):c}};return p})},"xstyle/has-class":function(){define(["dojo/has"],function(r){var d={};return function(){for(var m,l=arguments,
c=0;c<l.length;c++)if(m=l[c],!d[m]){d[m]=!0;var t=m.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),q=r(t[2]),p=-t[4];(0<p?p<=q&&(-t[5]||p)>=q:!!q)==!t[1]&&(document.documentElement.className+=" has-"+m)}}})},"xstyle/css":function(){define(["require"],function(r){function d(d,l,c){var m=document.documentElement;d=m.insertBefore(document.createElement(d),m.firstChild);d.id=l;l=(d.currentStyle||getComputedStyle(d,null)||{})[c];m.removeChild(d);return l}return{load:function(m,l,c,t){function q(h){var a=
d("x-parse",null,"content"),g=h&&(h.sheet||h.styleSheet);a&&"none"!=a&&"normal"!=a?l([eval(a)],function(a){h?a.process(h,c):(a.processAll(),c(g))}):c(g)}var p=l.toUrl(m),h;p.match(/!$/)&&(h={wait:!1},p=p.slice(0,-1));var n=l.cache&&l.cache["url:"+p];if(n)n.xCss&&(n=n.cssText),r(["./core/load-css"],function(c){q(c.insertCss(n))});else{if("none"==d("div",m.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return q();r(["./core/load-css"],function(c){c(p,q,h)})}}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),
function(r,d,m,l,c,t,q,p,h){return m("dgrid.OnDemandList",[r,d],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:p.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);var c=this;q(this.bodyNode,"scroll",p[this.pagingMethod](function(d){c._processScroll(d)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},
renderQuery:function(d,k){function a(a){h(q,"!");if(a)throw g._refreshDeferred&&(g._refreshDeferred.reject(a),delete g._refreshDeferred),a;}var g=this,f=k&&k.container||this.contentNode,b={query:d,count:0,options:k},e,m=this.preload,n,p={node:h(f,"div.dgrid-preload",{rowIndex:0}),count:0,query:d,next:b,options:k};p.node.style.height="0";b.node=e=h(f,"div.dgrid-preload");b.previous=p;e.rowIndex=this.minRowsPerPage;m?((b.next=m.next)&&e.offsetTop>=m.node.offsetTop?b.previous=m:(b.next=m,b.previous=
m.previous),b.previous.next=b,b.next.previous=b):this.preload=b;var q=h(e,"-div.dgrid-loading");h(q,"div.dgrid-below").innerHTML=this.loadingMessage;k=l.mixin(this.get("queryOptions"),k,{start:0,count:this.minRowsPerPage},"level"in d?{queryLevel:d.level}:null);this._trackError(function(){return n=d(k)});if("undefined"===typeof n)a();else return c.when(g.renderArray(n,e,k),function(d){return c.when("undefined"===typeof n.total?n.length:n.total,function(a){var c=d.length,f=e.parentNode,l=g.noDataNode;
h(q,"!");"queryLevel"in k||(g._total=a);0===a&&f&&(l&&(h(l,"!"),delete g.noDataNode),g.noDataNode=l=h("div.dgrid-no-data"),f.insertBefore(l,g._getFirstRowSibling(f)),l.innerHTML=g.noDataMessage);for(l=f=0;l<c;l++)f+=g._calcRowHeight(d[l]);c&&f&&(g.rowHeight=f/c);f=g.rowHeight*g.bufferRows;f>g.farOffRemoval&&(g.farOffRemoval=f);a-=c;b.count=a;e.rowIndex=c;a?e.style.height=Math.min(a*g.rowHeight,g.maxEmptySpace)+"px":(e.style.display="none",k.count++);g._previousScrollPosition&&(g.scrollTo(g._previousScrollPosition),
delete g._previousScrollPosition);g._processScroll();g._refreshDeferred&&(g._refreshDeferred.resolve(n),delete g._refreshDeferred);return d},a)},a),n},refresh:function(d){var h=this,a=d&&d.keepScrollPosition,g;"undefined"===typeof a&&(a=this.keepScrollPosition);a&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store)return a=this._refreshDeferred=new c,g=h.renderQuery(function(a){return h.store.query(h.query,a)}),"undefined"===typeof g&&a.reject(),a.then(function(a){h._refreshTimeout=
setTimeout(function(){q.emit(h.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:h,results:a});h._refreshTimeout=null},0);delete h._refreshDeferred;return a},function(a){delete h._refreshDeferred;throw a;})},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(c){return c.lastChild},_calcRowHeight:function(c){var d=c.nextSibling;return d&&!/\bdgrid-preload\b/.test(d.className)?d.offsetTop-c.offsetTop:c.offsetHeight},lastScrollTop:0,_processScroll:function(d){function k(b,
c,d,e){var g=f.farOffRemoval,k=b.node;if(c>2*g){for(var l,m=k[d],n=0,p=0,q=[];l=m;){var r=f._calcRowHeight(l);if(n+r+g>c||0>m.className.indexOf("dgrid-row")&&0>m.className.indexOf("dgrid-loading"))break;m=l[d];n+=r;p+=l.count||1;f.removeRow(l,!0);q.push(l)}b.count+=p;e?(k.rowIndex-=p,a(b)):k.style.height=k.offsetHeight+n+"px";var u=h("div",q);setTimeout(function(){h(u,"!")},1)}}function a(a,b){a.node.style.height=Math.min(a.count*f.rowHeight,b?Infinity:f.maxEmptySpace)+"px"}function g(a,b){do a=b?
a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var f=this,b=f.bodyNode;d=d&&d.scrollTop||this.getScrollPosition().y;var b=b.offsetHeight+d,e,m,n=f.preload,p=f.lastScrollTop,q=f.bufferRows*f.rowHeight,r=q-f.rowHeight,t,E,y,C=!0;for(f.lastScrollTop=d;n&&!n.node.offsetWidth;)n=n.previous;for(;n&&n!=e;){e=f.preload;f.preload=n;m=n.node;var F=m.offsetTop;if(b+1+r<F)n=g(n,C=!1);else if(d-1-r>F+m.offsetHeight)n=g(n,C=!0);else{var B=((m.rowIndex?d-q:b)-F)/f.rowHeight,F=(b-d+2*q)/f.rowHeight,F=F+
Math.min(Math.abs(Math.max(Math.min((d-p)*f.rowHeight,f.maxRowsPerPage/2),f.maxRowsPerPage/-2)),10);0==m.rowIndex&&(B-=F);B=Math.max(B,0);10>B&&0<B&&F+B<f.maxRowsPerPage&&(F+=Math.max(0,B),B=0);F=Math.min(Math.max(F,f.minRowsPerPage),f.maxRowsPerPage,n.count);if(0==F)n=g(n,C);else{var F=Math.ceil(F),B=Math.min(Math.floor(B),n.count-F),G=l.mixin(f.get("queryOptions"),n.options);n.count-=F;var H=m,L,J=f.queryRowsOverlap,K=(0<m.rowIndex||m.offsetTop>d)&&n;if(K){var I=n.previous;I&&(k(I,d-(I.node.offsetTop+
I.node.offsetHeight),"nextSibling"),0<B&&I.node==m.previousSibling?(B=Math.min(n.count,B),n.previous.count+=B,a(n.previous,!0),m.rowIndex+=B,J=0):F+=B,n.count-=B);G.start=m.rowIndex-J;G.count=Math.min(F+J,f.maxRowsPerPage);m.rowIndex=G.start+G.count}else n.next&&(k(n.next,n.next.node.offsetTop-b,"previousSibling",!0),H=m.nextSibling,H==n.next.node?(n.next.count+=n.count-B,n.next.node.rowIndex=B+F,a(n.next),n.count=B,J=0):L=!0),G.start=n.count,G.count=Math.min(F+J,f.maxRowsPerPage);L&&H&&H.offsetWidth&&
(L=H.offsetTop);a(n);"level"in n.query&&(G.queryLevel=n.query.level);if("queryLevel"in G||!(G.start>f._total||0>G.count)){m=h(H,"-div.dgrid-loading[style\x3dheight:"+F*f.rowHeight+"px]");h(m,"div.dgrid-"+(K?"below":"above")).innerHTML=f.loadingMessage;m.count=F;var O=n.query(G);if(void 0===f._trackError(function(){return O})){h(m,"!");return}(function(b,d,e,g){y=c.when(f.renderArray(g,b,G),function(k){E=g;H=b.nextSibling;h(b,"!");if(e&&H&&H.offsetWidth){var l=f.getScrollPosition();f.scrollTo({x:l.x,
y:l.y+H.offsetTop-e,preserveMomentum:!0})}c.when(g.total||g.length,function(b){"queryLevel"in G||(f._total=b);d&&(d.count=b-d.node.rowIndex,0===d.count&&G.count++,a(d))});f._processScroll();return k},function(a){h(b,"!");throw a;})}).call(this,m,K,L,O);n=n.previous}}}}y&&(t=this._refreshDeferred)&&(delete this._refreshDeferred,c.when(y,function(){t.resolve(E)}))},removeRow:function(c,d){if(c){var a=c.previousSibling,g=c.nextSibling,f;if(f=a)f=a.observerIndex,f=null!=f?f:a.previousObserverIndex;a=
f;if(f=g)f=g.observerIndex,f=null!=f?f:g.nextObserverIndex;g=c.observerIndex;c.observerIndex=void 0;d&&(c.nextObserverIndex=f,c.previousObserverIndex=a);if(this.cleanEmptyObservers&&-1<g&&g!==a&&g!==f&&(a=this.observers,f=a[g])){if(!d)for(var b=f.rows,e=0;e<b.length;e++)if(b[e]!=c&&t.isDescendant(b[e],this.domNode))return this.inherited(arguments);f.cancel();this._numObservers--;a[g]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),
function(r,d,m,l,c,t,q){function p(c){return c}function h(d){if("object"!==typeof d)d=Error(d);else if("cancel"===d.dojoType)return;d.grid=this;c.emit(this.domNode,"dgrid-error",{grid:this,error:d,cancelable:!0,bubbles:!0})&&console.error(d)}return d("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};t.before(this,"configStructure",
m.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(c){c.set&&(this._columnsWithSet[c.field]=c);this.inherited(arguments)},_updateNotifyHandle:function(c){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);c&&"function"===typeof c.notify&&this.shouldObserveStore&&
(this._notifyHandle=t.after(c,"notify",m.hitch(this,"_onNotify"),!0),(c=this.get("sort"))&&c.length||console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},_setStore:function(c,d,a){this._updateNotifyHandle(c);this.store=c;this.dirty={};this.set("query",d,a)},_setQuery:function(c,d){var a=d&&d.sort;this.query=void 0!==c?c:this.query;this.queryOptions=d||this.queryOptions;
this._started&&(a?this.set("sort",a):this.refresh())},setStore:function(c,d,a){r.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",c,d,a)},setQuery:function(c,d){r.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",c,d)},_getQueryOptions:function(){var c=m.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)c.sort=this._sort;return c},_getQuery:function(){var c=this.query;return"object"==typeof c&&
null!=c?m.delegate(c,{}):c},_setSort:function(c,d){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(c,d){this.inherited(arguments);c&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var c=this.inherited(arguments);this.store||(this.noDataNode=q(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return c},renderArray:function(){var c=this,d=this.inherited(arguments);this.store||l.when(d,function(a){a.length&&
c.noDataNode&&q(c.noDataNode,"!")});return d},insertRow:function(c,d,a,g,f){var b=this.store,e=this.dirty,b=b&&b.getIdentity(c),h;b in e&&!(b in this._updating)&&(h=e[b]);h&&(c=m.delegate(c,h));return this.inherited(arguments)},updateDirty:function(c,d,a){var g=this.dirty,f=g[c];f||(f=g[c]={});f[d]=a},setDirty:function(c,d,a){r.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(c,d,a)},save:function(){function c(b,c){return function(e){var f=d._columnsWithSet,h=d._updating,
k,m;if("function"===typeof e.set)e.set(c);else for(k in c)e[k]=c[k];for(k in f)m=f[k].set(e),void 0!==m&&(e[k]=m);h[b]=!0;return l.when(a.put(e),function(){delete g[b];delete h[b]})}}var d=this,a=this.store,g=this.dirty,f=new l,b=f.promise,e=function(b){var c;return d.getBeforePut||!(c=d.row(b).data)?function(){return a.get(b)}:function(){return c}},h;for(h in g)var m=c(h,g[h]),b=b.then(e(h)).then(m);f.resolve();return b},revert:function(){this.dirty={};this.refresh()},_trackError:function(c){var d;
"string"==typeof c&&(c=m.hitch(this,c));try{d=c()}catch(a){h.call(this,a)}return l.when(d,p,m.hitch(this,h))},newRow:function(){var c=this.inherited(arguments);this.noDataNode&&(q(this.noDataNode,"!"),delete this.noDataNode);return c},removeRow:function(c,d){var a={element:c};!d&&this.noDataMessage&&this.up(a).element===c&&this.down(a).element===c&&(this.noDataNode=q(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),
function(r,d,m,l,c,t,q,p,h){function n(a,b){b=a.unselectable=b?"on":"";a=a.getElementsByTagName("*");for(var c=a.length;--c;)"INPUT"!==a[c].tagName&&"TEXTAREA"!==a[c].tagName&&(a[c].unselectable=b)}function k(a,b){var d=a.bodyNode,e=b?"text":21>c("ff")?"-moz-none":"none";g&&"msUserSelect"!==g?d.style[g]=e:c("dom-selectstart")?b||a._selectstartHandle?b&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=l(d,"selectstart",function(a){var b=a.target&&
a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):(n(d,!b),b||a._unselectableHandle)?b&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=t.after(a,"renderRow",function(a){n(a,!0);return a})}c.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});c.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});c.add("css-user-select",function(a,b,c){a=c.style;
b=["Khtml","O","ms","Moz","Webkit"];c=b.length;var d="userSelect";do if("undefined"!==typeof a[d])return d;while(c--&&(d=b[c]+"UserSelect"));return!1});c.add("dom-selectstart","undefined"!==typeof document.onselectstart);var a=c("mac")?"metaKey":"ctrlKey",g=c("css-user-select"),f=(q=c("pointer"))&&"MS"===q.slice(0,2),b=q?q+(f?"Down":"down"):"mousedown",e=q?q+(f?"Up":"up"):"mouseup";"WebkitUserSelect"===g&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(g=!1);return d("dgrid.Selection",
null,{selectionDelegate:".dgrid-row",selectionEvents:b+","+e+",dgrid-cellfocusin",selectionTouchEvents:c("touch")?p.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);
this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){r.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");
this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?k(this,a):k(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,c){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(c))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==a.parentType)&&(a.type!==e||c==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&a.type===b&&this.isSelected(c))this._waitForMouseUp=
c;else this[this._selectionHandlerName](a,c);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(b,c){b=b.keyCode?b.ctrlKey:b[a];this._lastSelected===c?this.select(c,null,!b||!this.isSelected(c)):(this.clearSelection(),this.select(c),this._lastSelected=c)},_multipleSelectionHandler:function(b,c){var d=this._lastSelected,e=b.keyCode?b.ctrlKey:b[a],f;b.shiftKey||(f=e?null:!0,d=null);this.select(c,d,f);d||(this._lastSelected=c)},_extendedSelectionHandler:function(b,c){(2===b.button?this.isSelected(c):
b.keyCode?b.ctrlKey:b[a])||this.clearSelection(null,!0);this._multipleSelectionHandler(b,c)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var b=this,d=this.contentNode,f=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};c("touch")&&!c("pointer")&&this.selectionTouchEvents?(l(d,p.selector(f,this.selectionTouchEvents),function(a){b._handleSelect(a,this);b._ignoreMouseSelect=this}),l(d,l.selector(f,this.selectionEvents),function(a){b._ignoreMouseSelect!==
this?b._handleSelect(a,this):a.type===e&&(b._ignoreMouseSelect=null)})):l(d,l.selector(f,this.selectionEvents),function(a){b._handleSelect(a,this)});this.addKeyHandler&&this.addKeyHandler(32,function(a){b._handleSelect(a,a.target)});if(this.allowSelectAll)this.on("keydown",function(c){c[a]&&65==c.keyCode&&!/\bdgrid-input\b/.test(c.target.className)&&(c.preventDefault(),b[b.allSelected?"clearSelection":"selectAll"]())});this._setStore&&t.after(this,"_setStore",function(){b._updateDeselectionAspect()});
this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(a,c,d){a=c||a&&a[b.idProperty||"id"];if(null!=a&&(c=(a=b.row(a))&&b.selection[a.id]))b[d](a,null,c)}var b=this,c=this.store,d,e;this._removeDeselectSignals&&this._removeDeselectSignals();c&&c.notify?(d=t.before(c,"notify",function(b,c){b||a(b,c,"deselect")}),e=t.after(c,"notify",function(b,c){a(b,c,"select")},!0),this._removeDeselectSignals=function(){d.remove();e.remove()}):(d=t.before(this,"removeRow",function(a,b){b||
(a=this.row(a))&&a.id in this.selection&&this.deselect(a)}),this._removeDeselectSignals=function(){d.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};c&&(d.parentType=c.type);d[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];l.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},
_select:function(a,b,c){var d,e,f;"undefined"===typeof c&&(c=!0);a.element||(a=this.row(a));if(!1===c||this.allowSelect(a))if(d=this.selection,e=!!d[a.id],null===c&&(c=!e),f=a.element,c||this.allSelected?d[a.id]=c:delete this.selection[a.id],f&&(c?h(f,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):h(f,"!dgrid-selected!ui-state-active")),c!==e&&f&&this._selectionEventQueues[(c?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element)for(d=this._determineSelectionDirection(f,
b),d||(b=document.getElementById(b.id),d=this._determineSelectionDirection(f,b));a.element!=b&&(a=this[d](a));)this._select(a,null,c)}else this._lastSelected=f,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:c("dom-comparedocumentposition")?function(a,
b){a=b.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=
this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);m.when(b,function(b){var c=a.selection,
d,e,f;for(d=0;d<b.length;d++)e=a.row(b[d]),(f=e.id in c?c[e.id]:a.allSelected)&&a._select(e,null,f);a._fireSelectionEvents()});return b}})})},"xstyle/main":function(){define("xstyle/main",["require","xstyle/core/parser","xstyle/core/base","xstyle/core/elemental","xstyle/core/generate"],function(r,d,m,l,c){function t(c){c=document.getElementsByTagName(c);for(var d=0;d<c.length;d++)p(c[d])}function q(){t("link");t("style")}function p(c,d,a){function g(){r(["xstyle/core/load-imports"],function(a){a(c,
function(){p(c,d,!0)})})}function f(a){for(var b=a.cssRules,c=0;c<b.length;c++){var f=b[c];if(f.selectorText&&"x-"==f.selectorText.substring(0,2)&&(e=!0,/^'/.test(f.style.content)))return h(eval(f.style.content),a,d),!0}}var b=c.sheet||c.styleSheet;if(b&&(!b.processed||a)){b.processed=!0;var e=b.needsParsing,k=b.rules||b.cssRules;if((b.href||b.imports&&b.imports.length)&&!a)return g();if(!e)for(var l=0;l<k.length;l++){var m=k[l];if(m.href&&!a){if(!f(m.styleSheet))return g();return}}h(b.localSource||
(b.ownerNode||b.owningElement).innerHTML,b,d)}}function h(c,h,a){h.addRule||(h.addRule=function(a,b,c){return this.insertRule(a+"{"+b+"}",0<=c?c:this.cssRules.length)});h.deleteRule||(h.deleteRule=h.removeRule);var g=1;(h.href||location.href).replace(/[^\/]+$/,"");m.css=c;d(m,c,h);0==--g&&a&&a(h);return m}l.ready(q);d.getStyleSheet=function(c,d){return c.styleSheet||c};return{process:p,processAll:q,parse:h,generate:c,update:l.update,load:function(c,d,a,g){d(["xstyle/css"],function(f){f.load(c,d,function(b){b?
p({sheet:b},a):(q(),a())},g)})}}})},"xstyle/core/parser":function(){define("xstyle/core/parser",[],function(){function r(){this.push.apply(this,arguments)}function d(a){this.value=a}function m(){var a,c=this.args[0];if("string"==typeof c)a=c.split(/\s*,\s*/);else if(c){a=[];for(var d=0,b=0;b<c.length+1;b++){var e=c[b];if("string"==typeof e||void 0===e)if(e=e&&e.split(/\s*,\s*/),1<a.length||void 0===e){var h=c.slice(d,b);0<d&&h.unshift(a.pop());d=b+1;a.push(h);e&&a.push.apply(a,e.slice(1))}}}else return[];
return a}function l(a,g,f){function b(f,g){function u(a){D=!1;var b=k.lastIndex;a.then(function(){D=!0;c&&(k.lastIndex=b,x())});var c=!0}function x(){function a(a){a&&"string"==typeof a&&z&&(a=z+a);M?M.push?"string"==typeof M[M.length-1]&&"string"==typeof a?M[M.length-1]+=a:a&&M.push(a):"string"==typeof M&&"string"==typeof a?M+=a:M=new r(M,a):M=a}for(D=!0;D;){var q=k.exec(f);if(!q)break;var x=q[5],z=q[1],A=q[2],C=q[3],R=q[4],N,Q,M,V,R=R&&n(R),A=A&&n(A);H?(C?(Q=A,N=C.charAt(0),V="?"==C.charAt(1),-1<
C.indexOf("\n")&&(R=C.slice(1))):R=A,M=R,H=!1):(R=C?A+C:A,a(R));"{"!=x&&(G+=q[0]);switch(x){case "'":case '"':var X="'"==x?c:t;X.lastIndex=k.lastIndex;(x=X.exec(f))||E("unterminated string");A=x[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(a,b){if(b)return String.fromCharCode(parseInt(b,16))});k.lastIndex=X.lastIndex;a(new d(A));G+=x[0];continue;case "\\":x=X.lastIndex++;a(f.charAt(x));continue;case "(":case "{":case "[":if("{"==x){H=!0;":"==N&&C&&(A+=C);G=n((G+A).replace(/\s+/g," "));a(C=
y.newRule(G));"\x3d"==N&&(B=!1,M.creating=!0);var T=null,Z=F;q[6]&&(R=g.cssRules||g.rules,C.cssRule=T=R[q[6].slice(1)])&&(G=T.selectorText);if(y.root&&B)for(R=g.cssRules||g.rules;T=R[F++];)if(T.selectorText==G||T.selectorText&&T.selectorText.replace(/::/g,":").replace(/'/g,'"')==G.replace(/::/g,":").replace(/'/g,'"')){C.cssRule=T;break}T||(C.ruleIndex=F=Z);C.styleSheet=g;M.creating?(C.selector="."+("\x3d"==N?A.match(/[\w-]*$/g,"")[0]:"")+"-x-"+h++,C.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(G)?
C.setMediaSelector(G):C.selector=y.root?G:y.selector+" "+G;G=""}else A=R.match(/(.*?)([\w-]*)$/),a(C=y.newCall(A[2],M,y)),C.ref=y.getDefinition(A[2]),C.getArgs=m,(M.calls||(M.calls=[])).push(C);y.currentName=Q;y.currentSequence=M;y.assignmentOperator=N;var W;"{"==x&&(W=C.selector.match(/[@:]\w+/))&&(W=W[0],(Q=y.getDefinition(W))&&Q.selector&&Q.selector(C));v.push(y=C);y.operator=x;y.start=k.lastIndex;M=Q=null;continue}if(M)if(A="string"==typeof M?M:M[0],A.charAt&&"@"==A.charAt(0))if(q=A.match(/\w+/)[0],
"import"==q)A=l.getStyleSheet((g.cssRules||g.imports)[F++],M,g),q=k.lastIndex,b(A.localSource,A),k.lastIndex=q;else{if("xstyle"==q){if("start"==A.slice(8,13))C=y?y.newRule(""):Y,C.root=y.root,v.push(y=C);else{var Y=y||Y;v.pop();y=v[v.length-1]}k=y?e:/(@[\w\s])/g}}else if("\x3d"===N)try{var w=y.declareDefinition(Q,M,V);w&&w.then&&u(w)}catch(S){E(S)}switch(x){case ":":"\x3d"==N?(H=!0,N=":"):a(":");break;case "}":if(Q&&!y.root&&!y.isMediaBlock)try{y[":"==N?"setValue":"declareDefinition"](Q,M,V)}catch(S){E(S)}case ")":case "]":p[y.operator]!=
x&&E("Incorrect opening operator "+y.operator+" with closing operator "+x);Q=null;Q=f.slice(y.start,k.lastIndex-1);y.cssText=y.cssText?y.cssText+";"+Q:Q;if("}"==x){"}"==U&&(U=y.parent.selector)&&"@"==!U.charAt(0)&&E("A nested rule must end with a semicolon");if(y.root)E("Unmatched "+x);else{try{y.onRule(y.selector,y)}catch(S){E(S)}B=!0}G=""}if(")"==x||"]"==x)y.args=[M];if(")"==x&&!N){try{w=v[v.length-2].onArguments(y)}catch(S){E(S)}w&&w.then&&u(w)}v.pop();y=v[v.length-1];M=y.currentSequence;Q=y.currentName;
N=y.assignmentOperator;if(y.root&&"}"==x){if(N)try{y[":"==N?"setValue":"declareDefinition"](Q,M,V)}catch(S){E(S)}H=!0;N=!1}break;case "":case void 0:return;case ";":if(y&&Q){try{(w=y[":"==N?"setValue":"declareDefinition"](Q,M,V))&&w.then&&u(w)}catch(S){E(S)}Q}M=null;H=!0;N=B=!1;G=""}var U=x}}function E(a){var c=f.slice(0,k.lastIndex).split("\n"),d=c[c.length-1],c=(g.href||"in-page stylesheet")+":"+c.length+":"+d.length+" near:\n"+d.slice(-40);if(b.onerror)b.onerror(a,c);console.error(a.message||a,
c);a.stack&&console.error(a.stack)}f=f.replace(q,function(a){return a.replace(/[^\n]/g,"")});var y=a;k.lastIndex=0;var D,F=0,B=!0,G="",H=!0;x()}f=f||{addRule:function(){},cssRules:[]};var e,k=e=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,v=[a];a.parse=b;b(g,f)}var c=/((?:\\.|[^'])*)'/g,t=/((?:\\.|[^"])*)"/g,q=/\/\*[\w\W]*?\*\//g,p={"{":"}","[":"]","(":")"},h=0,n="".trim?function(a){return a.trim()}:
function(a){return a.replace(/^\s+|\s+$/g,"")},k=r.prototype=[];k.toString=function(){return this.join("")};k.isSequence=!0;d.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};d.prototype.isLiteralString=!0;return l})},"xstyle/core/base":function(){define("xstyle/core/base","xstyle/core/elemental xstyle/core/expression xstyle/core/Definition xstyle/core/utils put-selector/put xstyle/core/Rule xstyle/core/es6".split(" "),function(r,d,m,l,c,t,q){function p(b,c,
d){function e(c){return{selectElement:function(a){d.newElement&&(a=a.parentNode);if(c&&c.selector)for(;!u(a,c);)if(a=a.parentNode,!a)throw Error("Rule not found");if(d.inherit)for(;!(b in a);)if(a=a.parentNode,!a)throw Error(b?b+" not found":"Property was never defined");return a},forElement:function(e){var f=e;e=this.selectElement(e);d.newElement&&(e["_"+b+"Node"]=f);e=d.get?d.get(e,b):e[b];return void 0===e&&c?a(b).valueOf().forRule(c):e},forRule:d.inherit&&function(a){return e(a)}}}var f=new m(function(){return e(c)});
f.define=function(a,c){return p(b||c,a,d)};f.keepCSSValue=!0;f.put=d.inherit?function(c,d){return a(b).put(c,d,b)}:function(a){return{forElement:function(e){if(c&&c.selector)for(;!u(e,c);)if(e=e.parentNode,!e)throw Error("Rule not found");d.set?d.set(e,b,a):e[b]=a;f.invalidate({elements:[e]})}}};return f}function h(a,b,c,e){return l.when(d.evaluate(a,c),function(b){b.forElement?r.addRenderer(a,function(a){e(b.forElement(a),a)}):e(b)})}function n(a,b){return{apply:function(c,d,e){h(c,e,d[0],function(d,
f){d.observe(function(d){d=d?a:b;value.toString().replace(new RegExp(a+"\\([^)]+\\)","g"),d);f?f.style[e]=d:c.setStyle(e,d)})})}}}function k(a,b){var c=a.variables;if(c&&b in c)return c[b];if(a=a.bases)for(c=0;c<a.length;c++){var d=k(a[c],b);if(void 0!==d)return d}}function a(a){var b=v[a];b||(b=v[a]=new m(function(){return{forRule:function(b){a:{do{var c=k(b,a);if(void 0!==c){b=c;break a}b=b.parent}while(b);b=void 0}return b}}}),b.put=function(a,c,d){return{forRule:function(c){function e(a){f.push(a);
for(var b in a.rules)e(a.rules[b])}(c.variables||(c.variables={}))[d]=a;for(var f=[];c;)e(c),c=c.parent;b.invalidate({rules:f})}}});return b}var g=c("div"),f=navigator.userAgent,b=-1<f.indexOf("WebKit")?"-webkit-":-1<f.indexOf("Firefox")?"-moz-":-1<f.indexOf("MSIE")?"-ms-":-1<f.indexOf("Opera")?"-o-":"",e;t=new t;var u=r.matchesRule;t.root=!0;var v={};t.definitions={Math:Math,window:window,global:window,module:d.selfResolving(function(a,b){a[0].value&&(a=a[0].value);b||require([a]);return{then:function(b){return(new q.Promise(function(b){require([a],
function(a){b(a)})})).then(b)}}}),item:p("item",null,{inherit:!0}),pageContent:new m,content:p("content",null,{inherit:!0,newElement:function(){return this.element}}),elementProperty:p(null,null,{}),elementClass:p(null,null,{get:function(a,b){return-1<(" "+a.className+" ").indexOf(" "+b+" ")},set:function(a,b,c){this.get(a,b)!=c&&(a.className=c?a.className+(" "+b):(" "+a.className+" ").replace(" "+b+" ","").replace(/^ +| +$/g,""))}}),element:{forElement:function(a){return a},define:function(a){return{forElement:function(b){for(;!u(b,
a);)if(b=b.parentNode,!b)throw Error("Rule not found");return b}}}},event:{observe:function(a){a(e)},valueOf:function(){return e}},each:{put:function(a){return{forRule:function(b){b.each=a}}}},prefix:{put:function(a,c,d){return{forRule:function(c){if("string"==typeof g.style[b+d])return c._setStyleFromValue(b+d,a),!0}}}},"var":{define:function(b,c){return a(c)},selfResolving:!0,apply:function(b,c){return a(l.convertCssNameToJs(c[0]))}},inline:n("inline","none"),block:n("block","none"),visible:n("visible",
"hidden"),"extends":{apply:function(a,b){for(;0<b.length;)return l.extend(a,b[0],console.error)}},set:{selfExecuting:!0,apply:function(a,b){return b[0].put(b[1].valueOf())}},get:{apply:function(a,b){return b[0]},put:function(a,b){d.evaluate(b,a)}},toggle:{selfExecuting:!0,apply:function(a,b){return b[0].put(!b[0].valueOf())}},on:{put:function(a,b,c){return{forRule:function(b){r.on(document,c.charAt(2).toLowerCase()+c.slice(3),b,function(f){e=f;try{l.when(d.evaluate(b,a).valueOf(),function(a){a&&a.forRule&&
(a=a.forRule(b));a&&a.forElement&&(a=a.forElement(f.target));e=null},function(b){console.error("Error in "+c+" event handler, executing "+a,b)})}catch(y){console.error("Error in "+c+" event handler, executing "+a,y)}})}}}},title:{put:function(a){return{forRule:function(b){d.observe(d.evaluate(b,a),function(a){document.title=a})}}}},"@supports":{selector:function(a){function b(a){var d;if(d=a.match(/^\s*not(.*)/))return!b(d[1]);if(d=a.match(/\((.*)\)/))return b(d[1]);if(d=a.match(/([^:]*):(.*)/))return a=
l.convertCssNameToJs(d[1]),d=g.style[a]=d[2],g.style[a]==d;if(d=a.match(/\w+\[(.*)=(.*)\]/))return c(d[0])[d[1]]==d[2];if(d=a.match(/\w+/))return l.isTagSupported(d);throw Error("can't parse @supports string");}b(a.selector.slice(10))?a.selector="":a.disabled=!0}},"true":!0,"false":!1,"null":null};t.elementProperty=p;return t})},"xstyle/core/elemental":function(){define("xstyle/core/elemental",["put-selector/put","xstyle/core/utils"],function(r,d){function m(b,c,d,e){function f(a){if(!d)return e(a);
var b=a.target;do if(A(b,d))return e(a);while((b=b.parentNode)&&1===b.nodeType)}a?b.addEventListener(c,f,!!g[c]):l(b,g[c]||c,f)}function l(a,b,c){b="on"+b;var d=a[b];a[b]=function(a){a=a||window.event;a.target=a.target||a.srcElement;d&&d(a);c(a)}}function c(a){/e/.test(n.readyState||"")?a():n.addEventListener("DOMContentLoaded",a)}function t(a){for(var b=n.querySelectorAll(a.selector),c=a.name,d=0,e=b.length;d<e;d++){var f=b[d],g=f.elementalStyle;g||(g=f.elementalStyle={},f.elementalSpecificities=
{});var h=f.renderings;h||(h=f.renderings=[],x.push(f));h.push({name:c,rendered:g[c]==a.propertyValue,renderer:a});g[c]=a.propertyValue}}function q(){for(;x.length;){for(var a=x.shift(),b=a.renderings,c=a.elementalStyle;b.length;){var d=b.shift(),e=d.renderer,f=e.rendered;z=c[d.name]==e.propertyValue;if(!f&&z)try{e.render(a)}catch(H){console.error(H,H.stack),r(a,"div.error",H.toString())}f&&!z&&e.unrender&&e.unrender(a)}a.renderings=void 0}}function p(a,b){for(var c=0,d=u.length;c<d;c++){var e=u[c];
b&&b!=e.selector||!A(a,e.rule)||e.render(a)}}function h(a,b){var c={selector:a.selector,rule:a,render:b};u.push(c);D&&t(c);q();return{remove:function(){u.splice(u.indexOf(c),1)}}}var n=document,k=1,a=!!n.addEventListener,g={blur:"focusout",focus:"focusin"};m(n,"change",null,function(a){a=a.target;for(var b=0,c=v.length;b<c;b++){var d=v[b];if(-1<(" "+a.className+" ").indexOf(d.rule.selector.slice(1))){var e=d.definition.valueOf();e&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&(e=e.forElement(a));
var f="checkbox"===a.type?a.checked:a.value;"number"===typeof e&&isFinite(f)&&(f=+f);(e=d.definition.put(f))&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&e.forElement(a)}}});navigator.userAgent.match(/MSIE|Trident/)&&m(n,"keydown",null,function(a){if(13==a.keyCode){var b=a.target;if(document.createEvent)a=document.createEvent("Events"),a.initEvent("change",!0,!0),b.dispatchEvent(a);else document.onchange({target:b})}});var f=n.createElement("div"),b={"dom-qsa2.1":!!f.querySelectorAll},e=f.matches||
f.matchesSelector||f.webkitMatchesSelector||f.mozMatchesSelector||f.msMatchesSelector||f.oMatchesSelector,u=[],v=[],x=[],D;c(function(){if(!D)if(D=!0,b["dom-qsa2.1"]){for(var a=0,c=u.length;a<c;a++)t(u[a]);q()}else for(var d=n.all,a=0,c=d.length;a<c;a++)p(d[a])});var z,A=e?function(a,b){return e.call(a,b.selector)}:function(a,b){b.ieId||b.setStyle(b.ieId="x-ie-"+k++,"true");return!!a.currentStyle[b.ieId]};return{ready:c,on:m,matchesRule:A,addRenderer:h,addInputConnector:function(a,b){v.push({rule:a,
definition:b})},update:p,clearRenderers:function(){u=[]},observeForElement:function(a,b,c){return d.when(a,function(a){function d(a){a.observe?a.observe(c):c(a)}a.forElement?h(b,function(b){d(a.forElement(b))}):d(a)})}}})},"xstyle/core/utils":function(){define("xstyle/core/utils",[],function(){function r(c,d){for(var l=0,m=c.length;l<m;l++){var h=c[l];if(h&&"object"==typeof h&&d in h)return!0}}function d(c,d){return d.toUpperCase()}var m="div"==document.createElement("div").tagName,l={};return{when:function(c,
d,l){return c&&c.then?c.then(d,l)||c:d(c)},whenAll:function(c,d){return r(c,"then")?{then:function(l,m){function h(){n--;n||l(d(k))}for(var n=1,k=[],a=0;a<c.length;a++){var g=c[a];n++;g&&g.then?function(a){g.then(function(b){k[a]=b;h()},m)}(a):(k[a]=g,h())}h()},inputs:c}:d(c)},convertCssNameToJs:function(c){return c.replace(/-(\w)/g,d)},isTagSupported:function(c){if(c in l)return l[c];var d=document.createElement(c);m?(d=d.toString(),d=!("[object HTMLUnknownElement]"==d||"[object]"==d)):d=d.tagName==
c.toUpperCase();return l[c]=d},extend:function(c,d){var l=d.split(".");d=l[0];var m=c.getDefinition(d,"rules");l[0]="";c.selector+=c.extraSelector=l.join(".");if(m)return this.when(m,function(d){if(d.extend)d.extend(c,!0);else for(var h in d)c[h]=d[h]});c.tagName=d;if(!this.isTagSupported(d))throw Error("Extending undefined definition "+d);},someHasProperty:r}})},"xstyle/core/expression":function(){define("xstyle/core/expression",["xstyle/core/utils","xstyle/core/Definition"],function(r,d){function m(a,
b){var c=b[0];return c&&a?(c=h(c),m(a.property?a.property(c):a[c],b.slice(1))):a}function l(a,b,c){if(n(b,a)){var d={};d[a]=function(d){for(var e=[],f=0,g=b.length;f<g;f++){var h=b[f];h&&"function"==typeof h[a]&&(h=h[a](d));e[f]=h}return c(e)};return d}return c(b)}function c(a,b){return{apply:function(c,d,f){for(var e=0,g=d.length;e<g;e++){var h=d[e];h.dependencyOf&&h.dependencyOf(f)}e=function(){var b=[];if(a.selfExecuting)return a.apply(c,d,f);for(var e=0,g=d.length;e<g;e++)b[e]=d[e].valueOf();
if(a.selfWaiting)return a.apply(c,b,f);b.push(c);return r.whenAll(b,function(b){var c=b.pop();return l("forRule",b,function(b){return l("forElement",b,function(b){return a.apply(c,b,f)})})})};e.reverse=function(a){return b(a,d)};return e}}}function t(c){return a[c]||(a[c]=new Function("a","b","return "+c))}function q(a,b,d,h,l){function e(a){a.skipResolve=!0;a.precedence=b;a.infix=!1!==l}var f=function(a,b){var c=b[0];b=b[1];if(c&&c.put)a=h(a,b&&b.valueOf()),a!==k&&c.put(a);else if(b&&b.put)b.put(l(a,
c&&c.valueOf()));else throw new TypeError("Can not put");},m={apply:function(b,k,m){var n;d=t(d);h=h&&t(h);l=l&&t(l);g[a]=n=c(d,f);e(n);return n.apply(b,k,m)}};e(m);g[a]=m}function p(a,b){function e(a){for(;l<=a.precedence;){var b=n.pop(),c=g[n.pop()],e=new d;e.setCompute(c.apply(null,c.infix?[n.pop(),b]:[b],e));q=n.length?n[n.length-1]:void 0;n.push(e);l=q&&g[q]&&g[q].precedence}}var f,h;b=b.join?b.slice():[b];for(f=0;f<b.length;f++)if(h=b[f],"string"==typeof h){var k=h.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g);
h=[f,1];k&&h.push.apply(h,k);b.splice.apply(b,h);f+=h.length-3}var l,n=[],q,k={};for(f=0;f<b.length;f++){h=b[f];if("("==h.operator){var t=n[n.length-1];void 0===t||g.hasOwnProperty(t)?h=p(a,h.getArgs()[0]):(n.pop(),h=function(b,e){function f(d){return r.when(b.valueOf(),function(f){var l=b.parent&&b.parent.valueOf();if(!f.selfResolving){if(!g){g=[];for(var m=0,n=e.length;m<n;m++)g[m]=p(a,e[m]);h=f.selfReacting?f.apply(l,g,k):c(f).apply(l,g,k)}return h()}f=f.apply(l,e,k);return d?f:f.valueOf()})}var g,
h,k=new d(f);k.setReverseCompute(function(){var a=arguments;return r.when(f(!0),function(b){return b.put.apply(b,a)})});return k}(t,h.getArgs()))}else if(g.hasOwnProperty(h))t=g[h],e(t),l=(q||t).precedence;else if(-1<h)h=+h;else if(h.isLiteralString)h=h.value;else{h=h.split(/\s*\/\s*/);var t=h[0],y=a.getDefinition(t);if("string"==typeof y||y instanceof Array)y=p(a,y);else if(void 0===y)throw Error('Could not find reference "'+t+'"');k[t]=y;1<h.length&&(y=m(y,h.slice(1)));h=y}n.push(h)}e({precedence:100});
if(1<n.length)throw Error("Could not reduce expression");h=n[0];h.inputs=k;return h}var h=r.convertCssNameToJs,n=r.someHasProperty,k={},a={},g={};q("+",6,"a+b","a-b","a-b");q("-",6,"a-b","a+b","b-a");q("*",5,"a*b","a/b","a/b");q("/",5,"a/b","a*b","b/a");q("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");q(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");q("!",4,"!a","!a",!1);q("%",5,"a%b");q("\x3e",8,"a\x3eb");q("\x3e\x3d",8,"a\x3e\x3db");q("\x3c",8,"a\x3cb");q("\x3c\x3d",8,"a\x3c\x3db");
q("\x3d\x3d",9,"a\x3d\x3d\x3db");q("\x26",8,"a\x26\x26b");q("|",8,"a||b");return{react:c,evaluate:p,selfResolving:function(a){a.selfResolving=!0;return a}}})},"xstyle/core/Definition":function(){define(["xstyle/core/utils","xstyle/core/es6"],function(r,d){function m(c){(this.computeValue=c)&&c.reverse&&this.setReverseCompute(c.reverse)}function l(l,h,m){if(h&&h.forElement)return{forElement:function(k){k=h.selectElement?h.selectElement(k):k;var a=["_cache_"+l.id];if(a in k){var g=k[a+"observe"];g.addKey&&
g.addKey(m);return k[a][m]}var f=k[a]=h.forElement(k),b=k[a+"observe"]=c(l,f,m,{elements:[k]});k.xcleanup=function(a){a&&d.unobserve(f,b)};return f[m]}}}function c(c,h,l,k){var a=c._properties,g;"object"==typeof h&&(g=function(c){for(var b=0;b<c.length;b++){var d=a[c[b].name];d&&d.invalidate&&d.invalidate(k)}},d.observe(h,g),g.addKey&&g.addKey(l));return g}var t={},q=1;m.prototype={id:"x-variable-"+q++,cache:t,valueOf:function(){if((this.dependents||this._properties)&&this.cache!==t)return this.cache;
var c=this,d=this.computeValue;if(d.then)return this.cache=d.then(function(d){c.computeValue=d;(d=c.cache=d())&&d.then&&d.then(function(d){c.cache=d});return d});(d=c.cache=d())&&d.then&&d.then(function(d){c.cache=d});return d},property:function(d){var h=this._properties||(this._properties={}),n=h[d];if(!n){var k=this,n=h[d]=new m(function(){return r.when(k.valueOf(),function(a){if(a&&a.forRule)return{forRule:function(f){f=a.selectRule?a.selectRule(f):f;var b=["_cache_"+k.id],e;if((e=b in f?f[b]:
f[b]=a.forRule(f))&&e.forElement)return l(k,e,d);var g=f[b+"observe"];g&&(g.addKey?g.addKey(d):f[b+"observe"]=c(k,e,d,{rules:[f]}));return e[d]}};if(a&&a.forElement)return l(k,a,d);var g=k.cacheObserve;g?g.addKey&&g.addKey(d):g=k.cacheObserve=c(k,a,d);return a[d]})});n.key=d;n.parent=this;n.put=function(a){return r.when(k.valueOf(),function(c){function f(b){if(b.forElement)return{forElement:function(c){b.forElement(c)[d]=a}};b[d]=a}if(c.forRule)return{forRule:function(a){return f(c.forRule(a))}};
f(c)})};n.id=this.id+"-"+d}return n},invalidate:function(c){var h=this.cacheObserve;h&&(d.unobserve(this.cache,h),this.cacheObserve=null);this.cache=t;var l,h=this._properties;for(l in h)h[l].invalidate(c);var k=this.dependents||0;l=0;for(h=k.length;l<h;l++)try{k[l].invalidate(c)}catch(a){console.error(a,"invalidating a definition")}},dependencyOf:function(c){(this.dependents||(this.dependents=[])).push(c)},notDependencyOf:function(c){for(var d=this.dependents||0,l=0;l<d.length;l++)d[l]===c&&d.splice(l--,
1)},setReverseCompute:function(c){this.put=function(){var d=c.apply(this,arguments);this.invalidate();return d}},setCompute:function(c){(this.computeValue=c)&&c.reverse&&this.setReverseCompute(c.reverse);this.invalidate()},setSource:function(c){this.computeValue=function(){return c};this.invalidate()},observe:function(c){this.computeValue&&c(this.valueOf());var d=this;return this.dependencyOf({invalidate:function(){c(d.valueOf())}})},newElement:function(){return r.when(this.valueOf(),function(c){return c&&
c.newElement&&c.newElement()})}};return m})},"xstyle/core/es6":function(){define("xstyle/core/es6",[],function(){function r(a,c,b){t?-1===t.indexOf(a)&&t.push(a):(t=[a],setTimeout(function(){t.forEach(function(a){var b=[];a.properties.forEach(function(c){b.push({target:a.object,name:c})});a(b);a.object=null;a.properties=null});t=null},0));a.object=c;a=a.properties||(a.properties=[]);-1===a.indexOf(b)&&a.push(b)}function d(){return d}var m=Object.observe,l;if(l=Object.defineProperty)a:{try{Object.defineProperty({},
"t",{});l=!0;break a}catch(g){}l=void 0}var c={observe:m,defineProperty:l,promise:"undefined"!==typeof Promise,WeakMap:"function"===typeof WeakMap},m=c.observe?Object.observe:c.defineProperty?function(a,c){c.addKey=function(b){var d="key"+b;if(!this[d]){this[d]=!0;var f=a[b];if((d=Object.getOwnPropertyDescriptor(a,b))&&d.set){var g=d.set,h=d.get;Object.defineProperty(a,b,{get:function(){return f=h.call(this)},set:function(a){g.call(this,a);f!==a&&(f=a,c&&r(c,this,b))}})}else Object.defineProperty(a,
b,{get:function(){return f},set:function(a){f!==a&&(f=a,c&&r(c,this,b))}})}};c.remove=function(){c=null}}:function(a,c){n||(n=!0,setInterval(function(){for(var a=0,b=q.length;a<b;a++){var c=p[a],d=q[a],e=h[a],f=void 0,g=void 0;for(g in c)c.hasOwnProperty(g)&&c[g]!==d[g]&&(c[g]=d[g],(f||(f=[])).push({name:g}));for(g in d)d.hasOwnProperty(g)&&!c.hasOwnProperty(g)&&(c[g]=d[g],(f||(f=[])).push({name:g}));f&&e(f)}},20));var b={},d;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);q.push(a);p.push(b);h.push(c)},
t;l=c.observe?Object.unobserve:function(a,c){c.remove&&c.remove();for(var b=0,d=q.length;b<d;b++)if(q[b]===a&&h[b]===c){q.splice(b,1);p.splice(b,1);h.splice(b,1);break}};var q=[],p=[],h=[],n=!1,k=1,a=function(){};a.prototype.toJSON=d;return{Promise:c.promise?Promise:function(){function a(c){function b(a){a&&a.then?a.then(b,d):(h=a,f())}function d(a){k=a;f()}function f(){g=!0;for(var a=0,b=l.length;a<b;a++)l[a]();l=0}var g,h,k,l=0;c(b,d);return{then:function(b,c){return new a(function(a,d){function e(){try{k&&
!c?d(k):a(k?c(k):b?b(h):h)}catch(B){d(B)}}g?e():(l||(l=[])).push(e)})}}}return a}(),WeakMap:c.WeakMap?WeakMap:function(d,f){var b="__"+(f||"")+k++;return c.defineProperty?{get:function(a){return a[b]},set:function(a,c){Object.defineProperty(a,b,{value:c,enumerable:!1})}}:{get:function(a){return(a=a[b])&&a.value},set:function(c,d){(c[b]||(c[b]=new a)).value=d}}},observe:m,unobserve:l,copy:function(a,c){for(var b in c)a[b]=c[b];return a}}})},"xstyle/core/Rule":function(){define("xstyle/core/Rule",["xstyle/core/expression",
"xstyle/core/Definition","put-selector/put","xstyle/core/es6","xstyle/core/utils"],function(r,d,m,l,c){function t(a,b,c){try{a[b]=c}catch(D){}}function q(){}function p(b,c,e,f){if(b.calls){var g;for(e=0;e<b.length;e++){var k=b[e];if(k instanceof h){b.hasOwnProperty(e)||(b[e]=k=a(k));var l=k.ref&&(k.ref.selfResolving?k.ref.apply(c,k.getArgs(),c):r.evaluate(c,[k.caller,k]));void 0!==l&&((g||(g=[])).push(l),k.evaluated=!0)}}}if(g)return c=r.react(function(){for(var a=0,c=b.slice(),d=0;d<b.length;d++){var e=
b[d];e instanceof h&&e.evaluated&&(c[d-1]=b[d-1].slice(0,-e.caller.length),c[d]=arguments[a++])}return c.join("")}),c.skipResolve=!0,f=new d,f.setCompute(c.apply(f,g,f)),f;if(!f)return b.toString()}function h(a){this.caller=a;this.args=[]}function n(a,b,d,e){return c.when(b,function(b){var c=b;b&&b.forRule&&((a._subRuleListeners||(a._subRuleListeners=[])).push(function(a){var b=c.forRule(a,!0);b&&b.forElement?k(a,b,e):d&&d(b)}),b=b.forRule(a));if(b&&b.forElement)return k(a,b,e);d&&d(b)})}function k(a,
b,c){return require(["xstyle/core/elemental"],function(d){d.addRenderer(a,function(a){var d=b.forElement(a);c&&c(d,a)})})}var a=Object.create||function(a){function b(){}b.prototype=a;return new b},g=c.convertCssNameToJs,f={"{":"}","[":"]","(":")"},b=m("div").style;q.prototype={property:function(a){return(this._properties||(this._properties={}))[a]||(this._properties[a]=new Proxy(this.get(a)))},eachProperty:function(a){for(var b=this.values||0,c=0;c<b.length;c++){var d=b[c];a.call(this,d||"unnamed",
b[d])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){a=(this.rules||(this.rules={}))[a]=new q;a.disabled=this.disabled;a.parent=this;return a},newCall:function(a){a=new h(a);a.parent=this;return a},addSheetRule:function(a,b){if("@"!=a.charAt(0)){var c=this.styleSheet,d=c.cssRules||c.rules,e=-1<this.ruleIndex?this.ruleIndex:d.length;try{c.addRule(a,b||" ",e)}catch(A){a.match(/-(moz|webkit|ie)-/)||console.warn("Unable to add rule",
a,b)}return d[e]}},onRule:function(){var a=this.getCssRule();if(this.installStyles)for(var b=0;b<this.installStyles.length;b++){var c=this.installStyles[b];t(a.style,c[0],c[1])}},setMediaSelector:function(a){this.isMediaBlock=!0;this.selector=a},setStyle:function(a,b){this.cssRule?t(this.cssRule.style,a,b):(this.installStyles||(this.installStyles=[])).push([a,b])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},
elements:function(a){var b=this;require(["xstyle/core/elemental"],function(c){c.addRenderer(b,function(b){a(b)})})},declareDefinition:function(a,d,e){a=a&&g(a);if(!this.disabled){var f=this;if(d.length)if("\x3e"==d[0].toString().charAt(0))a||(this.generator=d,require(["xstyle/core/generate","xstyle/core/elemental"],function(a,b){d=a.forSelector(d,f);b.addRenderer(f,d)}));else{var h=a in b||this.getDefinition(a);if(!e||!h){e=this.definitions||(this.definitions={});var k=d[0];if(k.indexOf&&-1<k.indexOf(","))for(var k=
d.join("").split(/\s*,\s*/),l=[],m=0;m<k.length;m++)l[m]=r.evaluate(this,k[m]);d[0]&&"{"==d[0].operator?l=d[0]:d[1]&&"{"==d[1].operator&&(l=d[1],c.extend(l,d[0]));l=l||r.evaluate(this,d);if(l.then)var n=l,l={then:function(a){return n.then(function(b){return a(p(b))})}};var p=function(b){b.define&&(b=b.define(f,a));return b};h&&console.warn('Overriding existing property "'+a+'"');return e[a]=p(l)}}else return e=this.definitions||(this.definitions={}),e[a]=d}},onArguments:function(a){var b=a.ref;return b&&
b.apply(this,a.getArgs(),this)},setValue:function(a,c,d){var e=g(a);if(!this.disabled){var f=this.values||(this.values=[]);f.push(a);f[a]=c;if(a){do{f=(d||this).getDefinition(a);if(void 0!==f){if(this.cssRule&&(!f||!f.keepCSSValue)){var h=this.cssRule.style;e in h&&t(h,e,"")}n(this,f.put(c,this,e))}a=a.substring(0,a.lastIndexOf("-"))}while(a)}e in b&&this._setStyleFromValue(e,c,!0)}},_setStyleFromValue:function(a,b,d){var e=b[0];if(e instanceof q)for(d=e.values,e=0;e<d.length;e++){var f=d[e];this._setStyleFromValue(a+
("main"==f?"":f.charAt(0).toUpperCase()+f.slice(1)),d[f])}else{if(b.calls){var g=this;if(b.expression=p(b,this,a,!0)){var h=b.expression&&b.expression.valueOf(),l=function(b,c){var d=h&&h.forRule?h.forRule(b,!0):h;if(d&&d.forElement)if(c=c&&c.elements)for(var e=0;e<c.length;e++)for(var f=c[e].querySelectorAll(b.selector),g=0;g<f.length;g++){var l=f[g];t(l.style,a,d.forElement(l))}else k(b,d,function(b,c){t(c.style,a,b)});else b.setStyle(a,d)},m=[g];c.when(h,function(a){(h=a)&&h.forRule&&(g._subRuleListeners||
(g._subRuleListeners=[])).push(function(a){m.push(a);l(a)});l(g)});b.expression.dependencyOf({invalidate:function(a){c.when(b.expression.valueOf(),function(b){h=b;for(b=0;b<m.length;b++){var c=!0,d=m[b];if(a&&a.rules)for(var c=!1,e=0;e<a.rules.length;e++)if(a.rules[e]===d){c=!0;break}c&&l(d,a)}})}})}}d||this.setStyle(a,b)}},put:function(a){var b=this;return{forRule:function(c){b.extend(c);if("defaults"!=a&&a&&"string"==typeof a&&b.values)for(var d=a.toString().split(/,\s*/),e=0;e<d.length;e++){var f=
b.values[e];f&&c.setValue(f,d[e],b)}}}},extend:function(c,d){(this.derivatives||(this.derivatives=[])).push(c);var e=this.extraSelector;e&&(c.selector+=e);for(var f=this.cssRule.style,h=c.getCssRule().style,k=c.inheritedStyles||(c.inheritedStyles={}),e=0;e<f.length;e++){var m=g(f[e]);if(!h[m]||k[m])h[m]=f[m],k[m]=!0}if(e=this.values){var e=a(e),n=c.values;c.values=n?l.copy(e,n):e}if(d){if(e=this.definitions){var e=a(e),p=c.definitions;c.definitions=p?l.copy(e,p):e}c.tagName=this.tagName||c.tagName}(c.bases||
(c.bases=[])).push(this);d=this._subRuleListeners||0;for(e=0;e<d.length;e++)d[e](c);var q=c.getCssRule().style;this.eachProperty(function(d,e){d=g(d);"object"==typeof e&&(e=a(e));d in b&&!q[d]&&c._setStyleFromValue(d,e)});if(n&&c.definitions)for(e=0,d=n.length;e<d;e++)m=n[e],f=g(m),c.definitions[f]!==(p&&p[f])&&c.setValue(m,n[f]);if(n=this.generator){if(n instanceof Array)for(n=n.slice(0),e=0;e<n.length;e++)p=n[e],"{"===p.operator&&(d=c.newRule(),d.selector=p.selector+c.selector.slice(1),d.styleSheet=
c.styleSheet||c.cssRule.parentStyleSheet,p.extend(d,!0),n[e]=d);c.declareDefinition(null,n)}},getDefinition:function(a,b){a=g(a);var c=this;do{var d=c.definitions&&c.definitions[a];void 0===d&&b&&c[b]&&(d=c[b][a]);c=c.parent}while(void 0===d&&c);return d},newElement:function(){return m((this.tagName||"span")+(this.selector||""))},cssText:""};r.evaluateText=p;var e=h.prototype=new q;e.declareDefinition=e.setValue=function(a,b){this.args.push(b)};e.toString=function(){var a=this.operator;return a+this.args+
f[a]};q.updateStaleProperties=function(){};return q})},"xstyle/core/generate":function(){define("xstyle/core/generate",["xstyle/core/elemental","put-selector/put","xstyle/core/utils","xstyle/core/expression","xstyle/core/base"],function(r,d,m,l,c){function t(a,c){a=a.sort?a:[a];return function(e,f,g){var k=e,l;"content"in e||(e.content=void 0);if(void 0===g){var p=(e._contentNode||e).childNodes||0,t=p[0];if(t){var u=b.createDocumentFragment();do u.appendChild(t);while(t=p[0]);e.content=u}if(e._contentNode){e._contentNode=
void 0;try{e.innerHTML=""}catch(M){}}}for(var v=0,x=[e],z=[],p=0,t=a.length;p<t;p++){var D=J,J=a[p];try{if(J.eachProperty){if(J.args)if("("==J.operator){var K=a[p+1];q(J,K,k,function(a,b,d){n(a,b,d,c)})}else{var I=J.args[0];if("string"===typeof I){var O=I.split("\x3d");try{k.setAttribute(O[0],O[1])}catch(M){console.error(M)}}else{var P=I[0].replace(/=$/,""),R=I[1];"("==R.operator?q(I[1],P,k,function(a,b,d){h(a,b,d,c)}):k.setAttribute(P,R.value)}}}else if("string"==typeof J){"\x3d"==J.charAt(0)&&(J=
J.slice(1));var N=k,K=a[p+1],O=[];J.replace(/([,\n]+)?([\t ]*)?(\.|#)?([-\w%$|\.\#]+)(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,function(){O.push(arguments)});for(var Q=0;Q<O.length;Q++)(function(a,b,h,n,p,q,r){function t(){var a=N._contentNode;a&&(a.innerHTML="",N=a)}b?(a=h?h.length:0,a>v?(t(),x[a]=N):N=x[a]||N,v=a):t();var u;if(n)u=(D&&D.args?"":"span")+n+p;else{n=p.match(/^[-\w]+/);if(!n)throw new SyntaxError("Unable to parse selector",p);n=n[0];var y;Q===O.length-1&&K&&K.selector?(K.bases||m.extend(K,
n),y=K):y=c.getDefinition(n);y&&(y.then||y.newElement)?N=function(a,b,c,e){var f,g;m.when(y&&y.newElement&&y.newElement(),function(a){(f=a)?(c=c.slice(e.length))&&d(f,c):f=d(c);if(g){g.parentNode.replaceChild(f,g);a=g.childNodes;var b;for(f=f._contentNode||f;b=a[0];)f.appendChild(b)}});if(f)return a.insertBefore(f,b||null);g=d("span");return a.insertBefore(g,b||null)}(N,g,p,n):u=p}u&&(N=d(g||N,(g?"-":"")+u));g=null;q&&N.setAttribute(q,""===r?q:r);f&&(N.item=f);l=l||N;(Q<O.length-1||N!=k&&N!=e)&&z.push(Q==
O.length-1&&K&&K.selector,N);k=N}).apply(this,O[Q])}else k.appendChild(b.createTextNode(J.value))}catch(M){console.error(M,M.stack),k.innerHTML&&(k.innerHTML=""),k.appendChild(b.createTextNode(M))}}for(;J=z.pop();)r.update(J,z.pop());return l}}function q(a,b,c,f){var g,h;b&&b.eachProperty?(d(c,g=b.selector),h=b):(d(c,g=a.selector||(a.selector=".-xbind-"+e++)),h=a);var k=a.getArgs()[0],m=a.expressionResult,n=a.expressionDefinition;n||(n=a.expressionDefinition=l.evaluate(a.parent,k),m=n.valueOf(),r.addInputConnector(h,
n),function(b,c,d){a.expressionResult=m;d.dependencyOf&&d.dependencyOf({invalidate:function(a){a=a?r.matchesRule(a.elements[0],h)?a.elements:a.elements[0].querySelectorAll(c):document.querySelectorAll(c);for(var e=0,g=a.length;e<g;e++)f(a[e],b,d.valueOf())}})}(b,g,n));f(c,b,m)}function p(a,b,c,d){return m.when(a,function(a){a&&a.forRule&&(a=a.forRule(b));a&&a.forElement&&(a=a.forElement(c));d(a)})}function h(a,b,c,d){p(c,d,a,function(c){a.setAttribute(b,c)})}function n(a,c,e,h){a._defaultBinding=
!0;if(e&&e.then&&"INPUT"!==a.tagName)try{a.appendChild(b.createTextNode("Loading"))}catch(z){}p(e,h,a,function(e){if(a._defaultBinding)if(k(a),a.childNodes.length&&(a.innerHTML=""),e&&e.sort)if(e.isSequence)t(e,h)(a);else{var l=c&&c.definitions&&c.definitions.each,m=h.newRule(),l=l?t(l,m):function(a,b,c){return d(c||a,(c?"-":"")+(g[a.tagName]||"span"),""+b)},n=[],p;e.track&&(e=e.track(),p=e.tracking);e.forEach(function(b){n.push(l(a,b,null))});if(e.on)var q=e.on("add,delete,update",function(b){var c=
b.target,d=b.previousIndex;b=b.index;if(-1<d){var e=n[d];k(e,!0);e.parentNode.removeChild(e);n.splice(d,1)}-1<b&&n.splice(b,0,l(a,c,n[b]||null))});if(p=p||q)a.xcleanup=function(){p.remove()}}else e&&e.nodeType?a.appendChild(e):(e=void 0===e?"":e,a.tagName in f?"checkbox"===a.type?a.checked=e:a.value=e:a.appendChild(b.createTextNode(e)))})}function k(a,b){a.xcleanup&&a.xcleanup(b);a=a.getElementsByTagName("*");b=0;for(var c=a.length;b<c;b++){var d=a[b];d.xcleanup&&d.xcleanup(!0)}}function a(a,b){return t(b,
c)(a)}var g={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},f={INPUT:1,TEXTAREA:1,SELECT:1},b=document,e=1;a.forSelector=t;return a})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a){m.isAsync||p(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var g=d("dojo.dnd.Source",k,{isSource:!0,
horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){l.mixin(this,l.mixin({},b));a=this.accept;if(a.length)for(this.accept={},b=0;b<a.length;++b)this.accept[a[b]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&c.add(this.node,"dojoDndSource");this.targetState="";this.accept&&c.add(this.node,"dojoDndTarget");
this.horizontal&&c.add(this.node,"dojoDndHorizontal");this.topics=[h.subscribe("/dnd/source/over",l.hitch(this,"onDndSourceOver")),h.subscribe("/dnd/start",l.hitch(this,"onDndStart")),h.subscribe("/dnd/drop",l.hitch(this,"onDndDrop")),h.subscribe("/dnd/cancel",l.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var c=0;c<b.length;++c){for(var d=a.getItem(b[c].id).type,f=!1,g=0;g<d.length;++g)if(d[g]in this.accept){f=!0;break}if(!f)return!1}return!0},
copyState:function(c,b){if(c)return!0;2>arguments.length&&(b=this==a.manager().target);if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){g.superclass.destroy.call(this);r.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(c){if(!this.isDragging||"Disabled"!=this.targetState){g.superclass.onMouseMove.call(this,c);var b=a.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(c.pageX-this._lastX)>
this.delay||Math.abs(c.pageY-this._lastY)>this.delay)){var d=this.getSelectedNodes();d.length&&b.startDrag(this,d,this.copyState(n.getCopyKeyState(c),!0))}this.isDragging&&(d=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=t.position(this.current,!0)),d=this.horizontal?c.pageX-this.targetBox.x<this.targetBox.w/2==t.isBodyLtr(this.current.ownerDocument):c.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||d!=this.before)&&(this._markTargetAnchor(d),
b.canDrop(!this.current||b.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(a){this.mouseDown||!this._legalMouseDown(a)||this.skipForm&&n.isFormElement(a)||(this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,g.superclass.onMouseDown.call(this,a))},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,g.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(c){this!==c?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(c=a.manager(),
c.canDrop("Disabled"!=this.targetState&&(!this.current||c.source!=this||!(this.current.id in this.selection))))},onDndStart:function(c,b,d){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==c?d?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(c,b);this._changeState("Target",b?"":"Disabled");this==c&&a.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,c,d){if(this==d)this.onDrop(a,b,c);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&
(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,c){if(this!=a)this.onDropExternal(a,b,c);else this.onDropInternal(b,c)},onDropExternal:function(a,b,c){var d=this._normalizedCreator;this._normalizedCreator=this.creator?function(b,c){return d.call(this,a.getItem(b.id).data,c)}:c?function(b){var c=a.getItem(b.id);b=b.cloneNode(!0);b.id=n.getUniqueId();return{node:b,
data:c.data,type:c.type}}:function(b){var c=a.getItem(b.id);a.delItem(b.id);return{node:b,data:c.data,type:c.type}};this.selectNone();c||this.creator||a.selectNone();this.insertNodes(!0,b,this.before,this.current);!c&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=d},onDropInternal:function(a,b){var c=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=this.creator?function(a,b){return c.call(this,this.getItem(a.id).data,b)}:function(a){var b=
this.getItem(a.id);a=a.cloneNode(!0);a.id=n.getUniqueId();return{node:a,data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=c}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){g.superclass.onOverEvent.call(this);a.manager().overSource(this);if(this.isDragging&&"Disabled"!=
this.targetState)this.onDraggingOver()},onOutEvent:function(){g.superclass.onOutEvent.call(this);a.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){if(this.current!=this.targetAnchor||this.before!=a)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":
"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!q.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(c.contains(a,"dojoDndHandle"))return!0;if(c.contains(a,"dojoDndItem")||c.contains(a,
"dojoDndIgnore"))break}return!1}});return g})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a){var g=d("dojo.dnd.Selector",a,{constructor:function(a,b){b||(b={});this.singular=b.singular;this.autoSync=b.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(h(this.node,n.press,l.hitch(this,
"onMouseDown")),h(this.node,n.release,l.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var a=new p,b=k._empty,d;for(d in this.selection)d in b||a.push(c.byId(d));return a},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(a,b){this._addItemClass(c.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=k._empty,b;for(b in this.selection)if(!(b in a)){var d=
c.byId(b);this.delItem(b);t.destroy(d)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||m.global;var c=this.selection,d=k._empty,f;for(f in c)f in d||a.call(b,this.getItem(f),f,this)},sync:function(){g.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],b=k._empty,c;for(c in this.selection)c in b||this.getItem(c)||a.push(c);r.forEach(a,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,
b,c,d){var e=this._normalizedCreator;this._normalizedCreator=function(b,c){b=e.call(this,b,c);a?(this.anchor?this.anchor!=b.node&&(this._removeItemClass(b.node,"Anchor"),this._addItemClass(b.node,"Selected")):(this.anchor=b.node,this._removeItemClass(b.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[b.node.id]=1):(this._removeItemClass(b.node,"Selected"),this._removeItemClass(b.node,"Anchor"));return b};g.superclass.insertNodes.call(this,b,c,d);this._normalizedCreator=e;
return this},destroy:function(){g.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!k.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,q.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){k.getCopyKeyState(a)||this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=b[0],this._addItemClass(this.anchor,
"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var c=0,d;c<b.length&&(d=b[c],d!=this.anchor&&d!=this.current);++c);for(++c;c<b.length;++c){d=b[c];if(d==this.anchor||d==this.current)break;this._addItemClass(d,"Selected");this.selection[d.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?k.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,
"Anchor"),this.selection[this.current.id]=1):k.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||
(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=h(this.node,n.move,l.hitch(this,"onMouseMove"))},
onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=k._empty,b;for(b in this.selection)if(!(b in a)){var d=c.byId(b);d&&this._removeItemClass(d,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return g})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k,a,g,f){d=d("dojo.dnd.Container",h,{skipForm:!1,allowNested:!1,constructor:function(a,c){this.node=t.byId(a);c||(c={});this.creator=c.creator||null;this.skipForm=c.skipForm;this.parent=c.dropParent&&t.byId(c.dropParent);this.map={};this.current=null;this.containerState="";q.add(this.node,"dojoDndContainer");c&&c._skipStartup||this.startup();this.events=[k(this.node,g.over,l.hitch(this,"onMouseOver")),k(this.node,g.out,l.hitch(this,"onMouseOut")),k(this.node,"dragstart",
l.hitch(this,"onSelectStart")),k(this.node,"selectstart",l.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,c){this.map[a]=c},delItem:function(a){delete this.map[a]},forInItems:function(a,c){c=c||m.global;var b=this.map,d=f._empty,e;for(e in b)e in d||a.call(c,b[e],e,this);return c},clearItems:function(){this.map={}},getAllNodes:function(){return a((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var c=
this.getItem(b.id);if(c){a[b.id]=c;return}}else b.id=f.getUniqueId();var c=b.getAttribute("dndType"),d=b.getAttribute("dndData");a[b.id]={data:d||b.innerHTML,type:c?c.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,c,d){this.parent.firstChild?c?d||(d=this.parent.firstChild):d&&(d=d.nextSibling):d=null;var b;if(d)for(c=0;c<a.length;++c)b=this._normalizedCreator(a[c]),this.setItem(b.node.id,{data:b.data,type:b.type}),d.parentNode.insertBefore(b.node,d);else for(c=0;c<
a.length;++c)b=this._normalizedCreator(a[c]),this.setItem(b.node.id,{data:b.data,type:b.type}),this.parent.appendChild(b.node);return this},destroy:function(){r.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,c,d){a._skipStartup=!0;return new d(c,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=
a[0])}this.defaultCreator=f._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&b!=this.node;)try{b=b.parentNode}catch(u){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(e){a=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){this.withHandles||this.skipForm&&f.isFormElement(a)||(a.stopPropagation(),a.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,c){var b="dojoDnd"+a;a=a.toLowerCase()+"State";q.replace(this.node,b+c,b+this[a]);this[a]=c},_addItemClass:function(a,c){q.add(a,"dojoDndItem"+c)},_removeItemClass:function(a,c){q.remove(a,"dojoDndItem"+
c)},_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&q.contains(a,"dojoDndItem"))return a;return null},_normalizedCreator:function(a,c){a=(this.creator||this.defaultCreator).call(this,a,c);l.isArray(a.type)||(a.type=["text"]);a.node.id||(a.node.id=f.getUniqueId());q.add(a.node,"dojoDndItem");return a}});f._createNode=function(a){return a?function(b){return p.create(a,{innerHTML:b})}:f._createSpan};f._createTrTd=function(a){var b=
p.create("tr");p.create("td",{innerHTML:a},b);return b};f._createSpan=function(a){return p.create("span",{innerHTML:a})};f._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};f._defaultCreator=function(a){a=a.tagName.toLowerCase();var b="tbody"==a||"thead"==a?f._createTrTd:f._createNode(f._defaultCreatorNodes[a]);return function(a,c){var d=a&&l.isObject(a),e;d&&a.tagName&&a.nodeType&&a.getAttribute?(e=a.getAttribute("dndData")||a.innerHTML,d=(d=a.getAttribute("dndType"))?d.split(/\s*,\s*/):["text"]):
(e=d&&a.data?a.data:a,d=d&&a.type?a.type:["text"],a=("avatar"==c?f._createSpan:b)(String(e)));a.id||(a.id=f.getUniqueId());return{node:a,data:e,type:d}}};return d})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a,g,f){var b=d("dojo.dnd.Manager",[t],{constructor:function(){this.source=this.avatar=null;this.nodes=
[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:q("touch")?4:16,OFFSET_Y:q("touch")?4:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());n.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),n.publish("/dnd/source/over",null)):n.publish("/dnd/source/over",null)},startDrag:function(a,b,d){function e(a){a.preventDefault();
a.stopPropagation()}g.autoScrollStart(l.doc);this.source=a;this.nodes=b;this.copy=!!d;this.avatar=this.makeAvatar();l.body().appendChild(this.avatar.node);n.publish("/dnd/start",a,b,this.copy);this.events=[h(l.doc,k.move,m.hitch(this,"onMouseMove")),h(l.doc,k.release,m.hitch(this,"onMouseUp")),h(l.doc,"keydown",m.hitch(this,"onKeyDown")),h(l.doc,"keyup",m.hitch(this,"onKeyUp")),h(l.doc,"dragstart",e),h(l.body(),"selectstart",e)];a="dojoDnd"+(d?"Copy":"Move");c.add(l.body(),a)},canDrop:function(a){a=
!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){c.remove(l.body(),["dojoDndCopy","dojoDndMove"]);r.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new f(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(b){var c=this.avatar;c&&(g.autoScrollNodes(b),c=c.node.style,c.left=b.pageX+this.OFFSET_X+"px",c.top=
b.pageY+this.OFFSET_Y+"px",c=!!this.source.copyState(a.getCopyKeyState(b)),this.copy!=c&&this._setCopyStatus(c));q("touch")&&b.preventDefault()},onMouseUp:function(b){if(this.avatar){if(this.target&&this.canDropFlag){var c=!!this.source.copyState(a.getCopyKeyState(b));n.publish("/dnd/drop/before",this.source,this.nodes,c,this.target,b);n.publish("/dnd/drop",this.source,this.nodes,c,this.target,b)}else n.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case p.CTRL:a=
!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case p.ESCAPE:n.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==p.CTRL&&(a=!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();c.replace(l.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});a._manager=null;b.manager=a.manager=function(){a._manager||
(a._manager=new b);return a._manager};return b})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(r,d,m,l,c,t,q,p){return r("dojo.dnd.Avatar",null,{constructor:function(c){this.manager=c;this.construct()},construct:function(){var c=t.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),d=this.manager.source,k,a=t.create("tbody",null,c),g=t.create("tr",
null,a),f=t.create("td",null,g),b=Math.min(5,this.manager.nodes.length),e=0;q("highcontrast")&&t.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},f);t.create("span",{innerHTML:d.generateText?this._generateText():""},f);for(l.set(g,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});e<b;++e)d.creator?k=d._normalizedCreator(d.getItem(this.manager.nodes[e].id).data,"avatar").node:(k=this.manager.nodes[e].cloneNode(!0),"tr"==k.tagName.toLowerCase()&&(g=t.create("table"),t.create("tbody",
null,g).appendChild(k),k=g)),k.id="",g=t.create("tr",null,a),f=t.create("td",null,g),f.appendChild(k),l.set(g,{"class":"dojoDndAvatarItem",style:{opacity:(9-e)/10}});this.node=c},destroy:function(){t.destroy(this.node);this.node=!1},update:function(){c.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(q("highcontrast")){var d=m.byId("a11yIcon"),l="+";this.manager.canDropFlag&&!this.manager.copy?l="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(l="x"):
l="o";d.innerHTML=l}p("tr.dojoDndAvatarHeader td span"+(q("highcontrast")?" span":""),this.node).forEach(function(c){c.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(r,d,m,l){return r("dijit.CheckedMenuItem",m,{baseClass:"dijitMenuItem dijitCheckedMenuItem",
templateString:l,checked:!1,_setCheckedAttr:function(c){this.domNode.setAttribute("aria-checked",c?"true":"false");this._set("checked",c)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(c){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(c)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(r,d,m,l,c,t,q,p,h,n,k){var a=h("dijit.ColorPalette",[m,l,c],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:d,baseClass:"dijitColorPalette",_dyeFactory:function(a,c,b,d){return new this._dyeClass(a,
c,b,d)},buildRendering:function(){this.inherited(arguments);this._dyeClass=h(a._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],q.getLocalization("dojo","colors",this.lang))}});a._Color=h("dijit._Color",p,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":r.toUrl("./themes/a11y/colors7x10.png"),"3x4":r.toUrl("./themes/a11y/colors3x4.png")},constructor:function(a,c,b,d){this._title=d;this._row=c;this._col=b;this.setColor(p.named[a])},getValue:function(){return this.toHex()},fillCell:function(a,c){c=k.substitute(t("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:c,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});n.place(c,a)}});return a})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(r,d,m,l,c,t,q,p,h,n,k){return r("dijit._PaletteMixin",p,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?t.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(a,d){this._cells=[];var f=this._blankGif;this.own(q(this.gridNode,h,t.hitch(this,"_onCellClick")));for(var b=0;b<a.length;b++)for(var e=l.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),g=0;g<a[b].length;g++){var m=a[b][g];if(m){var n=this._dyeFactory(m,b,g,d[m]),m=l.create("td",{"class":this.cellClass,tabIndex:"-1",title:d[m],role:"gridcell"},e);n.fillCell(m,f);m.idx=this._cells.length;this._cells.push({node:m,
dye:n})}}this._xDim=a[0].length;this._yDim=a.length;var p={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},r;for(r in p)this.own(k.addKeyListener(this.domNode,{keyCode:c[r],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=p[r];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){n.focus(this._currentFocus)},
_onCellClick:function(a){for(var c=a.target;"TD"!=c.tagName;){if(!c.parentNode||c==this.gridNode)return;c=c.parentNode}var d=this._getDye(c).getValue();this._setCurrent(c);n.focus(c);this._setValueAttr(d,!0);a.stopPropagation();a.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&d.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&d.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,c){0<=this._selectedCell&&m.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var d=0;d<this._cells.length;d++)if(a==this._cells[d].dye.getValue()){this._selectedCell=d;m.add(this._cells[d].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(c||void 0===c)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,c){-1!=c&&(a=this._currentFocus.idx+a,a<this._cells.length&&-1<a&&(a=this._cells[a].node,this._setCurrent(a),this.defer(t.hitch(n,"focus",a))))},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(r){return r})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(r,d,m){return r("dijit.form.ComboBox",[d,m],{})})},"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(r,d,m,l){r=function(c){function r(d,a){var g=c[d];g&&(c[d]=function(f){var b;"put"===d&&(b=c.getIdentity(f));if(n)return g.apply(this,arguments);
n=!0;try{var e=g.apply(this,arguments);m(e,function(c){a("object"==typeof c&&c||f,b)});return e}finally{n=!1}})}var q=[],p=0;c=d.delegate(c);c.notify=function(c,a){p++;for(var d=q.slice(),f=0,b=d.length;f<b;f++)d[f](c,a)};var h=c.query;c.query=function(k,a){a=a||{};var g=h.apply(this,arguments);if(g&&g.forEach){var f=d.mixin({},a);delete f.start;delete f.count;var b=c.queryEngine&&c.queryEngine(k,f),e=p,n=[],r;g.observe=function(d,f){1==n.push(d)&&q.push(r=function(d,h){m(g,function(g){var k=g.length!=
a.count,m,q;if(++e!=p)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var r,t=-1,u=-1;if(void 0!==h){var v=[].concat(g);b&&!d&&(v=b(g));m=0;for(q=g.length;m<q;m++){var x=g[m];if(c.getIdentity(x)==h&&!(0>v.indexOf(x))){r=x;t=m;!b&&d||g.splice(m,1);break}}}b?d&&(b.matches?b.matches(d):b([d]).length)&&(m=-1<t?t:g.length,g.splice(m,0,d),u=l.indexOf(b(g),d),g.splice(m,1),a.start&&0==u||!k&&u==g.length?u=-1:g.splice(u,0,d)):d&&(void 0!==h?u=t:a.start||(u=
c.defaultIndex||0,g.splice(u,0,d)));if((-1<t||-1<u)&&(f||!b||t!=u))for(k=n.slice(),m=0;g=k[m];m++)g(d||r,t,u)})});var h={};h.remove=h.cancel=function(){var a=l.indexOf(n,d);-1<a&&(n.splice(a,1),n.length||q.splice(l.indexOf(q,r),1))};return h}}return g};var n;r("put",function(d,a){c.notify(d,a)});r("add",function(d){c.notify(d)});r("remove",function(d){c.notify(void 0,d)});return c};d.setObject("dojo.store.Observable",r);return r})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare",
"dojo/dom-class","dojo/sniff","./TextBox"],function(r,d,m,l){return r("dijit.form.SimpleTextarea",l,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);m("ie")&&this.cols&&
d.add(this.textbox,"dijitTextAreaCols")},filter:function(c){c&&(c=c.replace(/\r/g,""));return this.inherited(arguments)},_onInput:function(c){if(this.maxLength){var d=parseInt(this.maxLength),l=this.textbox.value.replace(/\r/g,""),d=l.length-d;if(0<d){var p=this.textbox;if(p.selectionStart){var h=p.selectionStart,n=0;m("opera")&&(n=(this.textbox.value.substring(0,h).match(/\r/g)||[]).length);this.textbox.value=l.substring(0,h-d-n)+l.substring(h-n);p.setSelectionRange(h-d,h-d)}else this.ownerDocument.selection&&
(p.focus(),l=this.ownerDocument.selection.createRange(),l.moveStart("character",-d),l.text="",l.select())}}this.inherited(arguments)}})})},"dijit/form/RadioButton":function(){define(["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(r,d,m){return r("dijit.form.RadioButton",[d,m],{baseClass:"dijitRadio"})})},"dijit/form/_RadioButtonMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/lang dojo/query!css2 ../registry".split(" "),function(r,d,m,l,c,t){return d("dijit.form._RadioButtonMixin",
null,{type:"radio",_getRelatedWidgets:function(){var d=[];c("input[type\x3dradio]",this.focusNode.form||this.ownerDocument).forEach(l.hitch(this,function(c){c.name==this.name&&c.form==this.focusNode.form&&(c=t.getEnclosingWidget(c))&&d.push(c)}));return d},_setCheckedAttr:function(c){this.inherited(arguments);this._created&&c&&r.forEach(this._getRelatedWidgets(),l.hitch(this,function(c){c!=this&&c.checked&&c.set("checked",!1)}))},_getSubmitValue:function(c){return null==c?"on":c},_onClick:function(c){if(this.checked||
this.disabled)return c.stopPropagation(),c.preventDefault(),!1;if(this.readOnly)return c.stopPropagation(),c.preventDefault(),r.forEach(this._getRelatedWidgets(),l.hitch(this,function(c){m.set(this.focusNode||this.domNode,"checked",c.checked)})),!1;var d=!1,h;r.some(this._getRelatedWidgets(),function(c){return c.checked?(h=c,!0):!1});this.checked=!0;h&&(h.checked=!1);if(!1===this.onClick(c)||c.defaultPrevented)d=!0;this.checked=!1;h&&(h.checked=!0);d?c.preventDefault():this.set("checked",!0);return!d}})})},
"url:jimu/dijit/templates/AGOLLoading.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/AddItemForm.html":'\x3cdiv style\x3d"width: 100%" class\x3d"jimu-item-form"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"itemForm" encType\x3d"multipart/form-data" action\x3d"" method\x3d""\x3e\r\n    \x3cdiv class\x3d"line"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.title}\x3c/div\x3e\r\n      \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"itemName"\r\n      required\x3d"true" class\x3d"input-item"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"line line-margin"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.folder}\x3c/div\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"itemFolder" data-dojo-type\x3d"dijit/form/FilteringSelect" trim\x3d"true" class\x3d"input-item"\x3e\x3c/input\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv class\x3d"symbol-chooser" style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointCustomImageTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"customImageTd" class\x3d"custom-image-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"image-file-tip jimu-ellipsis jimu-leading-margin1" data-dojo-attach-point\x3d"imageNameNode"\x3e${nls.noFileChoosen}\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr" data-dojo-attach-point\x3d"pointIconTablesTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" style\x3d"position:relative"\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-attach-point\x3d"loadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput class\x3d"text-input" data-dojo-attach-point\x3d"inputText" type\x3d"text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ImageChooser.html":'\x3cdiv class\x3d"jimu-image-chooser js-fileapi-wrapper"\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintText"\x3e\r\n\t\t\x3cspan class\x3d"display-text" data-dojo-attach-point\x3d"displayText"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintImage"\x3e\r\n\t\t\x3cimg class\x3d"display-image" data-dojo-attach-point\x3d"selfImg"\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--\r\n  \x3cform data-dojo-attach-point\x3d"fileForm"\x3e\r\n    \x3clabel data-dojo-attach-point\x3d"mask"\x3e\x3c/label\x3e\r\n    \x3cinput type\x3d"file" data-dojo-attach-point\x3d"fileInput"\x3e\r\n  \x3c/form\x3e\r\n  \x3cimg class\x3d"tmp-image" style\x3d"display:none" data-dojo-attach-point\x3d"tmpImg"\x3e--\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_CropImage.html":'\x3cdiv class\x3d"jimu-crop-image"\x3e\r\n\t\x3cimg class\x3d"loading-image" data-dojo-attach-point\x3d"loadingImg" src\x3d""\x3e\r\n\r\n\t\x3cimg class\x3d"base-image hide-status" data-dojo-attach-point\x3d"baseImage" width\x3d"100%" height\x3d"100%" style\x3d"display:none;width:100%;height:100%"\x3e\r\n\x3c/div\x3e\r\n',"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e${_nls0}\x3c/li\x3e\r\n      \x3cli\x3e${_nls50}\x3c/li\x3e\r\n      \x3cli\x3e${_nls100}\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon" data-dojo-attach-point\x3d"pointIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon" data-dojo-attach-point\x3d"lineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon" data-dojo-attach-point\x3d"polylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon" data-dojo-attach-point\x3d"freehandPolylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon" data-dojo-attach-point\x3d"triangleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon" data-dojo-attach-point\x3d"extentIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon" data-dojo-attach-point\x3d"circleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon" data-dojo-attach-point\x3d"ellipseIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon" data-dojo-attach-point\x3d"polygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon" data-dojo-attach-point\x3d"freehandPolygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"TEXT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"drawings-clear" data-dojo-attach-point\x3d"btnClear" title\x3d"${nls.clear}"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ColorRecords.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\t\t\x3ctr tabindex\x3d"0" role\x3d"row" data-dojo-attach-point\x3d"container"\x3e\r\n\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/Filter.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"contentSection" class\x3d"content-section"\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"desktopAddSection" class\x3d"desktop-add-section hidden"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-event\x3d"click:_onBtnAddExpClick" data-dojo-attach-point\x3d"btnAddExpDesktop"\r\n\t\t\t class\x3d"add-with-icon add-expression jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addAnotherExpression}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-event\x3d"click:_onBtnAddSetClick" data-dojo-attach-point\x3d"btnAddSetDesktop"\r\n\t\t\t class\x3d"add-with-icon add-set jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addSet}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"matchMsg" class\x3d"match-msg"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"oneOrZeroMsg" style\x3d"display:none;"\x3e${nls.oneOrZeroMsg}\x3c/div\x3e\r\n\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgAll}\x3c/option\x3e\r\n\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgAny}\x3c/option\x3e\r\n\t\t\t\x3c/select\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"allExpsBox" data-dojo-attach-point\x3d"allExpsBox"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"errorSection" class\x3d"hidden"\x3e\r\n\t\t\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"errorTip" class\x3d"error-tip"\x3e\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"mobileAddSection" class\x3d"mobile-add-section hidden"\x3e\r\n\t\t\x3cdiv data-dojo-attach-event\x3d"click:_onBtnAddExpClick" title\x3d"${nls.addAnotherExpression}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddExpMobile"\x3e\r\n\t\t\t+ ${nls.addAnotherExpression}\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-event\x3d"click:_onBtnAddSetClick" title\x3d"${nls.addSet}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddSetMobile"\x3e\r\n\t\t\t+ ${nls.addSet}\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"noFilterTipSection" class\x3d"no-filter-tip hidden"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/DateValueSelector.html":'\x3cdiv\x3e\r\n\t\x3cinput data-dojo-type\x3d"dijit/form/DateTextBox" data-dojo-attach-point\x3d"dateTextBox" class\x3d"custom-date-text-box" data-dojo-attach-event\x3d"change:_onDateTextBoxChanged" data-dojo-props\x3d\'required:false,trim:true\' /\x3e\r\n\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"dateTypeSelect" class\x3d"date-type-select restrict-select-width" data-dojo-attach-event\x3d"change:_onDateTypeSelectChanged"\x3e\r\n\t\x3c/select\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:jimu/dijit/_filter/TwoNumbersValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"numberRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d\'"required":false,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-event\x3d"blur:_onRangeNumberBlur" data-dojo-props\x3d\'"required":false,intermediateChanges:true,constraints: {pattern: "#####0.##########"}\' style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoDatesValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"dateRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv1"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv2"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/ListValueProvider.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"valuesSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"label",required:false,intermediateChanges:true\' style\x3d"width:100%;" data-dojo-attach-event\x3d"input:_onFilteringSelectInput"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/_filter/AdvancedListValueSelect.html":'\x3cdiv class\x3d"jimu-list-multiple-select" data-dojo-attach-point\x3d"multipleSelect" \x3e\r\n  \x3cdiv class\x3d"selectedContainer" data-dojo-attach-point\x3d"selectedContainer"\x3e\r\n    \x3cdiv class\x3d"jimu-multiple-items-list" data-dojo-attach-point\x3d"selectedListContent"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv\x3e\r\n    \x3c!-- \x3cdiv style\x3d"position:absolute;height:345px;width:100%;z-index:1;display:none;" data-dojo-attach-point\x3d"listContainerOverlay"\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"searchKeyInput" data-dojo-attach-point\x3d"searchKeyInput" style\x3d"display:none;"\x3e\r\n      \x3cinput value\x3d"" placeholder\x3d"${jimuCommonNls.search}" data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n       data-dojo-attach-point\x3d"valueInput" data-dojo-props\x3d\'"required":false,intermediateChanges:true\' style\x3d"width:100%;" /\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"items-content loading-center" data-dojo-attach-point\x3d"listContainer"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listContentStore"style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\r\n      \x3c/div\x3e --\x3e\r\n      \x3cdiv class\x3d"jimu-multiple-items-list" data-dojo-attach-point\x3d"listContent"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadMoreDataBtn" class\x3d"jimu-list-multiple-select-Tips load-more-data-Tips"\x3e${jimuCommonNls.searchMore}\x3c/div\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"noDataTips" class\x3d"jimu-list-multiple-select-Tips no-data-Tips"\x3e${Nls.noData}\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noDataTips" class\x3d"jimu-list-multiple-select-Tips no-data-Tips"\x3e${noDataNls}\x3c/div\x3e\r\n      \x3c!-- \x3cdiv class\x3d"createNewItem" data-dojo-attach-point\x3d"createNewItem" data-dojo-attach-event\x3d"click:_createTarget"\x3e\x26nbsp;\x3c/div\x3e --\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--\r\n  \x3cdiv class\x3d"selectedToggleDiv" style\x3d"display:none;" data-dojo-attach-point\x3d"selectedToggleDiv"\x3e\r\n    \x3cspan class\x3d"selectedToggle" data-dojo-attach-point\x3d"selectedToggle"\x3e\x3c/span\x3e\r\n    \x3cspan class\x3d"toggleTxt" title\x3d"${Nls.showSelected}"\x3e${Nls.showSelected}\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  --\x3e\r\n\r\n  \x3cdiv class\x3d"selectedToggleDiv" style\x3d"display:none;" data-dojo-attach-point\x3d"selectedToggleDiv"\x3e\r\n      \x3cdiv class\x3d"showAllIcon iconHover jimu-flipx" title\x3d"${Nls.showAll}"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"showSelectedIcon jimu-flipx" title\x3d"${Nls.showSelected}"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"clearAllSelectedIcon jimu-flipx" title\x3d"${Nls.unCheckAll}" data-dojo-attach-point\x3d"clearAllSelectedBtn"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/AdvancedListValueProvider.html":'\x3cdiv\x3e\r\n   \x3cdiv class\x3d"checkBtn" data-dojo-attach-point\x3d"checkedBtn" style\x3d"display:none;"data-dojo-attach-event\x3d"click:_checkedBtnEvent"\x3e\r\n       \x3cdiv data-dojo-attach-point\x3d"checkedNumDiv" class\x3d"checkedNumDiv"\x3e\x3cspan class\x3d"checkedNum" data-dojo-attach-point\x3d"checkedNum"\x3e\x3c/span\x3e${CommonNls.selected}\x3c/div\x3e\r\n       \x3cdiv data-dojo-attach-point\x3d"checkedNameDiv" class\x3d"checkedNum checkedNameDiv jimu-ellipsis-Blanks"\x3e\x3c/div\x3e\r\n       \x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8 checkBtnDownIcon"\x3e\x3c/div\x3e\r\n   \x3c/div\x3e\r\n   \x3cdiv data-dojo-attach-point\x3d"listContent"\x3e\x3c/div\x3e\r\n   \x3cdiv class\x3d"value-multiple-popup" data-dojo-attach-point\x3d"listContentPopup"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"listContent"\x3e\x3c/div\x3e\r\n   \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/pageControlForQuery.html":'\x3cdiv class\x3d"pageControl pageItem"\x3e\r\n  \x3c!--\r\n  \x3cdiv data-dojo-attach-point\x3d"prevPage" class\x3d"pageBtn pageDisabled pageItem"\x3e\x3c-prevPage\x3c/div\x3e\r\n  \x3cdiv class\x3d"pageItem" data-dojo-attach-point\x3d"currentPage"\x3e1\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"nextPage" class\x3d"pageBtn pageItem"\x3enextPage-\x3e\x3c/div\x3e\r\n  --\x3e\r\n\r\n  \x3c!-- \x3cdiv data-dojo-attach-point\x3d"addNextPage"\x3eLoad more data(Test)\x3c/div\x3e --\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/PredefinedValueProvider.html":'\x3cdiv\x3e\r\n    \x3c!-- \x3cdiv data-dojo-attach-point\x3d"valueproviderStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3cdiv class\x3d"predefined-btn"  data-dojo-attach-point\x3d\'indexBtn\'\x3e\r\n        \x3cdiv class\x3d"tip jimu-ellipsis" title\x3d"predefined" data-dojo-attach-point\x3d\'indexBtnTips\'\x3epredefined\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d\'valueProviderPopupNode\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/EditTable.html":'\x3cdiv\x3e\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis" title\x3d"${Nls.value}"\x3e${Nls.value}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis" title\x3d"${CommonNls.label}"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"${CommonNls.defaults}"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis" title\x3d"${CommonNls.actions}"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked, dblclick:_onListContentDblClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e',
"url:jimu/dijit/_filter/PredefinedValuePopup.html":'\x3cdiv\x3e\r\n   \x3c!--\r\n    \x3cselect data-dojo-attach-point\x3d"valProviderSelect" class\x3d"dijit-form-Select multiple-Select"  data-dojo-attach-event\x3d"onclick:_showPopup"\x3e\r\n    \x3c/select\x3e\r\n    --\x3e\r\n    \x3c!-- \x3cdiv class\x3d"subTitle"\x3e${CommonNls.layer}: \x3cspan data-dojo-attach-point\x3d"layerName"\x3e\x3c/span\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listSelectStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n\r\n      \x3c!-- for list select popup --\x3e\r\n      \x3c!-- \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e --\x3e\r\n      \x3c!-- for eidtTable --\x3e\r\n      \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"icon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--\r\n      \x3cdiv class\x3d"add-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e\r\n        \x3cdiv class\x3d"tip"\x3eopenLayer-temp\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"add-btn add-btn-right" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n       --\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"tableContent"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"displayTypes" data-dojo-attach-point\x3d"displayTypes" data-dojo-attach-event\x3d"click:_changeDisplayType"\x3e\r\n      \x3cdiv class\x3d"title jimu-ellipsis"\x3e${Nls.displayAs}\x3c/div\x3e\r\n      \x3cspan class\x3d"option dropdownOption"\x3e\r\n        \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aDrowdownList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n      \x3cspan class\x3d"option expandedOption"\x3e\r\n      \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aExpandedList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3c!--\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.name}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"set default?"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    --\x3e\r\n\r\n    \x3cdiv class\x3d"value-type-popup" data-dojo-attach-point\x3d"valuesPopupNode" style\x3d"display:none;"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"mutiValuesSelect" multiple\x3d"true" data-dojo-type\x3d"dojox/form/CheckedMultiSelect" data-dojo-props\x3d\'searchAttr:"label",required:false,intermediateChanges:true\' style\x3d"width:100%;" \x3e\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"pageControlContainer"\x3eLoad more data\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3c!-- \x3ca data-dojo-attach-event\x3d"onclick:_setSelectType" class\x3d"popupOper" style\x3d"display:none;"\x3etype\x3c/a\x3e --\x3e\r\n  \x3c/div\x3e',
"url:dojox/form/resources/_CheckedMultiSelectMenuItem.html":'\x3ctr class\x3d"dijitReset dijitMenuItem" dojoAttachPoint\x3d"focusNode" role\x3d"menuitemcheckbox" tabIndex\x3d"-1"\r\n\tdojoAttachEvent\x3d"ondijitclick:_onClick"\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\r\n\t\t\x3e\x3cdiv src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitMenuItemIcon ${_iconClass}" dojoAttachPoint\x3d"iconNode"\r\n\t\t\t\x3e\x3cinput class\x3d"dojoxCheckedMultiSelectCheckBoxInput" dojoAttachPoint\x3d"inputNode" type\x3d"${_type.type}"\r\n\t\t/\x3e\x3c/div\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" dojoAttachPoint\x3d"containerNode,labelNode"\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" dojoAttachPoint\x3d"accelKeyNode"\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26nbsp;\x3c/td\r\n\x3e\x3c/tr\x3e',
"url:dojox/form/resources/_CheckedMultiSelectItem.html":'\x3cdiv class\x3d"dijitReset ${baseClass}"\r\n\t\x3e\x3cinput class\x3d"${baseClass}Box" data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-point\x3d"checkBox" \r\n\t\tdata-dojo-attach-event\x3d"_onClick:_changeBox" type\x3d"${_type.type}" data-dojo-props\x3d\'disabled:${disabled}, readOnly:${readOnly}\' baseClass\x3d"${_type.baseClass}"\r\n\t/\x3e\x3cdiv class\x3d"dijitInline ${baseClass}Label" data-dojo-attach-point\x3d"labelNode" data-dojo-attach-event\x3d"onclick:_onClick"\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dojox/form/resources/CheckedMultiSelect.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}"\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"comboButtonNode"\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"selectNode" class\x3d"dijit dijitReset dijitInline ${baseClass}Wrapper" data-dojo-attach-event\x3d"onmousedown:_onMouseDown,onclick:focus"\r\n\t\t\x3e\x3cselect class\x3d"${baseClass}Select dojoxCheckedMultiSelectHidden" multiple\x3d"true" data-dojo-attach-point\x3d"containerNode,focusNode"\x3e\x3c/select\r\n\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"wrapperDiv"\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:jimu/dijit/_filter/NumberListValueProvider.html":'\x3cdiv\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"numberListTable" style\x3d"width:100%;border-collapse:collapse;"\r\n        cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n        \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n                \x3ctd style\x3d"width:50%;"\x3e\r\n                    \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n                        data-dojo-props\x3d\'"required":false,constraints:{min:0,pattern:"#####0.##########"}\'\r\n                        style\x3d"width:100%;" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                    \x3cselect data-dojo-attach-point\x3d"rangeSelect" data-dojo-type\x3d"dijit/form/Select"\r\n                        style\x3d"width:100%;" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n                        \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n                    \x3c/select\x3e\r\n                \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n        \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/DateIsInValueProvider.html":'\x3cdiv\x3e\r\n\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"dateTypeSelect" class\x3d"date-type-select restrict-select-width" data-dojo-attach-event\x3d"change:_onDateTypeSelectChanged"\x3e\r\n\t\x3c/select\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/_SingleFilter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"settings-container"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"fieldsSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"displayName",required:true,intermediateChanges:true\' class\x3d"fields-select dijit-form-FilteringSelect"\x3e\x3c/div\x3e\r\n    \x3cselect data-dojo-attach-point\x3d"operatorsSelect" data-dojo-type\x3d"dijit/form/Select" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n      \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n    \x3c/select\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"attributeValueContainer" class\x3d"attribute-value-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"valueProviderContainer" class\x3d"value-provider-container"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"valueTypeSetNode" title\x3d"${nls.setInputType}" class\x3d"value-type-set jimu-icon jimu-icon-setting" data-dojo-attach-event\x3d"click:_onValueTypeSetClick"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-icon jimu-icon-delete" data-dojo-attach-point\x3d"btnDelete" data-dojo-attach-event\x3d"click:_destroySelf"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"askvalues"\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxAskValues" label\x3d"${nls.askForValues}" class\x3d"jimu-trailing-margin6"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxCaseSensitive" label\x3d"${nls.caseSensitive}" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"promptSection" class\x3d"prompt"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"promptTable" cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"prompt-table" style\x3d"width:100%;"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.prompt}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"promptTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.hint}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"hintTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"cascadeTr" class\x3d"cascade-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv style\x3d"margin-bottom:5px;"\x3e${nls.listValues}:\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"cascadeSelect" class\x3d"cascade-select restrict-select-width" style\x3d"width:100%;"\x3e\r\n              \x3coption value\x3d"none"\x3e${nls.noneCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"previous"\x3e${nls.previousCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"all"\x3e${nls.allCascadeFilterTip}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_FilterSet.html":'\x3cdiv\x3e\r\n\t\x3ctable class\x3d"header-table" cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgSetAll}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgSetAny}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-delete"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnDelete" data-dojo-attach-event\x3d"onclick:_destroySelf"\r\n\t\t\t\t\t class\x3d"jimu-icon jimu-icon-delete"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-add"\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"btnAdd" class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"allExpsBox" class\x3d"jimu-filter-exps-box"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_SingleFilterParameter.html":'\x3cdiv\x3e\r\n  \x3ctable style\x3d"width:100%;"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"first-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"prompt" data-dojo-attach-point\x3d"promptNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"second-tr"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"valueProviderTd"\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"third-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"*now":function(r){r(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});
define("./ConfigManager ./LayoutManager ./DataManager ./WidgetManager ./FeatureActionManager ./SelectionManager ./DataSourceManager ./FilterManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query esri/config esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main esri/main dojo/ready".split(" "),function(r,d,m,l,c,t,q,p,h,n,k,a,g,f,b,e,u,v,x,D,z,A,E,y,
C,F,B,G,H){function L(){var a=window.location.search,b={query:!0};if(""===a)return{};var a=v.queryToObject(a.substr(1)),c;for(c in a)b[c]||(a[c]=y.sanitizeHTML(a[c]));return a}function J(a,b){K=a;"loadingPageChange"!==b&&(h.setStyle(jimuConfig.loadingId,"display","none"),h.setStyle(jimuConfig.mainPageId,"display","block"))}e={};var K;window.topic=f;x.defaults.io.timeout=18E4;"function"!==typeof b.getAll&&(b.getAll=function(a){var c=[];(a=b(a))&&c.push(a);return c});window.jimuNls=B;window.apiNls=
G.bundle;A.setProtocolErrorHandler(function(){return!0});A=y.getAncestorWindow();var I=!1,O=/^http(s?):\/\//gi;try{I=0===A.location.href.indexOf("https://")}catch(P){}D.setRequestPreCallback(function(a){a.content&&a.content.printFlag&&(a.timeout=3E5);I&&(a.url=a.url.replace(O,"//"));if(-1!==a.url.indexOf("/queryRelatedRecords?")){var b=a.url,c=x.defaults.io.proxyUrl;c&&0===a.url.indexOf(c+"?")&&(b=a.url.replace(c+"?",""));y.isHostedService(b)||(a.url=a.url.replace("FeatureServer","MapServer"))}/GPServer\/.+\/jobs/.test(a.url)&&
(a.preventCache=(new Date).getTime());window.isBuilder||!K||K.mode||(K.appProxies&&0<K.appProxies.length&&k.some(K.appProxies,function(b){var c=b.sourceUrl;b=b.proxyUrl;I&&(c=c.replace(O,"//"),b=b.replace(O,"//"));if(0<=a.url.indexOf(c))return a.url=a.url.replace(c,b),!0}),K.map.appProxy&&k.some(K.map.appProxy.proxyItems,function(b){if(!b.useProxy||!b.proxyUrl)return!1;var c=b.sourceUrl;b=b.proxyUrl;I&&(c=c.replace(O,"//"),b=b.replace(O,"//"));if(0<=a.url.indexOf(c))return a.url=a.url.replace(c,b),
!0}));return a});a(window,"mousedown",function(a){if(g.isMiddle(a))return a.preventDefault(),a.stopPropagation(),a.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a?!0:!1};Number.isNaN=Number.isNaN||function(a){return a!==a};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=n.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",
layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.10";window.productVersion="Online 6.3";window.isBuilder?(f.subscribe("app/appConfigLoaded",J),f.subscribe("app/appConfigChanged",J)):(f.subscribe("appConfigLoaded",J),f.subscribe("appConfigChanged",J));10<y.has("ie")&&h.addClass(document.body,"ie-gte-10");e.initApp=function(){var a,b;console.log("jimu.js init...");a=L();if(a.mobileBreakPoint)try{b=parseInt(a.mobileBreakPoint,
10),jimuConfig.breakPoints[0]=b}catch(N){console.error("mobileBreakPoint URL parameter must be a number.",N)}a.mode&&(h.setStyle(jimuConfig.loadingId,"display","none"),h.setStyle(jimuConfig.mainPageId,"display","block"));m.getInstance(l.getInstance());c.getInstance();t.getInstance();q.getInstance();p.getInstance();b=d.getInstance({mapId:jimuConfig.mapId,urlParams:a},jimuConfig.layoutId);a=r.getInstance(a);b.startup();a.loadConfig();C(["dynamic-modules/preload"]);H(function(){setTimeout(function(){h.removeClass(document.body,
"dj_a11y")},50)})};return e});