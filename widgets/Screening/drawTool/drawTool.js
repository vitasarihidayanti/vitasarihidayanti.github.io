// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Screening/drawTool/drawTool.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"esriCTDrawBoxLabel"\x3e${nls.drawToolWidget.useDrawToolForAOILabel}\x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTDrawToolIconsParentDiv" data-dojo-attach-point\x3d"drawToolIconsParentDiv"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTSelectToolParentDiv" data-dojo-attach-point\x3d"selectToolParent"\x3e\r\n    \x3cdiv class\x3d"esriCTSelectToolDiv" data-dojo-attach-point\x3d"selectToolDiv"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTWidgetAndBufferSeparator" data-dojo-attach-point\x3d"seperatorAfterSelect"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTParentDivOfChooseSymbol" data-dojo-attach-point\x3d"parentDivOfChooseSymbol"\x3e\r\n    \x3cdiv class\x3d"esriCTExpandCollapseParentContainer"\x3e\r\n      \x3cdiv class\x3d"esriCTLayerPanelOfSelectIcon esriCTLayerPanelExpandIcon" data-dojo-attach-point\x3d"layerSectionIcon"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTSelectableLayerTitle esriCTEllipsis" data-dojo-attach-point\x3d"impactSummaryLayerTitle" title\x3d"${nls.drawToolWidget.chooseLayerTitle}"\x3e\r\n        ${nls.drawToolWidget.chooseLayerTitle}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTImpactSummaryLayerMaxRecordHint esriCTHidden esriCTCursorPointer" data-dojo-attach-point\x3d"singleLayerSelectionWarning"\r\n        title\x3d"${nls.drawToolWidget.layerSelectionWarningTooltip}"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"entireLayerParentContainer" class\x3d"esriCTHidden"\x3e\r\n      \x3cdiv class\x3d"jimu-widget-screening-selectable-layer-item no-action"\x3e\r\n        \x3cdiv class\x3d"layer-row"\x3e\r\n          \x3cdiv class\x3d"selectable-check checked" title\x3d"${nls.drawToolWidget.selectAllLayersText}" data-dojo-attach-point\x3d"selectAllLayers"\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"layer-name jimu-ellipsis" title\x3d"${nls.drawToolWidget.selectAllLayersText}"\x3e${nls.drawToolWidget.selectAllLayersText}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"layer-nodes" data-dojo-attach-point\x3d"layerItemsNode"\x3e\r\n        \x3cdiv class\x3d"esriCTLayerItems"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/text!./drawTool.html dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/Evented dojo/on dojo/dom-construct dojo/query dojo/dom-class dojo/_base/array jimu/BaseWidget jimu/dijit/DrawBox jimu/dijit/FeatureSetChooserForMultipleLayers jimu/SelectionManager esri/geometry/geometryEngine dojo/_base/html dojo/_base/array ./SelectableLayerItem jimu/dijit/Message".split(" "),function(l,m,n,c,p,e,q,g,b,k,r,t,u,v,w,h,f,x,y){return l([r,n,p],{baseClass:"jimu-widget-screening-drawTool",
templateString:m,_drawTool:null,_filteredLayerArray:[],selectTool:null,layerItems:null,constructor:function(a){this._drawTool=null;this._filteredLayerArray=[];this.layerItems=this.selectTool=null;c.mixin(this,a)},postCreate:function(){this.layerItems=[];this._createFeatureLayerArr();this._initializeDrawBoxTools();this.config.drawToolSelectableLayers&&0<this.config.drawToolSelectableLayers.length||!this.config.drawToolSelectableLayers?(b.remove(this.parentDivOfChooseSymbol,"esriCTHidden"),b.remove(this.seperatorAfterSelect,
"esriCTHidden"),this._initializeSelectTool(),this._setFeatureLayersForSelectTool(),this._initLayers()):(b.add(this.parentDivOfChooseSymbol,"esriCTHidden"),b.add(this.seperatorAfterSelect,"esriCTHidden"));this.own(e(this.layerSectionIcon,"click",c.hitch(this,this._showOrHideLayerDetailsContainer)));this.own(e(this.impactSummaryLayerTitle,"click",c.hitch(this,this._showOrHideLayerDetailsContainer)));this.own(e(this.selectAllLayers,"click",c.hitch(this,this._selectAllLayers)));this.own(e(this.singleLayerSelectionWarning,
"click",c.hitch(this,function(){this._showMessage(this.nls.drawToolWidget.layerSelectionWarningTooltip)})))},_initLayers:function(){h.empty(this.layerItemsNode);f.forEach(this._filteredLayerArray,c.hitch(this,function(a){if(a&&a.objectIdField&&a.geometryType){var d,b;f.forEach(this.layerInfoArray,c.hitch(this,function(b){b.id===a.id&&(d=b)}));b=new x({layerInfo:d,checked:!0,layerVisible:!0,map:this.map,nls:this.nls});this.own(e(b,"stateChange",c.hitch(this,function(){this.emit("clearExistingSelection");
this.selectTool.setFeatureLayers(this._getSelectableLayers());this._updateSelectAllState()})));b.init(a);h.place(b.domNode,this.layerItemsNode);b.startup();this.layerItems.push(b)}}))},_getSelectableLayers:function(){var a=[];f.forEach(this.layerItems,function(d){d.isLayerVisible()&&d.isChecked()&&a.push(d.featureLayer)},this);return a},_showOrHideLayerDetailsContainer:function(){b.contains(this.layerSectionIcon,"esriCTLayerPanelCollapseIcon")?(b.add(this.entireLayerParentContainer,"esriCTHidden"),
b.replace(this.layerSectionIcon,"esriCTLayerPanelExpandIcon","esriCTLayerPanelCollapseIcon")):(b.remove(this.entireLayerParentContainer,"esriCTHidden"),b.replace(this.layerSectionIcon,"esriCTLayerPanelCollapseIcon","esriCTLayerPanelExpandIcon"))},_selectAllLayers:function(){var a;h.toggleClass(this.selectAllLayers,"checked");a=b.contains(this.selectAllLayers,"checked");f.forEach(this.layerItems,function(d){a?b.contains(d.selectableCheckBox,"checked")||d.selectableCheckBox.click():b.contains(d.selectableCheckBox,
"checked")&&d.selectableCheckBox.click()})},_updateSelectAllState:function(){var a,d,c;c=!0;a=b.contains(this.selectAllLayers,"checked");f.forEach(this.layerItems,function(a){b.contains(a.selectableCheckBox,"checked")?c=!1:d=!0});d?b.remove(this.selectAllLayers,"checked"):a||b.add(this.selectAllLayers,"checked");c?b.remove(this.singleLayerSelectionWarning,"esriCTHidden"):b.add(this.singleLayerSelectionWarning,"esriCTHidden")},_createFeatureLayerArr:function(){if(this.config.drawToolSelectableLayers)f.forEach(this.config.drawToolSelectableLayers,
c.hitch(this,function(a){this._filteredLayerArray.push(this.map.getLayer(a))}));else for(var a in this.filteredLayerObj)this.filteredLayerObj.hasOwnProperty(a)&&this._filteredLayerArray.push(this.filteredLayerObj[a])},_initializeDrawBoxTools:function(){var a;this._drawTool=new t({geoTypes:["POINT","POLYLINE","EXTENT","POLYGON"],map:this.map,pointSymbol:this.pointSymbol,polylineSymbol:this.polylineSymbol,polygonSymbol:this.polygonSymbol},this.drawToolIconsParentDiv);this._drawTool.startup();this.own(e(this._drawTool,
"draw-activate",c.hitch(this,function(a){this.selectTool&&this.selectTool.isActive()&&(this.selectTool.deactivate(),this._drawTool.drawToolBar.activate(a));"extent"===a&&this.map.disablePan();this.map.setInfoWindowOnClick(!1)})));this.own(e(this._drawTool,"draw-end",c.hitch(this,function(b){this._drawTool.drawLayer.clear();this.map.enablePan();(a="polygon"===b.geometry.type?w.simplify(b.geometry):b.geometry)?this.emit("onDrawComplete",[b]):this._drawTool.drawLayer.clear();this.map.setInfoWindowOnClick(!0)})))},
_initializeSelectTool:function(){var a;this.selectTool=new u({map:this.map,updateSelection:!0,fullyWithin:!1},this.selectToolDiv);a=g(".btn-clear",this.selectTool.domNode)[0];b.add(a,"esriCTHidden");a=g(".btn-select",this.selectTool.domNode)[0];this.own(e(a,"click",c.hitch(this,function(){this._drawTool.isActive()&&this._drawTool.deactivate();this.selectTool&&this.selectTool.isActive()&&this.map.disablePan()})));this.own(e(this.selectTool,"unloading",c.hitch(this,function(){var a;this.selectTool.deactivate();
a=this._getSelectedFeature();this.emit("onSelectionComplete",a)})));q.place(this.selectToolParent,g(".draw-items",this.domNode)[0],"last")},deactivateTools:function(){this._drawTool&&this._drawTool.isActive()&&this._drawTool.deactivate();this.selectTool&&this.selectTool.isActive()&&this.selectTool.deactivate();this.map.enablePan()},_setFeatureLayersForSelectTool:function(){this.selectTool.setFeatureLayers(this._filteredLayerArray)},_getSelectedFeature:function(){var a;a=[];k.forEach(this._filteredLayerArray,
c.hitch(this,function(b){a=a.concat(b.getSelectedFeatures())}));return a},clearAllSelections:function(){var a;a=v.getInstance();k.forEach(this._filteredLayerArray,c.hitch(this,function(b){a.clearSelection(b)}))},_showMessage:function(a){(new y({message:a})).message=a}})});