// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/CostAnalysis/setting/LayerSettings.html":'\x3cdiv class\x3d"esriCTTabNode"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"layerSettingsMainContainer"\x3e\r\n    \x3cdiv class\x3d"esriCTLayerSettingsTableNode" data-dojo-attach-point\x3d"layerSettingsTableNode"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTHidden esriCTNoAssetLayersAvailable" data-dojo-attach-point\x3d"noAssetLayersAvailable"\x3e\r\n      ${nls.layerSettings.noAssetLayersAvailable}\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare jimu/BaseWidget dojo/Evented jimu/dijit/Message dijit/_WidgetsInTemplateMixin dojo/text!./LayerSettings.html dojo/_base/lang jimu/dijit/SimpleTable dojo/_base/array dojo/query dijit/registry dojo/dom-class dijit/form/Select dojo/dom-construct dojo/_base/html dojo/on dojo/dom-attr".split(" "),function(q,r,t,u,v,w,e,x,k,g,m,h,y,n,z,p,l){return q([r,t,v],{templateString:w,baseClass:"jimu-widget-cost-analysis-layer-settings",_layerSettingsTable:null,constructor:function(a){e.mixin(this,
a)},postMixInProperties:function(){this.nls.common={};e.mixin(this.nls.common,window.jimuNls.common)},postCreate:function(){this.inherited(arguments);this._layerSettingsTable=null},setConfig:function(){this._filterLayers()},getConfig:function(){return this._getUpdateLayerSettings()},_getUpdateLayerSettings:function(){var a;if(this._layerSettingsTable)return a=this._layerSettingsTable.getData(),a=this._getSelectedFields(a)},_createlayerSettingsGrid:function(){this._layerSettingsTable=new x({fields:[{name:"title",
title:this.nls.layerSettings.layerNameHeaderTitle,type:"text",editable:!1,width:"44%"},{name:"fieldPicker",title:this.nls.layerSettings.fieldPickerHeaderTitle,type:"empty",editable:!1,width:"40%"},{name:"editable",title:this.nls.layerSettings.EditableLayerHeaderTitle,type:"checkbox",editable:!1,width:"16%"},{name:"selectable",title:this.nls.layerSettings.SelectableLayerHeaderTitle,type:"checkbox",editable:!1,hidden:!0,width:"16%"},{name:"id",title:"id",type:"text",editable:!1,hidden:!0,width:"0%"},
{name:"url",title:"url",type:"text",editable:!1,hidden:!0,width:"0%"}],selectable:!0});this._layerSettingsTable.placeAt(this.layerSettingsTableNode);z.setStyle(this._layerSettingsTable.domNode,{height:"100%"});this._layerSettingsTable.startup()},onLayerSettingChange:function(a){var b={};if(a=this._layerSettingsTable.getRowData(a))b.layerId=a.id,b.editable=null===a.editable?!1:a.editable;this.emit("onLayerSettingUpdate",b)},_filterLayers:function(){var a,b,c=[];a=this.map.itemInfo.itemData.operationalLayers;
0===a.length?h.remove(this.noAssetLayersAvailable,"esriCTHidden"):(h.add(this.noAssetLayersAvailable,"esriCTDisabled"),this._createlayerSettingsGrid(),this._setTableHeadTooltip(),c=[this.config.projectSettings.costingGeometryLayer||"",this.config.projectSettings.projectLayer||""],this.config&&0<this.config.layerSettings.length&&k.forEach(this.config.layerSettings,e.hitch(this,function(a){(b=this.map.getLayer(a.id))&&(!b.errors||0>=b.errors.length)&&(c.push(a.id),b.editable=this._checkEditCapabilities(b),
this._createFieldsRows(a,b.editable))})),k.forEach(a,e.hitch(this,function(a){(!a.errors||0>=a.errors.length)&&"ArcGISFeatureLayer"===a.layerType&&-1===c.indexOf(a.id)&&(a.selectable=!0,a.editable=this._checkEditCapabilities(a.layerObject),this._createFieldsRows(a,a.editable))})))},_checkEditCapabilities:function(a){return a&&a.capabilities&&-1!==a.capabilities.indexOf("Delete")&&-1!==a.capabilities.indexOf("Create")&&-1!==a.capabilities.indexOf("Update")&&a.globalIdField?!0:!1},_getInvalidLayersMsg:function(a){var b,
c=[];b="";a=this.layerInfosObj.getLayerInfoById(a).layerObject;a.capabilities?(-1===a.capabilities.indexOf("Create")&&c.push("Create"),-1===a.capabilities.indexOf("Update")&&c.push("Update"),-1===a.capabilities.indexOf("Delete")&&c.push("Delete")):c=["Create","Update","Delete"];0<c.length&&(b=this.nls.layerSettings.missingCapabilitiesMsg,b+="\x3cbr/\x3e",k.forEach(c,e.hitch(this,function(a){b+="\x3cli\x3e"+this.nls.layerSettings[a.toLowerCase()]+"\x3c/li\x3e"})));a.globalIdField||(b+="\x3cbr/\x3e",
b+=this.nls.layerSettings.missingGlobalIdMsg);return b},_enableDisableEditableCheckbox:function(a,b,c){var d,f;d=g(".simple-table-cell ",a)[2];d.children[0]&&(f=m.byNode(d.children[0]));c?(f.setStatus(!0),a.selectFields&&a.selectFields.set("disabled",!1)):(l.set(f.domNode,"title",this.nls.layerSettings.disableEditableCheckboxTooltip),f.setValue(!1),f.setStatus(!1),h.add(f.domNode,"jimu-float-leading"),a.selectFields&&a.selectFields.set("disabled",!0),a.errorDiv||(b=this._getInvalidLayersMsg(b.id),
a.errorDiv=n.create("div",{"class":"esriCTFieldError"},d),l.set(a.errorDiv,"errorMessage",b),a.errorSpan=n.create("span",{"class":"jimu-icon jimu-icon-error"},a.errorDiv),this.own(p(a.errorDiv,"click",e.hitch(this,function(a){a=l.get(a.currentTarget,"errorMessage");u({message:a})})))))},_createFieldsRows:function(a,b){var c,d,f;a.editable&&(a.selectable=a.editable);c=this._layerSettingsTable.addRow({title:a.title?a.title:a.name,editable:a.editable,selectable:a.selectable,id:a.id,url:a.url});d=g(".jimu-checkbox",
c.tr.children[2]);f=g(".jimu-checkbox",c.tr.children[3]);a.editable&&this._setCheckBoxState(d[0],f[0]);setTimeout(e.hitch(this,function(){this._setHeaderCheckBoxState()}),200);this.own(p(m.byNode(d[0]),"change",e.hitch(this,function(){this._setCheckBoxState(d[0],f[0]);this._setHeaderCheckBoxState();this.onLayerSettingChange(d[0].parentElement.parentElement)})));this._addFieldsDropDown(c.tr,a);this._enableDisableEditableCheckbox(c.tr,a,b)},_setCheckBoxState:function(a,b){a=m.byNode(a);b=m.byNode(b);
a.checked?(b.set("checked",!0),b.set("status",!1),b.set("disable",!0),h.add(b.domNode,"jimu-state-disabled")):(b.set("checked",!0),b.set("status",!0),b.set("disable",!1),h.remove(b.domNode,"jimu-state-disabled"));h.add(b.domNode.children[0],"checked")},_setHeaderCheckBoxState:function(){var a,b,c=!0,d;a=g(".simple-table-title .checkbox",this.domNode)[1];d=g(".simple-table-title .jimu-checkbox",this.domNode)[1];k.some(this._layerSettingsTable.getRows(),e.hitch(this,function(a){b=g("td.selectable .checked",
a);if(0===b.length)return c=!1,!0}));c?(h.add(a,"checked"),m.byNode(d).set("checked",!0)):(h.remove(a,"checked"),m.byNode(d).set("checked",!1))},updateLayerSettingsTable:function(a){var b=this._layerSettingsTable.getData(),c;a.lastSelectedId&&(c=this.layerInfosObj.getLayerInfoById(a.lastSelectedId).layerObject,c.editable=this._checkEditCapabilities(c),c.selectable=!0,this._createFieldsRows(c,c.editable));a.currentSelectedLayerId&&k.some(b,e.hitch(this,function(b,c){if(b.id===a.currentSelectedLayerId)return this._layerSettingsTable.deleteRow(this._layerSettingsTable.tbody.rows[c]),
!0}))},_addFieldsDropDown:function(a,b){var c,d;d=b.layerObject?b.layerObject:this.map._layers[b.id];if(c=g(".simple-table-cell",a)[1])c=n.create("div",{"class":"esriCTDropDownContainer"},c),a.selectFields=new y({options:this._getFieldsOptionsObj(d),"class":"esriCTLayerSettingsFieldsDropdown"}),a.selectFields.placeAt(c),a.selectFields.startup(),b.selectedField&&a.selectFields.set("value",b.selectedField)},_getFieldsOptionsObj:function(a){var b=[],c,d;d=a.fields;c=["esriFieldTypeString"];b.push({label:this.nls.layerSettings.selectLabel,
value:""});k.forEach(d,e.hitch(this,function(d){d.editable&&!d.domain&&-1<c.indexOf(d.type)&&37<d.length&&d.name!==a.typeIdField&&b.push({label:d.alias||d.name,value:d.name})}));return b},_getSelectedFields:function(a){var b;b=this._layerSettingsTable.getRows();k.forEach(b,e.hitch(this,function(b,d){b.selectFields&&(a[d].selectedField=b.selectFields.getValue(),null===a[d].editable&&(a[d].editable=!1),delete a[d].fieldPicker)}));return a},_setTableHeadTooltip:function(){var a;a=g(".simple-table-thead th",
this.domNode);a.length&&(l.set(a[0],"title",this.nls.layerSettings.layerNameHeaderTooltip),l.set(a[1],"title",this.nls.layerSettings.fieldPickerHeaderTooltip),l.set(a[2],"title",this.nls.layerSettings.EditableLayerHeaderTooltip),l.set(a[3],"title",this.nls.layerSettings.SelectableLayerHeaderTooltip))}})});