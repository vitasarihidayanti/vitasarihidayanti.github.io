// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/CostAnalysis/work-bench.html":'\x3cdiv style\x3d"height: 100%; width: 100%"\x3e\r\n  \x3cdiv class\x3d"esriCTContentSection"\x3e\r\n    \x3cdiv class\x3d"esriCTAddEditFeatureContainer" data-dojo-attach-point\x3d"templatePickerContainer"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTSelectFeatureToCopyParentContainer"\x3e\r\n      \x3cdiv class\x3d"esriCTSelectFeatureLabel"\x3e${nls.workBench.featureModeText}:\x3c/div\x3e\r\n      \x3cdiv class\x3d"esriCTSelectFeatureToCopyContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTSketchEnable esriCTFeatureModeIcons" data-dojo-attach-point\x3d"sketchButton" title\x3d"${nls.workBench.sketchToolTitle}"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTSelectDisable esriCTFeatureModeIcons" data-dojo-attach-point\x3d"selectButton" title\x3d"${nls.workBench.selectToolTitle}"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"projectOverview"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"esriCTPageFooter"\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"backButton"\x3e${nls.common.back}\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn esriCTEllipsis" data-dojo-attach-point\x3d"refreshButton"\x3e${nls.workBench.refresh}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare jimu/BaseWidget jimu/FilterManager dojo/Evented dijit/_WidgetsInTemplateMixin dojo/text!./work-bench.html dojo/_base/lang dojo/dom-attr dojo/_base/array dojo/dom-class dojo/on esri/graphic dojo/dom-construct dojo/Deferred dojo/promise/all esri/layers/FeatureLayer esri/tasks/GeometryService esri/graphicsUtils ./template-picker ./project-overview ./project-summary ./asset-details".split(" "),function(u,v,w,x,y,z,e,A,k,p,h,q,m,n,r,t,B,C,D,E,F,G){return u([v,x,y],{templateString:z,
baseClass:"jimu-widget-cost-analysis-work-bench",_projectOverview:null,_projectSummary:null,_assetItemSummary:{},_assetGroupSummary:{},_assetTableIds:{},_recentlyOperatedLayerIds:[],_projectAssetTable:null,_additionalCostTable:null,_assetInfoForReset:{},filterManager:null,postCreate:function(){this.inherited(arguments);this._assetItemSummary={};this._assetGroupSummary={};this._assetTableIds={};this._recentlyOperatedLayerIds=[];this._assetInfoForReset={};this.filterManager=w.getInstance()},onWidgetActive:function(){this._templatePicker&&
this._templatePicker.bindLayerEvents()},onWidgetDeActive:function(){this._templatePicker&&this._templatePicker._editor&&this._templatePicker._editor.editToolbar&&(this._templatePicker._editor.templatePicker.clearSelection(),this._templatePicker._editor.editToolbar.deactivate(),this._templatePicker.removeLayerEvents())},onShow:function(){this.refreshTemplatePicker()},onWidgetOpen:function(){this.refreshTemplatePicker();this.config.projectSettings.projectLayer||(this._recentlyOperatedLayerIds=[],this._filterAssets());
this._templatePicker&&!this._templatePicker._editor&&(this._disableWebMapPopup(),this._templatePicker.initEditingToolbar())},onWidgetClose:function(){this.config.projectSettings.projectLayer||this._clearAppliedFilters();this._templatePicker&&this._templatePicker._editor&&(this._templatePicker._editor.destroy(),this._templatePicker._editor=null,this._enableWebMapPopup())},refreshTemplatePicker:function(){if(this._templatePicker)this._templatePicker.onWindowResize()},startup:function(){this.inherited(arguments);
this.config.projectSettings.projectLayer?this.own(h(this.backButton,"click",e.hitch(this,function(){p.contains(this.backButton,"jimu-state-disabled")||(this._clearAppliedFilters(),this._templatePicker.destroy(),this._templatePicker=null,this._enableWebMapPopup(),this.emit("showProjectPanel"))}))):(A.set(this.refreshButton,"innerHTML",this.nls.common.reset),p.add(this.backButton,"esriCTHidden"));this.own(h(this.refreshButton,"click",e.hitch(this,function(){this._clearAppliedFilters();this._templatePicker&&
(this._templatePicker.destroy(),this._templatePicker=null);this.projectInfo.projectId&&this.config.projectSettings.projectLayer?this.emit("reloadProject",this.projectInfo.projectId):this._resetProject()})));this.onProjectCreateOrLoad(this.projectInfo,this.assetInfo)},_resetProject:function(){var b=[],a;this.loadingIndicator.show();if(this._assetInfoForReset&&0<Object.keys(this._assetInfoForReset).length)for(a in this._assetInfoForReset){var c,d;c=this.layerInfosObj.getLayerInfoById(a).layerObject;
d=c.globalIdField+" in ('"+this._assetInfoForReset[a].join("','")+"')";b.push(this.appUtils.deleteFeatures(c.url,d))}r(b).then(e.hitch(this,function(){this.loadingIndicator.hide();this._assetInfoForReset={};this.onProjectCreateOrLoad(this.projectInfo,this.assetInfo);this.emit("resetProject")}),e.hitch(this,function(){this.loadingIndicator.hide()}))},_clearAppliedFilters:function(){this.config.projectSettings.projectLayer&&this.filterManager.applyWidgetFilter(this.config.projectSettings.projectLayer,
this.widgetId,"",!0,!0);this._recentlyOperatedLayerIds=[];k.forEach(this.config.layerSettings,e.hitch(this,function(b){var a;a=this.layerInfosObj.getLayerInfoById(b.id);b.editable&&a&&a.layerObject&&a.layerObject.clearSelection()}));this._filterAssets(!0)},_loadProjectAssetTable:function(){var b=new n;if(this.config.projectSettings.assetTable&&!this._projectAssetTable){var a;a=this.layerInfosObj.getTableInfoById(this.config.projectSettings.assetTable).layerObject;this._projectAssetTable=new t(a.url);
this.own(h(this._projectAssetTable,"load",function(){b.resolve()}))}else b.resolve();return b.promise},_loadAdditionalCostTable:function(){var b,a;a=new n;(b=this.config.projectSettings.multiplierAdditionalCostTable)&&!this._additionalCostTable?(b=this.layerInfosObj.getTableInfoById(b).layerObject.url,this._additionalCostTable=new t(b),this.own(h(this._additionalCostTable,"load",function(){a.resolve()}))):a.resolve();return a.promise},onProjectCreateOrLoad:function(b,a){var c=[];c.push(this._loadProjectAssetTable());
c.push(this._loadAdditionalCostTable());r(c).then(e.hitch(this,function(){var c,g,f;this.projectInfo=b;this._recentlyOperatedLayerIds=[];this._assetTableIds={};this._assetItemSummary={};this._assetGroupSummary={};this._disableWebMapPopup();this.initWorkBenchComponents().then(e.hitch(this,function(){f=this.config.projectSettings.projectLayer;this.projectInfo.projectId&&f&&(g=this.layerInfosObj.getLayerInfoById(f).layerObject,c=g.globalIdField+"\x3d '"+this.projectInfo.projectId+"'",this.filterManager.applyWidgetFilter(f,
this.widgetId,c,!0,!0));this._projectOverview&&this._projectOverview.showAssetItemSummary(this._assetItemSummary,!1);this._assetDetails&&this._assetDetails.reset();a?this.loadProject(a):this._filterAssets()}))}))},loadProject:function(b){var a=[];this._projectSummary.loadingProject=!0;this._projectSummary.loadAdditionalCost(b.additionalCostInfo);for(var c in b.assetInfo){var d=b.assetInfo[c],g=this.layerInfosObj.getLayerInfoById(c).layerObject,a=a.concat(d);this._loadAsset(g,d,b,c)}this._setExtentToProjectAssets(a);
this._recentlyOperatedLayerIds=[];this._onAssetInfoUpdate();this._projectSummary.loadingProject=!1;this._projectSummary.calculateGrossCost(this._projectSummary.totalCost,!1)},_loadAsset:function(b,a,c,d){k.forEach(a,e.hitch(this,function(a){var g=a.attributes[b.globalIdField],e=c.assetTemplateInfo[g];a.templateInfo=e;a.templateName=e.TEMPLATENAME;this._templatePicker.loadCostingInfo(d,e);this._assetTableIds[g]=e.OBJECTID;this._onFeaturesAdded([a],b,[e],!1)}))},_setExtentToProjectAssets:function(b){0<
b.length&&this.map.setExtent(C.graphicsExtent(b).expand(1.5))},initWorkBenchComponents:function(){var b=new n;this._initTemplatePicker();this._initProjectSummary();this._initProjectOverview();this._initAssetDetails(b);return b.promise},_initTemplatePicker:function(){var b=m.create("div",{},this.templatePickerContainer);this._templatePicker=new D({config:this.config,nls:this.nls,layerInfosObj:this.layerInfosObj,loadingIndicator:this.loadingIndicator,projectInfo:this.projectInfo,map:this.map,selectFeaturesNode:this.copyFeaturesNode,
selectButton:this.selectButton,sketchButton:this.sketchButton,appUtils:this.appUtils,widgetId:this.widgetId},b);h(this._templatePicker,"assetAdded",e.hitch(this,function(a,b,d){0<a.length&&0<d.length&&(this._onFeaturesAdded(a,b,d,!0),this._onAssetInfoUpdate())}));h(this._templatePicker,"assetDeleted",e.hitch(this,function(a,b){var d;d=this._getGlobalIds(b.globalIdField,a);this._onFeaturesUpdated(a);this._onAssetInfoUpdate();k.forEach(d,e.hitch(this,function(a){this._assetTableIds.hasOwnProperty(a)&&
delete this._assetTableIds[a];this._assetInfoForReset&&this._assetInfoForReset[b.id]&&(a=this._assetInfoForReset[b.id].indexOf(a),-1<a&&this._assetInfoForReset[b.id].splice(a,1))}));this._projectAssetTable&&(a=this.config.assetTableFields.ASSETGUID+" in ('"+d.join("','")+"')",this.appUtils.deleteFeatures(this._projectAssetTable.url,a))}));h(this._templatePicker,"assetUpdated",e.hitch(this,function(a){this._onFeaturesUpdated(a,!0);this._onAssetInfoUpdate()}));this._templatePicker.startup()},_initProjectSummary:function(){this._projectSummary?
this._projectSummary.reset(this.projectInfo):(this._projectSummary=new F({nls:this.nls,map:this.map,config:this.config,appUtils:this.appUtils,layerInfosObj:this.layerInfosObj,projectInfo:this.projectInfo,additionalCostTable:this._additionalCostTable},m.create("div",{},this.projectSummaryDiv)),this.own(h(this._projectSummary,"grossCostUpdated",e.hitch(this,function(b,a,c){this._projectOverview.grossCostUpdated(a);this._assetDetails.grossCostUpdated(b,a,c)}))),this.own(h(this._projectSummary,"onOkButtonClicked",
e.hitch(this,function(){this.emit("showAssetDetails")}))),this.own(h(this._projectSummary,"onCancelButtonClicked",e.hitch(this,function(){this.emit("showAssetDetails")}))),this._projectSummary.startup())},_initProjectOverview:function(){this._projectOverview?this._projectOverview.updateProjectInfo(this.projectInfo):(this._projectOverview=new E({config:this.config,appUtils:this.appUtils,nls:this.nls,map:this.map,layerInfosObj:this.layerInfosObj,geometryService:new B(this.config.helperServices.geometry.url),
projectInfo:this.projectInfo},m.create("div",{},this.projectOverview)),this.own(h(this._projectOverview,"actionClicked",e.hitch(this,function(b){this.emit("actionClicked",b)}))),this.own(h(this._projectOverview,"titleClicked",e.hitch(this,function(b){this.emit("titleClicked",b)}))),this.own(h(this._projectOverview,"totalCostCalculated",e.hitch(this,function(b){this._assetDetails.totalCostUpdated(b);this._projectSummary.calculateGrossCost(b,!0)}))),this._projectOverview.startup())},_initAssetDetails:function(b){this._assetDetails?
(this._assetDetails.showAssetDetails({}),b.resolve()):(this._assetDetails=new G({nls:this.nls,map:this.map,config:this.config,appUtils:this.appUtils,layerInfosObj:this.layerInfosObj},m.create("div",{},this.assetDetailsDiv)),this.own(h(this._assetDetails,"showAdditionalCost",e.hitch(this,function(){this._projectSummary&&this._projectSummary.cloneTableData();this.emit("showAdditionalCost")}))),this.own(h(this._assetDetails,"onOkButtonClicked",e.hitch(this,function(){this.emit("showWorkBenchPanel")}))),
this.own(h(this._assetDetails,"onCancelButtonClicked",e.hitch(this,function(){this.emit("showWorkBenchPanel")}))),this.own(h(this._assetDetails,"onLoad",e.hitch(this,function(){b.resolve()}))),this.own(h(this._assetDetails,"groupCostEquationUpdated",e.hitch(this,this._updateGroupCostEquation))),this._assetDetails.startup())},_onAssetInfoUpdate:function(){this._projectOverview.showAssetItemSummary(this._assetItemSummary,!0);this._assetDetails.showAssetDetails(this._assetGroupSummary);this._filterAssets();
this.emit("assetInfoUpdated",this._assetItemSummary)},_addAssetGroupSummary:function(b,a,c){var d=c[0].TEMPLATENAME;this._assetGroupSummary.hasOwnProperty(a.id)?this._assetGroupSummary[a.id].hasOwnProperty(d)||(this._assetGroupSummary[a.id][d]={}):(this._assetGroupSummary[a.id]={},this._assetGroupSummary[a.id][d]={});k.forEach(b,e.hitch(this,function(b,f){f=c[f];f.SCENARIO===this.nls.scenarioSelection.noneText&&(f.SCENARIO="null");f.GEOGRAPHY===this.nls.scenarioSelection.noneText&&(f.GEOGRAPHY="null");
this._assetGroupSummary[a.id][d].hasOwnProperty(f.GEOGRAPHY)?this._assetGroupSummary[a.id][d][f.GEOGRAPHY].hasOwnProperty(f.SCENARIO)||(this._assetGroupSummary[a.id][d][f.GEOGRAPHY][f.SCENARIO]=[]):(this._assetGroupSummary[a.id][d][f.GEOGRAPHY]={},this._assetGroupSummary[a.id][d][f.GEOGRAPHY][f.SCENARIO]=[]);this._assetGroupSummary[a.id][d][f.GEOGRAPHY][f.SCENARIO].push(b)}))},_updateAssetGroupSummary:function(b,a,c){var d,g,f,l;g=a.templateInfo.TEMPLATENAME;f=a.templateInfo.GEOGRAPHY;l=a.templateInfo.SCENARIO;
d=a.attributes[b.objectIdField];f===this.nls.scenarioSelection.noneText&&(f="null");l===this.nls.scenarioSelection.noneText&&(l="null");k.some(this._assetGroupSummary[b.id][g][f][l],e.hitch(this,function(e,k){if(e.attributes[b.objectIdField]===d)return c?this._assetGroupSummary[b.id][g][f][l][k].featureDimension=a.featureDimension:this._assetGroupSummary[b.id][g][f][l].splice(k,1),!0}))},_onFeaturesAdded:function(b,a,c,d){var g,f=[];g=c[0].TEMPLATENAME;f=this._getGlobalIds(a.globalIdField,b);this._addAssetGroupSummary(b,
a,c);this._assetItemSummary.hasOwnProperty(a.id)?this._assetItemSummary[a.id].templates.hasOwnProperty(g)?(b=this._assetItemSummary[a.id].templates[g].features.concat(b),this._assetItemSummary[a.id].templates[g].units=b.length):this._assetItemSummary[a.id].templates[g]={units:b.length,features:b,cost:null}:(this._assetItemSummary[a.id]={layerName:a.name,templates:{},geometryType:a.geometryType},this._assetItemSummary[a.id].templates[g]={units:b.length,features:b,cost:null});this._recentlyOperatedLayerIds=
[a.id];this._setFeaturesAndUnits(b,a,g);this._assetItemSummary[a.id].templates[g].cost=this._getTotalCost(a,g);d&&this._projectAssetTable?this._addAssetsToProjectAssetTable(c,f):(this._assetInfoForReset||(this._assetInfoForReset={}),this._assetInfoForReset[a.id]=this._assetInfoForReset[a.id]?this._assetInfoForReset[a.id].concat(f):e.clone(f))},_updateFeaturesInfo:function(b){var a;k.forEach(b,e.hitch(this,function(b){var d;d=b._layer;for(a in this._assetItemSummary[d.id].templates)this._setUpdatedTemplateFeatures(b,
d,a)}));return b},_setUpdatedTemplateFeatures:function(b,a,c){k.some(this._assetItemSummary[a.id].templates[c].features,e.hitch(this,function(d){if(d.attributes[a.objectIdField]===b.attributes[a.objectIdField])return b.featureDimension=d.featureDimension,b.templateName=c,b.templateInfo=d.templateInfo,!0}))},_onFeaturesUpdated:function(b,a){b=this._updateFeaturesInfo(b);this._recentlyOperatedLayerIds=[];k.forEach(b,e.hitch(this,function(b){var d,c;c=b.templateName;d=b._layer;this._recentlyOperatedLayerIds.push(d.id);
k.some(this._assetItemSummary[d.id].templates[c].features,e.hitch(this,function(f,e){if(f.attributes[d.objectIdField]===b.attributes[d.objectIdField])return this._assetItemSummary.hasOwnProperty(d.id)&&this._assetItemSummary[d.id].templates[c]&&(a?(this._assetItemSummary[d.id].templates[c].features[e]=b,this._setFeaturesAndUnits(this._assetItemSummary[d.id].templates[c].features,d,c,a)):(f=this._assetItemSummary[d.id].templates[c].units,f-=b.featureDimension,this._assetItemSummary[d.id].templates[c].units=
this.appUtils.removeNegativeExponents(f)),this._updateAssetGroupSummary(d,b,a)),a||this._assetItemSummary[d.id].templates[c].features.splice(e,1),!0}));0===this._assetItemSummary[d.id].templates[c].features.length?delete this._assetItemSummary[d.id].templates[c]:this._assetItemSummary[d.id].templates[c].cost=this._getTotalCost(d,c);0===Object.keys(this._assetItemSummary[d.id].templates).length&&delete this._assetItemSummary[d.id]}))},_setFeaturesAndUnits:function(b,a,c,d){var g,f=0;g=this.config.generalSettings.measurementUnit;
k.forEach(b,e.hitch(this,function(b){if(!b.hasOwnProperty("featureDimension")||d)b.featureDimension="esriGeometryPolygon"===a.geometryType?this.appUtils.getAreaOfGeometry(b.geometry,this.appUtils.units[g].areaUnit):"esriGeometryPolyline"===a.geometryType?this.appUtils.getLengthOfGeometry(b.geometry,this.appUtils.units[g].lengthUnit):1,d||(b.templateName=c);f+=b.featureDimension}));this._assetItemSummary[a.id].templates[c].features=b;return this._assetItemSummary[a.id].templates[c].units=f},_getGroupTotalMeasure:function(b,
a){var c,d,g,f;c=0;g=a.TEMPLATENAME;f=a.GEOGRAPHY;a=a.SCENARIO;try{d=this._assetGroupSummary[b][g][f][a],k.forEach(d,e.hitch(this,function(b){c+=b.featureDimension}))}catch(l){c=0}return c},_getGroupTotalCount:function(b,a){var c,d,e,f;c=0;e=a.TEMPLATENAME;f=a.GEOGRAPHY;a=a.SCENARIO;try{(d=this._assetGroupSummary[b][e][f][a])&&0<d.length&&(c=d.length)}catch(l){c=0}return c},_getTotalCost:function(b,a){var c=0;k.forEach(this._assetItemSummary[b.id].templates[a].features,e.hitch(this,function(d){var g,
f,l,h;l=this._getGroupTotalMeasure(b.id,d.templateInfo);h=this._getGroupTotalCount(b.id,d.templateInfo);try{f=d.templateInfo.COSTEQUATION,f=f.replace(/{MEASURE}/ig,d.featureDimension),f=f.replace(/{TOTALMEASURE}/ig,l),f=f.replace(/{TOTALCOUNT}/ig,h),g=this.appUtils.evaluate(f)}catch(H){g=0}k.some(this._assetGroupSummary[b.id][a][d.templateInfo.GEOGRAPHY][d.templateInfo.SCENARIO],e.hitch(this,function(a){if(a.attributes[b.objectIdField]===d.attributes[b.objectIdField])return a.individualCost=g,!0}));
d.individualCost=g;c+=g}));return Number(c)},_getGlobalIds:function(b,a){var c=[];k.forEach(a,e.hitch(this,function(a){c.push(a.attributes[b])}));return c},_getExpressionToFilterAssets:function(b){var a,c=[],d,e;if((e=this.layerInfosObj.getLayerInfoById(b))&&e.layerObject&&this._assetItemSummary[b])for(a in d=e.layerObject,this._assetItemSummary[b].templates)c=c.concat(this._getGlobalIds(d.globalIdField,this._assetItemSummary[b].templates[a].features));return 0<c.length?d.globalIdField+" in ('"+c.join("','")+
"')":"1\x3d2"},_filterAssets:function(b){this._recentlyOperatedLayerIds&&0!==this._recentlyOperatedLayerIds.length||(this._recentlyOperatedLayerIds=[],k.forEach(this.config.layerSettings,e.hitch(this,function(a){a.editable&&this._recentlyOperatedLayerIds.push(a.id)})));k.forEach(this._recentlyOperatedLayerIds,e.hitch(this,function(a){var c="";b||(c=this._getExpressionToFilterAssets(a));this.filterManager.applyWidgetFilter(a,this.widgetId,c,!0,!0)}))},_addAssetsToProjectAssetTable:function(b,a){var c=
[],d=["COSTEQUATION","SCENARIO","TEMPLATENAME","GEOGRAPHYGUID"];this.loadingIndicator.show();k.forEach(a,e.hitch(this,function(a,f){var g={};k.forEach(this._projectAssetTable.fields,e.hitch(this,function(c){var e="";-1<d.indexOf(c.name.toUpperCase())?(e=b[f][c.name.toUpperCase()],"SCENARIO"!==c.name.toUpperCase()&&"GEOGRAPHYGUID"!==c.name.toUpperCase()||"null"!==e||(e=null),g[c.name]=e):"ASSETGUID"===c.name.toUpperCase()?g[c.name]=a:"PROJECTGUID"===c.name.toUpperCase()&&this.projectInfo.projectId&&
(g[c.name]=this.projectInfo.projectId)}));c.push(new q(null,null,g))}));this._projectAssetTable.applyEdits(c,null,null,e.hitch(this,function(b){var c=!1;k.forEach(b,e.hitch(this,function(b,d){b.success?this._assetTableIds[a[d]]=b.objectId:c=!0}));c&&this.appUtils.showMessage(this.nls.workBench.errorInSavingAssetDetails);this.loadingIndicator.hide()}),e.hitch(this,function(){this.loadingIndicator.hide();this.appUtils.showMessage(this.nls.workBench.errorInSavingAssetDetails)}))},_updateGroupCostEquation:function(b){var a=
[],c,d,g;c=b.groupInfo;d=this._assetGroupSummary[c.layerId][c.templateName][c.region][c.scenario];g=this.layerInfosObj.getLayerInfoById(c.layerId).layerObject;k.forEach(d,e.hitch(this,function(d){var f={},h,m;h=d.attributes[g.globalIdField];m=d.attributes[g.objectIdField];k.some(this._assetItemSummary[c.layerId].templates[c.templateName].features,e.hitch(this,function(a){if(a.attributes[g.objectIdField]===m)return a.templateInfo.COSTEQUATION=b.templateInfo.COSTEQUATION,a.templateInfo.SCENARIO=b.templateInfo.SCENARIO,
!0}));d.templateInfo.COSTEQUATION=b.templateInfo.COSTEQUATION;d.templateInfo.SCENARIO=b.templateInfo.SCENARIO;this._projectAssetTable&&this._assetTableIds[h]&&(f[this.config.assetTableFields.COSTEQUATION]=b.templateInfo.COSTEQUATION,f[this.config.assetTableFields.SCENARIO]="null"===b.templateInfo.SCENARIO?null:b.templateInfo.SCENARIO,f[this.config.assetTableFields.OBJECTID]=this._assetTableIds[h],a.push(new q(null,null,f)))}));delete this._assetGroupSummary[c.layerId][c.templateName][c.region][c.scenario];
this._assetGroupSummary[c.layerId][c.templateName][c.region][b.templateInfo.SCENARIO]=d;this._templatePicker.loadCostingInfo(g.id,d[0].templateInfo);this._assetItemSummary[g.id].templates[c.templateName].cost=this._getTotalCost(g,c.templateName);this._projectOverview.showAssetItemSummary(this._assetItemSummary,!1);this._assetDetails.showAssetDetails(this._assetGroupSummary);this._projectAssetTable&&(this.loadingIndicator.show(),this._projectAssetTable.applyEdits(null,a,null,e.hitch(this,function(){this.loadingIndicator.hide()}),
e.hitch(this,function(){this.loadingIndicator.hide()})))},_enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},_disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1);this._hideWebMapPopup()},_hideWebMapPopup:function(){this.map.infoWindow.isShowing&&this.map.infoWindow.hide();this.map.infoWindow.clearFeatures()}})});